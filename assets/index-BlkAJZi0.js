(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();var ws=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(ws||{}),ju=(i=>(i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS",i))(ju||{}),go=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(go||{}),Be=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(Be||{}),gr=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(gr||{}),de=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(de||{}),$s=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))($s||{}),Fe=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(Fe||{}),we=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(we||{}),Rr=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(Rr||{}),Zr=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(Zr||{}),br=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(br||{}),Rt=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(Rt||{}),fr=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(fr||{}),eh=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(eh||{}),Ht=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(Ht||{}),ft=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(ft||{}),dt=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(dt||{}),mr=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(mr||{});const bp={createCanvas:(i,e)=>{const t=document.createElement("canvas");return t.width=i,t.height=e,t},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,e)=>fetch(i,e),parseXML:i=>new DOMParser().parseFromString(i,"text/xml")},Se={ADAPTER:bp,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Xn=/iPhone/i,Ch=/iPod/i,Ph=/iPad/i,Ih=/\biOS-universal(?:.+)Mac\b/i,Kn=/\bAndroid(?:.+)Mobile\b/i,Rh=/Android/i,Os=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Di=/Silk/i,Cr=/Windows Phone/i,Mh=/\bWindows(?:.+)ARM\b/i,Oh=/BlackBerry/i,kh=/BB10/i,Nh=/Opera Mini/i,Dh=/\b(CriOS|Chrome)(?:.+)Mobile/i,Fh=/Mobile(?:.+)Firefox\b/i,Bh=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function _p(i){return function(e){return e.test(i)}}function Lh(i){var e={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?e.userAgent=i:i&&i.userAgent&&(e={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var t=e.userAgent,r=t.split("[FBAN");typeof r[1]<"u"&&(t=r[0]),r=t.split("Twitter"),typeof r[1]<"u"&&(t=r[0]);var n=_p(t),a={apple:{phone:n(Xn)&&!n(Cr),ipod:n(Ch),tablet:!n(Xn)&&(n(Ph)||Bh(e))&&!n(Cr),universal:n(Ih),device:(n(Xn)||n(Ch)||n(Ph)||n(Ih)||Bh(e))&&!n(Cr)},amazon:{phone:n(Os),tablet:!n(Os)&&n(Di),device:n(Os)||n(Di)},android:{phone:!n(Cr)&&n(Os)||!n(Cr)&&n(Kn),tablet:!n(Cr)&&!n(Os)&&!n(Kn)&&(n(Di)||n(Rh)),device:!n(Cr)&&(n(Os)||n(Di)||n(Kn)||n(Rh))||n(/\bokhttp\b/i)},windows:{phone:n(Cr),tablet:n(Mh),device:n(Cr)||n(Mh)},other:{blackberry:n(Oh),blackberry10:n(kh),opera:n(Nh),firefox:n(Fh),chrome:n(Dh),device:n(Oh)||n(kh)||n(Nh)||n(Fh)||n(Dh)},any:!1,phone:!1,tablet:!1};return a.any=a.apple.device||a.android.device||a.windows.device||a.other.device,a.phone=a.apple.phone||a.android.phone||a.windows.phone,a.tablet=a.apple.tablet||a.android.tablet||a.windows.tablet,a}const xp=Lh.default??Lh,Mr=xp(globalThis.navigator);Se.RETINA_PREFIX=/@([0-9\.]+)x/;Se.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Ys=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function th(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Ep(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var e=i.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var n=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return i[r]}})}),t}var Yn={exports:{}},Uh;function wp(){return Uh||(Uh=1,function(i){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function n(c,d,g){this.fn=c,this.context=d,this.once=g||!1}function a(c,d,g,v,b){if(typeof g!="function")throw new TypeError("The listener must be a function");var y=new n(g,v||c,b),x=t?t+d:d;return c._events[x]?c._events[x].fn?c._events[x]=[c._events[x],y]:c._events[x].push(y):(c._events[x]=y,c._eventsCount++),c}function h(c,d){--c._eventsCount===0?c._events=new r:delete c._events[d]}function l(){this._events=new r,this._eventsCount=0}l.prototype.eventNames=function(){var d=[],g,v;if(this._eventsCount===0)return d;for(v in g=this._events)e.call(g,v)&&d.push(t?v.slice(1):v);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(g)):d},l.prototype.listeners=function(d){var g=t?t+d:d,v=this._events[g];if(!v)return[];if(v.fn)return[v.fn];for(var b=0,y=v.length,x=new Array(y);b<y;b++)x[b]=v[b].fn;return x},l.prototype.listenerCount=function(d){var g=t?t+d:d,v=this._events[g];return v?v.fn?1:v.length:0},l.prototype.emit=function(d,g,v,b,y,x){var S=t?t+d:d;if(!this._events[S])return!1;var w=this._events[S],T=arguments.length,N,M;if(w.fn){switch(w.once&&this.removeListener(d,w.fn,void 0,!0),T){case 1:return w.fn.call(w.context),!0;case 2:return w.fn.call(w.context,g),!0;case 3:return w.fn.call(w.context,g,v),!0;case 4:return w.fn.call(w.context,g,v,b),!0;case 5:return w.fn.call(w.context,g,v,b,y),!0;case 6:return w.fn.call(w.context,g,v,b,y,x),!0}for(M=1,N=new Array(T-1);M<T;M++)N[M-1]=arguments[M];w.fn.apply(w.context,N)}else{var F=w.length,O;for(M=0;M<F;M++)switch(w[M].once&&this.removeListener(d,w[M].fn,void 0,!0),T){case 1:w[M].fn.call(w[M].context);break;case 2:w[M].fn.call(w[M].context,g);break;case 3:w[M].fn.call(w[M].context,g,v);break;case 4:w[M].fn.call(w[M].context,g,v,b);break;default:if(!N)for(O=1,N=new Array(T-1);O<T;O++)N[O-1]=arguments[O];w[M].fn.apply(w[M].context,N)}}return!0},l.prototype.on=function(d,g,v){return a(this,d,g,v,!1)},l.prototype.once=function(d,g,v){return a(this,d,g,v,!0)},l.prototype.removeListener=function(d,g,v,b){var y=t?t+d:d;if(!this._events[y])return this;if(!g)return h(this,y),this;var x=this._events[y];if(x.fn)x.fn===g&&(!b||x.once)&&(!v||x.context===v)&&h(this,y);else{for(var S=0,w=[],T=x.length;S<T;S++)(x[S].fn!==g||b&&!x[S].once||v&&x[S].context!==v)&&w.push(x[S]);w.length?this._events[y]=w.length===1?w[0]:w:h(this,y)}return this},l.prototype.removeAllListeners=function(d){var g;return d?(g=t?t+d:d,this._events[g]&&h(this,g)):(this._events=new r,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,i.exports=l}(Yn)),Yn.exports}var Sp=wp();const Ci=th(Sp);var Fi={exports:{}},Gh;function Tp(){if(Gh)return Fi.exports;Gh=1,Fi.exports=i,Fi.exports.default=i;function i(R,k,P){P=P||2;var q=k&&k.length,U=q?k[0]*P:R.length,D=e(R,0,U,P,!0),Z=[];if(!D||D.next===D.prev)return Z;var Y,ie,ue,_e,Ee,Ce,De;if(q&&(D=c(R,k,D,P)),R.length>80*P){Y=ue=R[0],ie=_e=R[1];for(var ce=P;ce<U;ce+=P)Ee=R[ce],Ce=R[ce+1],Ee<Y&&(Y=Ee),Ce<ie&&(ie=Ce),Ee>ue&&(ue=Ee),Ce>_e&&(_e=Ce);De=Math.max(ue-Y,_e-ie),De=De!==0?32767/De:0}return r(D,Z,P,Y,ie,De,0),Z}function e(R,k,P,q,U){var D,Z;if(U===oe(R,k,P,q)>0)for(D=k;D<P;D+=q)Z=H(D,R[D],R[D+1],Z);else for(D=P-q;D>=k;D-=q)Z=H(D,R[D],R[D+1],Z);return Z&&F(Z,Z.next)&&(K(Z),Z=Z.next),Z}function t(R,k){if(!R)return R;k||(k=R);var P=R,q;do if(q=!1,!P.steiner&&(F(P,P.next)||M(P.prev,P,P.next)===0)){if(K(P),P=k=P.prev,P===P.next)break;q=!0}else P=P.next;while(q||P!==k);return k}function r(R,k,P,q,U,D,Z){if(R){!Z&&D&&y(R,q,U,D);for(var Y=R,ie,ue;R.prev!==R.next;){if(ie=R.prev,ue=R.next,D?a(R,q,U,D):n(R)){k.push(ie.i/P|0),k.push(R.i/P|0),k.push(ue.i/P|0),K(R),R=ue.next,Y=ue.next;continue}if(R=ue,R===Y){Z?Z===1?(R=h(t(R),k,P),r(R,k,P,q,U,D,2)):Z===2&&l(R,k,P,q,U,D):r(t(R),k,P,q,U,D,1);break}}}}function n(R){var k=R.prev,P=R,q=R.next;if(M(k,P,q)>=0)return!1;for(var U=k.x,D=P.x,Z=q.x,Y=k.y,ie=P.y,ue=q.y,_e=U<D?U<Z?U:Z:D<Z?D:Z,Ee=Y<ie?Y<ue?Y:ue:ie<ue?ie:ue,Ce=U>D?U>Z?U:Z:D>Z?D:Z,De=Y>ie?Y>ue?Y:ue:ie>ue?ie:ue,ce=q.next;ce!==k;){if(ce.x>=_e&&ce.x<=Ce&&ce.y>=Ee&&ce.y<=De&&T(U,Y,D,ie,Z,ue,ce.x,ce.y)&&M(ce.prev,ce,ce.next)>=0)return!1;ce=ce.next}return!0}function a(R,k,P,q){var U=R.prev,D=R,Z=R.next;if(M(U,D,Z)>=0)return!1;for(var Y=U.x,ie=D.x,ue=Z.x,_e=U.y,Ee=D.y,Ce=Z.y,De=Y<ie?Y<ue?Y:ue:ie<ue?ie:ue,ce=_e<Ee?_e<Ce?_e:Ce:Ee<Ce?Ee:Ce,Pe=Y>ie?Y>ue?Y:ue:ie>ue?ie:ue,ge=_e>Ee?_e>Ce?_e:Ce:Ee>Ce?Ee:Ce,fe=S(De,ce,k,P,q),Ue=S(Pe,ge,k,P,q),Ie=R.prevZ,Oe=R.nextZ;Ie&&Ie.z>=fe&&Oe&&Oe.z<=Ue;){if(Ie.x>=De&&Ie.x<=Pe&&Ie.y>=ce&&Ie.y<=ge&&Ie!==U&&Ie!==Z&&T(Y,_e,ie,Ee,ue,Ce,Ie.x,Ie.y)&&M(Ie.prev,Ie,Ie.next)>=0||(Ie=Ie.prevZ,Oe.x>=De&&Oe.x<=Pe&&Oe.y>=ce&&Oe.y<=ge&&Oe!==U&&Oe!==Z&&T(Y,_e,ie,Ee,ue,Ce,Oe.x,Oe.y)&&M(Oe.prev,Oe,Oe.next)>=0))return!1;Oe=Oe.nextZ}for(;Ie&&Ie.z>=fe;){if(Ie.x>=De&&Ie.x<=Pe&&Ie.y>=ce&&Ie.y<=ge&&Ie!==U&&Ie!==Z&&T(Y,_e,ie,Ee,ue,Ce,Ie.x,Ie.y)&&M(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.prevZ}for(;Oe&&Oe.z<=Ue;){if(Oe.x>=De&&Oe.x<=Pe&&Oe.y>=ce&&Oe.y<=ge&&Oe!==U&&Oe!==Z&&T(Y,_e,ie,Ee,ue,Ce,Oe.x,Oe.y)&&M(Oe.prev,Oe,Oe.next)>=0)return!1;Oe=Oe.nextZ}return!0}function h(R,k,P){var q=R;do{var U=q.prev,D=q.next.next;!F(U,D)&&O(U,q,q.next,D)&&se(U,D)&&se(D,U)&&(k.push(U.i/P|0),k.push(q.i/P|0),k.push(D.i/P|0),K(q),K(q.next),q=R=D),q=q.next}while(q!==R);return t(q)}function l(R,k,P,q,U,D){var Z=R;do{for(var Y=Z.next.next;Y!==Z.prev;){if(Z.i!==Y.i&&N(Z,Y)){var ie=ve(Z,Y);Z=t(Z,Z.next),ie=t(ie,ie.next),r(Z,k,P,q,U,D,0),r(ie,k,P,q,U,D,0);return}Y=Y.next}Z=Z.next}while(Z!==R)}function c(R,k,P,q){var U=[],D,Z,Y,ie,ue;for(D=0,Z=k.length;D<Z;D++)Y=k[D]*q,ie=D<Z-1?k[D+1]*q:R.length,ue=e(R,Y,ie,q,!1),ue===ue.next&&(ue.steiner=!0),U.push(w(ue));for(U.sort(d),D=0;D<U.length;D++)P=g(U[D],P);return P}function d(R,k){return R.x-k.x}function g(R,k){var P=v(R,k);if(!P)return k;var q=ve(P,R);return t(q,q.next),t(P,P.next)}function v(R,k){var P=k,q=R.x,U=R.y,D=-1/0,Z;do{if(U<=P.y&&U>=P.next.y&&P.next.y!==P.y){var Y=P.x+(U-P.y)*(P.next.x-P.x)/(P.next.y-P.y);if(Y<=q&&Y>D&&(D=Y,Z=P.x<P.next.x?P:P.next,Y===q))return Z}P=P.next}while(P!==k);if(!Z)return null;var ie=Z,ue=Z.x,_e=Z.y,Ee=1/0,Ce;P=Z;do q>=P.x&&P.x>=ue&&q!==P.x&&T(U<_e?q:D,U,ue,_e,U<_e?D:q,U,P.x,P.y)&&(Ce=Math.abs(U-P.y)/(q-P.x),se(P,R)&&(Ce<Ee||Ce===Ee&&(P.x>Z.x||P.x===Z.x&&b(Z,P)))&&(Z=P,Ee=Ce)),P=P.next;while(P!==ie);return Z}function b(R,k){return M(R.prev,R,k.prev)<0&&M(k.next,R,R.next)<0}function y(R,k,P,q){var U=R;do U.z===0&&(U.z=S(U.x,U.y,k,P,q)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==R);U.prevZ.nextZ=null,U.prevZ=null,x(U)}function x(R){var k,P,q,U,D,Z,Y,ie,ue=1;do{for(P=R,R=null,D=null,Z=0;P;){for(Z++,q=P,Y=0,k=0;k<ue&&(Y++,q=q.nextZ,!!q);k++);for(ie=ue;Y>0||ie>0&&q;)Y!==0&&(ie===0||!q||P.z<=q.z)?(U=P,P=P.nextZ,Y--):(U=q,q=q.nextZ,ie--),D?D.nextZ=U:R=U,U.prevZ=D,D=U;P=q}D.nextZ=null,ue*=2}while(Z>1);return R}function S(R,k,P,q,U){return R=(R-P)*U|0,k=(k-q)*U|0,R=(R|R<<8)&16711935,R=(R|R<<4)&252645135,R=(R|R<<2)&858993459,R=(R|R<<1)&1431655765,k=(k|k<<8)&16711935,k=(k|k<<4)&252645135,k=(k|k<<2)&858993459,k=(k|k<<1)&1431655765,R|k<<1}function w(R){var k=R,P=R;do(k.x<P.x||k.x===P.x&&k.y<P.y)&&(P=k),k=k.next;while(k!==R);return P}function T(R,k,P,q,U,D,Z,Y){return(U-Z)*(k-Y)>=(R-Z)*(D-Y)&&(R-Z)*(q-Y)>=(P-Z)*(k-Y)&&(P-Z)*(D-Y)>=(U-Z)*(q-Y)}function N(R,k){return R.next.i!==k.i&&R.prev.i!==k.i&&!V(R,k)&&(se(R,k)&&se(k,R)&&ae(R,k)&&(M(R.prev,R,k.prev)||M(R,k.prev,k))||F(R,k)&&M(R.prev,R,R.next)>0&&M(k.prev,k,k.next)>0)}function M(R,k,P){return(k.y-R.y)*(P.x-k.x)-(k.x-R.x)*(P.y-k.y)}function F(R,k){return R.x===k.x&&R.y===k.y}function O(R,k,P,q){var U=C(M(R,k,P)),D=C(M(R,k,q)),Z=C(M(P,q,R)),Y=C(M(P,q,k));return!!(U!==D&&Z!==Y||U===0&&J(R,P,k)||D===0&&J(R,q,k)||Z===0&&J(P,R,q)||Y===0&&J(P,k,q))}function J(R,k,P){return k.x<=Math.max(R.x,P.x)&&k.x>=Math.min(R.x,P.x)&&k.y<=Math.max(R.y,P.y)&&k.y>=Math.min(R.y,P.y)}function C(R){return R>0?1:R<0?-1:0}function V(R,k){var P=R;do{if(P.i!==R.i&&P.next.i!==R.i&&P.i!==k.i&&P.next.i!==k.i&&O(P,P.next,R,k))return!0;P=P.next}while(P!==R);return!1}function se(R,k){return M(R.prev,R,R.next)<0?M(R,k,R.next)>=0&&M(R,R.prev,k)>=0:M(R,k,R.prev)<0||M(R,R.next,k)<0}function ae(R,k){var P=R,q=!1,U=(R.x+k.x)/2,D=(R.y+k.y)/2;do P.y>D!=P.next.y>D&&P.next.y!==P.y&&U<(P.next.x-P.x)*(D-P.y)/(P.next.y-P.y)+P.x&&(q=!q),P=P.next;while(P!==R);return q}function ve(R,k){var P=new re(R.i,R.x,R.y),q=new re(k.i,k.x,k.y),U=R.next,D=k.prev;return R.next=k,k.prev=R,P.next=U,U.prev=P,q.next=P,P.prev=q,D.next=q,q.prev=D,q}function H(R,k,P,q){var U=new re(R,k,P);return q?(U.next=q.next,U.prev=q,q.next.prev=U,q.next=U):(U.prev=U,U.next=U),U}function K(R){R.next.prev=R.prev,R.prev.next=R.next,R.prevZ&&(R.prevZ.nextZ=R.nextZ),R.nextZ&&(R.nextZ.prevZ=R.prevZ)}function re(R,k,P){this.i=R,this.x=k,this.y=P,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}i.deviation=function(R,k,P,q){var U=k&&k.length,D=U?k[0]*P:R.length,Z=Math.abs(oe(R,0,D,P));if(U)for(var Y=0,ie=k.length;Y<ie;Y++){var ue=k[Y]*P,_e=Y<ie-1?k[Y+1]*P:R.length;Z-=Math.abs(oe(R,ue,_e,P))}var Ee=0;for(Y=0;Y<q.length;Y+=3){var Ce=q[Y]*P,De=q[Y+1]*P,ce=q[Y+2]*P;Ee+=Math.abs((R[Ce]-R[ce])*(R[De+1]-R[Ce+1])-(R[Ce]-R[De])*(R[ce+1]-R[Ce+1]))}return Z===0&&Ee===0?0:Math.abs((Ee-Z)/Z)};function oe(R,k,P,q){for(var U=0,D=k,Z=P-q;D<P;D+=q)U+=(R[Z]-R[D])*(R[D+1]+R[Z+1]),Z=D;return U}return i.flatten=function(R){for(var k=R[0][0].length,P={vertices:[],holes:[],dimensions:k},q=0,U=0;U<R.length;U++){for(var D=0;D<R[U].length;D++)for(var Z=0;Z<k;Z++)P.vertices.push(R[U][D][Z]);U>0&&(q+=R[U-1].length,P.holes.push(q))}return P},Fi.exports}var Ap=Tp();const Cp=th(Ap);var os={},gi={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */var Pp=gi.exports,jh;function Ip(){return jh||(jh=1,function(i,e){(function(t){var r=e&&!e.nodeType&&e,n=i&&!i.nodeType&&i,a=typeof Ys=="object"&&Ys;(a.global===a||a.window===a||a.self===a)&&(t=a);var h,l=2147483647,c=36,d=1,g=26,v=38,b=700,y=72,x=128,S="-",w=/^xn--/,T=/[^\x20-\x7E]/,N=/[\x2E\u3002\uFF0E\uFF61]/g,M={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},F=c-d,O=Math.floor,J=String.fromCharCode,C;function V(U){throw new RangeError(M[U])}function se(U,D){for(var Z=U.length,Y=[];Z--;)Y[Z]=D(U[Z]);return Y}function ae(U,D){var Z=U.split("@"),Y="";Z.length>1&&(Y=Z[0]+"@",U=Z[1]),U=U.replace(N,".");var ie=U.split("."),ue=se(ie,D).join(".");return Y+ue}function ve(U){for(var D=[],Z=0,Y=U.length,ie,ue;Z<Y;)ie=U.charCodeAt(Z++),ie>=55296&&ie<=56319&&Z<Y?(ue=U.charCodeAt(Z++),(ue&64512)==56320?D.push(((ie&1023)<<10)+(ue&1023)+65536):(D.push(ie),Z--)):D.push(ie);return D}function H(U){return se(U,function(D){var Z="";return D>65535&&(D-=65536,Z+=J(D>>>10&1023|55296),D=56320|D&1023),Z+=J(D),Z}).join("")}function K(U){return U-48<10?U-22:U-65<26?U-65:U-97<26?U-97:c}function re(U,D){return U+22+75*(U<26)-((D!=0)<<5)}function oe(U,D,Z){var Y=0;for(U=Z?O(U/b):U>>1,U+=O(U/D);U>F*g>>1;Y+=c)U=O(U/F);return O(Y+(F+1)*U/(U+v))}function R(U){var D=[],Z=U.length,Y,ie=0,ue=x,_e=y,Ee,Ce,De,ce,Pe,ge,fe,Ue,Ie;for(Ee=U.lastIndexOf(S),Ee<0&&(Ee=0),Ce=0;Ce<Ee;++Ce)U.charCodeAt(Ce)>=128&&V("not-basic"),D.push(U.charCodeAt(Ce));for(De=Ee>0?Ee+1:0;De<Z;){for(ce=ie,Pe=1,ge=c;De>=Z&&V("invalid-input"),fe=K(U.charCodeAt(De++)),(fe>=c||fe>O((l-ie)/Pe))&&V("overflow"),ie+=fe*Pe,Ue=ge<=_e?d:ge>=_e+g?g:ge-_e,!(fe<Ue);ge+=c)Ie=c-Ue,Pe>O(l/Ie)&&V("overflow"),Pe*=Ie;Y=D.length+1,_e=oe(ie-ce,Y,ce==0),O(ie/Y)>l-ue&&V("overflow"),ue+=O(ie/Y),ie%=Y,D.splice(ie++,0,ue)}return H(D)}function k(U){var D,Z,Y,ie,ue,_e,Ee,Ce,De,ce,Pe,ge=[],fe,Ue,Ie,Oe;for(U=ve(U),fe=U.length,D=x,Z=0,ue=y,_e=0;_e<fe;++_e)Pe=U[_e],Pe<128&&ge.push(J(Pe));for(Y=ie=ge.length,ie&&ge.push(S);Y<fe;){for(Ee=l,_e=0;_e<fe;++_e)Pe=U[_e],Pe>=D&&Pe<Ee&&(Ee=Pe);for(Ue=Y+1,Ee-D>O((l-Z)/Ue)&&V("overflow"),Z+=(Ee-D)*Ue,D=Ee,_e=0;_e<fe;++_e)if(Pe=U[_e],Pe<D&&++Z>l&&V("overflow"),Pe==D){for(Ce=Z,De=c;ce=De<=ue?d:De>=ue+g?g:De-ue,!(Ce<ce);De+=c)Oe=Ce-ce,Ie=c-ce,ge.push(J(re(ce+Oe%Ie,0))),Ce=O(Oe/Ie);ge.push(J(re(Ce,0))),ue=oe(Z,Ue,Y==ie),Z=0,++Y}++Z,++D}return ge.join("")}function P(U){return ae(U,function(D){return w.test(D)?R(D.slice(4).toLowerCase()):D})}function q(U){return ae(U,function(D){return T.test(D)?"xn--"+k(D):D})}if(h={version:"1.4.1",ucs2:{decode:ve,encode:H},decode:R,encode:k,toASCII:q,toUnicode:P},r&&n)if(i.exports==r)n.exports=h;else for(C in h)h.hasOwnProperty(C)&&(r[C]=h[C]);else t.punycode=h})(Pp)}(gi,gi.exports)),gi.exports}var Jn,Hh;function ei(){return Hh||(Hh=1,Jn=TypeError),Jn}const Rp={},Mp=Object.freeze(Object.defineProperty({__proto__:null,default:Rp},Symbol.toStringTag,{value:"Module"})),Op=Ep(Mp);var Zn,$h;function Rn(){if($h)return Zn;$h=1;var i=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,t=i&&e&&typeof e.get=="function"?e.get:null,r=i&&Map.prototype.forEach,n=typeof Set=="function"&&Set.prototype,a=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,h=n&&a&&typeof a.get=="function"?a.get:null,l=n&&Set.prototype.forEach,c=typeof WeakMap=="function"&&WeakMap.prototype,d=c?WeakMap.prototype.has:null,g=typeof WeakSet=="function"&&WeakSet.prototype,v=g?WeakSet.prototype.has:null,b=typeof WeakRef=="function"&&WeakRef.prototype,y=b?WeakRef.prototype.deref:null,x=Boolean.prototype.valueOf,S=Object.prototype.toString,w=Function.prototype.toString,T=String.prototype.match,N=String.prototype.slice,M=String.prototype.replace,F=String.prototype.toUpperCase,O=String.prototype.toLowerCase,J=RegExp.prototype.test,C=Array.prototype.concat,V=Array.prototype.join,se=Array.prototype.slice,ae=Math.floor,ve=typeof BigInt=="function"?BigInt.prototype.valueOf:null,H=Object.getOwnPropertySymbols,K=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,re=typeof Symbol=="function"&&typeof Symbol.iterator=="object",oe=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===re||!0)?Symbol.toStringTag:null,R=Object.prototype.propertyIsEnumerable,k=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(W){return W.__proto__}:null);function P(W,ee){if(W===1/0||W===-1/0||W!==W||W&&W>-1e3&&W<1e3||J.call(/e/,ee))return ee;var Je=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof W=="number"){var Ge=W<0?-ae(-W):ae(W);if(Ge!==W){var Qe=String(Ge),je=N.call(ee,Qe.length+1);return M.call(Qe,Je,"$&_")+"."+M.call(M.call(je,/([0-9]{3})/g,"$&_"),/_$/,"")}}return M.call(ee,Je,"$&_")}var q=Op,U=q.custom,D=Ue(U)?U:null,Z={__proto__:null,double:'"',single:"'"},Y={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};Zn=function W(ee,Je,Ge,Qe){var je=Je||{};if(rt(je,"quoteStyle")&&!rt(Z,je.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(rt(je,"maxStringLength")&&(typeof je.maxStringLength=="number"?je.maxStringLength<0&&je.maxStringLength!==1/0:je.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Vt=rt(je,"customInspect")?je.customInspect:!0;if(typeof Vt!="boolean"&&Vt!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(rt(je,"indent")&&je.indent!==null&&je.indent!=="	"&&!(parseInt(je.indent,10)===je.indent&&je.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(rt(je,"numericSeparator")&&typeof je.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var wr=je.numericSeparator;if(typeof ee>"u")return"undefined";if(ee===null)return"null";if(typeof ee=="boolean")return ee?"true":"false";if(typeof ee=="string")return Ri(ee,je);if(typeof ee=="number"){if(ee===0)return 1/0/ee>0?"0":"-0";var St=String(ee);return wr?P(ee,St):St}if(typeof ee=="bigint"){var ir=String(ee)+"n";return wr?P(ee,ir):ir}var Dt=typeof je.depth>"u"?5:je.depth;if(typeof Ge>"u"&&(Ge=0),Ge>=Dt&&Dt>0&&typeof ee=="object")return Ee(ee)?"[Array]":"[Object]";var nr=Mi(je,Ge);if(typeof Qe>"u")Qe=[];else if(sr(Qe,ee)>=0)return"[Circular]";function xt(Hr,$r,oi){if($r&&(Qe=se.call(Qe),Qe.push($r)),oi){var hi={depth:je.depth};return rt(je,"quoteStyle")&&(hi.quoteStyle=je.quoteStyle),W(Hr,hi,Ge+1,Qe)}return W(Hr,je,Ge+1,Qe)}if(typeof ee=="function"&&!De(ee)){var Sr=pt(ee),Ur=ts(ee,xt);return"[Function"+(Sr?": "+Sr:" (anonymous)")+"]"+(Ur.length>0?" { "+V.call(Ur,", ")+" }":"")}if(Ue(ee)){var Gr=re?M.call(String(ee),/^(Symbol\(.*\))_[^)]*$/,"$1"):K.call(ee);return typeof ee=="object"&&!re?Er(Gr):Gr}if($n(ee)){for(var jr="<"+O.call(String(ee.nodeName)),Ts=ee.attributes||[],rs=0;rs<Ts.length;rs++)jr+=" "+Ts[rs].name+"="+ie(ue(Ts[rs].value),"double",je);return jr+=">",ee.childNodes&&ee.childNodes.length&&(jr+="..."),jr+="</"+O.call(String(ee.nodeName))+">",jr}if(Ee(ee)){if(ee.length===0)return"[]";var ss=ts(ee,xt);return nr&&!ii(ss)?"["+ni(ss,nr)+"]":"[ "+V.call(ss,", ")+" ]"}if(ce(ee)){var It=ts(ee,xt);return!("cause"in Error.prototype)&&"cause"in ee&&!R.call(ee,"cause")?"{ ["+String(ee)+"] "+V.call(C.call("[cause]: "+xt(ee.cause),It),", ")+" }":It.length===0?"["+String(ee)+"]":"{ ["+String(ee)+"] "+V.call(It,", ")+" }"}if(typeof ee=="object"&&Vt){if(D&&typeof ee[D]=="function"&&q)return q(ee,{depth:Dt-Ge});if(Vt!=="symbol"&&typeof ee.inspect=="function")return ee.inspect()}if(Mt(ee)){var As=[];return r&&r.call(ee,function(Hr,$r){As.push(xt($r,ee,!0)+" => "+xt(Hr,ee))}),tt("Map",t.call(ee),As,nr)}if(xr(ee)){var Cs=[];return l&&l.call(ee,function(Hr){Cs.push(xt(Hr,ee))}),tt("Set",h.call(ee),Cs,nr)}if(Br(ee))return Ae("WeakMap");if(Hn(ee))return Ae("WeakSet");if(Lr(ee))return Ae("WeakRef");if(ge(ee))return Er(xt(Number(ee)));if(Ie(ee))return Er(xt(ve.call(ee)));if(fe(ee))return Er(x.call(ee));if(Pe(ee))return Er(xt(String(ee)));if(typeof window<"u"&&ee===window)return"{ [object Window] }";if(typeof globalThis<"u"&&ee===globalThis||typeof Ys<"u"&&ee===Ys)return"{ [object globalThis] }";if(!Ce(ee)&&!De(ee)){var ai=ts(ee,xt),Ft=k?k(ee)===Object.prototype:ee instanceof Object||ee.constructor===Object,Bt=ee instanceof Object?"":"null prototype",Tr=!Ft&&oe&&Object(ee)===ee&&oe in ee?N.call(ht(ee),8,-1):Bt?"Object":"",ut=Ft||typeof ee.constructor!="function"?"":ee.constructor.name?ee.constructor.name+" ":"",ar=ut+(Tr||Bt?"["+V.call(C.call([],Tr||[],Bt||[]),": ")+"] ":"");return ai.length===0?ar+"{}":nr?ar+"{"+ni(ai,nr)+"}":ar+"{ "+V.call(ai,", ")+" }"}return String(ee)};function ie(W,ee,Je){var Ge=Je.quoteStyle||ee,Qe=Z[Ge];return Qe+W+Qe}function ue(W){return M.call(String(W),/"/g,"&quot;")}function _e(W){return!oe||!(typeof W=="object"&&(oe in W||typeof W[oe]<"u"))}function Ee(W){return ht(W)==="[object Array]"&&_e(W)}function Ce(W){return ht(W)==="[object Date]"&&_e(W)}function De(W){return ht(W)==="[object RegExp]"&&_e(W)}function ce(W){return ht(W)==="[object Error]"&&_e(W)}function Pe(W){return ht(W)==="[object String]"&&_e(W)}function ge(W){return ht(W)==="[object Number]"&&_e(W)}function fe(W){return ht(W)==="[object Boolean]"&&_e(W)}function Ue(W){if(re)return W&&typeof W=="object"&&W instanceof Symbol;if(typeof W=="symbol")return!0;if(!W||typeof W!="object"||!K)return!1;try{return K.call(W),!0}catch{}return!1}function Ie(W){if(!W||typeof W!="object"||!ve)return!1;try{return ve.call(W),!0}catch{}return!1}var Oe=Object.prototype.hasOwnProperty||function(W){return W in this};function rt(W,ee){return Oe.call(W,ee)}function ht(W){return S.call(W)}function pt(W){if(W.name)return W.name;var ee=T.call(w.call(W),/^function\s*([\w$]+)/);return ee?ee[1]:null}function sr(W,ee){if(W.indexOf)return W.indexOf(ee);for(var Je=0,Ge=W.length;Je<Ge;Je++)if(W[Je]===ee)return Je;return-1}function Mt(W){if(!t||!W||typeof W!="object")return!1;try{t.call(W);try{h.call(W)}catch{return!0}return W instanceof Map}catch{}return!1}function Br(W){if(!d||!W||typeof W!="object")return!1;try{d.call(W,d);try{v.call(W,v)}catch{return!0}return W instanceof WeakMap}catch{}return!1}function Lr(W){if(!y||!W||typeof W!="object")return!1;try{return y.call(W),!0}catch{}return!1}function xr(W){if(!h||!W||typeof W!="object")return!1;try{h.call(W);try{t.call(W)}catch{return!0}return W instanceof Set}catch{}return!1}function Hn(W){if(!v||!W||typeof W!="object")return!1;try{v.call(W,v);try{d.call(W,d)}catch{return!0}return W instanceof WeakSet}catch{}return!1}function $n(W){return!W||typeof W!="object"?!1:typeof HTMLElement<"u"&&W instanceof HTMLElement?!0:typeof W.nodeName=="string"&&typeof W.getAttribute=="function"}function Ri(W,ee){if(W.length>ee.maxStringLength){var Je=W.length-ee.maxStringLength,Ge="... "+Je+" more character"+(Je>1?"s":"");return Ri(N.call(W,0,ee.maxStringLength),ee)+Ge}var Qe=Y[ee.quoteStyle||"single"];Qe.lastIndex=0;var je=M.call(M.call(W,Qe,"\\$1"),/[\x00-\x1f]/g,Le);return ie(je,"single",ee)}function Le(W){var ee=W.charCodeAt(0),Je={8:"b",9:"t",10:"n",12:"f",13:"r"}[ee];return Je?"\\"+Je:"\\x"+(ee<16?"0":"")+F.call(ee.toString(16))}function Er(W){return"Object("+W+")"}function Ae(W){return W+" { ? }"}function tt(W,ee,Je,Ge){var Qe=Ge?ni(Je,Ge):V.call(Je,", ");return W+" ("+ee+") {"+Qe+"}"}function ii(W){for(var ee=0;ee<W.length;ee++)if(sr(W[ee],`
`)>=0)return!1;return!0}function Mi(W,ee){var Je;if(W.indent==="	")Je="	";else if(typeof W.indent=="number"&&W.indent>0)Je=V.call(Array(W.indent+1)," ");else return null;return{base:Je,prev:V.call(Array(ee+1),Je)}}function ni(W,ee){if(W.length===0)return"";var Je=`
`+ee.prev+ee.base;return Je+V.call(W,","+Je)+`
`+ee.prev}function ts(W,ee){var Je=Ee(W),Ge=[];if(Je){Ge.length=W.length;for(var Qe=0;Qe<W.length;Qe++)Ge[Qe]=rt(W,Qe)?ee(W[Qe],W):""}var je=typeof H=="function"?H(W):[],Vt;if(re){Vt={};for(var wr=0;wr<je.length;wr++)Vt["$"+je[wr]]=je[wr]}for(var St in W)rt(W,St)&&(Je&&String(Number(St))===St&&St<W.length||re&&Vt["$"+St]instanceof Symbol||(J.call(/[^\w$]/,St)?Ge.push(ee(St,W)+": "+ee(W[St],W)):Ge.push(St+": "+ee(W[St],W))));if(typeof H=="function")for(var ir=0;ir<je.length;ir++)R.call(W,je[ir])&&Ge.push("["+ee(je[ir])+"]: "+ee(W[je[ir]],W));return Ge}return Zn}var Qn,Vh;function kp(){if(Vh)return Qn;Vh=1;var i=Rn(),e=ei(),t=function(l,c,d){for(var g=l,v;(v=g.next)!=null;g=v)if(v.key===c)return g.next=v.next,d||(v.next=l.next,l.next=v),v},r=function(l,c){if(l){var d=t(l,c);return d&&d.value}},n=function(l,c,d){var g=t(l,c);g?g.value=d:l.next={key:c,next:l.next,value:d}},a=function(l,c){return l?!!t(l,c):!1},h=function(l,c){if(l)return t(l,c,!0)};return Qn=function(){var c,d={assert:function(g){if(!d.has(g))throw new e("Side channel does not contain "+i(g))},delete:function(g){var v=c&&c.next,b=h(c,g);return b&&v&&v===b&&(c=void 0),!!b},get:function(g){return r(c,g)},has:function(g){return a(c,g)},set:function(g,v){c||(c={next:void 0}),n(c,g,v)}};return d},Qn}var ea,Wh;function Hu(){return Wh||(Wh=1,ea=Object),ea}var ta,zh;function Np(){return zh||(zh=1,ta=Error),ta}var ra,qh;function Dp(){return qh||(qh=1,ra=EvalError),ra}var sa,Xh;function Fp(){return Xh||(Xh=1,sa=RangeError),sa}var ia,Kh;function Bp(){return Kh||(Kh=1,ia=ReferenceError),ia}var na,Yh;function Lp(){return Yh||(Yh=1,na=SyntaxError),na}var aa,Jh;function Up(){return Jh||(Jh=1,aa=URIError),aa}var oa,Zh;function Gp(){return Zh||(Zh=1,oa=Math.abs),oa}var ha,Qh;function jp(){return Qh||(Qh=1,ha=Math.floor),ha}var la,el;function Hp(){return el||(el=1,la=Math.max),la}var ua,tl;function $p(){return tl||(tl=1,ua=Math.min),ua}var ca,rl;function Vp(){return rl||(rl=1,ca=Math.pow),ca}var da,sl;function Wp(){return sl||(sl=1,da=Math.round),da}var pa,il;function zp(){return il||(il=1,pa=Number.isNaN||function(e){return e!==e}),pa}var fa,nl;function qp(){if(nl)return fa;nl=1;var i=zp();return fa=function(t){return i(t)||t===0?t:t<0?-1:1},fa}var ga,al;function Xp(){return al||(al=1,ga=Object.getOwnPropertyDescriptor),ga}var ma,ol;function $u(){if(ol)return ma;ol=1;var i=Xp();if(i)try{i([],"length")}catch{i=null}return ma=i,ma}var ya,hl;function Kp(){if(hl)return ya;hl=1;var i=Object.defineProperty||!1;if(i)try{i({},"a",{value:1})}catch{i=!1}return ya=i,ya}var va,ll;function Yp(){return ll||(ll=1,va=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var n=42;e[t]=n;for(var a in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var h=Object.getOwnPropertySymbols(e);if(h.length!==1||h[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var l=Object.getOwnPropertyDescriptor(e,t);if(l.value!==n||l.enumerable!==!0)return!1}return!0}),va}var ba,ul;function Jp(){if(ul)return ba;ul=1;var i=typeof Symbol<"u"&&Symbol,e=Yp();return ba=function(){return typeof i!="function"||typeof Symbol!="function"||typeof i("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},ba}var _a,cl;function Vu(){return cl||(cl=1,_a=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),_a}var xa,dl;function Wu(){if(dl)return xa;dl=1;var i=Hu();return xa=i.getPrototypeOf||null,xa}var Ea,pl;function Zp(){if(pl)return Ea;pl=1;var i="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",n=function(c,d){for(var g=[],v=0;v<c.length;v+=1)g[v]=c[v];for(var b=0;b<d.length;b+=1)g[b+c.length]=d[b];return g},a=function(c,d){for(var g=[],v=d,b=0;v<c.length;v+=1,b+=1)g[b]=c[v];return g},h=function(l,c){for(var d="",g=0;g<l.length;g+=1)d+=l[g],g+1<l.length&&(d+=c);return d};return Ea=function(c){var d=this;if(typeof d!="function"||e.apply(d)!==r)throw new TypeError(i+d);for(var g=a(arguments,1),v,b=function(){if(this instanceof v){var T=d.apply(this,n(g,arguments));return Object(T)===T?T:this}return d.apply(c,n(g,arguments))},y=t(0,d.length-g.length),x=[],S=0;S<y;S++)x[S]="$"+S;if(v=Function("binder","return function ("+h(x,",")+"){ return binder.apply(this,arguments); }")(b),d.prototype){var w=function(){};w.prototype=d.prototype,v.prototype=new w,w.prototype=null}return v},Ea}var wa,fl;function Mn(){if(fl)return wa;fl=1;var i=Zp();return wa=Function.prototype.bind||i,wa}var Sa,gl;function rh(){return gl||(gl=1,Sa=Function.prototype.call),Sa}var Ta,ml;function zu(){return ml||(ml=1,Ta=Function.prototype.apply),Ta}var Aa,yl;function Qp(){return yl||(yl=1,Aa=typeof Reflect<"u"&&Reflect&&Reflect.apply),Aa}var Ca,vl;function ef(){if(vl)return Ca;vl=1;var i=Mn(),e=zu(),t=rh(),r=Qp();return Ca=r||i.call(t,e),Ca}var Pa,bl;function qu(){if(bl)return Pa;bl=1;var i=Mn(),e=ei(),t=rh(),r=ef();return Pa=function(a){if(a.length<1||typeof a[0]!="function")throw new e("a function is required");return r(i,t,a)},Pa}var Ia,_l;function tf(){if(_l)return Ia;_l=1;var i=qu(),e=$u(),t;try{t=[].__proto__===Array.prototype}catch(h){if(!h||typeof h!="object"||!("code"in h)||h.code!=="ERR_PROTO_ACCESS")throw h}var r=!!t&&e&&e(Object.prototype,"__proto__"),n=Object,a=n.getPrototypeOf;return Ia=r&&typeof r.get=="function"?i([r.get]):typeof a=="function"?function(l){return a(l==null?l:n(l))}:!1,Ia}var Ra,xl;function rf(){if(xl)return Ra;xl=1;var i=Vu(),e=Wu(),t=tf();return Ra=i?function(n){return i(n)}:e?function(n){if(!n||typeof n!="object"&&typeof n!="function")throw new TypeError("getProto: not an object");return e(n)}:t?function(n){return t(n)}:null,Ra}var Ma,El;function sf(){if(El)return Ma;El=1;var i=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=Mn();return Ma=t.call(i,e),Ma}var Oa,wl;function sh(){if(wl)return Oa;wl=1;var i,e=Hu(),t=Np(),r=Dp(),n=Fp(),a=Bp(),h=Lp(),l=ei(),c=Up(),d=Gp(),g=jp(),v=Hp(),b=$p(),y=Vp(),x=Wp(),S=qp(),w=Function,T=function(De){try{return w('"use strict"; return ('+De+").constructor;")()}catch{}},N=$u(),M=Kp(),F=function(){throw new l},O=N?function(){try{return arguments.callee,F}catch{try{return N(arguments,"callee").get}catch{return F}}}():F,J=Jp()(),C=rf(),V=Wu(),se=Vu(),ae=zu(),ve=rh(),H={},K=typeof Uint8Array>"u"||!C?i:C(Uint8Array),re={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?i:ArrayBuffer,"%ArrayIteratorPrototype%":J&&C?C([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":H,"%AsyncGenerator%":H,"%AsyncGeneratorFunction%":H,"%AsyncIteratorPrototype%":H,"%Atomics%":typeof Atomics>"u"?i:Atomics,"%BigInt%":typeof BigInt>"u"?i:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?i:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?i:Float16Array,"%Float32Array%":typeof Float32Array>"u"?i:Float32Array,"%Float64Array%":typeof Float64Array>"u"?i:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?i:FinalizationRegistry,"%Function%":w,"%GeneratorFunction%":H,"%Int8Array%":typeof Int8Array>"u"?i:Int8Array,"%Int16Array%":typeof Int16Array>"u"?i:Int16Array,"%Int32Array%":typeof Int32Array>"u"?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":J&&C?C(C([][Symbol.iterator]())):i,"%JSON%":typeof JSON=="object"?JSON:i,"%Map%":typeof Map>"u"?i:Map,"%MapIteratorPrototype%":typeof Map>"u"||!J||!C?i:C(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":N,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?i:Promise,"%Proxy%":typeof Proxy>"u"?i:Proxy,"%RangeError%":n,"%ReferenceError%":a,"%Reflect%":typeof Reflect>"u"?i:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?i:Set,"%SetIteratorPrototype%":typeof Set>"u"||!J||!C?i:C(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":J&&C?C(""[Symbol.iterator]()):i,"%Symbol%":J?Symbol:i,"%SyntaxError%":h,"%ThrowTypeError%":O,"%TypedArray%":K,"%TypeError%":l,"%Uint8Array%":typeof Uint8Array>"u"?i:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?i:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?i:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?i:Uint32Array,"%URIError%":c,"%WeakMap%":typeof WeakMap>"u"?i:WeakMap,"%WeakRef%":typeof WeakRef>"u"?i:WeakRef,"%WeakSet%":typeof WeakSet>"u"?i:WeakSet,"%Function.prototype.call%":ve,"%Function.prototype.apply%":ae,"%Object.defineProperty%":M,"%Object.getPrototypeOf%":V,"%Math.abs%":d,"%Math.floor%":g,"%Math.max%":v,"%Math.min%":b,"%Math.pow%":y,"%Math.round%":x,"%Math.sign%":S,"%Reflect.getPrototypeOf%":se};if(C)try{null.error}catch(De){var oe=C(C(De));re["%Error.prototype%"]=oe}var R=function De(ce){var Pe;if(ce==="%AsyncFunction%")Pe=T("async function () {}");else if(ce==="%GeneratorFunction%")Pe=T("function* () {}");else if(ce==="%AsyncGeneratorFunction%")Pe=T("async function* () {}");else if(ce==="%AsyncGenerator%"){var ge=De("%AsyncGeneratorFunction%");ge&&(Pe=ge.prototype)}else if(ce==="%AsyncIteratorPrototype%"){var fe=De("%AsyncGenerator%");fe&&C&&(Pe=C(fe.prototype))}return re[ce]=Pe,Pe},k={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},P=Mn(),q=sf(),U=P.call(ve,Array.prototype.concat),D=P.call(ae,Array.prototype.splice),Z=P.call(ve,String.prototype.replace),Y=P.call(ve,String.prototype.slice),ie=P.call(ve,RegExp.prototype.exec),ue=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,_e=/\\(\\)?/g,Ee=function(ce){var Pe=Y(ce,0,1),ge=Y(ce,-1);if(Pe==="%"&&ge!=="%")throw new h("invalid intrinsic syntax, expected closing `%`");if(ge==="%"&&Pe!=="%")throw new h("invalid intrinsic syntax, expected opening `%`");var fe=[];return Z(ce,ue,function(Ue,Ie,Oe,rt){fe[fe.length]=Oe?Z(rt,_e,"$1"):Ie||Ue}),fe},Ce=function(ce,Pe){var ge=ce,fe;if(q(k,ge)&&(fe=k[ge],ge="%"+fe[0]+"%"),q(re,ge)){var Ue=re[ge];if(Ue===H&&(Ue=R(ge)),typeof Ue>"u"&&!Pe)throw new l("intrinsic "+ce+" exists, but is not available. Please file an issue!");return{alias:fe,name:ge,value:Ue}}throw new h("intrinsic "+ce+" does not exist!")};return Oa=function(ce,Pe){if(typeof ce!="string"||ce.length===0)throw new l("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof Pe!="boolean")throw new l('"allowMissing" argument must be a boolean');if(ie(/^%?[^%]*%?$/,ce)===null)throw new h("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var ge=Ee(ce),fe=ge.length>0?ge[0]:"",Ue=Ce("%"+fe+"%",Pe),Ie=Ue.name,Oe=Ue.value,rt=!1,ht=Ue.alias;ht&&(fe=ht[0],D(ge,U([0,1],ht)));for(var pt=1,sr=!0;pt<ge.length;pt+=1){var Mt=ge[pt],Br=Y(Mt,0,1),Lr=Y(Mt,-1);if((Br==='"'||Br==="'"||Br==="`"||Lr==='"'||Lr==="'"||Lr==="`")&&Br!==Lr)throw new h("property names with quotes must have matching quotes");if((Mt==="constructor"||!sr)&&(rt=!0),fe+="."+Mt,Ie="%"+fe+"%",q(re,Ie))Oe=re[Ie];else if(Oe!=null){if(!(Mt in Oe)){if(!Pe)throw new l("base intrinsic for "+ce+" exists, but the property is not available.");return}if(N&&pt+1>=ge.length){var xr=N(Oe,Mt);sr=!!xr,sr&&"get"in xr&&!("originalValue"in xr.get)?Oe=xr.get:Oe=Oe[Mt]}else sr=q(Oe,Mt),Oe=Oe[Mt];sr&&!rt&&(re[Ie]=Oe)}}return Oe},Oa}var ka,Sl;function Xu(){if(Sl)return ka;Sl=1;var i=sh(),e=qu(),t=e([i("%String.prototype.indexOf%")]);return ka=function(n,a){var h=i(n,!!a);return typeof h=="function"&&t(n,".prototype.")>-1?e([h]):h},ka}var Na,Tl;function Ku(){if(Tl)return Na;Tl=1;var i=sh(),e=Xu(),t=Rn(),r=ei(),n=i("%Map%",!0),a=e("Map.prototype.get",!0),h=e("Map.prototype.set",!0),l=e("Map.prototype.has",!0),c=e("Map.prototype.delete",!0),d=e("Map.prototype.size",!0);return Na=!!n&&function(){var v,b={assert:function(y){if(!b.has(y))throw new r("Side channel does not contain "+t(y))},delete:function(y){if(v){var x=c(v,y);return d(v)===0&&(v=void 0),x}return!1},get:function(y){if(v)return a(v,y)},has:function(y){return v?l(v,y):!1},set:function(y,x){v||(v=new n),h(v,y,x)}};return b},Na}var Da,Al;function nf(){if(Al)return Da;Al=1;var i=sh(),e=Xu(),t=Rn(),r=Ku(),n=ei(),a=i("%WeakMap%",!0),h=e("WeakMap.prototype.get",!0),l=e("WeakMap.prototype.set",!0),c=e("WeakMap.prototype.has",!0),d=e("WeakMap.prototype.delete",!0);return Da=a?function(){var v,b,y={assert:function(x){if(!y.has(x))throw new n("Side channel does not contain "+t(x))},delete:function(x){if(a&&x&&(typeof x=="object"||typeof x=="function")){if(v)return d(v,x)}else if(r&&b)return b.delete(x);return!1},get:function(x){return a&&x&&(typeof x=="object"||typeof x=="function")&&v?h(v,x):b&&b.get(x)},has:function(x){return a&&x&&(typeof x=="object"||typeof x=="function")&&v?c(v,x):!!b&&b.has(x)},set:function(x,S){a&&x&&(typeof x=="object"||typeof x=="function")?(v||(v=new a),l(v,x,S)):r&&(b||(b=r()),b.set(x,S))}};return y}:r,Da}var Fa,Cl;function af(){if(Cl)return Fa;Cl=1;var i=ei(),e=Rn(),t=kp(),r=Ku(),n=nf(),a=n||r||t;return Fa=function(){var l,c={assert:function(d){if(!c.has(d))throw new i("Side channel does not contain "+e(d))},delete:function(d){return!!l&&l.delete(d)},get:function(d){return l&&l.get(d)},has:function(d){return!!l&&l.has(d)},set:function(d,g){l||(l=a()),l.set(d,g)}};return c},Fa}var Ba,Pl;function ih(){if(Pl)return Ba;Pl=1;var i=String.prototype.replace,e=/%20/g,t={RFC1738:"RFC1738",RFC3986:"RFC3986"};return Ba={default:t.RFC3986,formatters:{RFC1738:function(r){return i.call(r,e,"+")},RFC3986:function(r){return String(r)}},RFC1738:t.RFC1738,RFC3986:t.RFC3986},Ba}var La,Il;function Yu(){if(Il)return La;Il=1;var i=ih(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r=function(){for(var w=[],T=0;T<256;++T)w.push("%"+((T<16?"0":"")+T.toString(16)).toUpperCase());return w}(),n=function(T){for(;T.length>1;){var N=T.pop(),M=N.obj[N.prop];if(t(M)){for(var F=[],O=0;O<M.length;++O)typeof M[O]<"u"&&F.push(M[O]);N.obj[N.prop]=F}}},a=function(T,N){for(var M=N&&N.plainObjects?{__proto__:null}:{},F=0;F<T.length;++F)typeof T[F]<"u"&&(M[F]=T[F]);return M},h=function w(T,N,M){if(!N)return T;if(typeof N!="object"&&typeof N!="function"){if(t(T))T.push(N);else if(T&&typeof T=="object")(M&&(M.plainObjects||M.allowPrototypes)||!e.call(Object.prototype,N))&&(T[N]=!0);else return[T,N];return T}if(!T||typeof T!="object")return[T].concat(N);var F=T;return t(T)&&!t(N)&&(F=a(T,M)),t(T)&&t(N)?(N.forEach(function(O,J){if(e.call(T,J)){var C=T[J];C&&typeof C=="object"&&O&&typeof O=="object"?T[J]=w(C,O,M):T.push(O)}else T[J]=O}),T):Object.keys(N).reduce(function(O,J){var C=N[J];return e.call(O,J)?O[J]=w(O[J],C,M):O[J]=C,O},F)},l=function(T,N){return Object.keys(N).reduce(function(M,F){return M[F]=N[F],M},T)},c=function(w,T,N){var M=w.replace(/\+/g," ");if(N==="iso-8859-1")return M.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(M)}catch{return M}},d=1024,g=function(T,N,M,F,O){if(T.length===0)return T;var J=T;if(typeof T=="symbol"?J=Symbol.prototype.toString.call(T):typeof T!="string"&&(J=String(T)),M==="iso-8859-1")return escape(J).replace(/%u[0-9a-f]{4}/gi,function(K){return"%26%23"+parseInt(K.slice(2),16)+"%3B"});for(var C="",V=0;V<J.length;V+=d){for(var se=J.length>=d?J.slice(V,V+d):J,ae=[],ve=0;ve<se.length;++ve){var H=se.charCodeAt(ve);if(H===45||H===46||H===95||H===126||H>=48&&H<=57||H>=65&&H<=90||H>=97&&H<=122||O===i.RFC1738&&(H===40||H===41)){ae[ae.length]=se.charAt(ve);continue}if(H<128){ae[ae.length]=r[H];continue}if(H<2048){ae[ae.length]=r[192|H>>6]+r[128|H&63];continue}if(H<55296||H>=57344){ae[ae.length]=r[224|H>>12]+r[128|H>>6&63]+r[128|H&63];continue}ve+=1,H=65536+((H&1023)<<10|se.charCodeAt(ve)&1023),ae[ae.length]=r[240|H>>18]+r[128|H>>12&63]+r[128|H>>6&63]+r[128|H&63]}C+=ae.join("")}return C},v=function(T){for(var N=[{obj:{o:T},prop:"o"}],M=[],F=0;F<N.length;++F)for(var O=N[F],J=O.obj[O.prop],C=Object.keys(J),V=0;V<C.length;++V){var se=C[V],ae=J[se];typeof ae=="object"&&ae!==null&&M.indexOf(ae)===-1&&(N.push({obj:J,prop:se}),M.push(ae))}return n(N),T},b=function(T){return Object.prototype.toString.call(T)==="[object RegExp]"},y=function(T){return!T||typeof T!="object"?!1:!!(T.constructor&&T.constructor.isBuffer&&T.constructor.isBuffer(T))},x=function(T,N){return[].concat(T,N)},S=function(T,N){if(t(T)){for(var M=[],F=0;F<T.length;F+=1)M.push(N(T[F]));return M}return N(T)};return La={arrayToObject:a,assign:l,combine:x,compact:v,decode:c,encode:g,isBuffer:y,isRegExp:b,maybeMap:S,merge:h},La}var Ua,Rl;function of(){if(Rl)return Ua;Rl=1;var i=af(),e=Yu(),t=ih(),r=Object.prototype.hasOwnProperty,n={brackets:function(w){return w+"[]"},comma:"comma",indices:function(w,T){return w+"["+T+"]"},repeat:function(w){return w}},a=Array.isArray,h=Array.prototype.push,l=function(S,w){h.apply(S,a(w)?w:[w])},c=Date.prototype.toISOString,d=t.default,g={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,filter:void 0,format:d,formatter:t.formatters[d],indices:!1,serializeDate:function(w){return c.call(w)},skipNulls:!1,strictNullHandling:!1},v=function(w){return typeof w=="string"||typeof w=="number"||typeof w=="boolean"||typeof w=="symbol"||typeof w=="bigint"},b={},y=function S(w,T,N,M,F,O,J,C,V,se,ae,ve,H,K,re,oe,R,k){for(var P=w,q=k,U=0,D=!1;(q=q.get(b))!==void 0&&!D;){var Z=q.get(w);if(U+=1,typeof Z<"u"){if(Z===U)throw new RangeError("Cyclic object value");D=!0}typeof q.get(b)>"u"&&(U=0)}if(typeof se=="function"?P=se(T,P):P instanceof Date?P=H(P):N==="comma"&&a(P)&&(P=e.maybeMap(P,function(Ie){return Ie instanceof Date?H(Ie):Ie})),P===null){if(O)return V&&!oe?V(T,g.encoder,R,"key",K):T;P=""}if(v(P)||e.isBuffer(P)){if(V){var Y=oe?T:V(T,g.encoder,R,"key",K);return[re(Y)+"="+re(V(P,g.encoder,R,"value",K))]}return[re(T)+"="+re(String(P))]}var ie=[];if(typeof P>"u")return ie;var ue;if(N==="comma"&&a(P))oe&&V&&(P=e.maybeMap(P,V)),ue=[{value:P.length>0?P.join(",")||null:void 0}];else if(a(se))ue=se;else{var _e=Object.keys(P);ue=ae?_e.sort(ae):_e}var Ee=C?String(T).replace(/\./g,"%2E"):String(T),Ce=M&&a(P)&&P.length===1?Ee+"[]":Ee;if(F&&a(P)&&P.length===0)return Ce+"[]";for(var De=0;De<ue.length;++De){var ce=ue[De],Pe=typeof ce=="object"&&ce&&typeof ce.value<"u"?ce.value:P[ce];if(!(J&&Pe===null)){var ge=ve&&C?String(ce).replace(/\./g,"%2E"):String(ce),fe=a(P)?typeof N=="function"?N(Ce,ge):Ce:Ce+(ve?"."+ge:"["+ge+"]");k.set(w,U);var Ue=i();Ue.set(b,k),l(ie,S(Pe,fe,N,M,F,O,J,C,N==="comma"&&oe&&a(P)?null:V,se,ae,ve,H,K,re,oe,R,Ue))}}return ie},x=function(w){if(!w)return g;if(typeof w.allowEmptyArrays<"u"&&typeof w.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof w.encodeDotInKeys<"u"&&typeof w.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(w.encoder!==null&&typeof w.encoder<"u"&&typeof w.encoder!="function")throw new TypeError("Encoder has to be a function.");var T=w.charset||g.charset;if(typeof w.charset<"u"&&w.charset!=="utf-8"&&w.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var N=t.default;if(typeof w.format<"u"){if(!r.call(t.formatters,w.format))throw new TypeError("Unknown format option provided.");N=w.format}var M=t.formatters[N],F=g.filter;(typeof w.filter=="function"||a(w.filter))&&(F=w.filter);var O;if(w.arrayFormat in n?O=w.arrayFormat:"indices"in w?O=w.indices?"indices":"repeat":O=g.arrayFormat,"commaRoundTrip"in w&&typeof w.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var J=typeof w.allowDots>"u"?w.encodeDotInKeys===!0?!0:g.allowDots:!!w.allowDots;return{addQueryPrefix:typeof w.addQueryPrefix=="boolean"?w.addQueryPrefix:g.addQueryPrefix,allowDots:J,allowEmptyArrays:typeof w.allowEmptyArrays=="boolean"?!!w.allowEmptyArrays:g.allowEmptyArrays,arrayFormat:O,charset:T,charsetSentinel:typeof w.charsetSentinel=="boolean"?w.charsetSentinel:g.charsetSentinel,commaRoundTrip:!!w.commaRoundTrip,delimiter:typeof w.delimiter>"u"?g.delimiter:w.delimiter,encode:typeof w.encode=="boolean"?w.encode:g.encode,encodeDotInKeys:typeof w.encodeDotInKeys=="boolean"?w.encodeDotInKeys:g.encodeDotInKeys,encoder:typeof w.encoder=="function"?w.encoder:g.encoder,encodeValuesOnly:typeof w.encodeValuesOnly=="boolean"?w.encodeValuesOnly:g.encodeValuesOnly,filter:F,format:N,formatter:M,serializeDate:typeof w.serializeDate=="function"?w.serializeDate:g.serializeDate,skipNulls:typeof w.skipNulls=="boolean"?w.skipNulls:g.skipNulls,sort:typeof w.sort=="function"?w.sort:null,strictNullHandling:typeof w.strictNullHandling=="boolean"?w.strictNullHandling:g.strictNullHandling}};return Ua=function(S,w){var T=S,N=x(w),M,F;typeof N.filter=="function"?(F=N.filter,T=F("",T)):a(N.filter)&&(F=N.filter,M=F);var O=[];if(typeof T!="object"||T===null)return"";var J=n[N.arrayFormat],C=J==="comma"&&N.commaRoundTrip;M||(M=Object.keys(T)),N.sort&&M.sort(N.sort);for(var V=i(),se=0;se<M.length;++se){var ae=M[se],ve=T[ae];N.skipNulls&&ve===null||l(O,y(ve,ae,J,C,N.allowEmptyArrays,N.strictNullHandling,N.skipNulls,N.encodeDotInKeys,N.encode?N.encoder:null,N.filter,N.sort,N.allowDots,N.serializeDate,N.format,N.formatter,N.encodeValuesOnly,N.charset,V))}var H=O.join(N.delimiter),K=N.addQueryPrefix===!0?"?":"";return N.charsetSentinel&&(N.charset==="iso-8859-1"?K+="utf8=%26%2310003%3B&":K+="utf8=%E2%9C%93&"),H.length>0?K+H:""},Ua}var Ga,Ml;function hf(){if(Ml)return Ga;Ml=1;var i=Yu(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:i.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},n=function(b){return b.replace(/&#(\d+);/g,function(y,x){return String.fromCharCode(parseInt(x,10))})},a=function(b,y,x){if(b&&typeof b=="string"&&y.comma&&b.indexOf(",")>-1)return b.split(",");if(y.throwOnLimitExceeded&&x>=y.arrayLimit)throw new RangeError("Array limit exceeded. Only "+y.arrayLimit+" element"+(y.arrayLimit===1?"":"s")+" allowed in an array.");return b},h="utf8=%26%2310003%3B",l="utf8=%E2%9C%93",c=function(y,x){var S={__proto__:null},w=x.ignoreQueryPrefix?y.replace(/^\?/,""):y;w=w.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var T=x.parameterLimit===1/0?void 0:x.parameterLimit,N=w.split(x.delimiter,x.throwOnLimitExceeded?T+1:T);if(x.throwOnLimitExceeded&&N.length>T)throw new RangeError("Parameter limit exceeded. Only "+T+" parameter"+(T===1?"":"s")+" allowed.");var M=-1,F,O=x.charset;if(x.charsetSentinel)for(F=0;F<N.length;++F)N[F].indexOf("utf8=")===0&&(N[F]===l?O="utf-8":N[F]===h&&(O="iso-8859-1"),M=F,F=N.length);for(F=0;F<N.length;++F)if(F!==M){var J=N[F],C=J.indexOf("]="),V=C===-1?J.indexOf("="):C+1,se,ae;V===-1?(se=x.decoder(J,r.decoder,O,"key"),ae=x.strictNullHandling?null:""):(se=x.decoder(J.slice(0,V),r.decoder,O,"key"),ae=i.maybeMap(a(J.slice(V+1),x,t(S[se])?S[se].length:0),function(H){return x.decoder(H,r.decoder,O,"value")})),ae&&x.interpretNumericEntities&&O==="iso-8859-1"&&(ae=n(String(ae))),J.indexOf("[]=")>-1&&(ae=t(ae)?[ae]:ae);var ve=e.call(S,se);ve&&x.duplicates==="combine"?S[se]=i.combine(S[se],ae):(!ve||x.duplicates==="last")&&(S[se]=ae)}return S},d=function(b,y,x,S){var w=0;if(b.length>0&&b[b.length-1]==="[]"){var T=b.slice(0,-1).join("");w=Array.isArray(y)&&y[T]?y[T].length:0}for(var N=S?y:a(y,x,w),M=b.length-1;M>=0;--M){var F,O=b[M];if(O==="[]"&&x.parseArrays)F=x.allowEmptyArrays&&(N===""||x.strictNullHandling&&N===null)?[]:i.combine([],N);else{F=x.plainObjects?{__proto__:null}:{};var J=O.charAt(0)==="["&&O.charAt(O.length-1)==="]"?O.slice(1,-1):O,C=x.decodeDotInKeys?J.replace(/%2E/g,"."):J,V=parseInt(C,10);!x.parseArrays&&C===""?F={0:N}:!isNaN(V)&&O!==C&&String(V)===C&&V>=0&&x.parseArrays&&V<=x.arrayLimit?(F=[],F[V]=N):C!=="__proto__"&&(F[C]=N)}N=F}return N},g=function(y,x,S,w){if(y){var T=S.allowDots?y.replace(/\.([^.[]+)/g,"[$1]"):y,N=/(\[[^[\]]*])/,M=/(\[[^[\]]*])/g,F=S.depth>0&&N.exec(T),O=F?T.slice(0,F.index):T,J=[];if(O){if(!S.plainObjects&&e.call(Object.prototype,O)&&!S.allowPrototypes)return;J.push(O)}for(var C=0;S.depth>0&&(F=M.exec(T))!==null&&C<S.depth;){if(C+=1,!S.plainObjects&&e.call(Object.prototype,F[1].slice(1,-1))&&!S.allowPrototypes)return;J.push(F[1])}if(F){if(S.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+S.depth+" and strictDepth is true");J.push("["+T.slice(F.index)+"]")}return d(J,x,S,w)}},v=function(y){if(!y)return r;if(typeof y.allowEmptyArrays<"u"&&typeof y.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof y.decodeDotInKeys<"u"&&typeof y.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(y.decoder!==null&&typeof y.decoder<"u"&&typeof y.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof y.charset<"u"&&y.charset!=="utf-8"&&y.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof y.throwOnLimitExceeded<"u"&&typeof y.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var x=typeof y.charset>"u"?r.charset:y.charset,S=typeof y.duplicates>"u"?r.duplicates:y.duplicates;if(S!=="combine"&&S!=="first"&&S!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var w=typeof y.allowDots>"u"?y.decodeDotInKeys===!0?!0:r.allowDots:!!y.allowDots;return{allowDots:w,allowEmptyArrays:typeof y.allowEmptyArrays=="boolean"?!!y.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof y.allowPrototypes=="boolean"?y.allowPrototypes:r.allowPrototypes,allowSparse:typeof y.allowSparse=="boolean"?y.allowSparse:r.allowSparse,arrayLimit:typeof y.arrayLimit=="number"?y.arrayLimit:r.arrayLimit,charset:x,charsetSentinel:typeof y.charsetSentinel=="boolean"?y.charsetSentinel:r.charsetSentinel,comma:typeof y.comma=="boolean"?y.comma:r.comma,decodeDotInKeys:typeof y.decodeDotInKeys=="boolean"?y.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof y.decoder=="function"?y.decoder:r.decoder,delimiter:typeof y.delimiter=="string"||i.isRegExp(y.delimiter)?y.delimiter:r.delimiter,depth:typeof y.depth=="number"||y.depth===!1?+y.depth:r.depth,duplicates:S,ignoreQueryPrefix:y.ignoreQueryPrefix===!0,interpretNumericEntities:typeof y.interpretNumericEntities=="boolean"?y.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof y.parameterLimit=="number"?y.parameterLimit:r.parameterLimit,parseArrays:y.parseArrays!==!1,plainObjects:typeof y.plainObjects=="boolean"?y.plainObjects:r.plainObjects,strictDepth:typeof y.strictDepth=="boolean"?!!y.strictDepth:r.strictDepth,strictNullHandling:typeof y.strictNullHandling=="boolean"?y.strictNullHandling:r.strictNullHandling,throwOnLimitExceeded:typeof y.throwOnLimitExceeded=="boolean"?y.throwOnLimitExceeded:!1}};return Ga=function(b,y){var x=v(y);if(b===""||b===null||typeof b>"u")return x.plainObjects?{__proto__:null}:{};for(var S=typeof b=="string"?c(b,x):b,w=x.plainObjects?{__proto__:null}:{},T=Object.keys(S),N=0;N<T.length;++N){var M=T[N],F=g(M,S[M],x,typeof b=="string");w=i.merge(w,F,x)}return x.allowSparse===!0?w:i.compact(w)},Ga}var ja,Ol;function lf(){if(Ol)return ja;Ol=1;var i=of(),e=hf(),t=ih();return ja={formats:t,parse:e,stringify:i},ja}var kl;function uf(){if(kl)return os;kl=1;var i=Ip();function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var t=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,n=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,a=["<",">",'"',"`"," ","\r",`
`,"	"],h=["{","}","|","\\","^","`"].concat(a),l=["'"].concat(h),c=["%","/","?",";","#"].concat(l),d=["/","?","#"],g=255,v=/^[+a-z0-9A-Z_-]{0,63}$/,b=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,y={javascript:!0,"javascript:":!0},x={javascript:!0,"javascript:":!0},S={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},w=lf();function T(O,J,C){if(O&&typeof O=="object"&&O instanceof e)return O;var V=new e;return V.parse(O,J,C),V}e.prototype.parse=function(O,J,C){if(typeof O!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof O);var V=O.indexOf("?"),se=V!==-1&&V<O.indexOf("#")?"?":"#",ae=O.split(se),ve=/\\/g;ae[0]=ae[0].replace(ve,"/"),O=ae.join(se);var H=O;if(H=H.trim(),!C&&O.split("#").length===1){var K=n.exec(H);if(K)return this.path=H,this.href=H,this.pathname=K[1],K[2]?(this.search=K[2],J?this.query=w.parse(this.search.substr(1)):this.query=this.search.substr(1)):J&&(this.search="",this.query={}),this}var re=t.exec(H);if(re){re=re[0];var oe=re.toLowerCase();this.protocol=oe,H=H.substr(re.length)}if(C||re||H.match(/^\/\/[^@/]+@[^@/]+/)){var R=H.substr(0,2)==="//";R&&!(re&&x[re])&&(H=H.substr(2),this.slashes=!0)}if(!x[re]&&(R||re&&!S[re])){for(var k=-1,P=0;P<d.length;P++){var q=H.indexOf(d[P]);q!==-1&&(k===-1||q<k)&&(k=q)}var U,D;k===-1?D=H.lastIndexOf("@"):D=H.lastIndexOf("@",k),D!==-1&&(U=H.slice(0,D),H=H.slice(D+1),this.auth=decodeURIComponent(U)),k=-1;for(var P=0;P<c.length;P++){var q=H.indexOf(c[P]);q!==-1&&(k===-1||q<k)&&(k=q)}k===-1&&(k=H.length),this.host=H.slice(0,k),H=H.slice(k),this.parseHost(),this.hostname=this.hostname||"";var Z=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!Z)for(var Y=this.hostname.split(/\./),P=0,ie=Y.length;P<ie;P++){var ue=Y[P];if(ue&&!ue.match(v)){for(var _e="",Ee=0,Ce=ue.length;Ee<Ce;Ee++)ue.charCodeAt(Ee)>127?_e+="x":_e+=ue[Ee];if(!_e.match(v)){var De=Y.slice(0,P),ce=Y.slice(P+1),Pe=ue.match(b);Pe&&(De.push(Pe[1]),ce.unshift(Pe[2])),ce.length&&(H="/"+ce.join(".")+H),this.hostname=De.join(".");break}}}this.hostname.length>g?this.hostname="":this.hostname=this.hostname.toLowerCase(),Z||(this.hostname=i.toASCII(this.hostname));var ge=this.port?":"+this.port:"",fe=this.hostname||"";this.host=fe+ge,this.href+=this.host,Z&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),H[0]!=="/"&&(H="/"+H))}if(!y[oe])for(var P=0,ie=l.length;P<ie;P++){var Ue=l[P];if(H.indexOf(Ue)!==-1){var Ie=encodeURIComponent(Ue);Ie===Ue&&(Ie=escape(Ue)),H=H.split(Ue).join(Ie)}}var Oe=H.indexOf("#");Oe!==-1&&(this.hash=H.substr(Oe),H=H.slice(0,Oe));var rt=H.indexOf("?");if(rt!==-1?(this.search=H.substr(rt),this.query=H.substr(rt+1),J&&(this.query=w.parse(this.query)),H=H.slice(0,rt)):J&&(this.search="",this.query={}),H&&(this.pathname=H),S[oe]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var ge=this.pathname||"",ht=this.search||"";this.path=ge+ht}return this.href=this.format(),this};function N(O){return typeof O=="string"&&(O=T(O)),O instanceof e?O.format():e.prototype.format.call(O)}e.prototype.format=function(){var O=this.auth||"";O&&(O=encodeURIComponent(O),O=O.replace(/%3A/i,":"),O+="@");var J=this.protocol||"",C=this.pathname||"",V=this.hash||"",se=!1,ae="";this.host?se=O+this.host:this.hostname&&(se=O+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(se+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(ae=w.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var ve=this.search||ae&&"?"+ae||"";return J&&J.substr(-1)!==":"&&(J+=":"),this.slashes||(!J||S[J])&&se!==!1?(se="//"+(se||""),C&&C.charAt(0)!=="/"&&(C="/"+C)):se||(se=""),V&&V.charAt(0)!=="#"&&(V="#"+V),ve&&ve.charAt(0)!=="?"&&(ve="?"+ve),C=C.replace(/[?#]/g,function(H){return encodeURIComponent(H)}),ve=ve.replace("#","%23"),J+se+C+ve+V};function M(O,J){return T(O,!1,!0).resolve(J)}e.prototype.resolve=function(O){return this.resolveObject(T(O,!1,!0)).format()};function F(O,J){return O?T(O,!1,!0).resolveObject(J):J}return e.prototype.resolveObject=function(O){if(typeof O=="string"){var J=new e;J.parse(O,!1,!0),O=J}for(var C=new e,V=Object.keys(this),se=0;se<V.length;se++){var ae=V[se];C[ae]=this[ae]}if(C.hash=O.hash,O.href==="")return C.href=C.format(),C;if(O.slashes&&!O.protocol){for(var ve=Object.keys(O),H=0;H<ve.length;H++){var K=ve[H];K!=="protocol"&&(C[K]=O[K])}return S[C.protocol]&&C.hostname&&!C.pathname&&(C.pathname="/",C.path=C.pathname),C.href=C.format(),C}if(O.protocol&&O.protocol!==C.protocol){if(!S[O.protocol]){for(var re=Object.keys(O),oe=0;oe<re.length;oe++){var R=re[oe];C[R]=O[R]}return C.href=C.format(),C}if(C.protocol=O.protocol,!O.host&&!x[O.protocol]){for(var ie=(O.pathname||"").split("/");ie.length&&!(O.host=ie.shift()););O.host||(O.host=""),O.hostname||(O.hostname=""),ie[0]!==""&&ie.unshift(""),ie.length<2&&ie.unshift(""),C.pathname=ie.join("/")}else C.pathname=O.pathname;if(C.search=O.search,C.query=O.query,C.host=O.host||"",C.auth=O.auth,C.hostname=O.hostname||O.host,C.port=O.port,C.pathname||C.search){var k=C.pathname||"",P=C.search||"";C.path=k+P}return C.slashes=C.slashes||O.slashes,C.href=C.format(),C}var q=C.pathname&&C.pathname.charAt(0)==="/",U=O.host||O.pathname&&O.pathname.charAt(0)==="/",D=U||q||C.host&&O.pathname,Z=D,Y=C.pathname&&C.pathname.split("/")||[],ie=O.pathname&&O.pathname.split("/")||[],ue=C.protocol&&!S[C.protocol];if(ue&&(C.hostname="",C.port=null,C.host&&(Y[0]===""?Y[0]=C.host:Y.unshift(C.host)),C.host="",O.protocol&&(O.hostname=null,O.port=null,O.host&&(ie[0]===""?ie[0]=O.host:ie.unshift(O.host)),O.host=null),D=D&&(ie[0]===""||Y[0]==="")),U)C.host=O.host||O.host===""?O.host:C.host,C.hostname=O.hostname||O.hostname===""?O.hostname:C.hostname,C.search=O.search,C.query=O.query,Y=ie;else if(ie.length)Y||(Y=[]),Y.pop(),Y=Y.concat(ie),C.search=O.search,C.query=O.query;else if(O.search!=null){if(ue){C.host=Y.shift(),C.hostname=C.host;var _e=C.host&&C.host.indexOf("@")>0?C.host.split("@"):!1;_e&&(C.auth=_e.shift(),C.hostname=_e.shift(),C.host=C.hostname)}return C.search=O.search,C.query=O.query,(C.pathname!==null||C.search!==null)&&(C.path=(C.pathname?C.pathname:"")+(C.search?C.search:"")),C.href=C.format(),C}if(!Y.length)return C.pathname=null,C.search?C.path="/"+C.search:C.path=null,C.href=C.format(),C;for(var Ee=Y.slice(-1)[0],Ce=(C.host||O.host||Y.length>1)&&(Ee==="."||Ee==="..")||Ee==="",De=0,ce=Y.length;ce>=0;ce--)Ee=Y[ce],Ee==="."?Y.splice(ce,1):Ee===".."?(Y.splice(ce,1),De++):De&&(Y.splice(ce,1),De--);if(!D&&!Z)for(;De--;De)Y.unshift("..");D&&Y[0]!==""&&(!Y[0]||Y[0].charAt(0)!=="/")&&Y.unshift(""),Ce&&Y.join("/").substr(-1)!=="/"&&Y.push("");var Pe=Y[0]===""||Y[0]&&Y[0].charAt(0)==="/";if(ue){C.hostname=Pe?"":Y.length?Y.shift():"",C.host=C.hostname;var _e=C.host&&C.host.indexOf("@")>0?C.host.split("@"):!1;_e&&(C.auth=_e.shift(),C.hostname=_e.shift(),C.host=C.hostname)}return D=D||C.host&&Y.length,D&&!Pe&&Y.unshift(""),Y.length>0?C.pathname=Y.join("/"):(C.pathname=null,C.path=null),(C.pathname!==null||C.search!==null)&&(C.path=(C.pathname?C.pathname:"")+(C.search?C.search:"")),C.auth=O.auth||C.auth,C.slashes=C.slashes||O.slashes,C.href=C.format(),C},e.prototype.parseHost=function(){var O=this.host,J=r.exec(O);J&&(J=J[0],J!==":"&&(this.port=J.substr(1)),O=O.substr(0,O.length-J.length)),O&&(this.hostname=O)},os.parse=T,os.resolve=M,os.resolveObject=F,os.format=N,os.Url=e,os}uf();const Nl={};function Xe(i,e,t=3){if(Nl[e])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${i}`):(r=r.split(`
`).splice(t).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${i}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${i}`),console.warn(r))),Nl[e]=!0}function zt(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function ci(i){return i.split("?")[0].split("#")[0]}function cf(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function df(i,e,t){return i.replace(new RegExp(cf(e),"g"),t)}function pf(i,e){let t="",r=0,n=-1,a=0,h=-1;for(let l=0;l<=i.length;++l){if(l<i.length)h=i.charCodeAt(l);else{if(h===47)break;h=47}if(h===47){if(!(n===l-1||a===1))if(n!==l-1&&a===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){const c=t.lastIndexOf("/");if(c!==t.length-1){c===-1?(t="",r=0):(t=t.slice(0,c),r=t.length-1-t.lastIndexOf("/")),n=l,a=0;continue}}else if(t.length===2||t.length===1){t="",r=0,n=l,a=0;continue}}}else t.length>0?t+=`/${i.slice(n+1,l)}`:t=i.slice(n+1,l),r=l-n-1;n=l,a=0}else h===46&&a!==-1?++a:a=-1}return t}const vt={toPosix(i){return df(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},isBlobUrl(i){return i.startsWith("blob:")},hasProtocol(i){return/^[^/:]+:/.test(this.toPosix(i))},getProtocol(i){zt(i),i=this.toPosix(i);const e=/^file:\/\/\//.exec(i);if(e)return e[0];const t=/^[^/:]+:\/{0,2}/.exec(i);return t?t[0]:""},toAbsolute(i,e,t){if(zt(i),this.isDataUrl(i)||this.isBlobUrl(i))return i;const r=ci(this.toPosix(e??Se.ADAPTER.getBaseUrl())),n=ci(this.toPosix(t??this.rootname(r)));return i=this.toPosix(i),i.startsWith("/")?vt.join(n,i.slice(1)):this.isAbsolute(i)?i:this.join(r,i)},normalize(i){if(zt(i),i.length===0)return".";if(this.isDataUrl(i)||this.isBlobUrl(i))return i;i=this.toPosix(i);let e="";const t=i.startsWith("/");this.hasProtocol(i)&&(e=this.rootname(i),i=i.slice(e.length));const r=i.endsWith("/");return i=pf(i),i.length>0&&r&&(i+="/"),t?`/${i}`:e+i},isAbsolute(i){return zt(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){if(i.length===0)return".";let e;for(let t=0;t<i.length;++t){const r=i[t];if(zt(r),r.length>0)if(e===void 0)e=r;else{const n=i[t-1]??"";this.joinExtensions.includes(this.extname(n).toLowerCase())?e+=`/../${r}`:e+=`/${r}`}}return e===void 0?".":this.normalize(e)},dirname(i){if(zt(i),i.length===0)return".";i=this.toPosix(i);let e=i.charCodeAt(0);const t=e===47;let r=-1,n=!0;const a=this.getProtocol(i),h=i;i=i.slice(a.length);for(let l=i.length-1;l>=1;--l)if(e=i.charCodeAt(l),e===47){if(!n){r=l;break}}else n=!1;return r===-1?t?"/":this.isUrl(h)?a+i:a:t&&r===1?"//":a+i.slice(0,r)},rootname(i){zt(i),i=this.toPosix(i);let e="";if(i.startsWith("/")?e="/":e=this.getProtocol(i),this.isUrl(i)){const t=i.indexOf("/",e.length);t!==-1?e=i.slice(0,t):e=i,e.endsWith("/")||(e+="/")}return e},basename(i,e){zt(i),e&&zt(e),i=ci(this.toPosix(i));let t=0,r=-1,n=!0,a;if(e!==void 0&&e.length>0&&e.length<=i.length){if(e.length===i.length&&e===i)return"";let h=e.length-1,l=-1;for(a=i.length-1;a>=0;--a){const c=i.charCodeAt(a);if(c===47){if(!n){t=a+1;break}}else l===-1&&(n=!1,l=a+1),h>=0&&(c===e.charCodeAt(h)?--h===-1&&(r=a):(h=-1,r=l))}return t===r?r=l:r===-1&&(r=i.length),i.slice(t,r)}for(a=i.length-1;a>=0;--a)if(i.charCodeAt(a)===47){if(!n){t=a+1;break}}else r===-1&&(n=!1,r=a+1);return r===-1?"":i.slice(t,r)},extname(i){zt(i),i=ci(this.toPosix(i));let e=-1,t=0,r=-1,n=!0,a=0;for(let h=i.length-1;h>=0;--h){const l=i.charCodeAt(h);if(l===47){if(!n){t=h+1;break}continue}r===-1&&(n=!1,r=h+1),l===46?e===-1?e=h:a!==1&&(a=1):e!==-1&&(a=-1)}return e===-1||r===-1||a===0||a===1&&e===r-1&&e===t+1?"":i.slice(e,r)},parse(i){zt(i);const e={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return e;i=ci(this.toPosix(i));let t=i.charCodeAt(0);const r=this.isAbsolute(i);let n;e.root=this.rootname(i),r||this.hasProtocol(i)?n=1:n=0;let a=-1,h=0,l=-1,c=!0,d=i.length-1,g=0;for(;d>=n;--d){if(t=i.charCodeAt(d),t===47){if(!c){h=d+1;break}continue}l===-1&&(c=!1,l=d+1),t===46?a===-1?a=d:g!==1&&(g=1):a!==-1&&(g=-1)}return a===-1||l===-1||g===0||g===1&&a===l-1&&a===h+1?l!==-1&&(h===0&&r?e.base=e.name=i.slice(1,l):e.base=e.name=i.slice(h,l)):(h===0&&r?(e.name=i.slice(1,a),e.base=i.slice(1,l)):(e.name=i.slice(h,a),e.base=i.slice(h,l)),e.ext=i.slice(a,l)),e.dir=this.dirname(i),e},sep:"/",delimiter:":",joinExtensions:[".html"]};let Ha;async function ff(){return Ha??(Ha=(async()=>{var a;const i=document.createElement("canvas").getContext("webgl");if(!i)return Rt.UNPACK;const e=await new Promise(h=>{const l=document.createElement("video");l.onloadeddata=()=>h(l),l.onerror=()=>h(null),l.autoplay=!1,l.crossOrigin="anonymous",l.preload="auto",l.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",l.load()});if(!e)return Rt.UNPACK;const t=i.createTexture();i.bindTexture(i.TEXTURE_2D,t);const r=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,r),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e);const n=new Uint8Array(4);return i.readPixels(0,0,1,1,i.RGBA,i.UNSIGNED_BYTE,n),i.deleteFramebuffer(r),i.deleteTexture(t),(a=i.getExtension("WEBGL_lose_context"))==null||a.loseContext(),n[0]<=n[3]?Rt.PMA:Rt.UNPACK})()),Ha}let $a;function gf(){return typeof $a>"u"&&($a=function(){var e;const i={stencil:!0,failIfMajorPerformanceCaveat:Se.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Se.ADAPTER.getWebGLRenderingContext())return!1;const t=Se.ADAPTER.createCanvas();let r=t.getContext("webgl",i)||t.getContext("experimental-webgl",i);const n=!!((e=r==null?void 0:r.getContextAttributes())!=null&&e.stencil);if(r){const a=r.getExtension("WEBGL_lose_context");a&&a.loseContext()}return r=null,n}catch{return!1}}()),$a}var mf={grad:.9,turn:360,rad:360/(2*Math.PI)},Pr=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},mt=function(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*i)/t+0},$t=function(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),i>t?t:i>e?i:e},Ju=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},Dl=function(i){return{r:$t(i.r,0,255),g:$t(i.g,0,255),b:$t(i.b,0,255),a:$t(i.a)}},Va=function(i){return{r:mt(i.r),g:mt(i.g),b:mt(i.b),a:mt(i.a,3)}},yf=/^#([0-9a-f]{3,8})$/i,Bi=function(i){var e=i.toString(16);return e.length<2?"0"+e:e},Zu=function(i){var e=i.r,t=i.g,r=i.b,n=i.a,a=Math.max(e,t,r),h=a-Math.min(e,t,r),l=h?a===e?(t-r)/h:a===t?2+(r-e)/h:4+(e-t)/h:0;return{h:60*(l<0?l+6:l),s:a?h/a*100:0,v:a/255*100,a:n}},Qu=function(i){var e=i.h,t=i.s,r=i.v,n=i.a;e=e/360*6,t/=100,r/=100;var a=Math.floor(e),h=r*(1-t),l=r*(1-(e-a)*t),c=r*(1-(1-e+a)*t),d=a%6;return{r:255*[r,l,h,h,c,r][d],g:255*[c,r,r,l,h,h][d],b:255*[h,h,c,r,r,l][d],a:n}},Fl=function(i){return{h:Ju(i.h),s:$t(i.s,0,100),l:$t(i.l,0,100),a:$t(i.a)}},Bl=function(i){return{h:mt(i.h),s:mt(i.s),l:mt(i.l),a:mt(i.a,3)}},Ll=function(i){return Qu((t=(e=i).s,{h:e.h,s:(t*=((r=e.l)<50?r:100-r)/100)>0?2*t/(r+t)*100:0,v:r+t,a:e.a}));var e,t,r},wi=function(i){return{h:(e=Zu(i)).h,s:(n=(200-(t=e.s))*(r=e.v)/100)>0&&n<200?t*r/100/(n<=100?n:200-n)*100:0,l:n/2,a:e.a};var e,t,r,n},vf=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,bf=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,_f=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,xf=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,mo={string:[[function(i){var e=yf.exec(i);return e?(i=e[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?mt(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?mt(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var e=_f.exec(i)||xf.exec(i);return e?e[2]!==e[4]||e[4]!==e[6]?null:Dl({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(i){var e=vf.exec(i)||bf.exec(i);if(!e)return null;var t,r,n=Fl({h:(t=e[1],r=e[2],r===void 0&&(r="deg"),Number(t)*(mf[r]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return Ll(n)},"hsl"]],object:[[function(i){var e=i.r,t=i.g,r=i.b,n=i.a,a=n===void 0?1:n;return Pr(e)&&Pr(t)&&Pr(r)?Dl({r:Number(e),g:Number(t),b:Number(r),a:Number(a)}):null},"rgb"],[function(i){var e=i.h,t=i.s,r=i.l,n=i.a,a=n===void 0?1:n;if(!Pr(e)||!Pr(t)||!Pr(r))return null;var h=Fl({h:Number(e),s:Number(t),l:Number(r),a:Number(a)});return Ll(h)},"hsl"],[function(i){var e=i.h,t=i.s,r=i.v,n=i.a,a=n===void 0?1:n;if(!Pr(e)||!Pr(t)||!Pr(r))return null;var h=function(l){return{h:Ju(l.h),s:$t(l.s,0,100),v:$t(l.v,0,100),a:$t(l.a)}}({h:Number(e),s:Number(t),v:Number(r),a:Number(a)});return Qu(h)},"hsv"]]},Ul=function(i,e){for(var t=0;t<e.length;t++){var r=e[t][0](i);if(r)return[r,e[t][1]]}return[null,void 0]},Ef=function(i){return typeof i=="string"?Ul(i.trim(),mo.string):typeof i=="object"&&i!==null?Ul(i,mo.object):[null,void 0]},Wa=function(i,e){var t=wi(i);return{h:t.h,s:$t(t.s+100*e,0,100),l:t.l,a:t.a}},za=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},Gl=function(i,e){var t=wi(i);return{h:t.h,s:t.s,l:$t(t.l+100*e,0,100),a:t.a}},yo=function(){function i(e){this.parsed=Ef(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return mt(za(this.rgba),2)},i.prototype.isDark=function(){return za(this.rgba)<.5},i.prototype.isLight=function(){return za(this.rgba)>=.5},i.prototype.toHex=function(){return e=Va(this.rgba),t=e.r,r=e.g,n=e.b,h=(a=e.a)<1?Bi(mt(255*a)):"","#"+Bi(t)+Bi(r)+Bi(n)+h;var e,t,r,n,a,h},i.prototype.toRgb=function(){return Va(this.rgba)},i.prototype.toRgbString=function(){return e=Va(this.rgba),t=e.r,r=e.g,n=e.b,(a=e.a)<1?"rgba("+t+", "+r+", "+n+", "+a+")":"rgb("+t+", "+r+", "+n+")";var e,t,r,n,a},i.prototype.toHsl=function(){return Bl(wi(this.rgba))},i.prototype.toHslString=function(){return e=Bl(wi(this.rgba)),t=e.h,r=e.s,n=e.l,(a=e.a)<1?"hsla("+t+", "+r+"%, "+n+"%, "+a+")":"hsl("+t+", "+r+"%, "+n+"%)";var e,t,r,n,a},i.prototype.toHsv=function(){return e=Zu(this.rgba),{h:mt(e.h),s:mt(e.s),v:mt(e.v),a:mt(e.a,3)};var e},i.prototype.invert=function(){return lr({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},i.prototype.saturate=function(e){return e===void 0&&(e=.1),lr(Wa(this.rgba,e))},i.prototype.desaturate=function(e){return e===void 0&&(e=.1),lr(Wa(this.rgba,-e))},i.prototype.grayscale=function(){return lr(Wa(this.rgba,-1))},i.prototype.lighten=function(e){return e===void 0&&(e=.1),lr(Gl(this.rgba,e))},i.prototype.darken=function(e){return e===void 0&&(e=.1),lr(Gl(this.rgba,-e))},i.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},i.prototype.alpha=function(e){return typeof e=="number"?lr({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):mt(this.rgba.a,3);var t},i.prototype.hue=function(e){var t=wi(this.rgba);return typeof e=="number"?lr({h:e,s:t.s,l:t.l,a:t.a}):mt(t.h)},i.prototype.isEqual=function(e){return this.toHex()===lr(e).toHex()},i}(),lr=function(i){return i instanceof yo?i:new yo(i)},jl=[],wf=function(i){i.forEach(function(e){jl.indexOf(e)<0&&(e(yo,mo),jl.push(e))})};function Sf(i,e){var t={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var n in t)r[t[n]]=n;var a={};i.prototype.toName=function(h){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var l,c,d=r[this.toHex()];if(d)return d;if(h!=null&&h.closest){var g=this.toRgb(),v=1/0,b="black";if(!a.length)for(var y in t)a[y]=new i(t[y]).toRgb();for(var x in t){var S=(l=g,c=a[x],Math.pow(l.r-c.r,2)+Math.pow(l.g-c.g,2)+Math.pow(l.b-c.b,2));S<v&&(v=S,b=x)}return b}},e.string.push([function(h){var l=h.toLowerCase(),c=l==="transparent"?"#0000":t[l];return c?new i(c).toRgb():null},"name"])}wf([Sf]);const Ds=class sn{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof sn)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?{...e}:e}isSourceEqual(e,t){const r=typeof e;if(r!==typeof t)return!1;if(r==="number"||r==="string"||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length!==t.length?!1:e.every((n,a)=>n===t[a]);if(e!==null&&t!==null){const n=Object.keys(e),a=Object.keys(t);return n.length!==a.length?!1:n.every(h=>e[h]===t[h])}return e===t}toRgba(){const[e,t,r,n]=this._components;return{r:e,g:t,b:r,a:n}}toRgb(){const[e,t,r]=this._components;return{r:e,g:t,b:r}}toRgbaString(){const[e,t,r]=this.toUint8RgbArray();return`rgba(${e},${t},${r},${this.alpha})`}toUint8RgbArray(e){const[t,r,n]=this._components;return e=e??[],e[0]=Math.round(t*255),e[1]=Math.round(r*255),e[2]=Math.round(n*255),e}toRgbArray(e){e=e??[];const[t,r,n]=this._components;return e[0]=t,e[1]=r,e[2]=n,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[t,r,n,a]=sn.temp.setValue(e)._components;return this._components[0]*=t,this._components[1]*=r,this._components[2]*=n,this._components[3]*=a,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(e===1)return(255<<24)+this._int;if(e===0)return t?0:this._int;let r=this._int>>16&255,n=this._int>>8&255,a=this._int&255;return t&&(r=r*e+.5|0,n=n*e+.5|0,a=a*e+.5|0),(e*255<<24)+(r<<16)+(n<<8)+a}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[t,r,n]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(r*e)/e,this._components[2]=Math.round(n*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e??[];const[t,r,n,a]=this._components;return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e}normalize(e){let t,r,n,a;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const h=e;t=(h>>16&255)/255,r=(h>>8&255)/255,n=(h&255)/255,a=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[t,r,n,a=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[t,r,n,a=255]=e,t/=255,r/=255,n/=255,a/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const l=sn.HEX_PATTERN.exec(e);l&&(e=`#${l[2]}`)}const h=lr(e);h.isValid()&&({r:t,g:r,b:n,a}=h.rgba,t/=255,r/=255,n/=255)}if(t!==void 0)this._components[0]=t,this._components[1]=r,this._components[2]=n,this._components[3]=a,this.refreshInt();else throw new Error(`Unable to convert color ${e}`)}refreshInt(){this._clamp(this._components);const[e,t,r]=this._components;this._int=(e*255<<16)+(t*255<<8)+(r*255|0)}_clamp(e,t=0,r=1){return typeof e=="number"?Math.min(Math.max(e,t),r):(e.forEach((n,a)=>{e[a]=Math.min(Math.max(n,t),r)}),e)}};Ds.shared=new Ds,Ds.temp=new Ds,Ds.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let st=Ds;function Tf(i,e=[]){return Xe("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),st.shared.setValue(i).toRgbArray(e)}function Af(i){return Xe("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),st.shared.setValue(i).toHex()}function ec(i){return Xe("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),st.shared.setValue(i).toNumber()}function Cf(){const i=[],e=[];for(let r=0;r<32;r++)i[r]=r,e[r]=r;i[Be.NORMAL_NPM]=Be.NORMAL,i[Be.ADD_NPM]=Be.ADD,i[Be.SCREEN_NPM]=Be.SCREEN,e[Be.NORMAL]=Be.NORMAL_NPM,e[Be.ADD]=Be.ADD_NPM,e[Be.SCREEN]=Be.SCREEN_NPM;const t=[];return t.push(e),t.push(i),t}const tc=Cf();function rc(i,e){return tc[e?1:0][i]}function Pf(i,e=null){const t=i*6;if(e=e||new Uint16Array(t),e.length!==t)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${t}`);for(let r=0,n=0;r<t;r+=6,n+=4)e[r+0]=n+0,e[r+1]=n+1,e[r+2]=n+2,e[r+3]=n+0,e[r+4]=n+2,e[r+5]=n+3;return e}function sc(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}function pn(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function Hl(i){return!(i&i-1)&&!!i}function $l(i){let e=(i>65535?1:0)<<4;i>>>=e;let t=(i>255?1:0)<<3;return i>>>=t,e|=t,t=(i>15?1:0)<<2,i>>>=t,e|=t,t=(i>3?1:0)<<1,i>>>=t,e|=t,e|i>>1}function Vs(i,e,t){const r=i.length;let n;if(e>=r||t===0)return;t=e+t>r?r-e:t;const a=r-t;for(n=e;n<a;++n)i[n]=i[n+t];i.length=a}function Yr(i){return i===0?0:i<0?-1:1}let If=0;function xs(){return++If}const vo=class{constructor(i,e,t,r){this.left=i,this.top=e,this.right=t,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};vo.EMPTY=new vo(0,0,0,0);let Vl=vo;const Wl={},ur=Object.create(null),Wr=Object.create(null);class Rf{constructor(e,t,r){this._canvas=Se.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||Se.RESOLUTION,this.resize(e,t)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,t){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(t*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function zl(i,e,t){for(let r=0,n=4*t*e;r<e;++r,n+=4)if(i[n+3]!==0)return!1;return!0}function ql(i,e,t,r,n){const a=4*e;for(let h=r,l=r*a+4*t;h<=n;++h,l+=a)if(i[l+3]!==0)return!1;return!0}function Mf(i){const{width:e,height:t}=i,r=i.getContext("2d",{willReadFrequently:!0});if(r===null)throw new TypeError("Failed to get canvas 2D context");const n=r.getImageData(0,0,e,t).data;let a=0,h=0,l=e-1,c=t-1;for(;h<t&&zl(n,e,h);)++h;if(h===t)return Vl.EMPTY;for(;zl(n,e,c);)--c;for(;ql(n,e,a,h,c);)++a;for(;ql(n,e,l,h,c);)--l;return++l,++c,new Vl(a,h,l,c)}function Of(i){const e=Mf(i),{width:t,height:r}=e;let n=null;if(!e.isEmpty()){const a=i.getContext("2d");if(a===null)throw new TypeError("Failed to get canvas 2D context");n=a.getImageData(e.left,e.top,t,r)}return{width:t,height:r,data:n}}function kf(i,e=globalThis.location){if(i.startsWith("data:"))return"";e=e||globalThis.location;const t=new URL(i,document.baseURI);return t.hostname!==e.hostname||t.port!==e.port||t.protocol!==e.protocol?"anonymous":""}function Nr(i,e=1){var r;const t=(r=Se.RETINA_PREFIX)==null?void 0:r.exec(i);return t?parseFloat(t[1]):e}var be=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(be||{});const bo=i=>{if(typeof i=="function"||typeof i=="object"&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}}if(typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},Xl=(i,e)=>bo(i).priority??e,Me={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(bo).forEach(e=>{e.type.forEach(t=>{var r,n;return(n=(r=this._removeHandlers)[t])==null?void 0:n.call(r,e)})}),this},add(...i){return i.map(bo).forEach(e=>{e.type.forEach(t=>{var a,h;const r=this._addHandlers,n=this._queue;r[t]?(a=r[t])==null||a.call(r,e):(n[t]=n[t]||[],(h=n[t])==null||h.push(e))})}),this},handle(i,e,t){var h;const r=this._addHandlers,n=this._removeHandlers;if(r[i]||n[i])throw new Error(`Extension type ${i} already has a handler`);r[i]=e,n[i]=t;const a=this._queue;return a[i]&&((h=a[i])==null||h.forEach(l=>e(l)),delete a[i]),this},handleByMap(i,e){return this.handle(i,t=>{t.name&&(e[t.name]=t.ref)},t=>{t.name&&delete e[t.name]})},handleByList(i,e,t=-1){return this.handle(i,r=>{e.includes(r.ref)||(e.push(r.ref),e.sort((n,a)=>Xl(a,t)-Xl(n,t)))},r=>{const n=e.indexOf(r.ref);n!==-1&&e.splice(n,1)})}};class _o{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}const Nf=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Df(i){let e="";for(let t=0;t<i;++t)t>0&&(e+=`
else `),t<i-1&&(e+=`if(test == ${t}.0){}`);return e}function Ff(i,e){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const t=e.createShader(e.FRAGMENT_SHADER);for(;;){const r=Nf.replace(/%forloop%/gi,Df(i));if(e.shaderSource(t,r),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))i=i/2|0;else break}return i}const qa=0,Xa=1,Ka=2,Ya=3,Ja=4,Za=5;class _r{constructor(){this.data=0,this.blendMode=Be.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<qa)}set blend(e){!!(this.data&1<<qa)!==e&&(this.data^=1<<qa)}get offsets(){return!!(this.data&1<<Xa)}set offsets(e){!!(this.data&1<<Xa)!==e&&(this.data^=1<<Xa)}get culling(){return!!(this.data&1<<Ka)}set culling(e){!!(this.data&1<<Ka)!==e&&(this.data^=1<<Ka)}get depthTest(){return!!(this.data&1<<Ya)}set depthTest(e){!!(this.data&1<<Ya)!==e&&(this.data^=1<<Ya)}get depthMask(){return!!(this.data&1<<Za)}set depthMask(e){!!(this.data&1<<Za)!==e&&(this.data^=1<<Za)}get clockwiseFrontFace(){return!!(this.data&1<<Ja)}set clockwiseFrontFace(e){!!(this.data&1<<Ja)!==e&&(this.data^=1<<Ja)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==Be.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){const e=new _r;return e.depthTest=!1,e.blend=!0,e}}_r.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const xo=[];function ic(i,e){if(!i)return null;let t="";if(typeof i=="string"){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(t=r[1].toLowerCase())}for(let r=xo.length-1;r>=0;--r){const n=xo[r];if(n.test&&n.test(i,t))return new n(i,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class Jt{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,t,r,n,a,h,l,c){if(arguments.length>8)throw new Error("max arguments reached");const{name:d,items:g}=this;this._aliasCount++;for(let v=0,b=g.length;v<b;v++)g[v][d](e,t,r,n,a,h,l,c);return g===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const t=this.items.indexOf(e);return t!==-1&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Jt.prototype,{dispatch:{value:Jt.prototype.emit},run:{value:Jt.prototype.emit}});class Si{constructor(e=0,t=0){this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new Jt("setRealSize"),this.onUpdate=new Jt("update"),this.onError=new Jt("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,t,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,t){return!1}}class On extends Si{constructor(e,t){const{width:r,height:n}=t||{};if(!r||!n)throw new Error("BufferResource width or height invalid");super(r,n),this.data=e,this.unpackAlignment=t.unpackAlignment??4}upload(e,t,r){const n=e.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,this.unpackAlignment),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===Rt.UNPACK);const a=t.realWidth,h=t.realHeight;return r.width===a&&r.height===h?n.texSubImage2D(t.target,0,0,0,a,h,t.format,r.type,this.data):(r.width=a,r.height=h,n.texImage2D(t.target,0,r.internalFormat,a,h,0,t.format,r.type,this.data)),!0}dispose(){this.data=null}static test(e){return e===null||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}const Bf={scaleMode:Rr.NEAREST,alphaMode:Rt.NPM},Eo=class Fs extends Ci{constructor(e=null,t=null){super(),t=Object.assign({},Fs.defaultOptions,t);const{alphaMode:r,mipmap:n,anisotropicLevel:a,scaleMode:h,width:l,height:c,wrapMode:d,format:g,type:v,target:b,resolution:y,resourceOptions:x}=t;e&&!(e instanceof Si)&&(e=ic(e,x),e.internal=!0),this.resolution=y||Se.RESOLUTION,this.width=Math.round((l||0)*this.resolution)/this.resolution,this.height=Math.round((c||0)*this.resolution)/this.resolution,this._mipmap=n,this.anisotropicLevel=a,this._wrapMode=d,this._scaleMode=h,this.format=g,this.type=v,this.target=b,this.alphaMode=r,this.uid=xs(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=l>0&&c>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let r;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,r=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,r=!0),r&&this.dirtyStyleId++,this}setSize(e,t,r){return r=r||this.resolution,this.setRealSize(e*r,t*r,r)}setRealSize(e,t,r){return this.resolution=r||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Hl(this.realWidth)&&Hl(this.realHeight)}setResolution(e){const t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Wr[this.cacheId],delete ur[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),Fs.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,r=Se.STRICT_TEXTURE_CACHE){const n=typeof e=="string";let a=null;if(n)a=e;else{if(!e._pixiId){const l=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${l}_${xs()}`}a=e._pixiId}let h=Wr[a];if(n&&r&&!h)throw new Error(`The cacheId "${a}" does not exist in BaseTextureCache.`);return h||(h=new Fs(e,t),h.cacheId=a,Fs.addToCache(h,a)),h}static fromBuffer(e,t,r,n){e=e||new Float32Array(t*r*4);const a=new On(e,{width:t,height:r,...n==null?void 0:n.resourceOptions});let h,l;return e instanceof Float32Array?(h=de.RGBA,l=Fe.FLOAT):e instanceof Int32Array?(h=de.RGBA_INTEGER,l=Fe.INT):e instanceof Uint32Array?(h=de.RGBA_INTEGER,l=Fe.UNSIGNED_INT):e instanceof Int16Array?(h=de.RGBA_INTEGER,l=Fe.SHORT):e instanceof Uint16Array?(h=de.RGBA_INTEGER,l=Fe.UNSIGNED_SHORT):e instanceof Int8Array?(h=de.RGBA,l=Fe.BYTE):(h=de.RGBA,l=Fe.UNSIGNED_BYTE),a.internal=!0,new Fs(a,Object.assign({},Bf,{type:l,format:h},n))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),Wr[t]&&Wr[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),Wr[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=Wr[e];if(t){const r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete Wr[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete Wr[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};Eo.defaultOptions={mipmap:br.POW2,anisotropicLevel:0,scaleMode:Rr.LINEAR,wrapMode:Zr.CLAMP,alphaMode:Rt.UNPACK,target:$s.TEXTURE_2D,format:de.RGBA,type:Fe.UNSIGNED_BYTE},Eo._globalBatch=0;let He=Eo;class wo{constructor(){this.texArray=null,this.blend=0,this.type=gr.TRIANGLES,this.start=0,this.size=0,this.data=null}}let Lf=0;class lt{constructor(e,t=!0,r=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=t,this.id=Lf++,this.disposeRunner=new Jt("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?mr.ELEMENT_ARRAY_BUFFER:mr.ARRAY_BUFFER}get index(){return this.type===mr.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new lt(e)}}class fn{constructor(e,t=0,r=!1,n=Fe.FLOAT,a,h,l,c=1){this.buffer=e,this.size=t,this.normalized=r,this.type=n,this.stride=a,this.start=h,this.instance=l,this.divisor=c}destroy(){this.buffer=null}static from(e,t,r,n,a){return new fn(e,t,r,n,a)}}const Uf={Float32Array,Uint32Array,Int32Array,Uint8Array};function Gf(i,e){let t=0,r=0;const n={};for(let c=0;c<i.length;c++)r+=e[c],t+=i[c].length;const a=new ArrayBuffer(t*4);let h=null,l=0;for(let c=0;c<i.length;c++){const d=e[c],g=i[c],v=sc(g);n[v]||(n[v]=new Uf[v](a)),h=n[v];for(let b=0;b<g.length;b++){const y=(b/d|0)*r+l,x=b%d;h[y+x]=g[b]}l+=d}return new Float32Array(a)}const Kl={5126:4,5123:2,5121:1};let jf=0;const Hf={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Qr{constructor(e=[],t={}){this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=jf++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Jt("disposeGeometry"),this.refCount=0}addAttribute(e,t,r=0,n=!1,a,h,l,c=!1){if(!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof lt||(t instanceof Array&&(t=new Float32Array(t)),t=new lt(t));const d=e.split("|");if(d.length>1){for(let v=0;v<d.length;v++)this.addAttribute(d[v],t,r,n,a);return this}let g=this.buffers.indexOf(t);return g===-1&&(this.buffers.push(t),g=this.buffers.length-1),this.attributes[e]=new fn(g,r,n,a,h,l,c),this.instanced=this.instanced||c,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof lt||(e instanceof Array&&(e=new Uint16Array(e)),e=new lt(e)),e.type=mr.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const e=[],t=[],r=new lt;let n;for(n in this.attributes){const a=this.attributes[n],h=this.buffers[a.buffer];e.push(h.data),t.push(a.size*Kl[a.type]/4),a.buffer=0}for(r.data=Gf(e,t),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const e in this.attributes){const t=this.attributes[e];return this.buffers[t.buffer].data.length/(t.stride/4||t.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new Qr;for(let t=0;t<this.buffers.length;t++)e.buffers[t]=new lt(this.buffers[t].data.slice(0));for(const t in this.attributes){const r=this.attributes[t];e.attributes[t]=new fn(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=mr.ELEMENT_ARRAY_BUFFER),e}static merge(e){const t=new Qr,r=[],n=[],a=[];let h;for(let l=0;l<e.length;l++){h=e[l];for(let c=0;c<h.buffers.length;c++)n[c]=n[c]||0,n[c]+=h.buffers[c].data.length,a[c]=0}for(let l=0;l<h.buffers.length;l++)r[l]=new Hf[sc(h.buffers[l].data)](n[l]),t.buffers[l]=new lt(r[l]);for(let l=0;l<e.length;l++){h=e[l];for(let c=0;c<h.buffers.length;c++)r[c].set(h.buffers[c].data,a[c]),a[c]+=h.buffers[c].data.length}if(t.attributes=h.attributes,h.indexBuffer){t.indexBuffer=t.buffers[h.buffers.indexOf(h.indexBuffer)],t.indexBuffer.type=mr.ELEMENT_ARRAY_BUFFER;let l=0,c=0,d=0,g=0;for(let v=0;v<h.buffers.length;v++)if(h.buffers[v]!==h.indexBuffer){g=v;break}for(const v in h.attributes){const b=h.attributes[v];(b.buffer|0)===g&&(c+=b.size*Kl[b.type]/4)}for(let v=0;v<e.length;v++){const b=e[v].indexBuffer.data;for(let y=0;y<b.length;y++)t.indexBuffer.data[y+d]+=l;l+=e[v].buffers[g].data.length/c,d+=b.length}}return t}}class nc extends Qr{constructor(e=!1){super(),this._buffer=new lt(null,e,!1),this._indexBuffer=new lt(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,Fe.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,Fe.FLOAT).addAttribute("aColor",this._buffer,4,!0,Fe.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,Fe.FLOAT).addIndex(this._indexBuffer)}}const gn=Math.PI*2,$f=180/Math.PI,Vf=Math.PI/180;var _t=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(_t||{});class Ze{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new Ze(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}}Ze.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Li=[new Ze,new Ze,new Ze,new Ze];class We{constructor(e=0,t=0,r=0,n=0){this.x=Number(e),this.y=Number(t),this.width=Number(r),this.height=Number(n),this.type=_t.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new We(0,0,0,0)}clone(){return new We(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}intersects(e,t){if(!t){const V=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=V)return!1;const se=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>se}const r=this.left,n=this.right,a=this.top,h=this.bottom;if(n<=r||h<=a)return!1;const l=Li[0].set(e.left,e.top),c=Li[1].set(e.left,e.bottom),d=Li[2].set(e.right,e.top),g=Li[3].set(e.right,e.bottom);if(d.x<=l.x||c.y<=l.y)return!1;const v=Math.sign(t.a*t.d-t.b*t.c);if(v===0||(t.apply(l,l),t.apply(c,c),t.apply(d,d),t.apply(g,g),Math.max(l.x,c.x,d.x,g.x)<=r||Math.min(l.x,c.x,d.x,g.x)>=n||Math.max(l.y,c.y,d.y,g.y)<=a||Math.min(l.y,c.y,d.y,g.y)>=h))return!1;const b=v*(c.y-l.y),y=v*(l.x-c.x),x=b*r+y*a,S=b*n+y*a,w=b*r+y*h,T=b*n+y*h;if(Math.max(x,S,w,T)<=b*l.x+y*l.y||Math.min(x,S,w,T)>=b*g.x+y*g.y)return!1;const N=v*(l.y-d.y),M=v*(d.x-l.x),F=N*r+M*a,O=N*n+M*a,J=N*r+M*h,C=N*n+M*h;return!(Math.max(F,O,J,C)<=N*l.x+M*l.y||Math.min(F,O,J,C)>=N*g.x+M*g.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2,this}fit(e){const t=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),n=Math.max(this.y,e.y),a=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(r-t,0),this.y=n,this.height=Math.max(a-n,0),this}ceil(e=1,t=.001){const r=Math.ceil((this.x+this.width-t)*e)/e,n=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=r-this.x,this.height=n-this.y,this}enlarge(e){const t=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),n=Math.min(this.y,e.y),a=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=r-t,this.y=n,this.height=a-n,this}}We.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class kn{constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.radius=r,this.type=_t.CIRC}clone(){return new kn(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;const r=this.radius*this.radius;let n=this.x-e,a=this.y-t;return n*=n,a*=a,n+a<=r}getBounds(){return new We(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}kn.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class Nn{constructor(e=0,t=0,r=0,n=0){this.x=e,this.y=t,this.width=r,this.height=n,this.type=_t.ELIP}clone(){return new Nn(this.x,this.y,this.width,this.height)}contains(e,t){if(this.width<=0||this.height<=0)return!1;let r=(e-this.x)/this.width,n=(t-this.y)/this.height;return r*=r,n*=n,r+n<=1}getBounds(){return new We(this.x-this.width,this.y-this.height,this.width,this.height)}}Nn.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class vs{constructor(...e){let t=Array.isArray(e[0])?e[0]:e;if(typeof t[0]!="number"){const r=[];for(let n=0,a=t.length;n<a;n++)r.push(t[n].x,t[n].y);t=r}this.points=t,this.type=_t.POLY,this.closeStroke=!0}clone(){const e=this.points.slice(),t=new vs(e);return t.closeStroke=this.closeStroke,t}contains(e,t){let r=!1;const n=this.points.length/2;for(let a=0,h=n-1;a<n;h=a++){const l=this.points[a*2],c=this.points[a*2+1],d=this.points[h*2],g=this.points[h*2+1];c>t!=g>t&&e<(d-l)*((t-c)/(g-c))+l&&(r=!r)}return r}}vs.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((i,e)=>`${i}, ${e}`,"")}]`};class Dn{constructor(e=0,t=0,r=0,n=0,a=20){this.x=e,this.y=t,this.width=r,this.height=n,this.radius=a,this.type=_t.RREC}clone(){return new Dn(this.x,this.y,this.width,this.height,this.radius)}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+r&&t<=this.y+this.height-r||e>=this.x+r&&e<=this.x+this.width-r)return!0;let n=e-(this.x+r),a=t-(this.y+r);const h=r*r;if(n*n+a*a<=h||(n=e-(this.x+this.width-r),n*n+a*a<=h)||(a=t-(this.y+this.height-r),n*n+a*a<=h)||(n=e-(this.x+r),n*n+a*a<=h))return!0}return!1}}Dn.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class it{constructor(e=1,t=0,r=0,n=1,a=0,h=0){this.array=null,this.a=e,this.b=t,this.c=r,this.d=n,this.tx=a,this.ty=h}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,r,n,a,h){return this.a=e,this.b=t,this.c=r,this.d=n,this.tx=a,this.ty=h,this}toArray(e,t){this.array||(this.array=new Float32Array(9));const r=t||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(e,t){t=t||new Ze;const r=e.x,n=e.y;return t.x=this.a*r+this.c*n+this.tx,t.y=this.b*r+this.d*n+this.ty,t}applyInverse(e,t){t=t||new Ze;const r=1/(this.a*this.d+this.c*-this.b),n=e.x,a=e.y;return t.x=this.d*r*n+-this.c*r*a+(this.ty*this.c-this.tx*this.d)*r,t.y=this.a*r*a+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){const t=Math.cos(e),r=Math.sin(e),n=this.a,a=this.c,h=this.tx;return this.a=n*t-this.b*r,this.b=n*r+this.b*t,this.c=a*t-this.d*r,this.d=a*r+this.d*t,this.tx=h*t-this.ty*r,this.ty=h*r+this.ty*t,this}append(e){const t=this.a,r=this.b,n=this.c,a=this.d;return this.a=e.a*t+e.b*n,this.b=e.a*r+e.b*a,this.c=e.c*t+e.d*n,this.d=e.c*r+e.d*a,this.tx=e.tx*t+e.ty*n+this.tx,this.ty=e.tx*r+e.ty*a+this.ty,this}setTransform(e,t,r,n,a,h,l,c,d){return this.a=Math.cos(l+d)*a,this.b=Math.sin(l+d)*a,this.c=-Math.sin(l-c)*h,this.d=Math.cos(l-c)*h,this.tx=e-(r*this.a+n*this.c),this.ty=t-(r*this.b+n*this.d),this}prepend(e){const t=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){const r=this.a,n=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){const t=this.a,r=this.b,n=this.c,a=this.d,h=e.pivot,l=-Math.atan2(-n,a),c=Math.atan2(r,t),d=Math.abs(l+c);return d<1e-5||Math.abs(gn-d)<1e-5?(e.rotation=c,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=l,e.skew.y=c),e.scale.x=Math.sqrt(t*t+r*r),e.scale.y=Math.sqrt(n*n+a*a),e.position.x=this.tx+(h.x*t+h.y*n),e.position.y=this.ty+(h.x*r+h.y*a),e}invert(){const e=this.a,t=this.b,r=this.c,n=this.d,a=this.tx,h=e*n-t*r;return this.a=n/h,this.b=-t/h,this.c=-r/h,this.d=e/h,this.tx=(r*this.ty-n*a)/h,this.ty=-(e*this.ty-t*a)/h,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new it;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return new it}static get TEMP_MATRIX(){return new it}}it.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const us=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],cs=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],ds=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],ps=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],So=[],ac=[],Ui=Math.sign;function Wf(){for(let i=0;i<16;i++){const e=[];So.push(e);for(let t=0;t<16;t++){const r=Ui(us[i]*us[t]+ds[i]*cs[t]),n=Ui(cs[i]*us[t]+ps[i]*cs[t]),a=Ui(us[i]*ds[t]+ds[i]*ps[t]),h=Ui(cs[i]*ds[t]+ps[i]*ps[t]);for(let l=0;l<16;l++)if(us[l]===r&&cs[l]===n&&ds[l]===a&&ps[l]===h){e.push(l);break}}}for(let i=0;i<16;i++){const e=new it;e.set(us[i],cs[i],ds[i],ps[i],0,0),ac.push(e)}}Wf();const at={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>us[i],uY:i=>cs[i],vX:i=>ds[i],vY:i=>ps[i],inv:i=>i&8?i&15:-i&7,add:(i,e)=>So[i][e],sub:(i,e)=>So[i][at.inv(e)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,e)=>Math.abs(i)*2<=Math.abs(e)?e>=0?at.S:at.N:Math.abs(e)*2<=Math.abs(i)?i>0?at.E:at.W:e>0?i>0?at.SE:at.SW:i>0?at.NE:at.NW,matrixAppendRotationInv:(i,e,t=0,r=0)=>{const n=ac[at.inv(e)];n.tx=t,n.ty=r,i.append(n)}};class Or{constructor(e,t,r=0,n=0){this._x=r,this._y=n,this.cb=e,this.scope=t}clone(e=this.cb,t=this.scope){return new Or(e,t,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}Or.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const To=class{constructor(){this.worldTransform=new it,this.localTransform=new it,this.position=new Or(this.onChange,this,0,0),this.scale=new Or(this.onChange,this,1,1),this.pivot=new Or(this.onChange,this,0,0),this.skew=new Or(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){const t=i.worldTransform,r=this.worldTransform;r.a=e.a*t.a+e.b*t.c,r.b=e.a*t.b+e.b*t.d,r.c=e.c*t.a+e.d*t.c,r.d=e.c*t.b+e.d*t.d,r.tx=e.tx*t.a+e.ty*t.c+t.tx,r.ty=e.tx*t.b+e.ty*t.d+t.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}};To.IDENTITY=new To;let nh=To;nh.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var zf=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,qf=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Yl(i,e,t){const r=i.createShader(e);return i.shaderSource(r,t),i.compileShader(r),r}function Qa(i){const e=new Array(i);for(let t=0;t<e.length;t++)e[t]=!1;return e}function oc(i,e){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return Qa(2*e);case"bvec3":return Qa(3*e);case"bvec4":return Qa(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Ws=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,e)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(e==null||e.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,e)=>i.type==="mat3"&&i.size===1&&!i.isArray&&e.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,e)=>i.type==="vec2"&&i.size===1&&!i.isArray&&e.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,e)=>i.type==="vec4"&&i.size===1&&!i.isArray&&e.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(i,e)=>i.type==="vec4"&&i.size===1&&!i.isArray&&e.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${i}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(i,e)=>i.type==="vec3"&&i.size===1&&!i.isArray&&e.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${i}"].location, v.red, v.green, v.blue)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}],Xf={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},Kf={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function Yf(i,e){var r;const t=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const n in i.uniforms){const a=e[n];if(!a){((r=i.uniforms[n])==null?void 0:r.group)===!0&&(i.uniforms[n].ubo?t.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');
                    `):t.push(`
                        renderer.shader.syncUniformGroup(uv.${n}, syncData);
                    `));continue}const h=i.uniforms[n];let l=!1;for(let c=0;c<Ws.length;c++)if(Ws[c].test(a,h)){t.push(Ws[c].code(n,h)),l=!0;break}if(!l){const c=(a.size===1&&!a.isArray?Xf:Kf)[a.type].replace("location",`ud["${n}"].location`);t.push(`
            cu = ud["${n}"];
            cv = cu.value;
            v = uv["${n}"];
            ${c};`)}}return new Function("ud","uv","renderer","syncData",t.join(`
`))}const hc={};let ks=hc;function Jf(){if(ks===hc||ks!=null&&ks.isContextLost()){const i=Se.ADAPTER.createCanvas();let e;Se.PREFER_ENV>=ws.WEBGL2&&(e=i.getContext("webgl2",{})),e||(e=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),ks=e}return ks}let Gi;function Zf(){if(!Gi){Gi=Ht.MEDIUM;const i=Jf();if(i&&i.getShaderPrecisionFormat){const e=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);e&&(Gi=e.precision?Ht.HIGH:Ht.MEDIUM)}}return Gi}function Jl(i,e){const t=i.getShaderSource(e).split(`
`).map((d,g)=>`${g}: ${d}`),r=i.getShaderInfoLog(e),n=r.split(`
`),a={},h=n.map(d=>parseFloat(d.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(d=>d&&!a[d]?(a[d]=!0,!0):!1),l=[""];h.forEach(d=>{t[d-1]=`%c${t[d-1]}%c`,l.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const c=t.join(`
`);l[0]=c,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...l),console.groupEnd()}function Qf(i,e,t,r){i.getProgramParameter(e,i.LINK_STATUS)||(i.getShaderParameter(t,i.COMPILE_STATUS)||Jl(i,t),i.getShaderParameter(r,i.COMPILE_STATUS)||Jl(i,r),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(e)))}const eg={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function lc(i){return eg[i]}let ji=null;const Zl={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function uc(i,e){if(!ji){const t=Object.keys(Zl);ji={};for(let r=0;r<t.length;++r){const n=t[r];ji[i[n]]=Zl[n]}}return ji[e]}function Ql(i,e,t){if(i.substring(0,9)!=="precision"){let r=e;return e===Ht.HIGH&&t!==Ht.HIGH&&(r=Ht.MEDIUM),`precision ${r} float;
${i}`}else if(t!==Ht.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}let di;function tg(){if(typeof di=="boolean")return di;try{di=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{di=!1}return di}let rg=0;const Hi={},Ao=class Bs{constructor(e,t,r="pixi-shader",n={}){this.extra={},this.id=rg++,this.vertexSrc=e||Bs.defaultVertexSrc,this.fragmentSrc=t||Bs.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Hi[r]?(Hi[r]++,r+=`-${Hi[r]}`):Hi[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=Ql(this.vertexSrc,Bs.defaultVertexPrecision,Ht.HIGH),this.fragmentSrc=Ql(this.fragmentSrc,Bs.defaultFragmentPrecision,Zf())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return qf}static get defaultFragmentSrc(){return zf}static from(e,t,r){const n=e+t;let a=Wl[n];return a||(Wl[n]=a=new Bs(e,t,r)),a}};Ao.defaultVertexPrecision=Ht.HIGH,Ao.defaultFragmentPrecision=Mr.apple.device?Ht.HIGH:Ht.MEDIUM;let kr=Ao,sg=0;class Zt{constructor(e,t,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=sg++,this.static=!!t,this.ubo=!!r,e instanceof lt?(this.buffer=e,this.buffer.type=mr.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new lt(new Float32Array(1)),this.buffer.type=mr.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,t,r){if(!this.ubo)this.uniforms[e]=new Zt(t,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(e,t,r){return new Zt(e,t,r)}static uboFrom(e,t){return new Zt(e,t??!0,!0)}}class yr{constructor(e,t){this.uniformBindCount=0,this.program=e,t?t instanceof Zt?this.uniformGroup=t:this.uniformGroup=new Zt(t):this.uniformGroup=new Zt({}),this.disposeRunner=new Jt("disposeShader")}checkUniformExists(e,t){if(t.uniforms[e])return!0;for(const r in t.uniforms){const n=t.uniforms[r];if(n.group===!0&&this.checkUniformExists(e,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,t,r){const n=kr.from(e,t);return new yr(n,r)}}class ig{constructor(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},!t.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!t.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const r=new Int32Array(e);for(let a=0;a<e;a++)r[a]=a;this.defaultGroupCache[e]=Zt.from({uSamplers:r},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${e}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new kr(this.vertexSrc,n)}const t={tint:new Float32Array([1,1,1,1]),translationMatrix:new it,default:this.defaultGroupCache[e]};return new yr(this.programCache[e],t)}generateSampleSrc(e){let t="";t+=`
`,t+=`
`;for(let r=0;r<e;r++)r>0&&(t+=`
else `),r<e-1&&(t+=`if(vTextureId < ${r}.5)`),t+=`
{`,t+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,t+=`
}`;return t+=`
`,t+=`
`,t}}class Co{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}function ng(){return!Mr.apple.device}function ag(i){let e=!0;const t=Se.ADAPTER.getNavigator();if(Mr.tablet||Mr.phone){if(Mr.apple.device){const r=t.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(e=!1)}if(Mr.android.device){const r=t.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(e=!1)}}return e?i:4}class Fn{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}var og=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,hg=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const mi=class Xt extends Fn{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=nc,this.vertexSize=6,this.state=_r.for2d(),this.size=Xt.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??ag(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??ng(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return Xe("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return hg}static get defaultFragmentTemplate(){return og}setShaderGenerator({vertex:e=Xt.defaultVertexSrc,fragment:t=Xt.defaultFragmentTemplate}={}){this.shaderGenerator=new ig(e,t)}contextChange(){const e=this.renderer.gl;Se.PREFER_ENV===ws.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),Xt.defaultMaxTextures),this.maxTextures=Ff(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=Xt,r=this.size/4,n=Math.floor(r/this.maxTextures)+1;for(;e.length<r;)e.push(new wo);for(;t.length<n;)t.push(new Co);for(let a=0;a<this.maxTextures;a++)this._tempBoundTextures[a]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:t}=this,r=Xt._textureArrayPool,n=this.renderer.batch,a=this._tempBoundTextures,h=this.renderer.textureGC.count;let l=++He._globalBatch,c=0,d=r[0],g=0;n.copyBoundTextures(a,t);for(let v=0;v<this._bufferSize;++v){const b=e[v];e[v]=null,b._batchEnabled!==l&&(d.count>=t&&(n.boundArray(d,a,l,t),this.buildDrawCalls(d,g,v),g=v,d=r[++c],++l),b._batchEnabled=l,b.touched=h,d.elements[d.count++]=b)}d.count>0&&(n.boundArray(d,a,l,t),this.buildDrawCalls(d,g,this._bufferSize),++c,++l);for(let v=0;v<a.length;v++)a[v]=null;He._globalBatch=l}buildDrawCalls(e,t,r){const{_bufferedElements:n,_attributeBuffer:a,_indexBuffer:h,vertexSize:l}=this,c=Xt._drawCallPool;let d=this._dcIndex,g=this._aIndex,v=this._iIndex,b=c[d];b.start=this._iIndex,b.texArray=e;for(let y=t;y<r;++y){const x=n[y],S=x._texture.baseTexture,w=tc[S.alphaMode?1:0][x.blendMode];n[y]=null,t<y&&b.blend!==w&&(b.size=v-b.start,t=y,b=c[++d],b.texArray=e,b.start=v),this.packInterleavedGeometry(x,a,h,g,v),g+=x.vertexData.length/2*l,v+=x.indices.length,b.blend=w}t<r&&(b.size=v-b.start,++d),this._dcIndex=d,this._aIndex=g,this._iIndex=v}bindAndClearTexArray(e){const t=this.renderer.texture;for(let r=0;r<e.count;r++)t.bind(e.elements[r],e.ids[r]),e.elements[r]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:r}=this;Xt.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:t,state:r}=this.renderer,n=Xt._drawCallPool;let a=null;for(let h=0;h<e;h++){const{texArray:l,type:c,size:d,start:g,blend:v}=n[h];a!==l&&(a=l,this.bindAndClearTexArray(l)),this.state.blendMode=v,r.set(this.state),t.drawElements(c,d,t.UNSIGNED_SHORT,g*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Xt.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=pn(Math.ceil(e/8)),r=$l(t),n=t*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let a=this._aBuffers[n];return a||(this._aBuffers[n]=a=new _o(n*this.vertexSize*4)),a}getIndexBuffer(e){const t=pn(Math.ceil(e/12)),r=$l(t),n=t*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let a=this._iBuffers[r];return a||(this._iBuffers[r]=a=new Uint16Array(n)),a}packInterleavedGeometry(e,t,r,n,a){const{uint32View:h,float32View:l}=t,c=n/this.vertexSize,d=e.uvs,g=e.indices,v=e.vertexData,b=e._texture.baseTexture._batchLocation,y=Math.min(e.worldAlpha,1),x=st.shared.setValue(e._tintRGB).toPremultiplied(y,e._texture.baseTexture.alphaMode>0);for(let S=0;S<v.length;S+=2)l[n++]=v[S],l[n++]=v[S+1],l[n++]=d[S],l[n++]=d[S+1],h[n++]=x,l[n++]=b;for(let S=0;S<g.length;S++)r[a++]=c+g[S]}};mi.defaultBatchSize=4096,mi.extension={name:"batch",type:be.RendererPlugin},mi._drawCallPool=[],mi._textureArrayPool=[];let fs=mi;Me.add(fs);var lg=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,ug=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Po=class yi extends yr{constructor(e,t,r){const n=kr.from(e||yi.defaultVertexSrc,t||yi.defaultFragmentSrc);super(n,r),this.padding=0,this.resolution=yi.defaultResolution,this.multisample=yi.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new _r}apply(e,t,r,n,a){e.applyFilter(this,t,r,n)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return ug}static get defaultFragmentSrc(){return lg}};Po.defaultResolution=1,Po.defaultMultisample=dt.NONE;let wt=Po;class mn{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new st(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;const{backgroundColor:t,background:r,backgroundAlpha:n}=e,a=r??t;a!==void 0&&(this.color=a),this.alpha=n}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}}mn.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},mn.extension={type:[be.RendererSystem,be.CanvasRendererSystem],name:"background"};Me.add(mn);class cc{constructor(e){this.renderer=e,this.emptyRenderer=new Fn(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,t){const{boundTextures:r}=this.renderer.texture;for(let n=t-1;n>=0;--n)e[n]=r[n]||null,e[n]&&(e[n]._batchLocation=n)}boundArray(e,t,r,n){const{elements:a,ids:h,count:l}=e;let c=0;for(let d=0;d<l;d++){const g=a[d],v=g._batchLocation;if(v>=0&&v<n&&t[v]===g){h[d]=v;continue}for(;c<n;){const b=t[c];if(b&&b._batchEnabled===r&&b._batchLocation===c){c++;continue}h[d]=c,g._batchLocation=c,t[c]=g;break}}}destroy(){this.renderer=null}}cc.extension={type:be.RendererSystem,name:"batch"};Me.add(cc);let eu=0;class yn{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=eu++}init(e){if(e.context)this.initFromContext(e.context);else{const t=this.renderer.background.alpha<1,r=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:t,premultipliedAlpha:r,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=eu++,this.renderer.runners.contextChange.emit(e);const t=this.renderer.view;t.addEventListener!==void 0&&(t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){const t=this.createContext(this.renderer.view,e);this.initFromContext(t)}createContext(e,t){let r;if(Se.PREFER_ENV>=ws.WEBGL2&&(r=e.getContext("webgl2",t)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,e.removeEventListener!==void 0&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const t=e.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=r||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}yn.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},yn.extension={type:be.RendererSystem,name:"context"};Me.add(yn);class Io{constructor(e,t){if(this.width=Math.round(e),this.height=Math.round(t),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Jt("disposeFramebuffer"),this.multisample=dt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,t){return this.colorTextures[e]=t||new He(null,{scaleMode:Rr.NEAREST,resolution:1,mipmap:br.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new He(null,{scaleMode:Rr.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:br.OFF,format:de.DEPTH_COMPONENT,type:Fe.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,t){if(e=Math.round(e),t=Math.round(t),!e||!t)throw new Error("Framebuffer width and height must not be zero");if(!(e===this.width&&t===this.height)){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const n=this.colorTextures[r],a=n.resolution;n.setSize(e/a,t/a)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(e/r,t/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class dc extends He{constructor(e={}){if(typeof e=="number"){const t=arguments[0],r=arguments[1],n=arguments[2],a=arguments[3];e={width:t,height:r,scaleMode:n,resolution:a}}e.width=e.width??100,e.height=e.height??100,e.multisample??(e.multisample=dt.NONE),super(null,e),this.mipmap=br.OFF,this.valid=!0,this._clear=new st([0,0,0,0]),this.framebuffer=new Io(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Dr extends Si{constructor(e){const t=e,r=t.naturalWidth||t.videoWidth||t.displayWidth||t.width,n=t.naturalHeight||t.videoHeight||t.displayHeight||t.height;super(r,n),this.source=e,this.noSubImage=!1}static crossOrigin(e,t,r){r===void 0&&!t.startsWith("data:")?e.crossOrigin=kf(t):r!==!1&&(e.crossOrigin=typeof r=="string"?r:"anonymous")}upload(e,t,r,n){const a=e.gl,h=t.realWidth,l=t.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1)return!1;return a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===Rt.UNPACK),!this.noSubImage&&t.target===a.TEXTURE_2D&&r.width===h&&r.height===l?a.texSubImage2D(a.TEXTURE_2D,0,0,0,t.format,r.type,n):(r.width=h,r.height=l,a.texImage2D(t.target,0,r.internalFormat,t.format,r.type,n)),!0}update(){if(this.destroyed)return;const e=this.source,t=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;this.resize(t,r),super.update()}dispose(){this.source=null}}class pc extends Dr{constructor(e,t){if(t=t||{},typeof e=="string"){const r=new Image;Dr.crossOrigin(r,e,t.crossorigin),r.src=e,e=r}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(t.createBitmap??Se.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.bitmap=null,this._load=null,t.autoLoad!==!1&&this.load()}load(e){return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise((t,r)=>{const n=this.source;this.url=n.src;const a=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.update(),this._load=null,this.createBitmap?t(this.process()):t(this))};n.complete&&n.src?a():(n.onload=a,n.onerror=h=>{r(h),this.onError.emit(h)})}),this._load)}process(){const e=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const t=globalThis.createImageBitmap,r=!e.crossOrigin||e.crossOrigin==="anonymous";return this._process=fetch(e.src,{mode:r?"cors":"no-cors"}).then(n=>n.blob()).then(n=>t(n,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Rt.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,t,r){if(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,t,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,t,r,this.bitmap),!this.preserveBitmap){let n=!0;const a=t._glTextures;for(const h in a){const l=a[h];if(l!==r&&l.dirtyId!==t.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&(typeof e=="string"||e instanceof HTMLImageElement)}}class ah{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,r){const n=t.width,a=t.height;if(r){const h=e.width/2/n,l=e.height/2/a,c=e.x/n+h,d=e.y/a+l;r=at.add(r,at.NW),this.x0=c+h*at.uX(r),this.y0=d+l*at.uY(r),r=at.add(r,2),this.x1=c+h*at.uX(r),this.y1=d+l*at.uY(r),r=at.add(r,2),this.x2=c+h*at.uX(r),this.y2=d+l*at.uY(r),r=at.add(r,2),this.x3=c+h*at.uX(r),this.y3=d+l*at.uY(r)}else this.x0=e.x/n,this.y0=e.y/a,this.x1=(e.x+e.width)/n,this.y1=e.y/a,this.x2=(e.x+e.width)/n,this.y2=(e.y+e.height)/a,this.x3=e.x/n,this.y3=(e.y+e.height)/a;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}ah.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const tu=new ah;function $i(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}class Re extends Ci{constructor(e,t,r,n,a,h,l){if(super(),this.noFrame=!1,t||(this.noFrame=!0,t=new We(0,0,1,1)),e instanceof Re&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=n,this.valid=!1,this.destroyed=!1,this._uvs=tu,this.uvMatrix=null,this.orig=r||t,this._rotate=Number(a||0),a===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=h?new Ze(h.x,h.y):new Ze(0,0),this.defaultBorders=l,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=t:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){const{resource:t}=this.baseTexture;t!=null&&t.url&&ur[t.url]&&Re.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Re.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var n;const e=this._frame.clone(),t=this._frame===this.orig?e:this.orig.clone(),r=new Re(this.baseTexture,!this.noFrame&&e,t,(n=this.trim)==null?void 0:n.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=e),r}updateUvs(){this._uvs===tu&&(this._uvs=new ah),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,t={},r=Se.STRICT_TEXTURE_CACHE){const n=typeof e=="string";let a=null;if(n)a=e;else if(e instanceof He){if(!e.cacheId){const l=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e.cacheId=`${l}-${xs()}`,He.addToCache(e,e.cacheId)}a=e.cacheId}else{if(!e._pixiId){const l=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${l}_${xs()}`}a=e._pixiId}let h=ur[a];if(n&&r&&!h)throw new Error(`The cacheId "${a}" does not exist in TextureCache.`);return!h&&!(e instanceof He)?(t.resolution||(t.resolution=Nr(e)),h=new Re(new He(e,t)),h.baseTexture.cacheId=a,He.addToCache(h.baseTexture,a),Re.addToCache(h,a)):!h&&e instanceof He&&(h=new Re(e),Re.addToCache(h,a)),h}static fromURL(e,t){const r=Object.assign({autoLoad:!1},t==null?void 0:t.resourceOptions),n=Re.from(e,Object.assign({resourceOptions:r},t),!1),a=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):a.load().then(()=>Promise.resolve(n))}static fromBuffer(e,t,r,n){return new Re(He.fromBuffer(e,t,r,n))}static fromLoader(e,t,r,n){const a=new He(e,Object.assign({scaleMode:He.defaultOptions.scaleMode,resolution:Nr(t)},n)),{resource:h}=a;h instanceof pc&&(h.url=t);const l=new Re(a);return r||(r=t),He.addToCache(l.baseTexture,r),Re.addToCache(l,r),r!==t&&(He.addToCache(l.baseTexture,t),Re.addToCache(l,t)),l.baseTexture.valid?Promise.resolve(l):new Promise(c=>{l.baseTexture.once("loaded",()=>c(l))})}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),ur[t]&&ur[t]!==e&&console.warn(`Texture added to the cache with an id [${t}] that already had an entry`),ur[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=ur[e];if(t){const r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete ur[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)ur[e.textureCacheIds[t]]===e&&delete ur[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:t,y:r,width:n,height:a}=e,h=t+n>this.baseTexture.width,l=r+a>this.baseTexture.height;if(h||l){const c=h&&l?"and":"or",d=`X: ${t} + ${n} = ${t+n} > ${this.baseTexture.width}`,g=`Y: ${r} + ${a} = ${r+a} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${d} ${c} ${g}`)}this.valid=n&&a&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Re._EMPTY||(Re._EMPTY=new Re(new He),$i(Re._EMPTY),$i(Re._EMPTY.baseTexture)),Re._EMPTY}static get WHITE(){if(!Re._WHITE){const e=Se.ADAPTER.createCanvas(16,16),t=e.getContext("2d");e.width=16,e.height=16,t.fillStyle="white",t.fillRect(0,0,16,16),Re._WHITE=new Re(He.from(e)),$i(Re._WHITE),$i(Re._WHITE.baseTexture)}return Re._WHITE}}class Ss extends Re{constructor(e,t){super(e,t),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t,r=!0){const n=this.baseTexture.resolution,a=Math.round(e*n)/n,h=Math.round(t*n)/n;this.valid=a>0&&h>0,this._frame.width=this.orig.width=a,this._frame.height=this.orig.height=h,r&&this.baseTexture.resize(a,h),this.updateUvs()}setResolution(e){const{baseTexture:t}=this;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))}static create(e){return new Ss(new dc(e))}}class fc{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,t,r=dt.NONE){const n=new dc(Object.assign({width:e,height:t,resolution:1,multisample:r},this.textureOptions));return new Ss(n)}getOptimalTexture(e,t,r=1,n=dt.NONE){let a;e=Math.max(Math.ceil(e*r-1e-6),1),t=Math.max(Math.ceil(t*r-1e-6),1),!this.enableFullScreen||e!==this._pixelsWidth||t!==this._pixelsHeight?(e=pn(e),t=pn(t),a=((e&65535)<<16|t&65535)>>>0,n>1&&(a+=n*4294967296)):a=n>1?-n:-1,this.texturePool[a]||(this.texturePool[a]=[]);let h=this.texturePool[a].pop();return h||(h=this.createTexture(e,t,n)),h.filterPoolKey=a,h.setResolution(r),h}getFilterTexture(e,t,r){const n=this.getOptimalTexture(e.width,e.height,t||e.resolution,r||dt.NONE);return n.filterFrame=e.filterFrame,n}returnTexture(e){const t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=e!==!1,e)for(const t in this.texturePool){const r=this.texturePool[t];if(r)for(let n=0;n<r.length;n++)r[n].destroy(!0)}this.texturePool={}}setScreenSize(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const r=this.texturePool[t];if(r)for(let n=0;n<r.length;n++)r[n].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}fc.SCREEN_KEY=-1;class cg extends Qr{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class gc extends Qr{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new lt(this.vertices),this.uvBuffer=new lt(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,t){let r=0,n=0;return this.uvs[0]=r,this.uvs[1]=n,this.uvs[2]=r+t.width/e.width,this.uvs[3]=n,this.uvs[4]=r+t.width/e.width,this.uvs[5]=n+t.height/e.height,this.uvs[6]=r,this.uvs[7]=n+t.height/e.height,r=t.x,n=t.y,this.vertices[0]=r,this.vertices[1]=n,this.vertices[2]=r+t.width,this.vertices[3]=n,this.vertices[4]=r+t.width,this.vertices[5]=n+t.height,this.vertices[6]=r,this.vertices[7]=n+t.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class dg{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=dt.NONE,this.sourceFrame=new We,this.destinationFrame=new We,this.bindingSourceFrame=new We,this.bindingDestinationFrame=new We,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Vi=[new Ze,new Ze,new Ze,new Ze],eo=new it;class mc{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new fc,this.statePool=[],this.quad=new cg,this.quadUv=new gc,this.tempRect=new We,this.activeState={},this.globalUniforms=new Zt({outputFrame:new We,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,t){const r=this.renderer,n=this.defaultFilterStack,a=this.statePool.pop()||new dg,h=r.renderTexture;let l,c;if(h.current){const w=h.current;l=w.resolution,c=w.multisample}else l=r.resolution,c=r.multisample;let d=t[0].resolution||l,g=t[0].multisample??c,v=t[0].padding,b=t[0].autoFit,y=t[0].legacy??!0;for(let w=1;w<t.length;w++){const T=t[w];d=Math.min(d,T.resolution||l),g=Math.min(g,T.multisample??c),v=this.useMaxPadding?Math.max(v,T.padding):v+T.padding,b=b&&T.autoFit,y=y||(T.legacy??!0)}n.length===1&&(this.defaultFilterStack[0].renderTexture=h.current),n.push(a),a.resolution=d,a.multisample=g,a.legacy=y,a.target=e,a.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),a.sourceFrame.pad(v);const x=this.tempRect.copyFrom(h.sourceFrame);r.projection.transform&&this.transformAABB(eo.copyFrom(r.projection.transform).invert(),x),b?(a.sourceFrame.fit(x),(a.sourceFrame.width<=0||a.sourceFrame.height<=0)&&(a.sourceFrame.width=0,a.sourceFrame.height=0)):a.sourceFrame.intersects(x)||(a.sourceFrame.width=0,a.sourceFrame.height=0),this.roundFrame(a.sourceFrame,h.current?h.current.resolution:r.resolution,h.sourceFrame,h.destinationFrame,r.projection.transform),a.renderTexture=this.getOptimalFilterTexture(a.sourceFrame.width,a.sourceFrame.height,d,g),a.filters=t,a.destinationFrame.width=a.renderTexture.width,a.destinationFrame.height=a.renderTexture.height;const S=this.tempRect;S.x=0,S.y=0,S.width=a.sourceFrame.width,S.height=a.sourceFrame.height,a.renderTexture.filterFrame=a.sourceFrame,a.bindingSourceFrame.copyFrom(h.sourceFrame),a.bindingDestinationFrame.copyFrom(h.destinationFrame),a.transform=r.projection.transform,r.projection.transform=null,h.bind(a.renderTexture,a.sourceFrame,S),r.framebuffer.clear(0,0,0,0)}pop(){const e=this.defaultFilterStack,t=e.pop(),r=t.filters;this.activeState=t;const n=this.globalUniforms.uniforms;n.outputFrame=t.sourceFrame,n.resolution=t.resolution;const a=n.inputSize,h=n.inputPixel,l=n.inputClamp;if(a[0]=t.destinationFrame.width,a[1]=t.destinationFrame.height,a[2]=1/a[0],a[3]=1/a[1],h[0]=Math.round(a[0]*t.resolution),h[1]=Math.round(a[1]*t.resolution),h[2]=1/h[0],h[3]=1/h[1],l[0]=.5*h[2],l[1]=.5*h[3],l[2]=t.sourceFrame.width*a[2]-.5*h[2],l[3]=t.sourceFrame.height*a[3]-.5*h[3],t.legacy){const d=n.filterArea;d[0]=t.destinationFrame.width,d[1]=t.destinationFrame.height,d[2]=t.sourceFrame.x,d[3]=t.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const c=e[e.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,t.renderTexture,c.renderTexture,fr.BLEND,t),this.returnFilterTexture(t.renderTexture);else{let d=t.renderTexture,g=this.getOptimalFilterTexture(d.width,d.height,t.resolution);g.filterFrame=d.filterFrame;let v=0;for(v=0;v<r.length-1;++v){v===1&&t.multisample>1&&(g=this.getOptimalFilterTexture(d.width,d.height,t.resolution),g.filterFrame=d.filterFrame),r[v].apply(this,d,g,fr.CLEAR,t);const b=d;d=g,g=b}r[v].apply(this,d,c.renderTexture,fr.BLEND,t),v>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(d),this.returnFilterTexture(g)}t.clear(),this.statePool.push(t)}bindAndClear(e,t=fr.CLEAR){const{renderTexture:r,state:n}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e==null?void 0:e.filterFrame){const h=this.tempRect;h.x=0,h.y=0,h.width=e.filterFrame.width,h.height=e.filterFrame.height,r.bind(e,e.filterFrame,h)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const a=n.stateId&1||this.forceClear;(t===fr.CLEAR||t===fr.BLIT&&a)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,t,r,n){const a=this.renderer;a.state.set(e.state),this.bindAndClear(r,n),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,a.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),a.geometry.bind(this.quadUv),a.geometry.draw(gr.TRIANGLES)):(a.geometry.bind(this.quad),a.geometry.draw(gr.TRIANGLE_STRIP))}calculateSpriteMatrix(e,t){const{sourceFrame:r,destinationFrame:n}=this.activeState,{orig:a}=t._texture,h=e.set(n.width,0,0,n.height,r.x,r.y),l=t.worldTransform.copyTo(it.TEMP_MATRIX);return l.invert(),h.prepend(l),h.scale(1/a.width,1/a.height),h.translate(t.anchor.x,t.anchor.y),h}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,t,r=1,n=dt.NONE){return this.texturePool.getOptimalTexture(e,t,r,n)}getFilterTexture(e,t,r){if(typeof e=="number"){const a=e;e=t,t=a}e=e||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,r||dt.NONE);return n.filterFrame=e.filterFrame,n}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,t){const r=Vi[0],n=Vi[1],a=Vi[2],h=Vi[3];r.set(t.left,t.top),n.set(t.left,t.bottom),a.set(t.right,t.top),h.set(t.right,t.bottom),e.apply(r,r),e.apply(n,n),e.apply(a,a),e.apply(h,h);const l=Math.min(r.x,n.x,a.x,h.x),c=Math.min(r.y,n.y,a.y,h.y),d=Math.max(r.x,n.x,a.x,h.x),g=Math.max(r.y,n.y,a.y,h.y);t.x=l,t.y=c,t.width=d-l,t.height=g-c}roundFrame(e,t,r,n,a){if(!(e.width<=0||e.height<=0||r.width<=0||r.height<=0)){if(a){const{a:h,b:l,c,d}=a;if((Math.abs(l)>1e-4||Math.abs(c)>1e-4)&&(Math.abs(h)>1e-4||Math.abs(d)>1e-4))return}a=a?eo.copyFrom(a):eo.identity(),a.translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.transformAABB(a,e),e.ceil(t),this.transformAABB(a.invert(),e)}}}mc.extension={type:be.RendererSystem,name:"filter"};Me.add(mc);class pg{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=dt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const fg=new We;class yc{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new Io(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new We,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let t=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;Se.PREFER_ENV===ws.WEBGL_LEGACY&&(t=null,r=null),t?e.drawBuffers=n=>t.drawBuffersWEBGL(n):(this.hasMRT=!1,e.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,t,r=0){const{gl:n}=this;if(e){const a=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,n.bindFramebuffer(n.FRAMEBUFFER,a.framebuffer)),a.mipLevel!==r&&(e.dirtyId++,e.dirtyFormat++,a.mipLevel=r),a.dirtyId!==e.dirtyId&&(a.dirtyId=e.dirtyId,a.dirtyFormat!==e.dirtyFormat?(a.dirtyFormat=e.dirtyFormat,a.dirtySize=e.dirtySize,this.updateFramebuffer(e,r)):a.dirtySize!==e.dirtySize&&(a.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let h=0;h<e.colorTextures.length;h++){const l=e.colorTextures[h];this.renderer.texture.unbind(l.parentTextureArray||l)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){const h=t.width>>r,l=t.height>>r,c=h/t.width;this.setViewport(t.x*c,t.y*c,h,l)}else{const h=e.width>>r,l=e.height>>r;this.setViewport(0,0,h,l)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,t,r,n){const a=this.viewport;e=Math.round(e),t=Math.round(t),r=Math.round(r),n=Math.round(n),(a.width!==r||a.height!==n||a.x!==e||a.y!==t)&&(a.x=e,a.y=t,a.width=r,a.height=n,this.gl.viewport(e,t,r,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,t,r,n,a=go.COLOR|go.DEPTH){const{gl:h}=this;h.clearColor(e,t,r,n),h.clear(a)}initFramebuffer(e){const{gl:t}=this,r=new pg(t.createFramebuffer());return r.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(e),e.disposeRunner.add(this),r}resizeFramebuffer(e){const{gl:t}=this,r=e.glFramebuffers[this.CONTEXT_UID];if(r.stencil){t.bindRenderbuffer(t.RENDERBUFFER,r.stencil);let h;this.renderer.context.webGLVersion===1?h=t.DEPTH_STENCIL:e.depth&&e.stencil?h=t.DEPTH24_STENCIL8:e.depth?h=t.DEPTH_COMPONENT24:h=t.STENCIL_INDEX8,r.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,h,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,h,e.width,e.height)}const n=e.colorTextures;let a=n.length;t.drawBuffers||(a=Math.min(a,1));for(let h=0;h<a;h++){const l=n[h],c=l.parentTextureArray||l;this.renderer.texture.bind(c,0),h===0&&r.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,r.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,c._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,t){const{gl:r}=this,n=e.glFramebuffers[this.CONTEXT_UID],a=e.colorTextures;let h=a.length;r.drawBuffers||(h=Math.min(h,1)),n.multisample>1&&this.canMultisampleFramebuffer(e)?n.msaaBuffer=n.msaaBuffer||r.createRenderbuffer():n.msaaBuffer&&(r.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const l=[];for(let c=0;c<h;c++){const d=a[c],g=d.parentTextureArray||d;this.renderer.texture.bind(g,0),c===0&&n.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,n.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,g._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+c,d.target,g._glTextures[this.CONTEXT_UID].texture,t),l.push(r.COLOR_ATTACHMENT0+c))}if(l.length>1&&r.drawBuffers(l),e.depthTexture&&this.writeDepthTexture){const c=e.depthTexture;this.renderer.texture.bind(c,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,c._glTextures[this.CONTEXT_UID].texture,t)}if((e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)){n.stencil=n.stencil||r.createRenderbuffer();let c,d;this.renderer.context.webGLVersion===1?(c=r.DEPTH_STENCIL_ATTACHMENT,d=r.DEPTH_STENCIL):e.depth&&e.stencil?(c=r.DEPTH_STENCIL_ATTACHMENT,d=r.DEPTH24_STENCIL8):e.depth?(c=r.DEPTH_ATTACHMENT,d=r.DEPTH_COMPONENT24):(c=r.STENCIL_ATTACHMENT,d=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),n.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,d,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,d,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,c,r.RENDERBUFFER,n.stencil)}else n.stencil&&(r.deleteRenderbuffer(n.stencil),n.stencil=null)}canMultisampleFramebuffer(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:t}=this;let r=dt.NONE;if(e<=1||t===null)return r;for(let n=0;n<t.length;n++)if(t[n]<=e){r=t[n];break}return r===1&&(r=dt.NONE),r}blit(e,t,r){const{current:n,renderer:a,gl:h,CONTEXT_UID:l}=this;if(a.context.webGLVersion!==2||!n)return;const c=n.glFramebuffers[l];if(!c)return;if(!e){if(!c.msaaBuffer)return;const g=n.colorTextures[0];if(!g)return;c.blitFramebuffer||(c.blitFramebuffer=new Io(n.width,n.height),c.blitFramebuffer.addColorTexture(0,g)),e=c.blitFramebuffer,e.colorTextures[0]!==g&&(e.colorTextures[0]=g,e.dirtyId++,e.dirtyFormat++),(e.width!==n.width||e.height!==n.height)&&(e.width=n.width,e.height=n.height,e.dirtyId++,e.dirtySize++)}t||(t=fg,t.width=n.width,t.height=n.height),r||(r=t);const d=t.width===r.width&&t.height===r.height;this.bind(e),h.bindFramebuffer(h.READ_FRAMEBUFFER,c.framebuffer),h.blitFramebuffer(t.left,t.top,t.right,t.bottom,r.left,r.top,r.right,r.bottom,h.COLOR_BUFFER_BIT,d?h.NEAREST:h.LINEAR),h.bindFramebuffer(h.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,t){const r=e.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!r)return;delete e.glFramebuffers[this.CONTEXT_UID];const a=this.managedFramebuffers.indexOf(e);a>=0&&this.managedFramebuffers.splice(a,1),e.disposeRunner.remove(this),t||(n.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&n.deleteRenderbuffer(r.msaaBuffer),r.stencil&&n.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,t)}disposeAll(e){const t=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<t.length;r++)this.disposeFramebuffer(t[r],e)}forceStencil(){const e=this.current;if(!e)return;const t=e.glFramebuffers[this.CONTEXT_UID];if(!t||t.stencil&&e.stencil)return;e.stencil=!0;const r=e.width,n=e.height,a=this.gl,h=t.stencil=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,h);let l,c;this.renderer.context.webGLVersion===1?(l=a.DEPTH_STENCIL_ATTACHMENT,c=a.DEPTH_STENCIL):e.depth?(l=a.DEPTH_STENCIL_ATTACHMENT,c=a.DEPTH24_STENCIL8):(l=a.STENCIL_ATTACHMENT,c=a.STENCIL_INDEX8),t.msaaBuffer?a.renderbufferStorageMultisample(a.RENDERBUFFER,t.multisample,c,r,n):a.renderbufferStorage(a.RENDERBUFFER,c,r,n),a.framebufferRenderbuffer(a.FRAMEBUFFER,l,a.RENDERBUFFER,h)}reset(){this.current=this.unknownFramebuffer,this.viewport=new We}destroy(){this.renderer=null}}yc.extension={type:be.RendererSystem,name:"framebuffer"};Me.add(yc);const to={5126:4,5123:2,5121:1};class vc{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,t.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;Se.PREFER_ENV===ws.WEBGL_LEGACY&&(r=null),r?(e.createVertexArray=()=>r.createVertexArrayOES(),e.bindVertexArray=n=>r.bindVertexArrayOES(n),e.deleteVertexArray=n=>r.deleteVertexArrayOES(n)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(t.webGLVersion!==2){const r=e.getExtension("ANGLE_instanced_arrays");r?(e.vertexAttribDivisor=(n,a)=>r.vertexAttribDivisorANGLE(n,a),e.drawElementsInstanced=(n,a,h,l,c)=>r.drawElementsInstancedANGLE(n,a,h,l,c),e.drawArraysInstanced=(n,a,h,l)=>r.drawArraysInstancedANGLE(n,a,h,l)):this.hasInstance=!1}this.canUseUInt32ElementIndex=t.webGLVersion===2||!!t.extensions.uint32ElementIndex}bind(e,t){t=t||this.renderer.shader.shader;const{gl:r}=this;let n=e.glVertexArrayObjects[this.CONTEXT_UID],a=!1;n||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=n={},a=!0);const h=n[t.program.id]||this.initGeometryVao(e,t,a);this._activeGeometry=e,this._activeVao!==h&&(this._activeVao=h,this.hasVao?r.bindVertexArray(h):this.activateVao(e,t.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,t=this.renderer.buffer;for(let r=0;r<e.buffers.length;r++){const n=e.buffers[r];t.update(n)}}checkCompatibility(e,t){const r=e.attributes,n=t.attributeData;for(const a in n)if(!r[a])throw new Error(`shader and geometry incompatible, geometry missing the "${a}" attribute`)}getSignature(e,t){const r=e.attributes,n=t.attributeData,a=["g",e.id];for(const h in r)n[h]&&a.push(h,n[h].location);return a.join("-")}initGeometryVao(e,t,r=!0){const n=this.gl,a=this.CONTEXT_UID,h=this.renderer.buffer,l=t.program;l.glPrograms[a]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,l);const c=this.getSignature(e,l),d=e.glVertexArrayObjects[this.CONTEXT_UID];let g=d[c];if(g)return d[l.id]=g,g;const v=e.buffers,b=e.attributes,y={},x={};for(const S in v)y[S]=0,x[S]=0;for(const S in b)!b[S].size&&l.attributeData[S]?b[S].size=l.attributeData[S].size:b[S].size||console.warn(`PIXI Geometry attribute '${S}' size cannot be determined (likely the bound shader does not have the attribute)`),y[b[S].buffer]+=b[S].size*to[b[S].type];for(const S in b){const w=b[S],T=w.size;w.stride===void 0&&(y[w.buffer]===T*to[w.type]?w.stride=0:w.stride=y[w.buffer]),w.start===void 0&&(w.start=x[w.buffer],x[w.buffer]+=T*to[w.type])}g=n.createVertexArray(),n.bindVertexArray(g);for(let S=0;S<v.length;S++){const w=v[S];h.bind(w),r&&w._glBuffers[a].refCount++}return this.activateVao(e,l),d[l.id]=g,d[c]=g,n.bindVertexArray(null),h.unbind(mr.ARRAY_BUFFER),g}disposeGeometry(e,t){var l;if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const r=e.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,a=e.buffers,h=(l=this.renderer)==null?void 0:l.buffer;if(e.disposeRunner.remove(this),!!r){if(h)for(let c=0;c<a.length;c++){const d=a[c]._glBuffers[this.CONTEXT_UID];d&&(d.refCount--,d.refCount===0&&!t&&h.dispose(a[c],t))}if(!t){for(const c in r)if(c[0]==="g"){const d=r[c];this._activeVao===d&&this.unbind(),n.deleteVertexArray(d)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const t=Object.keys(this.managedGeometries);for(let r=0;r<t.length;r++)this.disposeGeometry(this.managedGeometries[t[r]],e)}activateVao(e,t){const r=this.gl,n=this.CONTEXT_UID,a=this.renderer.buffer,h=e.buffers,l=e.attributes;e.indexBuffer&&a.bind(e.indexBuffer);let c=null;for(const d in l){const g=l[d],v=h[g.buffer],b=v._glBuffers[n];if(t.attributeData[d]){c!==b&&(a.bind(v),c=b);const y=t.attributeData[d].location;if(r.enableVertexAttribArray(y),r.vertexAttribPointer(y,g.size,g.type||r.FLOAT,g.normalized,g.stride,g.start),g.instance)if(this.hasInstance)r.vertexAttribDivisor(y,g.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,t,r,n){const{gl:a}=this,h=this._activeGeometry;if(h.indexBuffer){const l=h.indexBuffer.data.BYTES_PER_ELEMENT,c=l===2?a.UNSIGNED_SHORT:a.UNSIGNED_INT;l===2||l===4&&this.canUseUInt32ElementIndex?h.instanced?a.drawElementsInstanced(e,t||h.indexBuffer.data.length,c,(r||0)*l,n||1):a.drawElements(e,t||h.indexBuffer.data.length,c,(r||0)*l):console.warn("unsupported index buffer type: uint32")}else h.instanced?a.drawArraysInstanced(e,r,t||h.getSize(),n||1):a.drawArrays(e,r,t||h.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}vc.extension={type:be.RendererSystem,name:"geometry"};Me.add(vc);const ru=new it;class bc{constructor(e,t){this._texture=e,this.mapCoord=new it,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,t){t===void 0&&(t=e);const r=this.mapCoord;for(let n=0;n<e.length;n+=2){const a=e[n],h=e[n+1];t[n]=a*r.a+h*r.c+r.tx,t[n+1]=a*r.b+h*r.d+r.ty}return t}update(e){const t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;const r=t._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const n=t.orig,a=t.trim;a&&(ru.set(n.width/a.width,0,0,n.height/a.height,-a.x/a.width,-a.y/a.height),this.mapCoord.append(ru));const h=t.baseTexture,l=this.uClampFrame,c=this.clampMargin/h.resolution,d=this.clampOffset;return l[0]=(t._frame.x+c+d)/h.width,l[1]=(t._frame.y+c+d)/h.height,l[2]=(t._frame.x+t._frame.width-c+d)/h.width,l[3]=(t._frame.y+t._frame.height-c+d)/h.height,this.uClampOffset[0]=d/h.realWidth,this.uClampOffset[1]=d/h.realHeight,this.isSimple=t._frame.width===h.width&&t._frame.height===h.height&&t.rotate===0,!0}}var gg=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,mg=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class yg extends wt{constructor(e,t,r){let n=null;typeof e!="string"&&t===void 0&&r===void 0&&(n=e,e=void 0,t=void 0,r=void 0),super(e||mg,t||gg,r),this.maskSprite=n,this.maskMatrix=new it}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,t,r,n){const a=this._maskSprite,h=a._texture;h.valid&&(h.uvMatrix||(h.uvMatrix=new bc(h,0)),h.uvMatrix.update(),this.uniforms.npmAlpha=h.baseTexture.alphaMode?0:1,this.uniforms.mask=h,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,a).prepend(h.uvMatrix.mapCoord),this.uniforms.alpha=a.worldAlpha,this.uniforms.maskClamp=h.uvMatrix.uClampFrame,e.applyFilter(this,t,r,n))}}class vg{constructor(e=null){this.type=ft.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=wt.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=ft.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class _c{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,t){let r=t;if(!r.isMaskData){const a=this.maskDataPool.pop()||new vg;a.pooled=!0,a.maskObject=t,r=a}const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(n),r._colorMask=n?n._colorMask:15,r.autoDetect&&this.detect(r),r._target=e,r.type!==ft.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case ft.SCISSOR:this.renderer.scissor.push(r);break;case ft.STENCIL:this.renderer.stencil.push(r);break;case ft.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case ft.COLOR:this.pushColorMask(r);break}r.type===ft.SPRITE&&this.maskStack.push(r)}pop(e){const t=this.maskStack.pop();if(!(!t||t._target!==e)){if(t.enabled)switch(t.type){case ft.SCISSOR:this.renderer.scissor.pop(t);break;case ft.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case ft.SPRITE:this.popSpriteMask(t);break;case ft.COLOR:this.popColorMask(t);break}if(t.reset(),t.pooled&&this.maskDataPool.push(t),this.maskStack.length!==0){const r=this.maskStack[this.maskStack.length-1];r.type===ft.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(e){const t=e.maskObject;t?t.isSprite?e.type=ft.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=ft.SCISSOR:e.type=ft.STENCIL:e.type=ft.COLOR}pushSpriteMask(e){const{maskObject:t}=e,r=e._target;let n=e._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new yg])),n[0].resolution=e.resolution,n[0].multisample=e.multisample,n[0].maskSprite=t;const a=r.filterArea;r.filterArea=t.getBounds(!0),this.renderer.filter.push(r,n),r.filterArea=a,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const t=e._colorMask,r=e._colorMask=t&e.colorMask;r!==t&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(e){const t=e._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==t&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}}_c.extension={type:be.RendererSystem,name:"mask"};Me.add(_c);class xc{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:t}=this.renderer,r=this.getStackLength();this.maskStack=e;const n=this.getStackLength();n!==r&&(n===0?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const su=new it,iu=[],Ec=class nn extends xc{constructor(e){super(e),this.glConst=Se.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:r}=e,{renderer:n}=this,a=n.renderTexture,h=r.getBounds(!0,iu.pop()??new We);this.roundFrameToPixels(h,a.current?a.current.resolution:n.resolution,a.sourceFrame,a.destinationFrame,n.projection.transform),t&&h.fit(t),e._scissorRectLocal=h}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:r,c:n,d:a}=e;return(Math.abs(r)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(a)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||nn.isMatrixRotated(t.worldTransform)||nn.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const r=e._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(e,t,r,n,a){nn.isMatrixRotated(a)||(a=a?su.copyFrom(a):su.identity(),a.translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.renderer.filter.transformAABB(a,e),e.fit(n),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&iu.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};Ec.extension={type:be.RendererSystem,name:"scissor"};let bg=Ec;Me.add(bg);class wc extends xc{constructor(e){super(e),this.glConst=Se.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const t=e.maskObject,{gl:r}=this.renderer,n=e._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),e._stencilCounter++;const a=e._colorMask;a!==0&&(e._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,n,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,a!==0&&(e._colorMask=a,r.colorMask((a&1)!==0,(a&2)!==0,(a&4)!==0,(a&8)!==0)),this._useCurrent()}pop(e){const t=this.renderer.gl;if(this.getStackLength()===0)t.disable(t.STENCIL_TEST);else{const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=r?r._colorMask:15;n!==0&&(r._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,n!==0&&(r._colorMask=n,t.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}wc.extension={type:be.RendererSystem,name:"stencil"};Me.add(wc);class Sc{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return Xe("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract}},prepare:{enumerable:!1,get(){return Xe("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare}},interaction:{enumerable:!1,get(){return Xe("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events}}})}init(){const e=this.rendererPlugins;for(const t in e)this.plugins[t]=new e[t](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}Sc.extension={type:[be.RendererSystem,be.CanvasRendererSystem],name:"_plugin"};Me.add(Sc);class Tc{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new it,this.transform=null}update(e,t,r,n){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,n),this.transform&&this.projectionMatrix.append(this.transform);const a=this.renderer;a.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,a.globalUniforms.update(),a.shader.shader&&a.shader.syncUniformGroup(a.shader.shader.uniforms.globals)}calculateProjection(e,t,r,n){const a=this.projectionMatrix,h=n?-1:1;a.identity(),a.a=1/t.width*2,a.d=h*(1/t.height*2),a.tx=-1-t.x*a.a,a.ty=-h-t.y*a.d}setTransform(e){}destroy(){this.renderer=null}}Tc.extension={type:be.RendererSystem,name:"projection"};Me.add(Tc);const _g=new nh,nu=new We;class Ac{constructor(e){this.renderer=e,this._tempMatrix=new it}generateTexture(e,t){const{region:r,...n}=t||{},a=(r==null?void 0:r.copyTo(nu))||e.getLocalBounds(nu,!0),h=n.resolution||this.renderer.resolution;a.width=Math.max(a.width,1/h),a.height=Math.max(a.height,1/h),n.width=a.width,n.height=a.height,n.resolution=h,n.multisample??(n.multisample=this.renderer.multisample);const l=Ss.create(n);this._tempMatrix.tx=-a.x,this._tempMatrix.ty=-a.y;const c=e.transform;return e.transform=_g,this.renderer.render(e,{renderTexture:l,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=c,l}destroy(){}}Ac.extension={type:[be.RendererSystem,be.CanvasRendererSystem],name:"textureGenerator"};Me.add(Ac);const hs=new We,pi=new We;class Cc{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new We,this.destinationFrame=new We,this.viewportFrame=new We}contextChange(){var t;const e=(t=this.renderer)==null?void 0:t.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(e=null,t,r){const n=this.renderer;this.current=e;let a,h,l;e?(a=e.baseTexture,l=a.resolution,t||(hs.width=e.frame.width,hs.height=e.frame.height,t=hs),r||(pi.x=e.frame.x,pi.y=e.frame.y,pi.width=t.width,pi.height=t.height,r=pi),h=a.framebuffer):(l=n.resolution,t||(hs.width=n._view.screen.width,hs.height=n._view.screen.height,t=hs),r||(r=hs,r.width=t.width,r.height=t.height));const c=this.viewportFrame;c.x=r.x*l,c.y=r.y*l,c.width=r.width*l,c.height=r.height*l,e||(c.y=n.view.height-(c.y+c.height)),c.ceil(),this.renderer.framebuffer.bind(h,c),this.renderer.projection.update(r,t,l,!h),e?this.renderer.mask.setMaskStack(a.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(r)}clear(e,t){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=st.shared.setValue(e||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&n.premultiply(n.alpha);const a=this.destinationFrame,h=this.current?this.current.baseTexture:this.renderer._view.screen,l=a.width!==h.width||a.height!==h.height;if(l){let{x:c,y:d,width:g,height:v}=this.viewportFrame;c=Math.round(c),d=Math.round(d),g=Math.round(g),v=Math.round(v),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(c,d,g,v)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,t),l&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Cc.extension={type:be.RendererSystem,name:"renderTexture"};Me.add(Cc);class xg{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Eg(i,e){const t={},r=e.getProgramParameter(i,e.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const a=e.getActiveAttrib(i,n);if(a.name.startsWith("gl_"))continue;const h=uc(e,a.type),l={type:h,name:a.name,size:lc(h),location:e.getAttribLocation(i,a.name)};t[a.name]=l}return t}function wg(i,e){const t={},r=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let n=0;n<r;n++){const a=e.getActiveUniform(i,n),h=a.name.replace(/\[.*?\]$/,""),l=!!a.name.match(/\[.*?\]$/),c=uc(e,a.type);t[h]={name:h,index:n,type:c,size:a.size,isArray:l,value:oc(c,a.size)}}return t}function Sg(i,e){var l;const t=Yl(i,i.VERTEX_SHADER,e.vertexSrc),r=Yl(i,i.FRAGMENT_SHADER,e.fragmentSrc),n=i.createProgram();i.attachShader(n,t),i.attachShader(n,r);const a=(l=e.extra)==null?void 0:l.transformFeedbackVaryings;if(a&&(typeof i.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):i.transformFeedbackVaryings(n,a.names,a.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(n),i.getProgramParameter(n,i.LINK_STATUS)||Qf(i,n,t,r),e.attributeData=Eg(n,i),e.uniformData=wg(n,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const c=Object.keys(e.attributeData);c.sort((d,g)=>d>g?1:-1);for(let d=0;d<c.length;d++)e.attributeData[c[d]].location=d,i.bindAttribLocation(n,d,c[d]);i.linkProgram(n)}i.deleteShader(t),i.deleteShader(r);const h={};for(const c in e.uniformData){const d=e.uniformData[c];h[c]={location:i.getUniformLocation(n,c),value:oc(d.type,d.size)}}return new xg(n,h)}function Tg(i,e,t,r,n){t.buffer.update(n)}const Ag={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Pc={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function Cg(i){const e=i.map(a=>({data:a,offset:0,dataLen:0,dirty:0}));let t=0,r=0,n=0;for(let a=0;a<e.length;a++){const h=e[a];if(t=Pc[h.data.type],h.data.size>1&&(t=Math.max(t,16)*h.data.size),h.dataLen=t,r%t!==0&&r<16){const l=r%t%16;r+=l,n+=l}r+t>16?(n=Math.ceil(n/16)*16,h.offset=n,n+=t,r=t):(h.offset=n,r+=t,n+=t)}return n=Math.ceil(n/16)*16,{uboElements:e,size:n}}function Pg(i,e){const t=[];for(const r in i)e[r]&&t.push(e[r]);return t.sort((r,n)=>r.index-n.index),t}function Ig(i,e){if(!i.autoManage)return{size:0,syncFunc:Tg};const t=Pg(i.uniforms,e),{uboElements:r,size:n}=Cg(t),a=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let h=0;h<r.length;h++){const l=r[h],c=i.uniforms[l.data.name],d=l.data.name;let g=!1;for(let v=0;v<Ws.length;v++){const b=Ws[v];if(b.codeUbo&&b.test(l.data,c)){a.push(`offset = ${l.offset/4};`,Ws[v].codeUbo(l.data.name,c)),g=!0;break}}if(!g)if(l.data.size>1){const v=lc(l.data.type),b=Math.max(Pc[l.data.type]/16,1),y=v/b,x=(4-y%4)%4;a.push(`
                cv = ud.${d}.value;
                v = uv.${d};
                offset = ${l.offset/4};

                t = 0;

                for(var i=0; i < ${l.data.size*b}; i++)
                {
                    for(var j = 0; j < ${y}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${x};
                }

                `)}else{const v=Ag[l.data.type];a.push(`
                cv = ud.${d}.value;
                v = uv.${d};
                offset = ${l.offset/4};
                ${v};
                `)}}return a.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",a.join(`
`))}}let Rg=0;const Wi={textureCount:0,uboCount:0};class Ic{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Rg++}systemCheck(){if(!tg())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const r=e.program,n=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==r&&(this.program=r,this.gl.useProgram(n.program)),t||(Wi.textureCount=0,Wi.uboCount=0,this.syncUniformGroup(e.uniformGroup,Wi)),n}setUniforms(e){const t=this.shader.program,r=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(r.uniformData,e,this.renderer)}syncUniformGroup(e,t){const r=this.getGlProgram();(!e.static||e.dirtyId!==r.uniformDirtyGroups[e.id])&&(r.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,r,t))}syncUniforms(e,t,r){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,r)}createSyncGroups(e){const t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=Yf(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,t){const r=this.getGlProgram();if(!e.static||e.dirtyId!==0||!r.uniformGroups[e.id]){e.dirtyId=0;const n=r.uniformGroups[e.id]||this.createSyncBufferGroup(e,r,t);e.buffer.update(),n(r.uniformData,e.uniforms,this.renderer,Wi,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,r.uniformBufferBindings[t])}createSyncBufferGroup(e,t,r){const{gl:n}=this.renderer;this.renderer.buffer.bind(e.buffer);const a=this.gl.getUniformBlockIndex(t.program,r);t.uniformBufferBindings[r]=this.shader.uniformBindCount,n.uniformBlockBinding(t.program,a,this.shader.uniformBindCount),this.shader.uniformBindCount++;const h=this.getSignature(e,this.shader.program.uniformData,"ubo");let l=this._uboCache[h];if(l||(l=this._uboCache[h]=Ig(e,this.shader.program.uniformData)),e.autoManage){const c=new Float32Array(l.size/4);e.buffer.update(c)}return t.uniformGroups[e.id]=l.syncFunc,t.uniformGroups[e.id]}getSignature(e,t,r){const n=e.uniforms,a=[`${r}-`];for(const h in n)a.push(h),t[h]&&a.push(t[h].type);return a.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const t=this.gl,r=e.program,n=Sg(t,r);return r.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Ic.extension={type:be.RendererSystem,name:"shader"};Me.add(Ic);class vn{constructor(e){this.renderer=e}run(e){const{renderer:t}=this;t.runners.init.emit(t.options),e.hello&&console.log(`PixiJS 7.4.3 - ${t.rendererLogId} - https://pixijs.com`),t.resize(t.screen.width,t.screen.height)}destroy(){}}vn.defaultOptions={hello:!1},vn.extension={type:[be.RendererSystem,be.CanvasRendererSystem],name:"startup"};Me.add(vn);function Mg(i,e=[]){return e[Be.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.ADD]=[i.ONE,i.ONE],e[Be.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.NONE]=[0,0],e[Be.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],e[Be.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Be.SRC_IN]=[i.DST_ALPHA,i.ZERO],e[Be.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],e[Be.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],e[Be.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],e[Be.DST_IN]=[i.ZERO,i.SRC_ALPHA],e[Be.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],e[Be.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],e[Be.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],e[Be.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],e}const Og=0,kg=1,Ng=2,Dg=3,Fg=4,Bg=5,Rc=class Ro{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=Be.NONE,this._blendEq=!1,this.map=[],this.map[Og]=this.setBlend,this.map[kg]=this.setOffset,this.map[Ng]=this.setCullFace,this.map[Dg]=this.setDepthTest,this.map[Fg]=this.setFrontFace,this.map[Bg]=this.setDepthMask,this.checks=[],this.defaultState=new _r,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=Mg(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,r=0;for(;t;)t&1&&this.map[r].call(this,!!(e.data&1<<r)),t=t>>1,r++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(Ro.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(Ro.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],r=this.gl;t.length===2?r.blendFunc(t[0],t[1]):r.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,r.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const r=this.checks.indexOf(e);t&&r===-1?this.checks.push(e):!t&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};Rc.extension={type:be.RendererSystem,name:"state"};let Lg=Rc;Me.add(Lg);class Ug extends Ci{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);const t=(e.priority??[]).filter(n=>e.systems[n]),r=[...t,...Object.keys(e.systems).filter(n=>!t.includes(n))];for(const n of r)this.addSystem(e.systems[n],n)}addRunners(...e){e.forEach(t=>{this.runners[t]=new Jt(t)})}addSystem(e,t){const r=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=r,this._systemsHash[t]=r;for(const n in this.runners)this.runners[n].add(r);return this}emitWithCustomOptions(e,t){const r=Object.keys(this._systemsHash);e.items.forEach(n=>{const a=r.find(h=>this._systemsHash[h]===n);n[e.name](t[a])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}}const vi=class an{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=an.defaultMaxIdle,this.checkCountMax=an.defaultCheckCountMax,this.mode=an.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==eh.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let r=!1;for(let n=0;n<t.length;n++){const a=t[n];a.resource&&this.count-a.touched>this.maxIdle&&(e.destroyTexture(a,!0),t[n]=null,r=!0)}if(r){let n=0;for(let a=0;a<t.length;a++)t[a]!==null&&(t[n++]=t[a]);t.length=n}}unload(e){const t=this.renderer.texture,r=e._texture;r&&!r.framebuffer&&t.destroyTexture(r);for(let n=e.children.length-1;n>=0;n--)this.unload(e.children[n])}destroy(){this.renderer=null}};vi.defaultMode=eh.AUTO,vi.defaultMaxIdle=60*60,vi.defaultCheckCountMax=60*10,vi.extension={type:be.RendererSystem,name:"textureGC"};let gs=vi;Me.add(gs);class ro{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=Fe.UNSIGNED_BYTE,this.internalFormat=de.RGBA,this.samplerType=0}}function Gg(i){let e;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?e={[i.RGB]:we.FLOAT,[i.RGBA]:we.FLOAT,[i.ALPHA]:we.FLOAT,[i.LUMINANCE]:we.FLOAT,[i.LUMINANCE_ALPHA]:we.FLOAT,[i.R8]:we.FLOAT,[i.R8_SNORM]:we.FLOAT,[i.RG8]:we.FLOAT,[i.RG8_SNORM]:we.FLOAT,[i.RGB8]:we.FLOAT,[i.RGB8_SNORM]:we.FLOAT,[i.RGB565]:we.FLOAT,[i.RGBA4]:we.FLOAT,[i.RGB5_A1]:we.FLOAT,[i.RGBA8]:we.FLOAT,[i.RGBA8_SNORM]:we.FLOAT,[i.RGB10_A2]:we.FLOAT,[i.RGB10_A2UI]:we.FLOAT,[i.SRGB8]:we.FLOAT,[i.SRGB8_ALPHA8]:we.FLOAT,[i.R16F]:we.FLOAT,[i.RG16F]:we.FLOAT,[i.RGB16F]:we.FLOAT,[i.RGBA16F]:we.FLOAT,[i.R32F]:we.FLOAT,[i.RG32F]:we.FLOAT,[i.RGB32F]:we.FLOAT,[i.RGBA32F]:we.FLOAT,[i.R11F_G11F_B10F]:we.FLOAT,[i.RGB9_E5]:we.FLOAT,[i.R8I]:we.INT,[i.R8UI]:we.UINT,[i.R16I]:we.INT,[i.R16UI]:we.UINT,[i.R32I]:we.INT,[i.R32UI]:we.UINT,[i.RG8I]:we.INT,[i.RG8UI]:we.UINT,[i.RG16I]:we.INT,[i.RG16UI]:we.UINT,[i.RG32I]:we.INT,[i.RG32UI]:we.UINT,[i.RGB8I]:we.INT,[i.RGB8UI]:we.UINT,[i.RGB16I]:we.INT,[i.RGB16UI]:we.UINT,[i.RGB32I]:we.INT,[i.RGB32UI]:we.UINT,[i.RGBA8I]:we.INT,[i.RGBA8UI]:we.UINT,[i.RGBA16I]:we.INT,[i.RGBA16UI]:we.UINT,[i.RGBA32I]:we.INT,[i.RGBA32UI]:we.UINT,[i.DEPTH_COMPONENT16]:we.FLOAT,[i.DEPTH_COMPONENT24]:we.FLOAT,[i.DEPTH_COMPONENT32F]:we.FLOAT,[i.DEPTH_STENCIL]:we.FLOAT,[i.DEPTH24_STENCIL8]:we.FLOAT,[i.DEPTH32F_STENCIL8]:we.FLOAT}:e={[i.RGB]:we.FLOAT,[i.RGBA]:we.FLOAT,[i.ALPHA]:we.FLOAT,[i.LUMINANCE]:we.FLOAT,[i.LUMINANCE_ALPHA]:we.FLOAT,[i.DEPTH_STENCIL]:we.FLOAT},e}function jg(i){let e;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?e={[Fe.UNSIGNED_BYTE]:{[de.RGBA]:i.RGBA8,[de.RGB]:i.RGB8,[de.RG]:i.RG8,[de.RED]:i.R8,[de.RGBA_INTEGER]:i.RGBA8UI,[de.RGB_INTEGER]:i.RGB8UI,[de.RG_INTEGER]:i.RG8UI,[de.RED_INTEGER]:i.R8UI,[de.ALPHA]:i.ALPHA,[de.LUMINANCE]:i.LUMINANCE,[de.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[Fe.BYTE]:{[de.RGBA]:i.RGBA8_SNORM,[de.RGB]:i.RGB8_SNORM,[de.RG]:i.RG8_SNORM,[de.RED]:i.R8_SNORM,[de.RGBA_INTEGER]:i.RGBA8I,[de.RGB_INTEGER]:i.RGB8I,[de.RG_INTEGER]:i.RG8I,[de.RED_INTEGER]:i.R8I},[Fe.UNSIGNED_SHORT]:{[de.RGBA_INTEGER]:i.RGBA16UI,[de.RGB_INTEGER]:i.RGB16UI,[de.RG_INTEGER]:i.RG16UI,[de.RED_INTEGER]:i.R16UI,[de.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[Fe.SHORT]:{[de.RGBA_INTEGER]:i.RGBA16I,[de.RGB_INTEGER]:i.RGB16I,[de.RG_INTEGER]:i.RG16I,[de.RED_INTEGER]:i.R16I},[Fe.UNSIGNED_INT]:{[de.RGBA_INTEGER]:i.RGBA32UI,[de.RGB_INTEGER]:i.RGB32UI,[de.RG_INTEGER]:i.RG32UI,[de.RED_INTEGER]:i.R32UI,[de.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[Fe.INT]:{[de.RGBA_INTEGER]:i.RGBA32I,[de.RGB_INTEGER]:i.RGB32I,[de.RG_INTEGER]:i.RG32I,[de.RED_INTEGER]:i.R32I},[Fe.FLOAT]:{[de.RGBA]:i.RGBA32F,[de.RGB]:i.RGB32F,[de.RG]:i.RG32F,[de.RED]:i.R32F,[de.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[Fe.HALF_FLOAT]:{[de.RGBA]:i.RGBA16F,[de.RGB]:i.RGB16F,[de.RG]:i.RG16F,[de.RED]:i.R16F},[Fe.UNSIGNED_SHORT_5_6_5]:{[de.RGB]:i.RGB565},[Fe.UNSIGNED_SHORT_4_4_4_4]:{[de.RGBA]:i.RGBA4},[Fe.UNSIGNED_SHORT_5_5_5_1]:{[de.RGBA]:i.RGB5_A1},[Fe.UNSIGNED_INT_2_10_10_10_REV]:{[de.RGBA]:i.RGB10_A2,[de.RGBA_INTEGER]:i.RGB10_A2UI},[Fe.UNSIGNED_INT_10F_11F_11F_REV]:{[de.RGB]:i.R11F_G11F_B10F},[Fe.UNSIGNED_INT_5_9_9_9_REV]:{[de.RGB]:i.RGB9_E5},[Fe.UNSIGNED_INT_24_8]:{[de.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[Fe.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[de.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:e={[Fe.UNSIGNED_BYTE]:{[de.RGBA]:i.RGBA,[de.RGB]:i.RGB,[de.ALPHA]:i.ALPHA,[de.LUMINANCE]:i.LUMINANCE,[de.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[Fe.UNSIGNED_SHORT_5_6_5]:{[de.RGB]:i.RGB},[Fe.UNSIGNED_SHORT_4_4_4_4]:{[de.RGBA]:i.RGBA},[Fe.UNSIGNED_SHORT_5_5_5_1]:{[de.RGBA]:i.RGBA}},e}class Mc{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new He,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=jg(e),this.samplerTypes=Gg(e);const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(let n=0;n<t;n++)this.boundTextures[n]=null;this.emptyTextures={};const r=new ro(e.createTexture());e.bindTexture(e.TEXTURE_2D,r.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=r,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new ro(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(e,t=0){const{gl:r}=this;if(e=e==null?void 0:e.castToBaseTexture(),(e==null?void 0:e.valid)&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const n=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(e.target,n.texture)),n.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),this.updateTexture(e)):n.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[t]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:t,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<r.length;n++)r[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<r.length;n++)r[n]===e&&(this.currentLocation!==n&&(t.activeTexture(t.TEXTURE0+n),this.currentLocation=n),t.bindTexture(e.target,this.emptyTextures[e.target].texture),r[n]=null)}ensureSamplerType(e){const{boundTextures:t,hasIntegerTextures:r,CONTEXT_UID:n}=this;if(r)for(let a=e-1;a>=0;--a){const h=t[a];h&&h._glTextures[n].samplerType!==we.FLOAT&&this.renderer.texture.unbind(h)}}initTexture(e){const t=new ro(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t}initTextureType(e,t){var r;t.internalFormat=((r=this.internalFormats[e.type])==null?void 0:r[e.format])??e.format,t.samplerType=this.samplerTypes[t.internalFormat]??we.FLOAT,this.webGLVersion===2&&e.type===Fe.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type}updateTexture(e){var n;const t=e._glTextures[this.CONTEXT_UID];if(!t)return;const r=this.renderer;if(this.initTextureType(e,t),(n=e.resource)==null?void 0:n.upload(r,e,t))t.samplerType!==we.FLOAT&&(this.hasIntegerTextures=!0);else{const a=e.realWidth,h=e.realHeight,l=r.gl;(t.width!==a||t.height!==h||t.dirtyId<0)&&(t.width=a,t.height=h,l.texImage2D(e.target,0,t.internalFormat,a,h,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}destroyTexture(e,t){const{gl:r}=this;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),r.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){const n=this.managedTextures.indexOf(e);n!==-1&&Vs(this.managedTextures,n,1)}}updateTextureStyle(e){var r;const t=e._glTextures[this.CONTEXT_UID];t&&((e.mipmap===br.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?t.mipmap=!1:t.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?t.wrapMode=Zr.CLAMP:t.wrapMode=e.wrapMode,(r=e.resource)!=null&&r.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)}setStyle(e,t){const r=this.gl;if(t.mipmap&&e.mipmap!==br.ON_MANUAL&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,t.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===Rr.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&e.anisotropicLevel>0&&e.scaleMode===Rr.LINEAR){const a=Math.min(e.anisotropicLevel,r.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(e.target,n.TEXTURE_MAX_ANISOTROPY_EXT,a)}}else r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===Rr.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode===Rr.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}Mc.extension={type:be.RendererSystem,name:"texture"};Me.add(Mc);class Oc{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:r}=this,n=e._glTransformFeedbacks[r]||this.createGLTransformFeedback(e);t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,t){const{gl:r,renderer:n}=this;t&&n.shader.bind(t),r.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:t,renderer:r,CONTEXT_UID:n}=this,a=t.createTransformFeedback();e._glTransformFeedbacks[n]=a,t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,a);for(let h=0;h<e.buffers.length;h++){const l=e.buffers[h];l&&(r.buffer.update(l),l._glBuffers[n].refCount++,t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,h,l._glBuffers[n].buffer||null))}return t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),a}disposeTransformFeedback(e,t){const r=e._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;e.disposeRunner.remove(this);const a=this.renderer.buffer;if(a)for(let h=0;h<e.buffers.length;h++){const l=e.buffers[h];if(!l)continue;const c=l._glBuffers[this.CONTEXT_UID];c&&(c.refCount--,c.refCount===0&&!t&&a.dispose(l,t))}r&&(t||n.deleteTransformFeedback(r),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Oc.extension={type:be.RendererSystem,name:"transformFeedback"};Me.add(Oc);class bn{constructor(e){this.renderer=e}init(e){this.screen=new We(0,0,e.width,e.height),this.element=e.view||Se.ADAPTER.createCanvas(),this.resolution=e.resolution||Se.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,t){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(t*this.resolution);const r=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=r,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",r,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){var t;e&&((t=this.element.parentNode)==null||t.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}bn.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},bn.extension={type:[be.RendererSystem,be.CanvasRendererSystem],name:"_view"};Me.add(bn);Se.PREFER_ENV=ws.WEBGL2;Se.STRICT_TEXTURE_CACHE=!1;Se.RENDER_OPTIONS={...yn.defaultOptions,...mn.defaultOptions,...bn.defaultOptions,...vn.defaultOptions};Object.defineProperties(Se,{WRAP_MODE:{get(){return He.defaultOptions.wrapMode},set(i){Xe("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),He.defaultOptions.wrapMode=i}},SCALE_MODE:{get(){return He.defaultOptions.scaleMode},set(i){Xe("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),He.defaultOptions.scaleMode=i}},MIPMAP_TEXTURES:{get(){return He.defaultOptions.mipmap},set(i){Xe("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),He.defaultOptions.mipmap=i}},ANISOTROPIC_LEVEL:{get(){return He.defaultOptions.anisotropicLevel},set(i){Xe("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),He.defaultOptions.anisotropicLevel=i}},FILTER_RESOLUTION:{get(){return Xe("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),wt.defaultResolution},set(i){wt.defaultResolution=i}},FILTER_MULTISAMPLE:{get(){return Xe("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),wt.defaultMultisample},set(i){wt.defaultMultisample=i}},SPRITE_MAX_TEXTURES:{get(){return fs.defaultMaxTextures},set(i){Xe("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),fs.defaultMaxTextures=i}},SPRITE_BATCH_SIZE:{get(){return fs.defaultBatchSize},set(i){Xe("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),fs.defaultBatchSize=i}},CAN_UPLOAD_SAME_BUFFER:{get(){return fs.canUploadSameBuffer},set(i){Xe("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),fs.canUploadSameBuffer=i}},GC_MODE:{get(){return gs.defaultMode},set(i){Xe("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),gs.defaultMode=i}},GC_MAX_IDLE:{get(){return gs.defaultMaxIdle},set(i){Xe("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),gs.defaultMaxIdle=i}},GC_MAX_CHECK_COUNT:{get(){return gs.defaultCheckCountMax},set(i){Xe("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),gs.defaultCheckCountMax=i}},PRECISION_VERTEX:{get(){return kr.defaultVertexPrecision},set(i){Xe("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),kr.defaultVertexPrecision=i}},PRECISION_FRAGMENT:{get(){return kr.defaultFragmentPrecision},set(i){Xe("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),kr.defaultFragmentPrecision=i}}});var Es=(i=>(i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(Es||{});class so{constructor(e,t=null,r=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=r,this.once=n}match(e,t=null){return this.fn===e&&this.context===t}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const t=this.next;return this.next=e?null:t,this.previous=null,t}}const kc=class kt{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new so(null,null,1/0),this.deltaMS=1/kt.targetFPMS,this.elapsedMS=1/kt.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,r=Es.NORMAL){return this._addListener(new so(e,t,r))}addOnce(e,t,r=Es.NORMAL){return this._addListener(new so(e,t,r,!0))}_addListener(e){let t=this._head.next,r=this._head;if(!t)e.connect(r);else{for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}return this._startIfPossible(),this}remove(e,t){let r=this._head.next;for(;r;)r.match(e,t)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const a=e-this._lastFrame|0;if(a<this._minElapsedMS)return;this._lastFrame=e-a%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*kt.targetFPMS;const r=this._head;let n=r.next;for(;n;)n=n.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,t)/1e3,kt.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!kt._shared){const e=kt._shared=new kt;e.autoStart=!0,e._protected=!0}return kt._shared}static get system(){if(!kt._system){const e=kt._system=new kt;e.autoStart=!0,e._protected=!0}return kt._system}};kc.targetFPMS=.06;let Nt=kc;Object.defineProperties(Se,{TARGET_FPMS:{get(){return Nt.targetFPMS},set(i){Xe("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Nt.targetFPMS=i}}});class Nc{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,Es.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Nt.shared:new Nt,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}Nc.extension=be.Application;Me.add(Nc);const Dc=[];Me.handleByList(be.Renderer,Dc);function Hg(i){for(const e of Dc)if(e.test(i))return new e(i);throw new Error("Unable to auto-detect a suitable renderer.")}var $g=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Vg=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Wg=$g,Fc=Vg;class Bc{constructor(e){this.renderer=e}contextChange(e){let t;if(this.renderer.context.webGLVersion===1){const r=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,r)}else{const r=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,r)}t>=dt.HIGH?this.multisample=dt.HIGH:t>=dt.MEDIUM?this.multisample=dt.MEDIUM:t>=dt.LOW?this.multisample=dt.LOW:this.multisample=dt.NONE}destroy(){}}Bc.extension={type:be.RendererSystem,name:"_multisample"};Me.add(Bc);class zg{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Lc{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:r}=this,n=e._glBuffers[r]||this.createGLBuffer(e);t.bindBuffer(e.type,n.buffer)}unbind(e){const{gl:t}=this;t.bindBuffer(e,null)}bindBufferBase(e,t){const{gl:r,CONTEXT_UID:n}=this;if(this.boundBufferBases[t]!==e){const a=e._glBuffers[n]||this.createGLBuffer(e);this.boundBufferBases[t]=e,r.bindBufferBase(r.UNIFORM_BUFFER,t,a.buffer)}}bindBufferRange(e,t,r){const{gl:n,CONTEXT_UID:a}=this;r=r||0;const h=e._glBuffers[a]||this.createGLBuffer(e);n.bindBufferRange(n.UNIFORM_BUFFER,t||0,h.buffer,r*256,256)}update(e){const{gl:t,CONTEXT_UID:r}=this,n=e._glBuffers[r]||this.createGLBuffer(e);if(e._updateID!==n.updateID)if(n.updateID=e._updateID,t.bindBuffer(e.type,n.buffer),n.byteLength>=e.data.byteLength)t.bufferSubData(e.type,0,e.data);else{const a=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;n.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,a)}}dispose(e,t){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const r=e._glBuffers[this.CONTEXT_UID],n=this.gl;e.disposeRunner.remove(this),r&&(t||n.deleteBuffer(r.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const t=Object.keys(this.managedBuffers);for(let r=0;r<t.length;r++)this.dispose(this.managedBuffers[t[r]],e)}createGLBuffer(e){const{CONTEXT_UID:t,gl:r}=this;return e._glBuffers[t]=new zg(r.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[t]}}Lc.extension={type:be.RendererSystem,name:"buffer"};Me.add(Lc);class Uc{constructor(e){this.renderer=e}render(e,t){const r=this.renderer;let n,a,h,l;if(t&&(n=t.renderTexture,a=t.clear,h=t.transform,l=t.skipUpdateTransform),this.renderingToScreen=!n,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=h,!r.context.isLost){if(n||(this.lastObjectRendered=e),!l){const c=e.enableTempParent();e.updateTransform(),e.disableTempParent(c)}r.renderTexture.bind(n),r.batch.currentRenderer.start(),(a??r.background.clearBeforeRender)&&r.renderTexture.clear(),e.render(r),r.batch.currentRenderer.flush(),n&&(t.blit&&r.framebuffer.blit(),n.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Uc.extension={type:be.RendererSystem,name:"objectRenderer"};Me.add(Uc);const on=class Mo extends Ug{constructor(e){super(),this.type=ju.WEBGL,e=Object.assign({},Se.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Zt({projectionMatrix:new it},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Mo.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(Xe("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha),this._plugin.rendererPlugins=Mo.__plugins,this.options=e,this.startup.run(this.options)}static test(e){return e!=null&&e.forceCanvas?!1:gf()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Xe("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Xe("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Xe("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Xe("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){Xe("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return Xe("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){Xe("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return Xe("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};on.extension={type:be.Renderer,priority:1},on.__plugins={},on.__systems={};let oh=on;Me.handleByMap(be.RendererPlugin,oh.__plugins);Me.handleByMap(be.RendererSystem,oh.__systems);Me.add(oh);class Gc extends Si{constructor(e,t){const{width:r,height:n}=t||{};super(r,n),this.items=[],this.itemDirtyIds=[];for(let a=0;a<e;a++){const h=new He;this.items.push(h),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,t){for(let r=0;r<this.length;r++)e[r]&&(e[r].castToBaseTexture?this.addBaseTextureAt(e[r].castToBaseTexture(),r):e[r]instanceof Si?this.addResourceAt(e[r],r):this.addResourceAt(ic(e[r],t),r))}dispose(){for(let e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,t){if(!this.items[t])throw new Error(`Index ${t} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this}bind(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)}unbind(e){super.unbind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)}load(){if(this._load)return this._load;const e=this.items.map(t=>t.resource).filter(t=>t).map(t=>t.load());return this._load=Promise.all(e).then(()=>{const{realWidth:t,realHeight:r}=this.items[0];return this.resize(t,r),this.update(),Promise.resolve(this)}),this._load}}class qg extends Gc{constructor(e,t){const{width:r,height:n}=t||{};let a,h;Array.isArray(e)?(a=e,h=e.length):h=e,super(h,{width:r,height:n}),a&&this.initFromArray(a,t)}addBaseTextureAt(e,t){if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(e){super.bind(e),e.target=$s.TEXTURE_2D_ARRAY}upload(e,t,r){const{length:n,itemDirtyIds:a,items:h}=this,{gl:l}=e;r.dirtyId<0&&l.texImage3D(l.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,n,0,t.format,r.type,null);for(let c=0;c<n;c++){const d=h[c];a[c]<d.dirtyId&&(a[c]=d.dirtyId,d.valid&&l.texSubImage3D(l.TEXTURE_2D_ARRAY,0,0,0,c,d.resource.width,d.resource.height,1,t.format,r.type,d.resource.source))}return!0}}class Xg extends Dr{constructor(e){super(e)}static test(e){const{OffscreenCanvas:t}=globalThis;return t&&e instanceof t?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}}const jc=class bi extends Gc{constructor(e,t){const{width:r,height:n,autoLoad:a,linkBaseTexture:h}=t||{};if(e&&e.length!==bi.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:r,height:n});for(let l=0;l<bi.SIDES;l++)this.items[l].target=$s.TEXTURE_CUBE_MAP_POSITIVE_X+l;this.linkBaseTexture=h!==!1,e&&this.initFromArray(e,t),a!==!1&&this.load()}bind(e){super.bind(e),e.target=$s.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=$s.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,r){const n=this.itemDirtyIds;for(let a=0;a<bi.SIDES;a++){const h=this.items[a];(n[a]<h.dirtyId||r.dirtyId<t.dirtyId)&&(h.valid&&h.resource?(h.resource.upload(e,h,r),n[a]=h.dirtyId):n[a]<-1&&(e.gl.texImage2D(h.target,0,r.internalFormat,t.realWidth,t.realHeight,0,t.format,r.type,null),n[a]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===bi.SIDES}};jc.SIDES=6;let Kg=jc;class js extends Dr{constructor(e,t){t=t||{};let r,n,a;typeof e=="string"?(r=js.EMPTY,n=e,a=!0):(r=e,n=null,a=!1),super(r),this.url=n,this.crossOrigin=t.crossOrigin??!0,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.ownsImageBitmap=t.ownsImageBitmap??a,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(e,t)=>{if(this.url===null){e(this);return}try{const r=await Se.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await r.blob();if(this.destroyed)return;const a=await createImageBitmap(n,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Rt.UNPACK?"premultiply":"none"});if(this.destroyed){a.close();return}this.source=a,this.update(),e(this)}catch(r){if(this.destroyed)return;t(r),this.onError.emit(r)}}),this._load)}upload(e,t,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),super.upload(e,t,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof e=="string"||e instanceof ImageBitmap)}static get EMPTY(){return js._EMPTY=js._EMPTY??Se.ADAPTER.createCanvas(0,0),js._EMPTY}}const Oo=class hn extends Dr{constructor(e,t){t=t||{},super(Se.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.update(),e(this)},hn.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;Dr.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,r=e.height;if(!t||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let n=t*this.scale,a=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(n=this._overrideWidth||this._overrideHeight/r*t,a=this._overrideHeight||this._overrideWidth/t*r),n=Math.round(n),a=Math.round(a);const h=this.source;h.width=n,h.height=a,h._pixiId=`canvas_${xs()}`,h.getContext("2d").drawImage(e,0,0,t,r,0,0,n,a),this._resolve(),this._resolve=null}}static getSize(e){const t=hn.SVG_SIZE.exec(e),r={};return t&&(r[t[1]]=Math.round(parseFloat(t[3])),r[t[5]]=Math.round(parseFloat(t[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&hn.SVG_XML.test(e)}};Oo.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Oo.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let ko=Oo;class Yg extends Dr{constructor(e){super(e)}static test(e){return!!globalThis.VideoFrame&&e instanceof globalThis.VideoFrame}}const No=class Do extends Dr{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const r=document.createElement("video");t.autoLoad!==!1&&r.setAttribute("preload","auto"),t.playsinline!==!1&&(r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline","")),t.muted===!0&&(r.setAttribute("muted",""),r.muted=!0),t.loop===!0&&r.setAttribute("loop",""),t.autoPlay!==!1&&r.setAttribute("autoplay",""),typeof e=="string"&&(e=[e]);const n=e[0].src||e[0];Dr.crossOrigin(r,n,t.crossorigin);for(let a=0;a<e.length;++a){const h=document.createElement("source");let{src:l,mime:c}=e[a];if(l=l||e[a],l.startsWith("data:"))c=l.slice(5,l.indexOf(";"));else if(!l.startsWith("blob:")){const d=l.split("?").shift().toLowerCase(),g=d.slice(d.lastIndexOf(".")+1);c=c||Do.MIME_TYPES[g]||`video/${g}`}h.src=l,c&&(h.type=c),r.appendChild(h)}e=r}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){if(this._updateFPS){const t=Nt.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((t,r)=>{this.valid?t(this):(this._resolve=t,this._reject=r,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!t&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._configureAutoUpdate();const e=this.source;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Nt.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Nt.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Nt.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||Do.TYPES.includes(t)}};No.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],No.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Hc=No;xo.push(js,pc,Xg,Hc,Yg,ko,On,Kg,qg);class _n{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?We.EMPTY:(e=e||new We(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,t){const{a:r,b:n,c:a,d:h,tx:l,ty:c}=e,d=r*t.x+a*t.y+l,g=n*t.x+h*t.y+c;this.minX=Math.min(this.minX,d),this.maxX=Math.max(this.maxX,d),this.minY=Math.min(this.minY,g),this.maxY=Math.max(this.maxY,g)}addQuad(e){let t=this.minX,r=this.minY,n=this.maxX,a=this.maxY,h=e[0],l=e[1];t=h<t?h:t,r=l<r?l:r,n=h>n?h:n,a=l>a?l:a,h=e[2],l=e[3],t=h<t?h:t,r=l<r?l:r,n=h>n?h:n,a=l>a?l:a,h=e[4],l=e[5],t=h<t?h:t,r=l<r?l:r,n=h>n?h:n,a=l>a?l:a,h=e[6],l=e[7],t=h<t?h:t,r=l<r?l:r,n=h>n?h:n,a=l>a?l:a,this.minX=t,this.minY=r,this.maxX=n,this.maxY=a}addFrame(e,t,r,n,a){this.addFrameMatrix(e.worldTransform,t,r,n,a)}addFrameMatrix(e,t,r,n,a){const h=e.a,l=e.b,c=e.c,d=e.d,g=e.tx,v=e.ty;let b=this.minX,y=this.minY,x=this.maxX,S=this.maxY,w=h*t+c*r+g,T=l*t+d*r+v;b=w<b?w:b,y=T<y?T:y,x=w>x?w:x,S=T>S?T:S,w=h*n+c*r+g,T=l*n+d*r+v,b=w<b?w:b,y=T<y?T:y,x=w>x?w:x,S=T>S?T:S,w=h*t+c*a+g,T=l*t+d*a+v,b=w<b?w:b,y=T<y?T:y,x=w>x?w:x,S=T>S?T:S,w=h*n+c*a+g,T=l*n+d*a+v,b=w<b?w:b,y=T<y?T:y,x=w>x?w:x,S=T>S?T:S,this.minX=b,this.minY=y,this.maxX=x,this.maxY=S}addVertexData(e,t,r){let n=this.minX,a=this.minY,h=this.maxX,l=this.maxY;for(let c=t;c<r;c+=2){const d=e[c],g=e[c+1];n=d<n?d:n,a=g<a?g:a,h=d>h?d:h,l=g>l?g:l}this.minX=n,this.minY=a,this.maxX=h,this.maxY=l}addVertices(e,t,r,n){this.addVerticesMatrix(e.worldTransform,t,r,n)}addVerticesMatrix(e,t,r,n,a=0,h=a){const l=e.a,c=e.b,d=e.c,g=e.d,v=e.tx,b=e.ty;let y=this.minX,x=this.minY,S=this.maxX,w=this.maxY;for(let T=r;T<n;T+=2){const N=t[T],M=t[T+1],F=l*N+d*M+v,O=g*M+c*N+b;y=Math.min(y,F-a),S=Math.max(S,F+a),x=Math.min(x,O-h),w=Math.max(w,O+h)}this.minX=y,this.minY=x,this.maxX=S,this.maxY=w}addBounds(e){const t=this.minX,r=this.minY,n=this.maxX,a=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<r?e.minY:r,this.maxX=e.maxX>n?e.maxX:n,this.maxY=e.maxY>a?e.maxY:a}addBoundsMask(e,t){const r=e.minX>t.minX?e.minX:t.minX,n=e.minY>t.minY?e.minY:t.minY,a=e.maxX<t.maxX?e.maxX:t.maxX,h=e.maxY<t.maxY?e.maxY:t.maxY;if(r<=a&&n<=h){const l=this.minX,c=this.minY,d=this.maxX,g=this.maxY;this.minX=r<l?r:l,this.minY=n<c?n:c,this.maxX=a>d?a:d,this.maxY=h>g?h:g}}addBoundsMatrix(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,t){const r=e.minX>t.x?e.minX:t.x,n=e.minY>t.y?e.minY:t.y,a=e.maxX<t.x+t.width?e.maxX:t.x+t.width,h=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(r<=a&&n<=h){const l=this.minX,c=this.minY,d=this.maxX,g=this.maxY;this.minX=r<l?r:l,this.minY=n<c?n:c,this.maxX=a>d?a:d,this.maxY=h>g?h:g}}pad(e=0,t=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)}addFramePad(e,t,r,n,a,h){e-=a,t-=h,r+=a,n+=h,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>n?this.maxY:n}}class ot extends Ci{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new nh,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new _n,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){const t=Object.keys(e);for(let r=0;r<t.length;++r){const n=t[r];Object.defineProperty(ot.prototype,n,Object.getOwnPropertyDescriptor(e,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new We),t=this._boundsRect),this._bounds.getRectangle(t)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new We),e=this._localBoundsRect),this._localBounds||(this._localBounds=new _n);const t=this.transform,r=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(r==null?void 0:r.worldAlpha)??1,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,a=this._boundsID;this._bounds=this._localBounds;const h=this.getBounds(!1,e);return this.parent=r,this.transform=t,this._bounds=n,this._bounds.updateID+=this._boundsID-a,h}toGlobal(e,t,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)}toLocal(e,t,r,n){return t&&(e=t.toGlobal(e,r,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,r)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e=0,t=0,r=1,n=1,a=0,h=0,l=0,c=0,d=0){return this.position.x=e,this.position.y=t,this.scale.x=r||1,this.scale.y=n||1,this.rotation=a,this.skew.x=h,this.skew.y=l,this.pivot.x=c,this.pivot.y=d,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new Jg),this.tempDisplayObjectParent}enableTempParent(){const e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*$f}set angle(e){this.transform.rotation=e*Vf}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex!==e&&(this._zIndex=e,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,t._maskRefCount===0&&(t.renderable=!0,t.isMask=!1))}if(this._mask=e,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount===0&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class Jg extends ot{constructor(){super(...arguments),this.sortDirty=null}}ot.prototype.displayObjectUpdateTransform=ot.prototype.updateTransform;const Zg=new it;function Qg(i,e){return i.zIndex===e.zIndex?i._lastSortedIndex-e._lastSortedIndex:i.zIndex-e.zIndex}const $c=class Fo extends ot{constructor(){super(),this.children=[],this.sortableChildren=Fo.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const r=this.getChildIndex(e),n=this.getChildIndex(t);this.children[r]=t,this.children[n]=e,this.onChildrenChange(r<n?r:n)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(e);Vs(this.children,r,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],r=this.children.indexOf(t);if(r===-1)return null;t.parent=null,t.transform._parentID=-1,Vs(this.children,r,1),this._boundsID++,this.onChildrenChange(r),t.emit("removed",this),this.emit("childRemoved",t,this,r)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,Vs(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const r=e,n=t,a=n-r;let h;if(a>0&&a<=n){h=this.children.splice(r,a);for(let l=0;l<h.length;++l)h[l].parent=null,h[l].transform&&(h[l].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let l=0;l<h.length;++l)h[l].emit("removed",this),this.emit("childRemoved",h[l],this,l);return h}else if(a===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,r=this.children.length;t<r;++t){const n=this.children[t];n._lastSortedIndex=t,!e&&n.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(Qg),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const r=this.children[e];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(t._bounds,r._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const r=super.getLocalBounds(e);if(!t)for(let n=0,a=this.children.length;n<a;++n){const h=this.children[n];h.visible&&h.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let r,n;this.cullArea?(r=this.cullArea,n=this.worldTransform):this._render!==Fo.prototype._render&&(r=this.getBounds(!0));const a=e.projection.transform;if(a&&(n?(n=Zg.copyFrom(n),n.prepend(a)):n=a),r&&t.intersects(r,n))this._render(e);else if(this.cullArea)return;for(let h=0,l=this.children.length;h<l;++h){const c=this.children[h],d=c.cullable;c.cullable=d||!this.cullArea,c.render(e),c.cullable=d}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let r=0,n=this.children.length;r<n;++r)this.children[r].render(e)}}renderAdvanced(e){var a,h,l;const t=this.filters,r=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let c=0;c<t.length;c++)t[c].enabled&&this._enabledFilters.push(t[c])}const n=t&&((a=this._enabledFilters)==null?void 0:a.length)||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==ft.NONE));if(n&&e.batch.flush(),t&&((h=this._enabledFilters)!=null&&h.length)&&e.filter.push(this,this._enabledFilters),r&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let c=0,d=this.children.length;c<d;++c)this.children[c].render(e)}n&&e.batch.flush(),r&&e.mask.pop(this),t&&((l=this._enabledFilters)!=null&&l.length)&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t=typeof e=="boolean"?e:e==null?void 0:e.children,r=this.removeChildren(0,this.children.length);if(t)for(let n=0;n<r.length;++n)r[n].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}};$c.defaultSortableChildren=!1;let tr=$c;tr.prototype.containerUpdateTransform=tr.prototype.updateTransform;Object.defineProperties(Se,{SORTABLE_CHILDREN:{get(){return tr.defaultSortableChildren},set(i){Xe("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),tr.defaultSortableChildren=i}}});const fi=new Ze,em=new Uint16Array([0,1,2,0,2,3]);class ti extends tr{constructor(e){super(),this._anchor=new Or(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new st(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=Be.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||Re.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=em,this.pluginName="batch",this.isSprite=!0,this._roundPixels=Se.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Yr(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Yr(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;const t=this.transform.worldTransform,r=t.a,n=t.b,a=t.c,h=t.d,l=t.tx,c=t.ty,d=this.vertexData,g=e.trim,v=e.orig,b=this._anchor;let y=0,x=0,S=0,w=0;if(g?(x=g.x-b._x*v.width,y=x+g.width,w=g.y-b._y*v.height,S=w+g.height):(x=-b._x*v.width,y=x+v.width,w=-b._y*v.height,S=w+v.height),d[0]=r*x+a*w+l,d[1]=h*w+n*x+c,d[2]=r*y+a*w+l,d[3]=h*w+n*y+c,d[4]=r*y+a*S+l,d[5]=h*S+n*y+c,d[6]=r*x+a*S+l,d[7]=h*S+n*x+c,this._roundPixels){const T=Se.RESOLUTION;for(let N=0;N<d.length;++N)d[N]=Math.round(d[N]*T)/T}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const e=this._texture,t=this.vertexTrimmedData,r=e.orig,n=this._anchor,a=this.transform.worldTransform,h=a.a,l=a.b,c=a.c,d=a.d,g=a.tx,v=a.ty,b=-n._x*r.width,y=b+r.width,x=-n._y*r.height,S=x+r.height;if(t[0]=h*b+c*x+g,t[1]=d*x+l*b+v,t[2]=h*y+c*x+g,t[3]=d*x+l*y+v,t[4]=h*y+c*S+g,t[5]=d*S+l*y+v,t[6]=h*b+c*S+g,t[7]=d*S+l*b+v,this._roundPixels){const w=Se.RESOLUTION;for(let T=0;T<t.length;++T)t[T]=Math.round(t[T]*w)/w}}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){const e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return this.children.length===0?(this._localBounds||(this._localBounds=new _n),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new We),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,fi);const t=this._texture.orig.width,r=this._texture.orig.height,n=-t*this.anchor.x;let a=0;return fi.x>=n&&fi.x<n+t&&(a=-r*this.anchor.y,fi.y>=a&&fi.y<a+r)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof e=="boolean"?e:e==null?void 0:e.texture){const t=typeof e=="boolean"?e:e==null?void 0:e.baseTexture;this._texture.destroy(!!t)}this._texture=null}static from(e,t){const r=e instanceof Re?e:Re.from(e,t);return new ti(r)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){const t=Yr(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){const t=Yr(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||Re.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}const Vc=new it;ot.prototype._cacheAsBitmap=!1;ot.prototype._cacheData=null;ot.prototype._cacheAsBitmapResolution=null;ot.prototype._cacheAsBitmapMultisample=null;class tm{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(ot.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(i){i!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(i){i!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(i){if(this._cacheAsBitmap===i)return;this._cacheAsBitmap=i;let e;i?(this._cacheData||(this._cacheData=new tm),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}});ot.prototype._renderCached=function(i){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(i),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(i))};ot.prototype._initCachedDisplayObject=function(i){var b,y;if((b=this._cacheData)!=null&&b.sprite)return;const e=this.alpha;this.alpha=1,i.batch.flush();const t=this.getLocalBounds(new We,!0);if((y=this.filters)!=null&&y.length){const x=this.filters[0].padding;t.pad(x)}const r=this.cacheAsBitmapResolution||i.resolution;t.ceil(r),t.width=Math.max(t.width,1/r),t.height=Math.max(t.height,1/r);const n=i.renderTexture.current,a=i.renderTexture.sourceFrame.clone(),h=i.renderTexture.destinationFrame.clone(),l=i.projection.transform,c=Ss.create({width:t.width,height:t.height,resolution:r,multisample:this.cacheAsBitmapMultisample??i.multisample}),d=`cacheAsBitmap_${xs()}`;this._cacheData.textureCacheId=d,He.addToCache(c.baseTexture,d),Re.addToCache(c,d);const g=this.transform.localTransform.copyTo(Vc).invert().translate(-t.x,-t.y);this.render=this._cacheData.originalRender,i.render(this,{renderTexture:c,clear:!0,transform:g,skipUpdateTransform:!1}),i.framebuffer.blit(),i.projection.transform=l,i.renderTexture.bind(n,a,h),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const v=new ti(c);v.transform.worldTransform=this.transform.worldTransform,v.anchor.x=-(t.x/t.width),v.anchor.y=-(t.y/t.height),v.alpha=e,v._bounds=this._bounds,this._cacheData.sprite=v,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=v.containsPoint.bind(v)};ot.prototype._renderCachedCanvas=function(i){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(i),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(i))};ot.prototype._initCachedDisplayObjectCanvas=function(i){var g;if((g=this._cacheData)!=null&&g.sprite)return;const e=this.getLocalBounds(new We,!0),t=this.alpha;this.alpha=1;const r=i.canvasContext.activeContext,n=i._projTransform,a=this.cacheAsBitmapResolution||i.resolution;e.ceil(a),e.width=Math.max(e.width,1/a),e.height=Math.max(e.height,1/a);const h=Ss.create({width:e.width,height:e.height,resolution:a}),l=`cacheAsBitmap_${xs()}`;this._cacheData.textureCacheId=l,He.addToCache(h.baseTexture,l),Re.addToCache(h,l);const c=Vc;this.transform.localTransform.copyTo(c),c.invert(),c.tx-=e.x,c.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,i.render(this,{renderTexture:h,clear:!0,transform:c,skipUpdateTransform:!1}),i.canvasContext.activeContext=r,i._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const d=new ti(h);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-(e.x/e.width),d.anchor.y=-(e.y/e.height),d.alpha=t,d._bounds=this._bounds,this._cacheData.sprite=d,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=i._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=d.containsPoint.bind(d)};ot.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};ot.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};ot.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,He.removeFromCache(this._cacheData.textureCacheId),Re.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};ot.prototype._cacheAsBitmapDestroy=function(i){this.cacheAsBitmap=!1,this.destroy(i)};ot.prototype.name=null;tr.prototype.getChildByName=function(i,e){for(let t=0,r=this.children.length;t<r;t++)if(this.children[t].name===i)return this.children[t];if(e)for(let t=0,r=this.children.length;t<r;t++){const n=this.children[t];if(!n.getChildByName)continue;const a=n.getChildByName(i,!0);if(a)return a}return null};ot.prototype.getGlobalPosition=function(i=new Ze,e=!1){return this.parent?this.parent.toGlobal(this.position,i,e):(i.x=this.position.x,i.y=this.position.y),i};var rm=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class sm extends wt{constructor(e=1){super(Wg,rm,{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}const im={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},nm=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function am(i){const e=im[i],t=e.length;let r=nm,n="";const a="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let h;for(let l=0;l<i;l++){let c=a.replace("%index%",l.toString());h=l,l>=t&&(h=i-l-1),c=c.replace("%value%",e[h].toString()),n+=c,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",i.toString()),r}const om=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function hm(i,e){const t=Math.ceil(i/2);let r=om,n="",a;e?a="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":a="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let h=0;h<i;h++){let l=a.replace("%index%",h.toString());l=l.replace("%sampleIndex%",`${h-(t-1)}.0`),n+=l,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",i.toString()),r}class Bo extends wt{constructor(e,t=8,r=4,n=wt.defaultResolution,a=5){const h=hm(a,e),l=am(a);super(h,l),this.horizontal=e,this.resolution=n,this._quality=0,this.quality=r,this.blur=t}apply(e,t,r,n){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/t.width):this.uniforms.strength=1/r.height*(r.height/t.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/t.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/t.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)e.applyFilter(this,t,r,n);else{const a=e.getFilterTexture(),h=e.renderer;let l=t,c=a;this.state.blend=!1,e.applyFilter(this,l,c,fr.CLEAR);for(let d=1;d<this.passes-1;d++){e.bindAndClear(l,fr.BLIT),this.uniforms.uSampler=c;const g=c;c=l,l=g,h.shader.bind(this),h.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,c,r,n),e.returnFilterTexture(a)}}get blur(){return this.strength}set blur(e){this.padding=1+Math.abs(e)*2,this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}}class lm extends wt{constructor(e=8,t=4,r=wt.defaultResolution,n=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Bo(!0,e,t,r,n),this.blurYFilter=new Bo(!1,e,t,r,n),this.resolution=r,this.quality=t,this.blur=e,this.repeatEdgePixels=!1}apply(e,t,r,n){const a=Math.abs(this.blurXFilter.strength),h=Math.abs(this.blurYFilter.strength);if(a&&h){const l=e.getFilterTexture();this.blurXFilter.apply(e,t,l,fr.CLEAR),this.blurYFilter.apply(e,l,r,n),e.returnFilterTexture(l)}else h?this.blurYFilter.apply(e,t,r,n):this.blurXFilter.apply(e,t,r,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}}var um=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class Lo extends wt{constructor(){const e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Fc,um,e),this.alpha=1}_loadMatrix(e,t=!1){let r=e;t&&(this._multiply(r,this.uniforms.m,e),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(e,t,r){return e[0]=t[0]*r[0]+t[1]*r[5]+t[2]*r[10]+t[3]*r[15],e[1]=t[0]*r[1]+t[1]*r[6]+t[2]*r[11]+t[3]*r[16],e[2]=t[0]*r[2]+t[1]*r[7]+t[2]*r[12]+t[3]*r[17],e[3]=t[0]*r[3]+t[1]*r[8]+t[2]*r[13]+t[3]*r[18],e[4]=t[0]*r[4]+t[1]*r[9]+t[2]*r[14]+t[3]*r[19]+t[4],e[5]=t[5]*r[0]+t[6]*r[5]+t[7]*r[10]+t[8]*r[15],e[6]=t[5]*r[1]+t[6]*r[6]+t[7]*r[11]+t[8]*r[16],e[7]=t[5]*r[2]+t[6]*r[7]+t[7]*r[12]+t[8]*r[17],e[8]=t[5]*r[3]+t[6]*r[8]+t[7]*r[13]+t[8]*r[18],e[9]=t[5]*r[4]+t[6]*r[9]+t[7]*r[14]+t[8]*r[19]+t[9],e[10]=t[10]*r[0]+t[11]*r[5]+t[12]*r[10]+t[13]*r[15],e[11]=t[10]*r[1]+t[11]*r[6]+t[12]*r[11]+t[13]*r[16],e[12]=t[10]*r[2]+t[11]*r[7]+t[12]*r[12]+t[13]*r[17],e[13]=t[10]*r[3]+t[11]*r[8]+t[12]*r[13]+t[13]*r[18],e[14]=t[10]*r[4]+t[11]*r[9]+t[12]*r[14]+t[13]*r[19]+t[14],e[15]=t[15]*r[0]+t[16]*r[5]+t[17]*r[10]+t[18]*r[15],e[16]=t[15]*r[1]+t[16]*r[6]+t[17]*r[11]+t[18]*r[16],e[17]=t[15]*r[2]+t[16]*r[7]+t[17]*r[12]+t[18]*r[17],e[18]=t[15]*r[3]+t[16]*r[8]+t[17]*r[13]+t[18]*r[18],e[19]=t[15]*r[4]+t[16]*r[9]+t[17]*r[14]+t[18]*r[19]+t[19],e}_colorMatrix(e){const t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){const r=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(r,t)}tint(e,t){const[r,n,a]=st.shared.setValue(e).toArray(),h=[r,0,0,0,0,0,n,0,0,0,0,0,a,0,0,0,0,0,1,0];this._loadMatrix(h,t)}greyscale(e,t){const r=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(r,t)}blackAndWhite(e){const t=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(t,e)}hue(e,t){e=(e||0)/180*Math.PI;const r=Math.cos(e),n=Math.sin(e),a=Math.sqrt,h=1/3,l=a(h),c=r+(1-r)*h,d=h*(1-r)-l*n,g=h*(1-r)+l*n,v=h*(1-r)+l*n,b=r+h*(1-r),y=h*(1-r)-l*n,x=h*(1-r)-l*n,S=h*(1-r)+l*n,w=r+h*(1-r),T=[c,d,g,0,0,v,b,y,0,0,x,S,w,0,0,0,0,0,1,0];this._loadMatrix(T,t)}contrast(e,t){const r=(e||0)+1,n=-.5*(r-1),a=[r,0,0,0,n,0,r,0,0,n,0,0,r,0,n,0,0,0,1,0];this._loadMatrix(a,t)}saturate(e=0,t){const r=e*2/3+1,n=(r-1)*-.5,a=[r,n,n,0,0,n,r,n,0,0,n,n,r,0,0,0,0,0,1,0];this._loadMatrix(a,t)}desaturate(){this.saturate(-1)}negative(e){const t=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(t,e)}sepia(e){const t=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(t,e)}technicolor(e){const t=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(t,e)}polaroid(e){const t=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(t,e)}toBGR(e){const t=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(t,e)}kodachrome(e){const t=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(t,e)}browni(e){const t=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(t,e)}vintage(e){const t=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(t,e)}colorTone(e,t,r,n,a){e=e||.2,t=t||.15,r=r||16770432,n=n||3375104;const h=st.shared,[l,c,d]=h.setValue(r).toArray(),[g,v,b]=h.setValue(n).toArray(),y=[.3,.59,.11,0,0,l,c,d,e,0,g,v,b,t,0,l-g,c-v,d-b,0,0];this._loadMatrix(y,a)}night(e,t){e=e||.1;const r=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(r,t)}predator(e,t){const r=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(r,t)}lsd(e){const t=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(t,e)}reset(){const e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}Lo.prototype.grayscale=Lo.prototype.greyscale;var cm=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,dm=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class pm extends wt{constructor(e,t){const r=new it;e.renderable=!1,super(dm,cm,{mapSampler:e._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=r,t==null&&(t=20),this.scale=new Ze(t,t)}apply(e,t,r,n){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const a=this.maskSprite.worldTransform,h=Math.sqrt(a.a*a.a+a.b*a.b),l=Math.sqrt(a.c*a.c+a.d*a.d);h!==0&&l!==0&&(this.uniforms.rotation[0]=a.a/h,this.uniforms.rotation[1]=a.b/h,this.uniforms.rotation[2]=a.c/l,this.uniforms.rotation[3]=a.d/l),e.applyFilter(this,t,r,n)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}}var fm=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,gm=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class mm extends wt{constructor(){super(gm,fm)}}var ym=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class vm extends wt{constructor(e=.5,t=Math.random()){super(Fc,ym,{uNoise:0,uSeed:0}),this.noise=e,this.seed=t}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}}const au={AlphaFilter:sm,BlurFilter:lm,BlurFilterPass:Bo,ColorMatrixFilter:Lo,DisplacementFilter:pm,FXAAFilter:mm,NoiseFilter:vm};Object.entries(au).forEach(([i,e])=>{Object.defineProperty(au,i,{get(){return Xe("7.1.0",`filters.${i} has moved to ${i}`),e}})});class bm{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(Nt.system.add(this.tickerUpdate,this,Es.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Nt.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&e.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const Kr=new bm;class Pi{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Pi.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Ze,this.page=new Ze,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,t,r,n,a){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class xn extends Pi{constructor(){super(...arguments),this.client=new Ze,this.movement=new Ze,this.offset=new Ze,this.global=new Ze,this.screen=new Ze}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,r){return e.worldTransform.applyInverse(r||this.global,t)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,r,n,a,h,l,c,d,g,v,b,y,x,S){throw new Error("Method not implemented.")}}class Kt extends xn{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class zs extends xn{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}zs.DOM_DELTA_PIXEL=0,zs.DOM_DELTA_LINE=1,zs.DOM_DELTA_PAGE=2;const _m=2048,xm=new Ze,io=new Ze;class Em{constructor(e){this.dispatch=new Ci,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((r,n)=>r.priority-n.priority)}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const t=this.mappingTable[e.type];if(t)for(let r=0,n=t.length;r<n;r++)t[r].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){Kr.pauseUpdate=!0;const r=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",n=this[r](this.rootTarget,this.rootTarget.eventMode,xm.set(e,t),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(e,t){if(!e.target)return;const r=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let n=0,a=r.length-1;n<a;n++)if(e.currentTarget=r[n],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!(e.propagationStopped||e.propagationImmediatelyStopped)){e.eventPhase=e.BUBBLING_PHASE;for(let n=r.length-2;n>=0;n--)if(e.currentTarget=r[n],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,r=this._allInteractiveElements){if(r.length===0)return;e.eventPhase=e.BUBBLING_PHASE;const n=Array.isArray(t)?t:[t];for(let a=r.length-1;a>=0;a--)n.forEach(h=>{e.currentTarget=r[a],this.notifyTarget(e,h)})}propagationPath(e){const t=[e];for(let r=0;r<_m&&e!==this.rootTarget;r++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestMoveRecursive(e,t,r,n,a,h=!1){let l=!1;if(this._interactivePrune(e))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(Kr.pauseUpdate=!1),e.interactiveChildren&&e.children){const g=e.children;for(let v=g.length-1;v>=0;v--){const b=g[v],y=this.hitTestMoveRecursive(b,this._isInteractive(t)?t:b.eventMode,r,n,a,h||a(e,r));if(y){if(y.length>0&&!y[y.length-1].parent)continue;const x=e.isInteractive();(y.length>0||x)&&(x&&this._allInteractiveElements.push(e),y.push(e)),this._hitElements.length===0&&(this._hitElements=y),l=!0}}}const c=this._isInteractive(t),d=e.isInteractive();return c&&d&&this._allInteractiveElements.push(e),h||this._hitElements.length>0?null:l?this._hitElements:c&&!a(e,r)&&n(e,r)?d?[e]:[]:null}hitTestRecursive(e,t,r,n,a){if(this._interactivePrune(e)||a(e,r))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(Kr.pauseUpdate=!1),e.interactiveChildren&&e.children){const c=e.children;for(let d=c.length-1;d>=0;d--){const g=c[d],v=this.hitTestRecursive(g,this._isInteractive(t)?t:g.eventMode,r,n,a);if(v){if(v.length>0&&!v[v.length-1].parent)continue;const b=e.isInteractive();return(v.length>0||b)&&v.push(e),v}}}const h=this._isInteractive(t),l=e.isInteractive();return h&&n(e,r)?l?[e]:[]:null}_isInteractive(e){return e==="static"||e==="dynamic"}_interactivePrune(e){return!!(!e||e.isMask||!e.visible||!e.renderable||e.eventMode==="none"||e.eventMode==="passive"&&!e.interactiveChildren||e.isMask)}hitPruneFn(e,t){var r;if(e.hitArea&&(e.worldTransform.applyInverse(t,io),!e.hitArea.contains(io.x,io.y)))return!0;if(e._mask){const n=e._mask.isMaskData?e._mask.maskObject:e._mask;if(n&&!((r=n.containsPoint)!=null&&r.call(n,t)))return!0}return!1}hitTestFn(e,t){return e.eventMode==="passive"?!1:e.hitArea?!0:e.containsPoint?e.containsPoint(t):!1}notifyTarget(e,t){var a,h;t=t??e.type;const r=`on${t}`;(h=(a=e.currentTarget)[r])==null||h.call(a,e);const n=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this.notifyListeners(e,n),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof Kt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),t.pointerType==="touch")this.dispatchEvent(t,"touchstart");else if(t.pointerType==="mouse"||t.pointerType==="pen"){const n=t.button===2;this.dispatchEvent(t,n?"rightdown":"mousedown")}const r=this.trackingData(e.pointerId);r.pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){var c,d;if(!(e instanceof Kt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const t=this.createPointerEvent(e);this._isPointerMoveEvent=!1;const r=t.pointerType==="mouse"||t.pointerType==="pen",n=this.trackingData(e.pointerId),a=this.findMountedTarget(n.overTargets);if(((c=n.overTargets)==null?void 0:c.length)>0&&a!==t.target){const g=e.type==="mousemove"?"mouseout":"pointerout",v=this.createPointerEvent(e,g,a);if(this.dispatchEvent(v,"pointerout"),r&&this.dispatchEvent(v,"mouseout"),!t.composedPath().includes(a)){const b=this.createPointerEvent(e,"pointerleave",a);for(b.eventPhase=b.AT_TARGET;b.target&&!t.composedPath().includes(b.target);)b.currentTarget=b.target,this.notifyTarget(b),r&&this.notifyTarget(b,"mouseleave"),b.target=b.target.parent;this.freeEvent(b)}this.freeEvent(v)}if(a!==t.target){const g=e.type==="mousemove"?"mouseover":"pointerover",v=this.clonePointerEvent(t,g);this.dispatchEvent(v,"pointerover"),r&&this.dispatchEvent(v,"mouseover");let b=a==null?void 0:a.parent;for(;b&&b!==this.rootTarget.parent&&b!==t.target;)b=b.parent;if(!b||b===this.rootTarget.parent){const y=this.clonePointerEvent(t,"pointerenter");for(y.eventPhase=y.AT_TARGET;y.target&&y.target!==a&&y.target!==this.rootTarget.parent;)y.currentTarget=y.target,this.notifyTarget(y),r&&this.notifyTarget(y,"mouseenter"),y.target=y.target.parent;this.freeEvent(y)}this.freeEvent(v)}const h=[],l=this.enableGlobalMoveEvents??!0;this.moveOnAll?h.push("pointermove"):this.dispatchEvent(t,"pointermove"),l&&h.push("globalpointermove"),t.pointerType==="touch"&&(this.moveOnAll?h.splice(1,0,"touchmove"):this.dispatchEvent(t,"touchmove"),l&&h.push("globaltouchmove")),r&&(this.moveOnAll?h.splice(1,0,"mousemove"):this.dispatchEvent(t,"mousemove"),l&&h.push("globalmousemove"),this.cursor=(d=t.target)==null?void 0:d.cursor),h.length>0&&this.all(t,h),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=t.composedPath(),this.freeEvent(t)}mapPointerOver(e){var h;if(!(e instanceof Kt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId),r=this.createPointerEvent(e),n=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),n&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=(h=r.target)==null?void 0:h.cursor);const a=this.clonePointerEvent(r,"pointerenter");for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),n&&this.notifyTarget(a,"mouseenter"),a.target=a.target.parent;t.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(a)}mapPointerOut(e){if(!(e instanceof Kt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId);if(t.overTargets){const r=e.pointerType==="mouse"||e.pointerType==="pen",n=this.findMountedTarget(t.overTargets),a=this.createPointerEvent(e,"pointerout",n);this.dispatchEvent(a),r&&this.dispatchEvent(a,"mouseout");const h=this.createPointerEvent(e,"pointerleave",n);for(h.eventPhase=h.AT_TARGET;h.target&&h.target!==this.rootTarget.parent;)h.currentTarget=h.target,this.notifyTarget(h),r&&this.notifyTarget(h,"mouseleave"),h.target=h.target.parent;t.overTargets=null,this.freeEvent(a),this.freeEvent(h)}this.cursor=null}mapPointerUp(e){if(!(e instanceof Kt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=performance.now(),r=this.createPointerEvent(e);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const l=r.button===2;this.dispatchEvent(r,l?"rightup":"mouseup")}const n=this.trackingData(e.pointerId),a=this.findMountedTarget(n.pressTargetsByButton[e.button]);let h=a;if(a&&!r.composedPath().includes(a)){let l=a;for(;l&&!r.composedPath().includes(l);){if(r.currentTarget=l,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const c=r.button===2;this.notifyTarget(r,c?"rightupoutside":"mouseupoutside")}l=l.parent}delete n.pressTargetsByButton[e.button],h=l}if(h){const l=this.clonePointerEvent(r,"click");l.target=h,l.path=null,n.clicksByButton[e.button]||(n.clicksByButton[e.button]={clickCount:0,target:l.target,timeStamp:t});const c=n.clicksByButton[e.button];if(c.target===l.target&&t-c.timeStamp<200?++c.clickCount:c.clickCount=1,c.target=l.target,c.timeStamp=t,l.detail=c.clickCount,l.pointerType==="mouse"){const d=l.button===2;this.dispatchEvent(l,d?"rightclick":"click")}else l.pointerType==="touch"&&this.dispatchEvent(l,"tap");this.dispatchEvent(l,"pointertap"),this.freeEvent(l)}this.freeEvent(r)}mapPointerUpOutside(e){if(!(e instanceof Kt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId),r=this.findMountedTarget(t.pressTargetsByButton[e.button]),n=this.createPointerEvent(e);if(r){let a=r;for(;a;)n.currentTarget=a,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),a=a.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(n)}mapWheel(e){if(!(e instanceof zs)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let r=1;r<e.length&&e[r].parent===t;r++)t=e[r];return t}createPointerEvent(e,t,r){const n=this.allocateEvent(Kt);return this.copyPointerData(e,n),this.copyMouseData(e,n),this.copyData(e,n),n.nativeEvent=e.nativeEvent,n.originalEvent=e,n.target=r??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],typeof t=="string"&&(n.type=t),n}createWheelEvent(e){const t=this.allocateEvent(zs);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){const r=this.allocateEvent(Kt);return r.nativeEvent=e.nativeEvent,r.originalEvent=e.originalEvent,this.copyPointerData(e,r),this.copyMouseData(e,r),this.copyData(e,r),r.target=e.target,r.path=e.composedPath().slice(),r.type=t??r.type,r}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof Kt&&t instanceof Kt&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof xn&&t instanceof xn&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}notifyListeners(e,t){const r=e.currentTarget._events[t];if(r&&e.currentTarget.isInteractive())if("fn"in r)r.once&&e.currentTarget.removeListener(t,r.fn,void 0,!0),r.fn.call(r.context,e);else for(let n=0,a=r.length;n<a&&!e.propagationImmediatelyStopped;n++)r[n].once&&e.currentTarget.removeListener(t,r[n].fn,void 0,!0),r[n].fn.call(r[n].context,e)}}const wm=1,Sm={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Uo=class Go{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new Em(null),Kr.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Kt(null),this.rootWheelEvent=new zs(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Go.defaultEventFeatures},{set:(t,r,n)=>(r==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=n),t[r]=n,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{view:t,resolution:r}=this.renderer;this.setTargetElement(t),this.resolution=r,Go._defaultEventMode=e.eventMode??"auto",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;const r=this.cursorStyles[e];if(r)switch(typeof r){case"string":t&&(this.domElement.style.cursor=r);break;case"function":r(e);break;case"object":t&&Object.assign(this.domElement.style,r);break}else t&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let r=0,n=t.length;r<n;r++){const a=t[r],h=this.bootstrapEvent(this.rootPointerEvent,a);this.rootBoundary.mapEvent(h)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Kr.pointerMoved();const t=this.normalizeToPointerData(e);for(let r=0,n=t.length;r<n;r++){const a=this.bootstrapEvent(this.rootPointerEvent,t[r]);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const r=t!==this.domElement?"outside":"",n=this.normalizeToPointerData(e);for(let a=0,h=n.length;a<h;a++){const l=this.bootstrapEvent(this.rootPointerEvent,n[a]);l.type+=r,this.rootBoundary.mapEvent(l)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);for(let r=0,n=t.length;r<n;r++){const a=this.bootstrapEvent(this.rootPointerEvent,t[r]);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,Kr.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Kr.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Kr.removeTickerListener();const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,r){const n=this.domElement.isConnected?this.domElement.getBoundingClientRect():{width:this.domElement.width,height:this.domElement.height,left:0,top:0},a=1/this.resolution;e.x=(t-n.left)*(this.domElement.width/n.width)*a,e.y=(r-n.top)*(this.domElement.height/n.height)*a}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let r=0,n=e.changedTouches.length;r<n;r++){const a=e.changedTouches[r];typeof a.button>"u"&&(a.button=0),typeof a.buttons>"u"&&(a.buttons=1),typeof a.isPrimary>"u"&&(a.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof a.width>"u"&&(a.width=a.radiusX||1),typeof a.height>"u"&&(a.height=a.radiusY||1),typeof a.tiltX>"u"&&(a.tiltX=0),typeof a.tiltY>"u"&&(a.tiltY=0),typeof a.pointerType>"u"&&(a.pointerType="touch"),typeof a.pointerId>"u"&&(a.pointerId=a.identifier||0),typeof a.pressure>"u"&&(a.pressure=a.force||.5),typeof a.twist>"u"&&(a.twist=0),typeof a.tangentialPressure>"u"&&(a.tangentialPressure=0),typeof a.layerX>"u"&&(a.layerX=a.offsetX=a.clientX),typeof a.layerY>"u"&&(a.layerY=a.offsetY=a.clientY),a.isNormalized=!0,a.type=e.type,t.push(a)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){const r=e;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=wm),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,t.push(r)}else t.push(e);return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,e.type==="pointerleave"&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=Sm[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};Uo.extension={name:"events",type:[be.RendererSystem,be.CanvasRendererSystem]},Uo.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let jo=Uo;Me.add(jo);function ou(i){return i==="dynamic"||i==="static"}const Tm={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??ou(jo.defaultEventMode)},set interactive(i){Xe("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=i,this.eventMode=i?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??jo.defaultEventMode},set eventMode(i){this._internalInteractive=ou(i),this._internalEventMode=i},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(i,e,t){const r=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,n=typeof t=="object"?t.signal:void 0,a=typeof t=="object"?t.once===!0:!1,h=typeof e=="function"?void 0:e;i=r?`${i}capture`:i;const l=typeof e=="function"?e:e.handleEvent,c=this;n&&n.addEventListener("abort",()=>{c.off(i,l,h)}),a?c.once(i,l,h):c.on(i,l,h)},removeEventListener(i,e,t){const r=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,n=typeof e=="function"?void 0:e;i=r?`${i}capture`:i,e=typeof e=="function"?e:e.handleEvent,this.off(i,e,n)},dispatchEvent(i){if(!(i instanceof Pi))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return i.defaultPrevented=!1,i.path=null,i.target=this,i.manager.dispatchEvent(i),!i.defaultPrevented}};ot.mixin(Tm);const Am={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};ot.mixin(Am);const Cm=9,zi=100,Pm=0,Im=0,hu=2,lu=1,Rm=-1e3,Mm=-1e3,Om=2;class Wc{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Mr.tablet||Mr.phone)&&this.createTouchHook();const t=document.createElement("div");t.style.width=`${zi}px`,t.style.height=`${zi}px`,t.style.position="absolute",t.style.top=`${Pm}px`,t.style.left=`${Im}px`,t.style.zIndex=hu.toString(),this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const e=document.createElement("button");e.style.width=`${lu}px`,e.style.height=`${lu}px`,e.style.position="absolute",e.style.top=`${Rm}px`,e.style.left=`${Mm}px`,e.style.zIndex=Om.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var e;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(e=this.renderer.view.parentNode)==null||e.appendChild(this.div))}deactivate(){var e;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(e=this.div.parentNode)==null||e.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);const t=e.children;if(t)for(let r=0;r<t.length;r++)this.updateAccessibleObjects(t[r])}update(){const e=performance.now();if(Mr.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:t,y:r,width:n,height:a}=this.renderer.view.getBoundingClientRect(),{width:h,height:l,resolution:c}=this.renderer,d=n/h*c,g=a/l*c;let v=this.div;v.style.left=`${t}px`,v.style.top=`${r}px`,v.style.width=`${h}px`,v.style.height=`${l}px`;for(let b=0;b<this.children.length;b++){const y=this.children[b];if(y.renderId!==this.renderId)y._accessibleActive=!1,Vs(this.children,b,1),this.div.removeChild(y._accessibleDiv),this.pool.push(y._accessibleDiv),y._accessibleDiv=null,b--;else{v=y._accessibleDiv;let x=y.hitArea;const S=y.worldTransform;y.hitArea?(v.style.left=`${(S.tx+x.x*S.a)*d}px`,v.style.top=`${(S.ty+x.y*S.d)*g}px`,v.style.width=`${x.width*S.a*d}px`,v.style.height=`${x.height*S.d*g}px`):(x=y.getBounds(),this.capHitArea(x),v.style.left=`${x.x*d}px`,v.style.top=`${x.y*g}px`,v.style.width=`${x.width*d}px`,v.style.height=`${x.height*g}px`,v.title!==y.accessibleTitle&&y.accessibleTitle!==null&&(v.title=y.accessibleTitle),v.getAttribute("aria-label")!==y.accessibleHint&&y.accessibleHint!==null&&v.setAttribute("aria-label",y.accessibleHint)),(y.accessibleTitle!==v.title||y.tabIndex!==v.tabIndex)&&(v.title=y.accessibleTitle,v.tabIndex=y.tabIndex,this.debug&&this.updateDebugHTML(v))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:t,height:r}=this.renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>r&&(e.height=r-e.y)}addChild(e){let t=this.pool.pop();t||(t=document.createElement("button"),t.style.width=`${zi}px`,t.style.height=`${zi}px`,t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=hu.toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?t.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(t.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&e.accessibleHint!==null&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){const{displayObject:r}=e.target,n=this.renderer.events.rootBoundary,a=Object.assign(new Pi(n),{target:r});n.rootTarget=this.renderer.lastObjectRendered,t.forEach(h=>n.dispatchEvent(a,h))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){e.keyCode===Cm&&this.activate()}_onMouseMove(e){e.movementX===0&&e.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Wc.extension={name:"accessibility",type:[be.RendererPlugin,be.CanvasRendererPlugin]};Me.add(Wc);const zc=class Ho{constructor(e){this.stage=new tr,e=Object.assign({forceCanvas:!1},e),this.renderer=Hg(e),Ho._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){var e;return(e=this.renderer)==null?void 0:e.view}get screen(){var e;return(e=this.renderer)==null?void 0:e.screen}destroy(e,t){const r=Ho._plugins.slice(0);r.reverse(),r.forEach(n=>{n.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};zc._plugins=[];let hh=zc;Me.handleByList(be.Application,hh._plugins);class qc{static init(e){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let t,r;if(this._resizeTo===globalThis.window)t=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:a}=this._resizeTo;t=n,r=a}this.renderer.resize(t,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}qc.extension=be.Application;Me.add(qc);const uu={loader:be.LoadParser,resolver:be.ResolveParser,cache:be.CacheParser,detection:be.DetectionParser};Me.handle(be.Asset,i=>{const e=i.ref;Object.entries(uu).filter(([t])=>!!e[t]).forEach(([t,r])=>Me.add(Object.assign(e[t],{extension:e[t].extension??r})))},i=>{const e=i.ref;Object.keys(uu).filter(t=>!!e[t]).forEach(t=>Me.remove(e[t]))});class km{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(t=>{this._assetList.push(t)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<t;r++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}function ri(i,e){if(Array.isArray(e)){for(const t of e)if(i.startsWith(`data:${t}`))return!0;return!1}return i.startsWith(`data:${e}`)}function es(i,e){const t=i.split("?")[0],r=vt.extname(t).toLowerCase();return Array.isArray(e)?e.includes(r):r===e}const Yt=(i,e,t=!1)=>(Array.isArray(i)||(i=[i]),e?i.map(r=>typeof r=="string"||t?e(r):r):i),$o=(i,e)=>{const t=e.split("?")[1];return t&&(i+=`?${t}`),i};function Xc(i,e,t,r,n){const a=e[t];for(let h=0;h<a.length;h++){const l=a[h];t<e.length-1?Xc(i.replace(r[t],l),e,t+1,r,n):n.push(i.replace(r[t],l))}}function Nm(i){const e=/\{(.*?)\}/g,t=i.match(e),r=[];if(t){const n=[];t.forEach(a=>{const h=a.substring(1,a.length-1).split(",");n.push(h)}),Xc(i,n,0,t,r)}else r.push(i);return r}const En=i=>!Array.isArray(i);class Dm{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const t=this._cache.get(e);return t||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){const r=Yt(e);let n;for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];if(c.test(t)){n=c.getCacheableAssets(r,t);break}}n||(n={},r.forEach(l=>{n[l]=t}));const a=Object.keys(n),h={cacheKeys:a,keys:r};if(r.forEach(l=>{this._cacheMap.set(l,h)}),a.forEach(l=>{const c=n?n[l]:t;this._cache.has(l)&&this._cache.get(l)!==c&&console.warn("[Cache] already has key:",l),this._cache.set(l,n[l])}),t instanceof Re){const l=t;r.forEach(c=>{l.baseTexture!==Re.EMPTY.baseTexture&&He.addToCache(l.baseTexture,c),Re.addToCache(l,c)})}}remove(e){if(!this._cacheMap.has(e)){console.warn(`[Assets] Asset id ${e} was not found in the Cache`);return}const t=this._cacheMap.get(e);t.cacheKeys.forEach(r=>{this._cache.delete(r)}),t.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}}const ys=new Dm;class Fm{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,r)=>(this._parsersValidated=!1,e[t]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){const r={promise:null,parser:null};return r.promise=(async()=>{var h,l;let n=null,a=null;if(t.loadParser&&(a=this._parserHash[t.loadParser],a||console.warn(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`)),!a){for(let c=0;c<this.parsers.length;c++){const d=this.parsers[c];if(d.load&&((h=d.test)!=null&&h.call(d,e,t,this))){a=d;break}}if(!a)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await a.load(e,t,this),r.parser=a;for(let c=0;c<this.parsers.length;c++){const d=this.parsers[c];d.parse&&d.parse&&await((l=d.testParse)==null?void 0:l.call(d,n,t,this))&&(n=await d.parse(n,t,this)||n,r.parser=d)}return n})(),r}async load(e,t){this._parsersValidated||this._validateParsers();let r=0;const n={},a=En(e),h=Yt(e,d=>({alias:[d],src:d})),l=h.length,c=h.map(async d=>{const g=vt.toAbsolute(d.src);if(!n[d.src])try{this.promiseCache[g]||(this.promiseCache[g]=this._getLoadPromiseAndParser(g,d)),n[d.src]=await this.promiseCache[g].promise,t&&t(++r/l)}catch(v){throw delete this.promiseCache[g],delete n[d.src],new Error(`[Loader.load] Failed to load ${g}.
${v}`)}});return await Promise.all(c),a?n[h[0].src]:n}async unload(e){const t=Yt(e,r=>({alias:[r],src:r})).map(async r=>{var h,l;const n=vt.toAbsolute(r.src),a=this.promiseCache[n];if(a){const c=await a.promise;delete this.promiseCache[n],(l=(h=a.parser)==null?void 0:h.unload)==null||l.call(h,c,r,this)}});await Promise.all(t)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,t)=>(e[t.name]&&console.warn(`[Assets] loadParser name conflict "${t.name}"`),{...e,[t.name]:t}),{})}}var rr=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(rr||{});const Bm=".json",Lm="application/json",Um={extension:{type:be.LoadParser,priority:rr.Low},name:"loadJson",test(i){return ri(i,Lm)||es(i,Bm)},async load(i){return await(await Se.ADAPTER.fetch(i)).json()}};Me.add(Um);const Gm=".txt",jm="text/plain",Hm={name:"loadTxt",extension:{type:be.LoadParser,priority:rr.Low},test(i){return ri(i,jm)||es(i,Gm)},async load(i){return await(await Se.ADAPTER.fetch(i)).text()}};Me.add(Hm);const $m=["normal","bold","100","200","300","400","500","600","700","800","900"],Vm=[".ttf",".otf",".woff",".woff2"],Wm=["font/ttf","font/otf","font/woff","font/woff2"],zm=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function qm(i){const e=vt.extname(i),t=vt.basename(i,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1));let r=t.length>0;for(const a of t)if(!a.match(zm)){r=!1;break}let n=t.join(" ");return r||(n=`"${n.replace(/[\\"]/g,"\\$&")}"`),n}const Xm=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function Km(i){return Xm.test(i)?i:encodeURI(i)}const Ym={extension:{type:be.LoadParser,priority:rr.Low},name:"loadWebFont",test(i){return ri(i,Wm)||es(i,Vm)},async load(i,e){var r,n,a;const t=Se.ADAPTER.getFontFaceSet();if(t){const h=[],l=((r=e.data)==null?void 0:r.family)??qm(i),c=((a=(n=e.data)==null?void 0:n.weights)==null?void 0:a.filter(g=>$m.includes(g)))??["normal"],d=e.data??{};for(let g=0;g<c.length;g++){const v=c[g],b=new FontFace(l,`url(${Km(i)})`,{...d,weight:v});await b.load(),t.add(b),h.push(b)}return h.length===1?h[0]:h}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(i){(Array.isArray(i)?i:[i]).forEach(e=>Se.ADAPTER.getFontFaceSet().delete(e))}};Me.add(Ym);const Jm=`(function() {
  "use strict";
  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
  async function checkImageBitmap() {
    try {
      if (typeof createImageBitmap != "function")
        return !1;
      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap.width === 1 && imageBitmap.height === 1;
    } catch {
      return !1;
    }
  }
  checkImageBitmap().then((result) => {
    self.postMessage(result);
  });
})();
`;let qs=null,Vo=class{constructor(){qs||(qs=URL.createObjectURL(new Blob([Jm],{type:"application/javascript"}))),this.worker=new Worker(qs)}};Vo.revokeObjectURL=function(){qs&&(URL.revokeObjectURL(qs),qs=null)};const Zm=`(function() {
  "use strict";
  async function loadImageBitmap(url) {
    const response = await fetch(url);
    if (!response.ok)
      throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
    const imageBlob = await response.blob();
    return await createImageBitmap(imageBlob);
  }
  self.onmessage = async (event) => {
    try {
      const imageBitmap = await loadImageBitmap(event.data.data[0]);
      self.postMessage({
        data: imageBitmap,
        uuid: event.data.uuid,
        id: event.data.id
      }, [imageBitmap]);
    } catch (e) {
      self.postMessage({
        error: e,
        uuid: event.data.uuid,
        id: event.data.id
      });
    }
  };
})();
`;let Xs=null;class Kc{constructor(){Xs||(Xs=URL.createObjectURL(new Blob([Zm],{type:"application/javascript"}))),this.worker=new Worker(Xs)}}Kc.revokeObjectURL=function(){Xs&&(URL.revokeObjectURL(Xs),Xs=null)};let cu=0,no;class Qm{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{const{worker:t}=new Vo;t.addEventListener("message",r=>{t.terminate(),Vo.revokeObjectURL(),e(r.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){no===void 0&&(no=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<no&&(this._createdWorkers++,e=new Kc().worker,e.addEventListener("message",t=>{this.complete(t.data),this.returnWorker(t.target),this.next()})),e}returnWorker(e){this.workerPool.push(e)}complete(e){e.error!==void 0?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();const r=new Promise((n,a)=>{this.queue.push({id:e,arguments:t,resolve:n,reject:a})});return this.next(),r}next(){if(!this.queue.length)return;const e=this.getWorker();if(!e)return;const t=this.queue.pop(),r=t.id;this.resolveHash[cu]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:cu++,id:r})}}const du=new Qm;function Ii(i,e,t){i.resource.internal=!0;const r=new Re(i),n=()=>{delete e.promiseCache[t],ys.has(t)&&ys.remove(t)};return r.baseTexture.once("destroyed",()=>{t in e.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),n())}),r.once("destroyed",()=>{i.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),n())}),r}const ey=[".jpeg",".jpg",".png",".webp",".avif"],ty=["image/jpeg","image/png","image/webp","image/avif"];async function ry(i){const e=await Se.ADAPTER.fetch(i);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${e.status} ${e.statusText}`);const t=await e.blob();return await createImageBitmap(t)}const Bn={name:"loadTextures",extension:{type:be.LoadParser,priority:rr.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(i){return ri(i,ty)||es(i,ey)},async load(i,e,t){var l;const r=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let n;r?this.config.preferWorkers&&await du.isImageBitmapSupported()?n=await du.loadImageBitmap(i):n=await ry(i):n=await new Promise((c,d)=>{const g=new Image;g.crossOrigin=this.config.crossOrigin,g.src=i,g.complete?c(g):(g.onload=()=>c(g),g.onerror=v=>d(v))});const a={...e.data};a.resolution??(a.resolution=Nr(i)),r&&((l=a.resourceOptions)==null?void 0:l.ownsImageBitmap)===void 0&&(a.resourceOptions={...a.resourceOptions},a.resourceOptions.ownsImageBitmap=!0);const h=new He(n,a);return h.resource.src=i,Ii(h,t,i)},unload(i){i.destroy(!0)}};Me.add(Bn);const sy=".svg",iy="image/svg+xml",ny={extension:{type:be.LoadParser,priority:rr.High},name:"loadSVG",test(i){return ri(i,iy)||es(i,sy)},async testParse(i){return ko.test(i)},async parse(i,e,t){var a;const r=new ko(i,(a=e==null?void 0:e.data)==null?void 0:a.resourceOptions);await r.load();const n=new He(r,{resolution:Nr(i),...e==null?void 0:e.data});return n.resource.src=e.src,Ii(n,t,e.src)},async load(i,e){return(await Se.ADAPTER.fetch(i)).text()},unload:Bn.unload};Me.add(ny);const ay=[".mp4",".m4v",".webm",".ogv"],oy=["video/mp4","video/webm","video/ogg"],hy={name:"loadVideo",extension:{type:be.LoadParser,priority:rr.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test(i){return ri(i,oy)||es(i,ay)},async load(i,e,t){var h;let r;const n=await(await Se.ADAPTER.fetch(i)).blob(),a=URL.createObjectURL(n);try{const l={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...(h=e==null?void 0:e.data)==null?void 0:h.resourceOptions,autoLoad:!0},c=new Hc(a,l);await c.load();const d=new He(c,{alphaMode:await ff(),resolution:Nr(i),...e==null?void 0:e.data});d.resource.src=i,r=Ii(d,t,i),r.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(a)})}catch(l){throw URL.revokeObjectURL(a),l}return r},unload(i){i.destroy(!0)}};Me.add(hy);class ly{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{const t=e;this._defaultSearchParams=Object.keys(t).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(t[r])}`).join("&")}}getAlias(e){const{alias:t,name:r,src:n,srcs:a}=e;return Yt(t||r||n||a,h=>typeof h=="string"?h:Array.isArray(h)?h.map(l=>(l==null?void 0:l.src)??(l==null?void 0:l.srcs)??l):h!=null&&h.src||h!=null&&h.srcs?h.src??h.srcs:h,!0)}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(t=>{this.addBundle(t.name,t.assets)})}addBundle(e,t){const r=[];Array.isArray(t)?t.forEach(n=>{const a=n.src??n.srcs,h=n.alias??n.name;let l;if(typeof h=="string"){const c=this._createBundleAssetId(e,h);r.push(c),l=[h,c]}else{const c=h.map(d=>this._createBundleAssetId(e,d));r.push(...c),l=[...h,...c]}this.add({...n,alias:l,src:a})}):Object.keys(t).forEach(n=>{const a=[n,this._createBundleAssetId(e,n)];if(typeof t[n]=="string")this.add({alias:a,src:t[n]});else if(Array.isArray(t[n]))this.add({alias:a,src:t[n]});else{const h=t[n],l=h.src??h.srcs;this.add({...h,alias:a,src:Array.isArray(l)?l:[l]})}r.push(...a)}),this._bundles[e]=r}add(e,t,r,n,a){const h=[];typeof e=="string"||Array.isArray(e)&&typeof e[0]=="string"?(Xe("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),h.push({alias:e,src:t,data:r,format:n,loadParser:a})):Array.isArray(e)?h.push(...e):h.push(e);let l;l=c=>{this.hasKey(c)&&console.warn(`[Resolver] already has key: ${c} overwriting`)},Yt(h).forEach(c=>{const{src:d,srcs:g}=c;let{data:v,format:b,loadParser:y}=c;const x=Yt(d||g).map(T=>typeof T=="string"?Nm(T):Array.isArray(T)?T:[T]),S=this.getAlias(c);Array.isArray(S)?S.forEach(l):l(S);const w=[];x.forEach(T=>{T.forEach(N=>{let M={};if(typeof N!="object"){M.src=N;for(let F=0;F<this._parsers.length;F++){const O=this._parsers[F];if(O.test(N)){M=O.parse(N);break}}}else v=N.data??v,b=N.format??b,y=N.loadParser??y,M={...M,...N};if(!S)throw new Error(`[Resolver] alias is undefined for this asset: ${M.src}`);M=this.buildResolvedAsset(M,{aliases:S,data:v,format:b,loadParser:y}),w.push(M)})}),S.forEach(T=>{this._assetMap[T]=w})})}resolveBundle(e){const t=En(e);e=Yt(e);const r={};return e.forEach(n=>{const a=this._bundles[n];if(a){const h=this.resolve(a),l={};for(const c in h){const d=h[c];l[this._extractAssetIdFromBundle(n,c)]=d}r[n]=l}}),t?r[e[0]]:r}resolveUrl(e){const t=this.resolve(e);if(typeof e!="string"){const r={};for(const n in t)r[n]=t[n].src;return r}return t.src}resolve(e){const t=En(e);e=Yt(e);const r={};return e.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let a=this._assetMap[n];const h=a[0],l=this._getPreferredOrder(a);l==null||l.priority.forEach(c=>{l.params[c].forEach(d=>{const g=a.filter(v=>v[c]?v[c]===d:!1);g.length&&(a=g)})}),this._resolverHash[n]=a[0]??h}else this._resolverHash[n]=this.buildResolvedAsset({alias:[n],src:n},{});r[n]=this._resolverHash[n]}),t?r[e[0]]:r}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){const r=e[0],n=this._preferredOrder.find(a=>a.params.format.includes(r.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;const t=/\?/.test(e)?"&":"?";return`${e}${t}${this._defaultSearchParams}`}buildResolvedAsset(e,t){const{aliases:r,data:n,loadParser:a,format:h}=t;return(this._basePath||this._rootPath)&&(e.src=vt.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=r??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...n||{},...e.data},e.loadParser=a??e.loadParser,e.format=h??e.format??vt.extname(e.src).slice(1),e.srcs=e.src,e.name=e.alias,e}}class uy{constructor(){this._detections=[],this._initialized=!1,this.resolver=new ly,this.loader=new Fm,this.cache=ys,this._backgroundLoader=new km(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){var a,h;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let l=e.manifest;typeof l=="string"&&(l=await this.load(l)),this.resolver.addManifest(l)}const t=((a=e.texturePreference)==null?void 0:a.resolution)??1,r=typeof t=="number"?[t]:t,n=await this._detectFormats({preferredFormats:(h=e.texturePreference)==null?void 0:h.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:r}}),e.preferences&&this.setPreferences(e.preferences)}add(e,t,r,n,a){this.resolver.add(e,t,r,n,a)}async load(e,t){this._initialized||await this.init();const r=En(e),n=Yt(e).map(l=>{if(typeof l!="string"){const c=this.resolver.getAlias(l);return c.some(d=>!this.resolver.hasKey(d))&&this.add(l),Array.isArray(c)?c[0]:c}return this.resolver.hasKey(l)||this.add({alias:l,src:l}),l}),a=this.resolver.resolve(n),h=await this._mapLoadToResolve(a,t);return r?h[n[0]]:h}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let r=!1;typeof e=="string"&&(r=!0,e=[e]);const n=this.resolver.resolveBundle(e),a={},h=Object.keys(n);let l=0,c=0;const d=()=>{t==null||t(++l/c)},g=h.map(v=>{const b=n[v];return c+=Object.keys(b).length,this._mapLoadToResolve(b,d).then(y=>{a[v]=y})});return await Promise.all(g),r?a[e[0]]:a}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return ys.get(e);const t={};for(let r=0;r<e.length;r++)t[r]=ys.get(e[r]);return t}async _mapLoadToResolve(e,t){const r=Object.values(e),n=Object.keys(e);this._backgroundLoader.active=!1;const a=await this.loader.load(r,t);this._backgroundLoader.active=!0;const h={};return r.forEach((l,c)=>{const d=a[l.src],g=[l.src];l.alias&&g.push(...l.alias),h[n[c]]=d,ys.set(g,d)}),h}async unload(e){this._initialized||await this.init();const t=Yt(e).map(n=>typeof n!="string"?n.src:n),r=this.resolver.resolve(t);await this._unloadFromResolved(r)}async unloadBundle(e){this._initialized||await this.init(),e=Yt(e);const t=this.resolver.resolveBundle(e),r=Object.keys(t).map(n=>this._unloadFromResolved(t[n]));await Promise.all(r)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach(r=>{ys.remove(r.src)}),await this.loader.unload(t)}async _detectFormats(e){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const r of e.detections)e.skipDetections||await r.test()?t=await r.add(t):e.skipDetections||(t=await r.remove(t));return t=t.filter((r,n)=>t.indexOf(r)===n),t}get detections(){return this._detections}get preferWorkers(){return Bn.config.preferWorkers}set preferWorkers(e){Xe("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(r=>r in e).forEach(r=>{t.config[r]=e[r]})})}}const qi=new uy;Me.handleByList(be.LoadParser,qi.loader.parsers).handleByList(be.ResolveParser,qi.resolver.parsers).handleByList(be.CacheParser,qi.cache.parsers).handleByList(be.DetectionParser,qi.detections);const cy={extension:be.CacheParser,test:i=>Array.isArray(i)&&i.every(e=>e instanceof Re),getCacheableAssets:(i,e)=>{const t={};return i.forEach(r=>{e.forEach((n,a)=>{t[r+(a===0?"":a+1)]=n})}),t}};Me.add(cy);async function Yc(i){if("Image"in globalThis)return new Promise(e=>{const t=new Image;t.onload=()=>{e(!0)},t.onerror=()=>{e(!1)},t.src=i});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(i)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}const dy={extension:{type:be.DetectionParser,priority:1},test:async()=>Yc("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async i=>[...i,"avif"],remove:async i=>i.filter(e=>e!=="avif")};Me.add(dy);const py={extension:{type:be.DetectionParser,priority:0},test:async()=>Yc("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async i=>[...i,"webp"],remove:async i=>i.filter(e=>e!=="webp")};Me.add(py);const pu=["png","jpg","jpeg"],fy={extension:{type:be.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...pu],remove:async i=>i.filter(e=>!pu.includes(e))};Me.add(fy);const gy="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function lh(i){return gy?!1:document.createElement("video").canPlayType(i)!==""}const my={extension:{type:be.DetectionParser,priority:0},test:async()=>lh("video/webm"),add:async i=>[...i,"webm"],remove:async i=>i.filter(e=>e!=="webm")};Me.add(my);const yy={extension:{type:be.DetectionParser,priority:0},test:async()=>lh("video/mp4"),add:async i=>[...i,"mp4","m4v"],remove:async i=>i.filter(e=>e!=="mp4"&&e!=="m4v")};Me.add(yy);const vy={extension:{type:be.DetectionParser,priority:0},test:async()=>lh("video/ogg"),add:async i=>[...i,"ogv"],remove:async i=>i.filter(e=>e!=="ogv")};Me.add(vy);const by={extension:be.ResolveParser,test:Bn.test,parse:i=>{var e;return{resolution:parseFloat(((e=Se.RETINA_PREFIX.exec(i))==null?void 0:e[1])??"1"),format:vt.extname(i).slice(1),src:i}}};Me.add(by);var bt=(i=>(i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i[i.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",i[i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",i[i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",i[i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",i))(bt||{});const wn={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let cr,Ls;function fu(){Ls={bptc:cr.getExtension("EXT_texture_compression_bptc"),astc:cr.getExtension("WEBGL_compressed_texture_astc"),etc:cr.getExtension("WEBGL_compressed_texture_etc"),s3tc:cr.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:cr.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:cr.getExtension("WEBGL_compressed_texture_pvrtc")||cr.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:cr.getExtension("WEBGL_compressed_texture_etc1"),atc:cr.getExtension("WEBGL_compressed_texture_atc")}}const _y={extension:{type:be.DetectionParser,priority:2},test:async()=>{const i=Se.ADAPTER.createCanvas().getContext("webgl");return i?(cr=i,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async i=>{Ls||fu();const e=[];for(const t in Ls)Ls[t]&&e.push(t);return[...e,...i]},remove:async i=>(Ls||fu(),i.filter(e=>!(e in Ls)))};Me.add(_y);class xy extends On{constructor(e,t={width:1,height:1,autoLoad:!0}){let r,n;typeof e=="string"?(r=e,n=new Uint8Array):(r=null,n=e),super(n,t),this.origin=r,this.buffer=n?new _o(n):null,this._load=null,this.loaded=!1,this.origin!==null&&t.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>(this.data=new Uint32Array(e),this.buffer=new _o(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),this)),this._load)}}class bs extends xy{constructor(e,t){super(e,t),this.format=t.format,this.levels=t.levels||1,this._width=t.width,this._height=t.height,this._extension=bs._formatToExtension(this.format),(t.levelBuffers||this.buffer)&&(this._levelBuffers=t.levelBuffers||bs._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,t,r){const n=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;n.pixelStorei(n.UNPACK_ALIGNMENT,4);for(let a=0,h=this.levels;a<h;a++){const{levelID:l,levelWidth:c,levelHeight:d,levelBuffer:g}=this._levelBuffers[a];n.compressedTexImage2D(n.TEXTURE_2D,l,this.format,c,d,0,g)}return!0}onBlobLoaded(){this._levelBuffers=bs._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=35916&&e<=35919)return"s3tc_sRGB";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(e===36196)return"etc1";if(e===35986||e===35987||e===34798)return"atc";if(e>=36492&&e<=36495)return"bptc";if(e===37808)return"astc";throw new Error(`Invalid (compressed) texture format given: ${e}`)}static _createLevelBuffers(e,t,r,n,a,h,l){const c=new Array(r);let d=e.byteOffset,g=h,v=l,b=g+n-1&~(n-1),y=v+a-1&~(a-1),x=b*y*wn[t];for(let S=0;S<r;S++)c[S]={levelID:S,levelWidth:r>1?g:b,levelHeight:r>1?v:y,levelBuffer:new Uint8Array(e.buffer,d,x)},d+=x,g=g>>1||1,v=v>>1||1,b=g+n-1&~(n-1),y=v+a-1&~(a-1),x=b*y*wn[t];return c}}const ao=4,Xi=124,Ey=32,gu=20,wy=542327876,Ki={HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},Sy={FOURCC:2},Yi={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3},Ty=1,Ay=2,Cy=4,Py=64,Iy=512,Ry=131072,My=827611204,Oy=861165636,ky=894720068,Ny=808540228,Dy=4,Fy={[My]:bt.COMPRESSED_RGBA_S3TC_DXT1_EXT,[Oy]:bt.COMPRESSED_RGBA_S3TC_DXT3_EXT,[ky]:bt.COMPRESSED_RGBA_S3TC_DXT5_EXT},By={70:bt.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:bt.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:bt.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:bt.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:bt.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:bt.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:bt.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:bt.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:bt.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:bt.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:bt.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:bt.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:bt.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function Ly(i){const e=new Uint32Array(i);if(e[0]!==wy)throw new Error("Invalid DDS file magic word");const t=new Uint32Array(i,0,Xi/Uint32Array.BYTES_PER_ELEMENT),r=t[Ki.HEIGHT],n=t[Ki.WIDTH],a=t[Ki.MIPMAP_COUNT],h=new Uint32Array(i,Ki.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Ey/Uint32Array.BYTES_PER_ELEMENT),l=h[Ty];if(l&Cy){const c=h[Sy.FOURCC];if(c!==Ny){const N=Fy[c],M=ao+Xi,F=new Uint8Array(i,M);return[new bs(F,{format:N,width:n,height:r,levels:a})]}const d=ao+Xi,g=new Uint32Array(e.buffer,d,gu/Uint32Array.BYTES_PER_ELEMENT),v=g[Yi.DXGI_FORMAT],b=g[Yi.RESOURCE_DIMENSION],y=g[Yi.MISC_FLAG],x=g[Yi.ARRAY_SIZE],S=By[v];if(S===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${v}`);if(y===Dy)throw new Error("DDSParser does not support cubemap textures");if(b===6)throw new Error("DDSParser does not supported 3D texture data");const w=new Array,T=ao+Xi+gu;if(x===1)w.push(new Uint8Array(i,T));else{const N=wn[S];let M=0,F=n,O=r;for(let C=0;C<a;C++){const V=Math.max(1,F+3&-4),se=Math.max(1,O+3&-4),ae=V*se*N;M+=ae,F=F>>>1,O=O>>>1}let J=T;for(let C=0;C<x;C++)w.push(new Uint8Array(i,J,M)),J+=M}return w.map(N=>new bs(N,{format:S,width:n,height:r,levels:a}))}throw l&Py?new Error("DDSParser does not support uncompressed texture data."):l&Iy?new Error("DDSParser does not supported YUV uncompressed texture data."):l&Ry?new Error("DDSParser does not support single-channel (lumninance) texture data!"):l&Ay?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const mu=[171,75,84,88,32,49,49,187,13,10,26,10],Uy=67305985,qt={ENDIANNESS:12,GL_TYPE:16,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Wo=64,yu={[Fe.UNSIGNED_BYTE]:1,[Fe.UNSIGNED_SHORT]:2,[Fe.INT]:4,[Fe.UNSIGNED_INT]:4,[Fe.FLOAT]:4,[Fe.HALF_FLOAT]:8},Gy={[de.RGBA]:4,[de.RGB]:3,[de.RG]:2,[de.RED]:1,[de.LUMINANCE]:1,[de.LUMINANCE_ALPHA]:2,[de.ALPHA]:1},jy={[Fe.UNSIGNED_SHORT_4_4_4_4]:2,[Fe.UNSIGNED_SHORT_5_5_5_1]:2,[Fe.UNSIGNED_SHORT_5_6_5]:2};function Hy(i,e,t=!1){const r=new DataView(e);if(!$y(i,r))return null;const n=r.getUint32(qt.ENDIANNESS,!0)===Uy,a=r.getUint32(qt.GL_TYPE,n),h=r.getUint32(qt.GL_FORMAT,n),l=r.getUint32(qt.GL_INTERNAL_FORMAT,n),c=r.getUint32(qt.PIXEL_WIDTH,n),d=r.getUint32(qt.PIXEL_HEIGHT,n)||1,g=r.getUint32(qt.PIXEL_DEPTH,n)||1,v=r.getUint32(qt.NUMBER_OF_ARRAY_ELEMENTS,n)||1,b=r.getUint32(qt.NUMBER_OF_FACES,n),y=r.getUint32(qt.NUMBER_OF_MIPMAP_LEVELS,n),x=r.getUint32(qt.BYTES_OF_KEY_VALUE_DATA,n);if(d===0||g!==1)throw new Error("Only 2D textures are supported");if(b!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(v!==1)throw new Error("WebGL does not support array textures");const S=4,w=4,T=c+3&-4,N=d+3&-4,M=new Array(v);let F=c*d;a===0&&(F=T*N);let O;if(a!==0?yu[a]?O=yu[a]*Gy[h]:O=jy[a]:O=wn[l],O===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const J=t?Wy(r,x,n):null;let C=F*O,V=c,se=d,ae=T,ve=N,H=Wo+x;for(let K=0;K<y;K++){const re=r.getUint32(H,n);let oe=H+4;for(let R=0;R<v;R++){let k=M[R];k||(k=M[R]=new Array(y)),k[K]={levelID:K,levelWidth:y>1||a!==0?V:ae,levelHeight:y>1||a!==0?se:ve,levelBuffer:new Uint8Array(e,oe,C)},oe+=C}H+=re+4,H=H%4!==0?H+4-H%4:H,V=V>>1||1,se=se>>1||1,ae=V+S-1&-4,ve=se+w-1&-4,C=ae*ve*O}return a!==0?{uncompressed:M.map(K=>{let re=K[0].levelBuffer,oe=!1;return a===Fe.FLOAT?re=new Float32Array(K[0].levelBuffer.buffer,K[0].levelBuffer.byteOffset,K[0].levelBuffer.byteLength/4):a===Fe.UNSIGNED_INT?(oe=!0,re=new Uint32Array(K[0].levelBuffer.buffer,K[0].levelBuffer.byteOffset,K[0].levelBuffer.byteLength/4)):a===Fe.INT&&(oe=!0,re=new Int32Array(K[0].levelBuffer.buffer,K[0].levelBuffer.byteOffset,K[0].levelBuffer.byteLength/4)),{resource:new On(re,{width:K[0].levelWidth,height:K[0].levelHeight}),type:a,format:oe?Vy(h):h}}),kvData:J}:{compressed:M.map(K=>new bs(null,{format:l,width:c,height:d,levels:y,levelBuffers:K})),kvData:J}}function $y(i,e){for(let t=0;t<mu.length;t++)if(e.getUint8(t)!==mu[t])return console.error(`${i} is not a valid *.ktx file!`),!1;return!0}function Vy(i){switch(i){case de.RGBA:return de.RGBA_INTEGER;case de.RGB:return de.RGB_INTEGER;case de.RG:return de.RG_INTEGER;case de.RED:return de.RED_INTEGER;default:return i}}function Wy(i,e,t){const r=new Map;let n=0;for(;n<e;){const a=i.getUint32(Wo+n,t),h=Wo+n+4,l=3-(a+3)%4;if(a===0||a>e-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let c=0;for(;c<a&&i.getUint8(h+c)!==0;c++);if(c===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const d=new TextDecoder().decode(new Uint8Array(i.buffer,h,c)),g=new DataView(i.buffer,h+c+1,a-c-1);r.set(d,g),n+=4+a+l}return r}const zy={extension:{type:be.LoadParser,priority:rr.High},name:"loadDDS",test(i){return es(i,".dds")},async load(i,e,t){const r=await(await Se.ADAPTER.fetch(i)).arrayBuffer(),n=Ly(r).map(a=>{const h=new He(a,{mipmap:br.OFF,alphaMode:Rt.NO_PREMULTIPLIED_ALPHA,resolution:Nr(i),...e.data});return Ii(h,t,i)});return n.length===1?n[0]:n},unload(i){Array.isArray(i)?i.forEach(e=>e.destroy(!0)):i.destroy(!0)}};Me.add(zy);const qy={extension:{type:be.LoadParser,priority:rr.High},name:"loadKTX",test(i){return es(i,".ktx")},async load(i,e,t){const r=await(await Se.ADAPTER.fetch(i)).arrayBuffer(),{compressed:n,uncompressed:a,kvData:h}=Hy(i,r),l=n??a,c={mipmap:br.OFF,alphaMode:Rt.NO_PREMULTIPLIED_ALPHA,resolution:Nr(i),...e.data},d=l.map(g=>{l===a&&Object.assign(c,{type:g.type,format:g.format});const v=g.resource??g,b=new He(v,c);return b.ktxKeyValueData=h,Ii(b,t,i)});return d.length===1?d[0]:d},unload(i){Array.isArray(i)?i.forEach(e=>e.destroy(!0)):i.destroy(!0)}};Me.add(qy);const Xy=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],Ky={extension:be.ResolveParser,test:i=>{const e=vt.extname(i).slice(1);return["basis","ktx","dds"].includes(e)},parse:i=>{var r,n;const e=i.split("."),t=e.pop();if(["ktx","dds"].includes(t)){const a=e.pop();if(Xy.includes(a))return{resolution:parseFloat(((r=Se.RETINA_PREFIX.exec(i))==null?void 0:r[1])??"1"),format:a,src:i}}return{resolution:parseFloat(((n=Se.RETINA_PREFIX.exec(i))==null?void 0:n[1])??"1"),format:t,src:i}}};Me.add(Ky);const Ji=new We,Yy=4,Jc=class _i{constructor(e){this.renderer=e,this._rendererPremultipliedAlpha=!1}contextChange(){var t;const e=(t=this.renderer)==null?void 0:t.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}async image(e,t,r,n){const a=new Image;return a.src=await this.base64(e,t,r,n),a}async base64(e,t,r,n){const a=this.canvas(e,n);if(a.toBlob!==void 0)return new Promise((h,l)=>{a.toBlob(c=>{if(!c){l(new Error("ICanvas.toBlob failed!"));return}const d=new FileReader;d.onload=()=>h(d.result),d.onerror=l,d.readAsDataURL(c)},t,r)});if(a.toDataURL!==void 0)return a.toDataURL(t,r);if(a.convertToBlob!==void 0){const h=await a.convertToBlob({type:t,quality:r});return new Promise((l,c)=>{const d=new FileReader;d.onload=()=>l(d.result),d.onerror=c,d.readAsDataURL(h)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e,t){const{pixels:r,width:n,height:a,flipY:h,premultipliedAlpha:l}=this._rawPixels(e,t);h&&_i._flipY(r,n,a),l&&_i._unpremultiplyAlpha(r);const c=new Rf(n,a,1),d=new ImageData(new Uint8ClampedArray(r.buffer),n,a);return c.context.putImageData(d,0,0),c.canvas}pixels(e,t){const{pixels:r,width:n,height:a,flipY:h,premultipliedAlpha:l}=this._rawPixels(e,t);return h&&_i._flipY(r,n,a),l&&_i._unpremultiplyAlpha(r),r}_rawPixels(e,t){const r=this.renderer;if(!r)throw new Error("The Extract has already been destroyed");let n,a=!1,h=!1,l,c=!1;e&&(e instanceof Ss?l=e:(l=r.generateTexture(e,{region:t,resolution:r.resolution,multisample:r.multisample}),c=!0,t&&(Ji.width=t.width,Ji.height=t.height,t=Ji)));const d=r.gl;if(l){if(n=l.baseTexture.resolution,t=t??l.frame,a=!1,h=l.baseTexture.alphaMode>0&&l.baseTexture.format===de.RGBA,!c){r.renderTexture.bind(l);const y=l.framebuffer.glFramebuffers[r.CONTEXT_UID];y.blitFramebuffer&&r.framebuffer.bind(y.blitFramebuffer)}}else n=r.resolution,t||(t=Ji,t.width=r.width/n,t.height=r.height/n),a=!0,h=this._rendererPremultipliedAlpha,r.renderTexture.bind();const g=Math.max(Math.round(t.width*n),1),v=Math.max(Math.round(t.height*n),1),b=new Uint8Array(Yy*g*v);return d.readPixels(Math.round(t.x*n),Math.round(t.y*n),g,v,d.RGBA,d.UNSIGNED_BYTE,b),c&&(l==null||l.destroy(!0)),{pixels:b,width:g,height:v,flipY:a,premultipliedAlpha:h}}destroy(){this.renderer=null}static _flipY(e,t,r){const n=t<<2,a=r>>1,h=new Uint8Array(n);for(let l=0;l<a;l++){const c=l*n,d=(r-l-1)*n;h.set(e.subarray(c,c+n)),e.copyWithin(c,d,d+n),e.set(h,d)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));const t=e.length;for(let r=0;r<t;r+=4){const n=e[r+3];if(n!==0){const a=255.001/n;e[r]=e[r]*a+.5,e[r+1]=e[r+1]*a+.5,e[r+2]=e[r+2]*a+.5}}}};Jc.extension={name:"extract",type:be.RendererSystem};let Jy=Jc;Me.add(Jy);const Sn={build(i){const e=i.points;let t,r,n,a,h,l;if(i.type===_t.CIRC){const x=i.shape;t=x.x,r=x.y,h=l=x.radius,n=a=0}else if(i.type===_t.ELIP){const x=i.shape;t=x.x,r=x.y,h=x.width,l=x.height,n=a=0}else{const x=i.shape,S=x.width/2,w=x.height/2;t=x.x+S,r=x.y+w,h=l=Math.max(0,Math.min(x.radius,Math.min(S,w))),n=S-h,a=w-l}if(!(h>=0&&l>=0&&n>=0&&a>=0)){e.length=0;return}const c=Math.ceil(2.3*Math.sqrt(h+l)),d=c*8+(n?4:0)+(a?4:0);if(e.length=d,d===0)return;if(c===0){e.length=8,e[0]=e[6]=t+n,e[1]=e[3]=r+a,e[2]=e[4]=t-n,e[5]=e[7]=r-a;return}let g=0,v=c*4+(n?2:0)+2,b=v,y=d;{const x=n+h,S=a,w=t+x,T=t-x,N=r+S;if(e[g++]=w,e[g++]=N,e[--v]=N,e[--v]=T,a){const M=r-S;e[b++]=T,e[b++]=M,e[--y]=M,e[--y]=w}}for(let x=1;x<c;x++){const S=Math.PI/2*(x/c),w=n+Math.cos(S)*h,T=a+Math.sin(S)*l,N=t+w,M=t-w,F=r+T,O=r-T;e[g++]=N,e[g++]=F,e[--v]=F,e[--v]=M,e[b++]=M,e[b++]=O,e[--y]=O,e[--y]=N}{const x=n,S=a+l,w=t+x,T=t-x,N=r+S,M=r-S;e[g++]=w,e[g++]=N,e[--y]=M,e[--y]=w,n&&(e[g++]=T,e[g++]=N,e[--y]=M,e[--y]=T)}},triangulate(i,e){const t=i.points,r=e.points,n=e.indices;if(t.length===0)return;let a=r.length/2;const h=a;let l,c;if(i.type!==_t.RREC){const g=i.shape;l=g.x,c=g.y}else{const g=i.shape;l=g.x+g.width/2,c=g.y+g.height/2}const d=i.matrix;r.push(i.matrix?d.a*l+d.c*c+d.tx:l,i.matrix?d.b*l+d.d*c+d.ty:c),a++,r.push(t[0],t[1]);for(let g=2;g<t.length;g+=2)r.push(t[g],t[g+1]),n.push(a++,h,a);n.push(h+1,h,a)}};function vu(i,e=!1){const t=i.length;if(t<6)return;let r=0;for(let n=0,a=i[t-2],h=i[t-1];n<t;n+=2){const l=i[n],c=i[n+1];r+=(l-a)*(c+h),a=l,h=c}if(!e&&r>0||e&&r<=0){const n=t/2;for(let a=n+n%2;a<t;a+=2){const h=t-a-2,l=t-a-1,c=a,d=a+1;[i[h],i[c]]=[i[c],i[h]],[i[l],i[d]]=[i[d],i[l]]}}}const Zc={build(i){i.points=i.shape.points.slice()},triangulate(i,e){let t=i.points;const r=i.holes,n=e.points,a=e.indices;if(t.length>=6){vu(t,!1);const h=[];for(let d=0;d<r.length;d++){const g=r[d];vu(g.points,!0),h.push(t.length/2),t=t.concat(g.points)}const l=Cp(t,h,2);if(!l)return;const c=n.length/2;for(let d=0;d<l.length;d+=3)a.push(l[d]+c),a.push(l[d+1]+c),a.push(l[d+2]+c);for(let d=0;d<t.length;d++)n.push(t[d])}}},Zy={build(i){const e=i.shape,t=e.x,r=e.y,n=e.width,a=e.height,h=i.points;h.length=0,n>=0&&a>=0&&h.push(t,r,t+n,r,t+n,r+a,t,r+a)},triangulate(i,e){const t=i.points,r=e.points;if(t.length===0)return;const n=r.length/2;r.push(t[0],t[1],t[2],t[3],t[6],t[7],t[4],t[5]),e.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},Qy={build(i){Sn.build(i)},triangulate(i,e){Sn.triangulate(i,e)}};var jt=(i=>(i.MITER="miter",i.BEVEL="bevel",i.ROUND="round",i))(jt||{}),Jr=(i=>(i.BUTT="butt",i.ROUND="round",i.SQUARE="square",i))(Jr||{});const Js={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(i,e=20){if(!this.adaptive||!i||isNaN(i))return e;let t=Math.ceil(i/this.maxLength);return t<this.minSegments?t=this.minSegments:t>this.maxSegments&&(t=this.maxSegments),t}};class bu{static curveTo(e,t,r,n,a,h){const l=h[h.length-2],c=h[h.length-1]-t,d=l-e,g=n-t,v=r-e,b=Math.abs(c*v-d*g);if(b<1e-8||a===0)return(h[h.length-2]!==e||h[h.length-1]!==t)&&h.push(e,t),null;const y=c*c+d*d,x=g*g+v*v,S=c*g+d*v,w=a*Math.sqrt(y)/b,T=a*Math.sqrt(x)/b,N=w*S/y,M=T*S/x,F=w*v+T*d,O=w*g+T*c,J=d*(T+N),C=c*(T+N),V=v*(w+M),se=g*(w+M),ae=Math.atan2(C-O,J-F),ve=Math.atan2(se-O,V-F);return{cx:F+e,cy:O+t,radius:a,startAngle:ae,endAngle:ve,anticlockwise:d*g>v*c}}static arc(e,t,r,n,a,h,l,c,d){const g=l-h,v=Js._segmentsCount(Math.abs(g)*a,Math.ceil(Math.abs(g)/gn)*40),b=g/(v*2),y=b*2,x=Math.cos(b),S=Math.sin(b),w=v-1,T=w%1/w;for(let N=0;N<=w;++N){const M=N+T*N,F=b+h+y*M,O=Math.cos(F),J=-Math.sin(F);d.push((x*O+S*J)*a+r,(x*-J+S*O)*a+n)}}}class ev{constructor(){this.reset()}begin(e,t,r){this.reset(),this.style=e,this.start=t,this.attribStart=r}end(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class uh{static curveLength(e,t,r,n,a,h,l,c){let d=0,g=0,v=0,b=0,y=0,x=0,S=0,w=0,T=0,N=0,M=0,F=e,O=t;for(let J=1;J<=10;++J)g=J/10,v=g*g,b=v*g,y=1-g,x=y*y,S=x*y,w=S*e+3*x*g*r+3*y*v*a+b*l,T=S*t+3*x*g*n+3*y*v*h+b*c,N=F-w,M=O-T,F=w,O=T,d+=Math.sqrt(N*N+M*M);return d}static curveTo(e,t,r,n,a,h,l){const c=l[l.length-2],d=l[l.length-1];l.length-=2;const g=Js._segmentsCount(uh.curveLength(c,d,e,t,r,n,a,h));let v=0,b=0,y=0,x=0,S=0;l.push(c,d);for(let w=1,T=0;w<=g;++w)T=w/g,v=1-T,b=v*v,y=b*v,x=T*T,S=x*T,l.push(y*c+3*b*T*e+3*v*x*r+S*a,y*d+3*b*T*t+3*v*x*n+S*h)}}function _u(i,e,t,r,n,a,h,l){const c=i-t*n,d=e-r*n,g=i+t*a,v=e+r*a;let b,y;h?(b=r,y=-t):(b=-r,y=t);const x=c+b,S=d+y,w=g+b,T=v+y;return l.push(x,S,w,T),2}function ls(i,e,t,r,n,a,h,l){const c=t-i,d=r-e;let g=Math.atan2(c,d),v=Math.atan2(n-i,a-e);l&&g<v?g+=Math.PI*2:!l&&g>v&&(v+=Math.PI*2);let b=g;const y=v-g,x=Math.abs(y),S=Math.sqrt(c*c+d*d),w=(15*x*Math.sqrt(S)/Math.PI>>0)+1,T=y/w;if(b+=T,l){h.push(i,e,t,r);for(let N=1,M=b;N<w;N++,M+=T)h.push(i,e,i+Math.sin(M)*S,e+Math.cos(M)*S);h.push(i,e,n,a)}else{h.push(t,r,i,e);for(let N=1,M=b;N<w;N++,M+=T)h.push(i+Math.sin(M)*S,e+Math.cos(M)*S,i,e);h.push(n,a,i,e)}return w*2}function tv(i,e){const t=i.shape;let r=i.points||t.points.slice();const n=e.closePointEps;if(r.length===0)return;const a=i.lineStyle,h=new Ze(r[0],r[1]),l=new Ze(r[r.length-2],r[r.length-1]),c=t.type!==_t.POLY||t.closeStroke,d=Math.abs(h.x-l.x)<n&&Math.abs(h.y-l.y)<n;if(c){r=r.slice(),d&&(r.pop(),r.pop(),l.set(r[r.length-2],r[r.length-1]));const k=(h.x+l.x)*.5,P=(l.y+h.y)*.5;r.unshift(k,P),r.push(k,P)}const g=e.points,v=r.length/2;let b=r.length;const y=g.length/2,x=a.width/2,S=x*x,w=a.miterLimit*a.miterLimit;let T=r[0],N=r[1],M=r[2],F=r[3],O=0,J=0,C=-(N-F),V=T-M,se=0,ae=0,ve=Math.sqrt(C*C+V*V);C/=ve,V/=ve,C*=x,V*=x;const H=a.alignment,K=(1-H)*2,re=H*2;c||(a.cap===Jr.ROUND?b+=ls(T-C*(K-re)*.5,N-V*(K-re)*.5,T-C*K,N-V*K,T+C*re,N+V*re,g,!0)+2:a.cap===Jr.SQUARE&&(b+=_u(T,N,C,V,K,re,!0,g))),g.push(T-C*K,N-V*K,T+C*re,N+V*re);for(let k=1;k<v-1;++k){T=r[(k-1)*2],N=r[(k-1)*2+1],M=r[k*2],F=r[k*2+1],O=r[(k+1)*2],J=r[(k+1)*2+1],C=-(N-F),V=T-M,ve=Math.sqrt(C*C+V*V),C/=ve,V/=ve,C*=x,V*=x,se=-(F-J),ae=M-O,ve=Math.sqrt(se*se+ae*ae),se/=ve,ae/=ve,se*=x,ae*=x;const P=M-T,q=N-F,U=M-O,D=J-F,Z=P*U+q*D,Y=q*U-D*P,ie=Y<0;if(Math.abs(Y)<.001*Math.abs(Z)){g.push(M-C*K,F-V*K,M+C*re,F+V*re),Z>=0&&(a.join===jt.ROUND?b+=ls(M,F,M-C*K,F-V*K,M-se*K,F-ae*K,g,!1)+4:b+=2,g.push(M-se*re,F-ae*re,M+se*K,F+ae*K));continue}const ue=(-C+T)*(-V+F)-(-C+M)*(-V+N),_e=(-se+O)*(-ae+F)-(-se+M)*(-ae+J),Ee=(P*_e-U*ue)/Y,Ce=(D*ue-q*_e)/Y,De=(Ee-M)*(Ee-M)+(Ce-F)*(Ce-F),ce=M+(Ee-M)*K,Pe=F+(Ce-F)*K,ge=M-(Ee-M)*re,fe=F-(Ce-F)*re,Ue=Math.min(P*P+q*q,U*U+D*D),Ie=ie?K:re,Oe=Ue+Ie*Ie*S,rt=De<=Oe;let ht=a.join;if(ht===jt.MITER&&De/S>w&&(ht=jt.BEVEL),rt)switch(ht){case jt.MITER:{g.push(ce,Pe,ge,fe);break}case jt.BEVEL:{ie?g.push(ce,Pe,M+C*re,F+V*re,ce,Pe,M+se*re,F+ae*re):g.push(M-C*K,F-V*K,ge,fe,M-se*K,F-ae*K,ge,fe),b+=2;break}case jt.ROUND:{ie?(g.push(ce,Pe,M+C*re,F+V*re),b+=ls(M,F,M+C*re,F+V*re,M+se*re,F+ae*re,g,!0)+4,g.push(ce,Pe,M+se*re,F+ae*re)):(g.push(M-C*K,F-V*K,ge,fe),b+=ls(M,F,M-C*K,F-V*K,M-se*K,F-ae*K,g,!1)+4,g.push(M-se*K,F-ae*K,ge,fe));break}}else{switch(g.push(M-C*K,F-V*K,M+C*re,F+V*re),ht){case jt.MITER:{ie?g.push(ge,fe,ge,fe):g.push(ce,Pe,ce,Pe),b+=2;break}case jt.ROUND:{ie?b+=ls(M,F,M+C*re,F+V*re,M+se*re,F+ae*re,g,!0)+2:b+=ls(M,F,M-C*K,F-V*K,M-se*K,F-ae*K,g,!1)+2;break}}g.push(M-se*K,F-ae*K,M+se*re,F+ae*re),b+=2}}T=r[(v-2)*2],N=r[(v-2)*2+1],M=r[(v-1)*2],F=r[(v-1)*2+1],C=-(N-F),V=T-M,ve=Math.sqrt(C*C+V*V),C/=ve,V/=ve,C*=x,V*=x,g.push(M-C*K,F-V*K,M+C*re,F+V*re),c||(a.cap===Jr.ROUND?b+=ls(M-C*(K-re)*.5,F-V*(K-re)*.5,M-C*K,F-V*K,M+C*re,F+V*re,g,!1)+2:a.cap===Jr.SQUARE&&(b+=_u(M,F,C,V,K,re,!1,g)));const oe=e.indices,R=Js.epsilon*Js.epsilon;for(let k=y;k<b+y-2;++k)T=g[k*2],N=g[k*2+1],M=g[(k+1)*2],F=g[(k+1)*2+1],O=g[(k+2)*2],J=g[(k+2)*2+1],!(Math.abs(T*(F-J)+M*(J-N)+O*(N-F))<R)&&oe.push(k,k+1,k+2)}function rv(i,e){let t=0;const r=i.shape,n=i.points||r.points,a=r.type!==_t.POLY||r.closeStroke;if(n.length===0)return;const h=e.points,l=e.indices,c=n.length/2,d=h.length/2;let g=d;for(h.push(n[0],n[1]),t=1;t<c;t++)h.push(n[t*2],n[t*2+1]),l.push(g,g+1),g++;a&&l.push(g,d)}function xu(i,e){i.lineStyle.native?rv(i,e):tv(i,e)}class ch{static curveLength(e,t,r,n,a,h){const l=e-2*r+a,c=t-2*n+h,d=2*r-2*e,g=2*n-2*t,v=4*(l*l+c*c),b=4*(l*d+c*g),y=d*d+g*g,x=2*Math.sqrt(v+b+y),S=Math.sqrt(v),w=2*v*S,T=2*Math.sqrt(y),N=b/S;return(w*x+S*b*(x-T)+(4*y*v-b*b)*Math.log((2*S+N+x)/(N+T)))/(4*w)}static curveTo(e,t,r,n,a){const h=a[a.length-2],l=a[a.length-1],c=Js._segmentsCount(ch.curveLength(h,l,e,t,r,n));let d=0,g=0;for(let v=1;v<=c;++v){const b=v/c;d=h+(e-h)*b,g=l+(t-l)*b,a.push(d+(e+(r-e)*b-d)*b,g+(t+(n-t)*b-g)*b)}}}const oo={[_t.POLY]:Zc,[_t.CIRC]:Sn,[_t.ELIP]:Sn,[_t.RECT]:Zy,[_t.RREC]:Qy},Eu=[],Zi=[];class Tn{constructor(e,t=null,r=null,n=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=r,this.fillStyle=t,this.matrix=n,this.type=e.type}clone(){return new Tn(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Ns=new Ze,Qc=class ed extends nc{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new _n,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),Zi.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),Eu.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,r=null,n=null){const a=new Tn(e,t,r,n);return this.graphicsData.push(a),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const r=new Tn(e,null,null,t),n=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=n.lineStyle,n.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let r=0;r<t.length;++r){const n=t[r];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(e,Ns):Ns.copyFrom(e),n.shape.contains(Ns.x,Ns.y))){let a=!1;if(n.holes){for(let h=0;h<n.holes.length;h++)if(n.holes[h].shape.contains(Ns.x,Ns.y)){a=!0;break}}if(!a)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let r=null,n=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],n=r.style);for(let c=this.shapeIndex;c<t.length;c++){this.shapeIndex++;const d=t[c],g=d.fillStyle,v=d.lineStyle;oo[d.type].build(d),d.matrix&&this.transformPoints(d.points,d.matrix),(g.visible||v.visible)&&this.processHoles(d.holes);for(let b=0;b<2;b++){const y=b===0?g:v;if(!y.visible)continue;const x=y.texture.baseTexture,S=this.indices.length,w=this.points.length/2;x.wrapMode=Zr.REPEAT,b===0?this.processFill(d):this.processLine(d);const T=this.points.length/2-w;T!==0&&(r&&!this._compareStyles(n,y)&&(r.end(S,w),r=null),r||(r=Eu.pop()||new ev,r.begin(y,S,w),this.batches.push(r),n=y),this.addUvs(this.points,e,y.texture,w,T,y.matrix))}}const a=this.indices.length,h=this.points.length/2;if(r&&r.end(a,h),this.batches.length===0){this.batchable=!0;return}const l=h>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&l===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=l?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const r=this.graphicsData[e],n=r.fillStyle,a=r.lineStyle;if(n&&!n.texture.baseTexture.valid||a&&!a.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,r=e.length;t<r;t++){const n=e[t];for(let a=0;a<n.size;a++){const h=n.start+a;this.indicesUint16[h]=this.indicesUint16[h]-n.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<ed.BATCHABLE_SIZE*2}buildDrawCalls(){let e=++He._globalBatch;for(let v=0;v<this.drawCalls.length;v++)this.drawCalls[v].texArray.clear(),Zi.push(this.drawCalls[v]);this.drawCalls.length=0;const t=this.colors,r=this.textureIds;let n=Zi.pop();n||(n=new wo,n.texArray=new Co),n.texArray.count=0,n.start=0,n.size=0,n.type=gr.TRIANGLES;let a=0,h=null,l=0,c=!1,d=gr.TRIANGLES,g=0;this.drawCalls.push(n);for(let v=0;v<this.batches.length;v++){const b=this.batches[v],y=8,x=b.style,S=x.texture.baseTexture;c!==!!x.native&&(c=!!x.native,d=c?gr.LINES:gr.TRIANGLES,h=null,a=y,e++),h!==S&&(h=S,S._batchEnabled!==e&&(a===y&&(e++,a=0,n.size>0&&(n=Zi.pop(),n||(n=new wo,n.texArray=new Co),this.drawCalls.push(n)),n.start=g,n.size=0,n.texArray.count=0,n.type=d),S.touched=1,S._batchEnabled=e,S._batchLocation=a,S.wrapMode=Zr.REPEAT,n.texArray.elements[n.texArray.count++]=S,a++)),n.size+=b.size,g+=b.size,l=S._batchLocation,this.addColors(t,x.color,x.alpha,b.attribSize,b.attribStart),this.addTextureIds(r,l,b.attribSize,b.attribStart)}He._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,r=this.colors,n=this.textureIds,a=new ArrayBuffer(e.length*3*4),h=new Float32Array(a),l=new Uint32Array(a);let c=0;for(let d=0;d<e.length/2;d++)h[c++]=e[d*2],h[c++]=e[d*2+1],h[c++]=t[d*2],h[c++]=t[d*2+1],l[c++]=r[d],h[c++]=n[d];this._buffer.update(a),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?Zc.triangulate(e,this):oo[e.type].triangulate(e,this)}processLine(e){xu(e,this);for(let t=0;t<e.holes.length;t++)xu(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const r=e[t];oo[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let r=0;r<e.length/2;r++){const n=e[r*2],a=e[r*2+1];e[r*2]=t.a*n+t.c*a+t.tx,e[r*2+1]=t.b*n+t.d*a+t.ty}}addColors(e,t,r,n,a=0){const h=st.shared.setValue(t).toLittleEndianNumber(),l=st.shared.setValue(h).toPremultiplied(r);e.length=Math.max(e.length,a+n);for(let c=0;c<n;c++)e[a+c]=l}addTextureIds(e,t,r,n=0){e.length=Math.max(e.length,n+r);for(let a=0;a<r;a++)e[n+a]=t}addUvs(e,t,r,n,a,h=null){let l=0;const c=t.length,d=r.frame;for(;l<a;){let v=e[(n+l)*2],b=e[(n+l)*2+1];if(h){const y=h.a*v+h.c*b+h.tx;b=h.b*v+h.d*b+h.ty,v=y}l++,t.push(v/d.width,b/d.height)}const g=r.baseTexture;(d.width<g.width||d.height<g.height)&&this.adjustUvs(t,r,c,a)}adjustUvs(e,t,r,n){const a=t.baseTexture,h=1e-6,l=r+n*2,c=t.frame,d=c.width/a.width,g=c.height/a.height;let v=c.x/c.width,b=c.y/c.height,y=Math.floor(e[r]+h),x=Math.floor(e[r+1]+h);for(let S=r+2;S<l;S+=2)y=Math.min(y,Math.floor(e[S]+h)),x=Math.min(x,Math.floor(e[S+1]+h));v-=y,b-=x;for(let S=r;S<l;S+=2)e[S]=(e[S]+v)*d,e[S+1]=(e[S+1]+b)*g}};Qc.BATCHABLE_SIZE=100;let sv=Qc;class Ln{constructor(){this.color=16777215,this.alpha=1,this.texture=Re.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const e=new Ln;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=Re.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class dh extends Ln{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Jr.BUTT,this.join=jt.MITER,this.miterLimit=10}clone(){const e=new dh;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=Jr.BUTT,this.join=jt.MITER,this.miterLimit=10}}const ho={},zo=class ln extends tr{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Ln,this._lineStyle=new dh,this._matrix=null,this._holeMode=!1,this.state=_r.for2d(),this._geometry=e||new sv,this._geometry.refCount++,this._transformID=-1,this._tintColor=new st(16777215),this.blendMode=Be.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new ln(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,r,n=.5,a=!1){return typeof e=="number"&&(e={width:e,color:t,alpha:r,alignment:n,native:a}),this.lineTextureStyle(e)}lineTextureStyle(e){const t={width:0,texture:Re.WHITE,color:e!=null&&e.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Jr.BUTT,join:jt.MITER,miterLimit:10};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const r=e.width>0&&e.alpha>0;return r?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:r},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new vs,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new vs,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const r=this.currentPath.points,n=r[r.length-2],a=r[r.length-1];return(n!==e||a!==t)&&r.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,r,n){this._initCurve();const a=this.currentPath.points;return a.length===0&&this.moveTo(0,0),ch.curveTo(e,t,r,n,a),this}bezierCurveTo(e,t,r,n,a,h){return this._initCurve(),uh.curveTo(e,t,r,n,a,h,this.currentPath.points),this}arcTo(e,t,r,n,a){this._initCurve(e,t);const h=this.currentPath.points,l=bu.curveTo(e,t,r,n,a,h);if(l){const{cx:c,cy:d,radius:g,startAngle:v,endAngle:b,anticlockwise:y}=l;this.arc(c,d,g,v,b,y)}return this}arc(e,t,r,n,a,h=!1){if(n===a)return this;if(!h&&a<=n?a+=gn:h&&n<=a&&(n+=gn),a-n===0)return this;const l=e+Math.cos(n)*r,c=t+Math.sin(n)*r,d=this._geometry.closePointEps;let g=this.currentPath?this.currentPath.points:null;if(g){const v=Math.abs(g[g.length-2]-l),b=Math.abs(g[g.length-1]-c);v<d&&b<d||g.push(l,c)}else this.moveTo(l,c),g=this.currentPath.points;return bu.arc(l,c,e,t,r,n,a,h,g),this}beginFill(e=0,t){return this.beginTextureFill({texture:Re.WHITE,color:e,alpha:t})}normalizeColor(e){const t=st.shared.setValue(e.color??0);e.color=t.toNumber(),e.alpha??(e.alpha=t.alpha)}beginTextureFill(e){const t={texture:Re.WHITE,color:16777215,matrix:null};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const r=e.alpha>0;return r?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:r},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,r,n){return this.drawShape(new We(e,t,r,n))}drawRoundedRect(e,t,r,n,a){return this.drawShape(new Dn(e,t,r,n,a))}drawCircle(e,t,r){return this.drawShape(new kn(e,t,r))}drawEllipse(e,t,r,n){return this.drawShape(new Nn(e,t,r,n))}drawPolygon(...e){let t,r=!0;const n=e[0];n.points?(r=n.closeStroke,t=n.points):Array.isArray(e[0])?t=e[0]:t=e;const a=new vs(t);return a.closeStroke=r,this.drawShape(a),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===_t.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,r=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(e.points);for(let n=0;n<r;n++){const a=e.batches[n],h=a.style.color,l=new Float32Array(this.vertexData.buffer,a.attribStart*4*2,a.attribSize*2),c=new Float32Array(e.uvsFloat32.buffer,a.attribStart*4*2,a.attribSize*2),d=new Uint16Array(e.indicesUint16.buffer,a.start*2,a.size),g={vertexData:l,blendMode:t,indices:d,uvs:c,_batchRGB:st.shared.setValue(h).toRgbArray(),_tintRGB:h,_texture:a.style.texture,alpha:a.style.alpha,worldAlpha:1};this.batches[n]=g}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,r=this.batches.length;t<r;t++){const n=this.batches[t];n.worldAlpha=this.worldAlpha*n.alpha,e.plugins[this.pluginName].render(n)}}}_renderDirect(e){const t=this._resolveDirectShader(e),r=this._geometry,n=this.worldAlpha,a=t.uniforms,h=r.drawCalls;a.translationMatrix=this.transform.worldTransform,st.shared.setValue(this._tintColor).premultiply(n).toArray(a.tint),e.shader.bind(t),e.geometry.bind(r,t),e.state.set(this.state);for(let l=0,c=h.length;l<c;l++)this._renderDrawCallDirect(e,r.drawCalls[l])}_renderDrawCallDirect(e,t){const{texArray:r,type:n,size:a,start:h}=t,l=r.count;for(let c=0;c<l;c++)e.texture.bind(r.elements[c],c);e.geometry.draw(n,a,h)}_resolveDirectShader(e){let t=this.shader;const r=this.pluginName;if(!t){if(!ho[r]){const{maxTextures:n}=e.plugins[r],a=new Int32Array(n);for(let c=0;c<n;c++)a[c]=c;const h={tint:new Float32Array([1,1,1,1]),translationMatrix:new it,default:Zt.from({uSamplers:a},!0)},l=e.plugins[r]._shader.program;ho[r]=new yr(l,h)}t=ho[r]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:r,maxX:n,maxY:a}=e.bounds;this._bounds.addFrame(this.transform,t,r,n,a)}containsPoint(e){return this.worldTransform.applyInverse(e,ln._TEMP_POINT),this._geometry.containsPoint(ln._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t._tintRGB=st.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,r=t.a,n=t.b,a=t.c,h=t.d,l=t.tx,c=t.ty,d=this._geometry.points,g=this.vertexData;let v=0;for(let b=0;b<d.length;b+=2){const y=d[b],x=d[b+1];g[v++]=r*y+a*x+l,g[v++]=h*x+n*y+c}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};zo.curves=Js,zo._TEMP_POINT=new Ze;let si=zo;class iv{constructor(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const t=this.uvBuffer.data;(!this.data||this.data.length!==t.length)&&(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}}const lo=new Ze,wu=new vs,td=class rd extends tr{constructor(e,t,r,n=gr.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=r||_r.for2d(),this.drawMode=n,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=Se.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===gr.TRIANGLES&&t.length<rd.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;const n=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[n]),e.plugins[n].render(this)}calculateVertices(){const e=this.geometry.buffers[0],t=e.data,r=e._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==t.length&&(this.vertexData=new Float32Array(t.length));const n=this.transform.worldTransform,a=n.a,h=n.b,l=n.c,c=n.d,d=n.tx,g=n.ty,v=this.vertexData;for(let b=0;b<v.length/2;b++){const y=t[b*2],x=t[b*2+1];v[b*2]=a*y+l*x+d,v[b*2+1]=h*y+c*x+g}if(this._roundPixels){const b=Se.RESOLUTION;for(let y=0;y<v.length;++y)v[y]=Math.round(v[y]*b)/b}this.vertexDirty=r}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new iv(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,lo);const t=this.geometry.getBuffer("aVertexPosition").data,r=wu.points,n=this.geometry.getIndex().data,a=n.length,h=this.drawMode===4?3:1;for(let l=0;l+2<a;l+=h){const c=n[l]*2,d=n[l+1]*2,g=n[l+2]*2;if(r[0]=t[c],r[1]=t[c+1],r[2]=t[d],r[3]=t[d+1],r[4]=t[g],r[5]=t[g+1],wu.contains(lo.x,lo.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};td.BATCHABLE_SIZE=100;let Su=td;class nv extends Qr{constructor(e,t,r){super();const n=new lt(e),a=new lt(t,!0),h=new lt(r,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,Fe.FLOAT).addAttribute("aTextureCoord",a,2,!1,Fe.FLOAT).addIndex(h),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var av=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,ov=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class Tu extends yr{constructor(e,t){const r={uSampler:e,alpha:1,uTextureMatrix:it.IDENTITY,uColor:new Float32Array([1,1,1,1])};t=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},t),t.uniforms&&Object.assign(r,t.uniforms),super(t.program||kr.from(ov,av),r),this._colorDirty=!1,this.uvMatrix=new bc(e),this.batchable=t.program===void 0,this.pluginName=t.pluginName,this._tintColor=new st(t.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=t.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this.tint&&(this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const e=this.texture.baseTexture.alphaMode;st.shared.setValue(this._tintColor).premultiply(this._alpha,e).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Au{constructor(e,t,r){this.geometry=new Qr,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<e.length;++n){let a=e[n];a={attributeName:a.attributeName,size:a.size,uploadFunction:a.uploadFunction,type:a.type||Fe.FLOAT,offset:a.offset},t[n]?this.dynamicProperties.push(a):this.staticProperties.push(a)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const e=this.geometry;let t=0;this.indexBuffer=new lt(Pf(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let h=0;h<this.dynamicProperties.length;++h){const l=this.dynamicProperties[h];l.offset=t,t+=l.size,this.dynamicStride+=l.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new lt(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let h=0;h<this.staticProperties.length;++h){const l=this.staticProperties[h];l.offset=n,n+=l.size,this.staticStride+=l.size}const a=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(a),this.staticDataUint32=new Uint32Array(a),this.staticBuffer=new lt(this.staticData,!0,!1);for(let h=0;h<this.dynamicProperties.length;++h){const l=this.dynamicProperties[h];e.addAttribute(l.attributeName,this.dynamicBuffer,0,l.type===Fe.UNSIGNED_BYTE,l.type,this.dynamicStride*4,l.offset*4)}for(let h=0;h<this.staticProperties.length;++h){const l=this.staticProperties[h];e.addAttribute(l.attributeName,this.staticBuffer,0,l.type===Fe.UNSIGNED_BYTE,l.type,this.staticStride*4,l.offset*4)}}uploadDynamic(e,t,r){for(let n=0;n<this.dynamicProperties.length;n++){const a=this.dynamicProperties[n];a.uploadFunction(e,t,r,a.type===Fe.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,a.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,t,r){for(let n=0;n<this.staticProperties.length;n++){const a=this.staticProperties[n];a.uploadFunction(e,t,r,a.type===Fe.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,a.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var hv=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,lv=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class sd extends Fn{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new it,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:Fe.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=yr.from(lv,hv,{}),this.state=_r.for2d()}render(e){const t=e.children,r=e._maxSize,n=e._batchSize,a=this.renderer;let h=t.length;if(h===0)return;h>r&&!e.autoResize&&(h=r);let l=e._buffers;l||(l=e._buffers=this.generateBuffers(e));const c=t[0]._texture.baseTexture,d=c.alphaMode>0;this.state.blendMode=rc(e.blendMode,d),a.state.set(this.state);const g=a.gl,v=e.worldTransform.copyTo(this.tempMatrix);v.prepend(a.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=v.toArray(!0),this.shader.uniforms.uColor=st.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,d).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=c,this.renderer.shader.bind(this.shader);let b=!1;for(let y=0,x=0;y<h;y+=n,x+=1){let S=h-y;S>n&&(S=n),x>=l.length&&l.push(this._generateOneMoreBuffer(e));const w=l[x];w.uploadDynamic(t,y,S);const T=e._bufferUpdateIDs[x]||0;b=b||w._updateID<T,b&&(w._updateID=e._updateID,w.uploadStatic(t,y,S)),a.geometry.bind(w.geometry),g.drawElements(g.TRIANGLES,S*6,g.UNSIGNED_SHORT,0)}}generateBuffers(e){const t=[],r=e._maxSize,n=e._batchSize,a=e._properties;for(let h=0;h<r;h+=n)t.push(new Au(this.properties,a,n));return t}_generateOneMoreBuffer(e){const t=e._batchSize,r=e._properties;return new Au(this.properties,r,t)}uploadVertices(e,t,r,n,a,h){let l=0,c=0,d=0,g=0;for(let v=0;v<r;++v){const b=e[t+v],y=b._texture,x=b.scale.x,S=b.scale.y,w=y.trim,T=y.orig;w?(c=w.x-b.anchor.x*T.width,l=c+w.width,g=w.y-b.anchor.y*T.height,d=g+w.height):(l=T.width*(1-b.anchor.x),c=T.width*-b.anchor.x,d=T.height*(1-b.anchor.y),g=T.height*-b.anchor.y),n[h]=c*x,n[h+1]=g*S,n[h+a]=l*x,n[h+a+1]=g*S,n[h+a*2]=l*x,n[h+a*2+1]=d*S,n[h+a*3]=c*x,n[h+a*3+1]=d*S,h+=a*4}}uploadPosition(e,t,r,n,a,h){for(let l=0;l<r;l++){const c=e[t+l].position;n[h]=c.x,n[h+1]=c.y,n[h+a]=c.x,n[h+a+1]=c.y,n[h+a*2]=c.x,n[h+a*2+1]=c.y,n[h+a*3]=c.x,n[h+a*3+1]=c.y,h+=a*4}}uploadRotation(e,t,r,n,a,h){for(let l=0;l<r;l++){const c=e[t+l].rotation;n[h]=c,n[h+a]=c,n[h+a*2]=c,n[h+a*3]=c,h+=a*4}}uploadUvs(e,t,r,n,a,h){for(let l=0;l<r;++l){const c=e[t+l]._texture._uvs;c?(n[h]=c.x0,n[h+1]=c.y0,n[h+a]=c.x1,n[h+a+1]=c.y1,n[h+a*2]=c.x2,n[h+a*2+1]=c.y2,n[h+a*3]=c.x3,n[h+a*3+1]=c.y3,h+=a*4):(n[h]=0,n[h+1]=0,n[h+a]=0,n[h+a+1]=0,n[h+a*2]=0,n[h+a*2+1]=0,n[h+a*3]=0,n[h+a*3+1]=0,h+=a*4)}}uploadTint(e,t,r,n,a,h){for(let l=0;l<r;++l){const c=e[t+l],d=st.shared.setValue(c._tintRGB).toPremultiplied(c.alpha,c.texture.baseTexture.alphaMode>0);n[h]=d,n[h+a]=d,n[h+a*2]=d,n[h+a*3]=d,h+=a*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}sd.extension={name:"particle",type:be.RendererPlugin};Me.add(sd);var Un=(i=>(i[i.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",i[i.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",i))(Un||{});const Qi={willReadFrequently:!0},dr=class Ne{static get experimentalLetterSpacingSupported(){let e=Ne._experimentalLetterSpacingSupported;if(e!==void 0){const t=Se.ADAPTER.getCanvasRenderingContext2D().prototype;e=Ne._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,r,n,a,h,l,c,d){this.text=e,this.style=t,this.width=r,this.height=n,this.lines=a,this.lineWidths=h,this.lineHeight=l,this.maxLineWidth=c,this.fontProperties=d}static measureText(e,t,r,n=Ne._canvas){r=r??t.wordWrap;const a=t.toFontString(),h=Ne.measureFont(a);h.fontSize===0&&(h.fontSize=t.fontSize,h.ascent=t.fontSize);const l=n.getContext("2d",Qi);l.font=a;const c=(r?Ne.wordWrap(e,t,n):e).split(/(?:\r\n|\r|\n)/),d=new Array(c.length);let g=0;for(let x=0;x<c.length;x++){const S=Ne._measureText(c[x],t.letterSpacing,l);d[x]=S,g=Math.max(g,S)}let v=g+t.strokeThickness;t.dropShadow&&(v+=t.dropShadowDistance);const b=t.lineHeight||h.fontSize+t.strokeThickness;let y=Math.max(b,h.fontSize+t.strokeThickness*2)+t.leading+(c.length-1)*(b+t.leading);return t.dropShadow&&(y+=t.dropShadowDistance),new Ne(e,t,v,y,c,d,b+t.leading,g,h)}static _measureText(e,t,r){let n=!1;Ne.experimentalLetterSpacingSupported&&(Ne.experimentalLetterSpacing?(r.letterSpacing=`${t}px`,r.textLetterSpacing=`${t}px`,n=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let a=r.measureText(e).width;return a>0&&(n?a-=t:a+=(Ne.graphemeSegmenter(e).length-1)*t),a}static wordWrap(e,t,r=Ne._canvas){const n=r.getContext("2d",Qi);let a=0,h="",l="";const c=Object.create(null),{letterSpacing:d,whiteSpace:g}=t,v=Ne.collapseSpaces(g),b=Ne.collapseNewlines(g);let y=!v;const x=t.wordWrapWidth+d,S=Ne.tokenize(e);for(let w=0;w<S.length;w++){let T=S[w];if(Ne.isNewline(T)){if(!b){l+=Ne.addLine(h),y=!v,h="",a=0;continue}T=" "}if(v){const M=Ne.isBreakingSpace(T),F=Ne.isBreakingSpace(h[h.length-1]);if(M&&F)continue}const N=Ne.getFromCache(T,d,c,n);if(N>x)if(h!==""&&(l+=Ne.addLine(h),h="",a=0),Ne.canBreakWords(T,t.breakWords)){const M=Ne.wordWrapSplit(T);for(let F=0;F<M.length;F++){let O=M[F],J=O,C=1;for(;M[F+C];){const se=M[F+C];if(!Ne.canBreakChars(J,se,T,F,t.breakWords))O+=se;else break;J=se,C++}F+=C-1;const V=Ne.getFromCache(O,d,c,n);V+a>x&&(l+=Ne.addLine(h),y=!1,h="",a=0),h+=O,a+=V}}else{h.length>0&&(l+=Ne.addLine(h),h="",a=0);const M=w===S.length-1;l+=Ne.addLine(T,!M),y=!1,h="",a=0}else N+a>x&&(y=!1,l+=Ne.addLine(h),h="",a=0),(h.length>0||!Ne.isBreakingSpace(T)||y)&&(h+=T,a+=N)}return l+=Ne.addLine(h,!1),l}static addLine(e,t=!0){return e=Ne.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,r,n){let a=r[e];return typeof a!="number"&&(a=Ne._measureText(e,t,n)+t,r[e]=a),a}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const r=e[t];if(!Ne.isBreakingSpace(r))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e!="string"?!1:Ne._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:Ne._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const t=[];let r="";if(typeof e!="string")return t;for(let n=0;n<e.length;n++){const a=e[n],h=e[n+1];if(Ne.isBreakingSpace(a,h)||Ne.isNewline(a)){r!==""&&(t.push(r),r=""),t.push(a);continue}r+=a}return r!==""&&t.push(r),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,r,n,a){return!0}static wordWrapSplit(e){return Ne.graphemeSegmenter(e)}static measureFont(e){if(Ne._fonts[e])return Ne._fonts[e];const t={ascent:0,descent:0,fontSize:0},r=Ne._canvas,n=Ne._context;n.font=e;const a=Ne.METRICS_STRING+Ne.BASELINE_SYMBOL,h=Math.ceil(n.measureText(a).width);let l=Math.ceil(n.measureText(Ne.BASELINE_SYMBOL).width);const c=Math.ceil(Ne.HEIGHT_MULTIPLIER*l);if(l=l*Ne.BASELINE_MULTIPLIER|0,h===0||c===0)return Ne._fonts[e]=t,t;r.width=h,r.height=c,n.fillStyle="#f00",n.fillRect(0,0,h,c),n.font=e,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(a,0,l);const d=n.getImageData(0,0,h,c).data,g=d.length,v=h*4;let b=0,y=0,x=!1;for(b=0;b<l;++b){for(let S=0;S<v;S+=4)if(d[y+S]!==255){x=!0;break}if(!x)y+=v;else break}for(t.ascent=l-b,y=g-v,x=!1,b=c;b>l;--b){for(let S=0;S<v;S+=4)if(d[y+S]!==255){x=!0;break}if(!x)y-=v;else break}return t.descent=b-l,t.fontSize=t.ascent+t.descent,Ne._fonts[e]=t,t}static clearMetrics(e=""){e?delete Ne._fonts[e]:Ne._fonts={}}static get _canvas(){var e;if(!Ne.__canvas){let t;try{const r=new OffscreenCanvas(0,0);if((e=r.getContext("2d",Qi))!=null&&e.measureText)return Ne.__canvas=r,r;t=Se.ADAPTER.createCanvas()}catch{t=Se.ADAPTER.createCanvas()}t.width=t.height=10,Ne.__canvas=t}return Ne.__canvas}static get _context(){return Ne.__context||(Ne.__context=Ne._canvas.getContext("2d",Qi)),Ne.__context}};dr.METRICS_STRING="|q",dr.BASELINE_SYMBOL="M",dr.BASELINE_MULTIPLIER=1.4,dr.HEIGHT_MULTIPLIER=2,dr.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const i=new Intl.Segmenter;return e=>[...i.segment(e)].map(t=>t.segment)}return i=>[...i]})(),dr.experimentalLetterSpacing=!1,dr._fonts={},dr._newlines=[10,13],dr._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Xr=dr;const uv=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],id=class xi{constructor(e){this.styleID=0,this.reset(),co(this,e,e)}clone(){const e={};return co(e,this,xi.defaultStyle),new xi(e)}reset(){co(this,xi.defaultStyle,xi.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=uo(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=uo(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){cv(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=uo(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let r=t.length-1;r>=0;r--){let n=t[r].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!uv.includes(n)&&(n=`"${n}"`),t[r]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};id.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Un.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Fr=id;function uo(i){const e=st.shared,t=r=>{const n=e.setValue(r);return n.alpha===1?n.toHex():n.toRgbaString()};return Array.isArray(i)?i.map(t):t(i)}function cv(i,e){if(!Array.isArray(i)||!Array.isArray(e)||i.length!==e.length)return!1;for(let t=0;t<i.length;++t)if(i[t]!==e[t])return!1;return!0}function co(i,e,t){for(const r in t)Array.isArray(e[r])?i[r]=e[r].slice():i[r]=e[r]}const dv={texture:!0,children:!1,baseTexture:!0},nd=class qo extends ti{constructor(e,t,r){let n=!1;r||(r=Se.ADAPTER.createCanvas(),n=!0),r.width=3,r.height=3;const a=Re.from(r);a.orig=new We,a.trim=new We,super(a),this._ownCanvas=n,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=qo.defaultResolution??Se.RESOLUTION,this._autoResolution=qo.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return Xr.experimentalLetterSpacing}static set experimentalLetterSpacing(e){Xe("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Xr.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const r=this.context,n=Xr.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),a=n.width,h=n.height,l=n.lines,c=n.lineHeight,d=n.lineWidths,g=n.maxLineWidth,v=n.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,a)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,h)+t.padding*2)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=t.strokeThickness,r.textBaseline=t.textBaseline,r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit;let b,y;const x=t.dropShadow?2:1;for(let S=0;S<x;++S){const w=t.dropShadow&&S===0,T=w?Math.ceil(Math.max(1,h)+t.padding*2):0,N=T*this._resolution;if(w){r.fillStyle="black",r.strokeStyle="black";const F=t.dropShadowColor,O=t.dropShadowBlur*this._resolution,J=t.dropShadowDistance*this._resolution;r.shadowColor=st.shared.setValue(F).setAlpha(t.dropShadowAlpha).toRgbaString(),r.shadowBlur=O,r.shadowOffsetX=Math.cos(t.dropShadowAngle)*J,r.shadowOffsetY=Math.sin(t.dropShadowAngle)*J+N}else r.fillStyle=this._generateFillStyle(t,l,n),r.strokeStyle=t.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let M=(c-v.fontSize)/2;c-v.fontSize<0&&(M=0);for(let F=0;F<l.length;F++)b=t.strokeThickness/2,y=t.strokeThickness/2+F*c+v.ascent+M,t.align==="right"?b+=g-d[F]:t.align==="center"&&(b+=(g-d[F])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(l[F],b+t.padding,y+t.padding-T,!0),t.fill&&this.drawLetterSpacing(l[F],b+t.padding,y+t.padding-T)}this.updateTexture()}drawLetterSpacing(e,t,r,n=!1){const a=this._style.letterSpacing;let h=!1;if(Xr.experimentalLetterSpacingSupported&&(Xr.experimentalLetterSpacing?(this.context.letterSpacing=`${a}px`,this.context.textLetterSpacing=`${a}px`,h=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),a===0||h){n?this.context.strokeText(e,t,r):this.context.fillText(e,t,r);return}let l=t;const c=Xr.graphemeSegmenter(e);let d=this.context.measureText(e).width,g=0;for(let v=0;v<c.length;++v){const b=c[v];n?this.context.strokeText(b,l,r):this.context.fillText(b,l,r);let y="";for(let x=v+1;x<c.length;++x)y+=c[x];g=this.context.measureText(y).width,l+=d-g+a,d=g}}updateTexture(){const e=this.canvas;if(this._style.trim){const h=Of(e);h.data&&(e.width=h.width,e.height=h.height,this.context.putImageData(h.data,0,0))}const t=this._texture,r=this._style,n=r.trim?0:r.padding,a=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-n,t.trim.y=-n,t.orig.width=t._frame.width-n*2,t.orig.height=t._frame.height-n*2,this._onTextureUpdate(),a.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),this._textureID===-1&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,r){const n=e.fill;if(Array.isArray(n)){if(n.length===1)return n[0]}else return n;let a;const h=e.dropShadow?e.dropShadowDistance:0,l=e.padding||0,c=this.canvas.width/this._resolution-h-l*2,d=this.canvas.height/this._resolution-h-l*2,g=n.slice(),v=e.fillGradientStops.slice();if(!v.length){const b=g.length+1;for(let y=1;y<b;++y)v.push(y/b)}if(g.unshift(n[0]),v.unshift(0),g.push(n[n.length-1]),v.push(1),e.fillGradientType===Un.LINEAR_VERTICAL){a=this.context.createLinearGradient(c/2,l,c/2,d+l);const b=r.fontProperties.fontSize+e.strokeThickness;for(let y=0;y<t.length;y++){const x=r.lineHeight*(y-1)+b,S=r.lineHeight*y;let w=S;y>0&&x>S&&(w=(S+x)/2);const T=S+b,N=r.lineHeight*(y+1);let M=T;y+1<t.length&&N<T&&(M=(T+N)/2);const F=(M-w)/d;for(let O=0;O<g.length;O++){let J=0;typeof v[O]=="number"?J=v[O]:J=O/g.length;let C=Math.min(1,Math.max(0,w/d+J*F));C=Number(C.toFixed(5)),a.addColorStop(C,g[O])}}}else{a=this.context.createLinearGradient(l,d/2,c+l,d/2);const b=g.length+1;let y=1;for(let x=0;x<g.length;x++){let S;typeof v[x]=="number"?S=v[x]:S=y/b,a.addColorStop(S,g[x]),y++}}return a}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},dv,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=Yr(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=Yr(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof Fr?this._style=e:this._style=new Fr(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};nd.defaultAutoResolution=!0;let Gn=nd;class pv{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function fv(i,e){var r;let t=!1;if((r=i==null?void 0:i._textures)!=null&&r.length){for(let n=0;n<i._textures.length;n++)if(i._textures[n]instanceof Re){const a=i._textures[n].baseTexture;e.includes(a)||(e.push(a),t=!0)}}return t}function gv(i,e){if(i.baseTexture instanceof He){const t=i.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function mv(i,e){if(i._texture&&i._texture instanceof Re){const t=i._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function yv(i,e){return e instanceof Gn?(e.updateText(!0),!0):!1}function vv(i,e){if(e instanceof Fr){const t=e.toFontString();return Xr.measureFont(t),!0}return!1}function bv(i,e){if(i instanceof Gn){e.includes(i.style)||e.push(i.style),e.includes(i)||e.push(i);const t=i._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function _v(i,e){return i instanceof Fr?(e.includes(i)||e.push(i),!0):!1}const ad=class od{constructor(e){this.limiter=new pv(od.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(bv),this.registerFindHook(_v),this.registerFindHook(fv),this.registerFindHook(gv),this.registerFindHook(mv),this.registerUploadHook(yv),this.registerUploadHook(vv)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,Nt.system.addOnce(this.tick,this,Es.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed){for(let r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)Nt.system.addOnce(this.tick,this,Es.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,r=e.length;t<r;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,r=this.addHooks.length;t<r&&!this.addHooks[t](e,this.queue);t++);if(e instanceof tr)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&Nt.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};ad.uploadsPerFrame=4;let Xo=ad;Object.defineProperties(Se,{UPLOADS_PER_FRAME:{get(){return Xo.uploadsPerFrame},set(i){Xe("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Xo.uploadsPerFrame=i}}});function hd(i,e){return e instanceof He?(e._glTextures[i.CONTEXT_UID]||i.texture.bind(e),!0):!1}function xv(i,e){if(!(e instanceof si))return!1;const{geometry:t}=e;e.finishPoly(),t.updateBatches();const{batches:r}=t;for(let n=0;n<r.length;n++){const{texture:a}=r[n].style;a&&hd(i,a.baseTexture)}return t.batchable||i.geometry.bind(t,e._resolveDirectShader(i)),!0}function Ev(i,e){return i instanceof si?(e.push(i),!0):!1}class ld extends Xo{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(Ev),this.registerUploadHook(hd),this.registerUploadHook(xv)}}ld.extension={name:"prepare",type:be.RendererSystem};Me.add(ld);var wv=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,Sv=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Tv=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,Cu=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Av=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const en=new it;class ud extends Fn{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new gc,this.state=_r.for2d()}contextChange(){const e=this.renderer,t={globals:e.globalUniforms};this.simpleShader=yr.from(Cu,Av,t),this.shader=e.context.webGLVersion>1?yr.from(Sv,wv,t):yr.from(Cu,Tv,t)}render(e){const t=this.renderer,r=this.quad;let n=r.vertices;n[0]=n[6]=e._width*-e.anchor.x,n[1]=n[3]=e._height*-e.anchor.y,n[2]=n[4]=e._width*(1-e.anchor.x),n[5]=n[7]=e._height*(1-e.anchor.y);const a=e.uvRespectAnchor?e.anchor.x:0,h=e.uvRespectAnchor?e.anchor.y:0;n=r.uvs,n[0]=n[6]=-a,n[1]=n[3]=-h,n[2]=n[4]=1-a,n[5]=n[7]=1-h,r.invalidate();const l=e._texture,c=l.baseTexture,d=c.alphaMode>0,g=e.tileTransform.localTransform,v=e.uvMatrix;let b=c.isPowerOfTwo&&l.frame.width===c.width&&l.frame.height===c.height;b&&(c._glTextures[t.CONTEXT_UID]?b=c.wrapMode!==Zr.CLAMP:c.wrapMode===Zr.CLAMP&&(c.wrapMode=Zr.REPEAT));const y=b?this.simpleShader:this.shader,x=l.width,S=l.height,w=e._width,T=e._height;en.set(g.a*x/w,g.b*x/T,g.c*S/w,g.d*S/T,g.tx/w,g.ty/T),en.invert(),b?en.prepend(v.mapCoord):(y.uniforms.uMapCoord=v.mapCoord.toArray(!0),y.uniforms.uClampFrame=v.uClampFrame,y.uniforms.uClampOffset=v.uClampOffset),y.uniforms.uTransform=en.toArray(!0),y.uniforms.uColor=st.shared.setValue(e.tint).premultiply(e.worldAlpha,d).toArray(y.uniforms.uColor),y.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),y.uniforms.uSampler=l,t.shader.bind(y),t.geometry.bind(r),this.state.blendMode=rc(e.blendMode,d),t.state.set(this.state),t.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}ud.extension={name:"tilingSprite",type:be.RendererPlugin};Me.add(ud);const cd=class Ei{constructor(e,t,r){this.linkedSheets=[],(e instanceof He||e instanceof Re)&&(e={texture:e,data:t,resolutionFilename:r});const{texture:n,data:a,resolutionFilename:h=null,cachePrefix:l=""}=e;this.cachePrefix=l,this._texture=n instanceof Re?n:null,this.baseTexture=n instanceof He?n:this._texture.baseTexture,this.textures={},this.animations={},this.data=a;const c=this.baseTexture.resource;this.resolution=this._updateResolution(h||(c?c.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let r=Nr(e,null);return r===null&&(r=typeof t=="number"?t:parseFloat(t??"1")),r!==1&&this.baseTexture.setResolution(r),r}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=Ei.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const r=Ei.BATCH_SIZE;for(;t-e<r&&t<this._frameKeys.length;){const n=this._frameKeys[t],a=this._frames[n],h=a.frame;if(h){let l=null,c=null;const d=a.trimmed!==!1&&a.sourceSize?a.sourceSize:a.frame,g=new We(0,0,Math.floor(d.w)/this.resolution,Math.floor(d.h)/this.resolution);a.rotated?l=new We(Math.floor(h.x)/this.resolution,Math.floor(h.y)/this.resolution,Math.floor(h.h)/this.resolution,Math.floor(h.w)/this.resolution):l=new We(Math.floor(h.x)/this.resolution,Math.floor(h.y)/this.resolution,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution),a.trimmed!==!1&&a.spriteSourceSize&&(c=new We(Math.floor(a.spriteSourceSize.x)/this.resolution,Math.floor(a.spriteSourceSize.y)/this.resolution,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution)),this.textures[n]=new Re(this.baseTexture,l,g,c,a.rotated?2:0,a.anchor,a.borders),Re.addToCache(this.textures[n],this.cachePrefix+n.toString())}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let r=0;r<e[t].length;r++){const n=e[t][r];this.animations[t].push(this.textures[n])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Ei.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Ei.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(const r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};cd.BATCH_SIZE=1e3;let Pu=cd;const Cv=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function dd(i,e,t){const r={};if(i.forEach(n=>{r[n]=e}),Object.keys(e.textures).forEach(n=>{r[`${e.cachePrefix}${n}`]=e.textures[n]}),!t){const n=vt.dirname(i[0]);e.linkedSheets.forEach((a,h)=>{Object.assign(r,dd([`${n}/${e.data.meta.related_multi_packs[h]}`],a,!0))})}return r}const Pv={extension:be.Asset,cache:{test:i=>i instanceof Pu,getCacheableAssets:(i,e)=>dd(i,e,!1)},resolver:{test:i=>{const e=i.split("?")[0].split("."),t=e.pop(),r=e.pop();return t==="json"&&Cv.includes(r)},parse:i=>{var t;const e=i.split(".");return{resolution:parseFloat(((t=Se.RETINA_PREFIX.exec(i))==null?void 0:t[1])??"1"),format:e[e.length-2],src:i}}},loader:{name:"spritesheetLoader",extension:{type:be.LoadParser,priority:rr.Normal},async testParse(i,e){return vt.extname(e.src).toLowerCase()===".json"&&!!i.frames},async parse(i,e,t){var g,v;const{texture:r,imageFilename:n,cachePrefix:a}=(e==null?void 0:e.data)??{};let h=vt.dirname(e.src);h&&h.lastIndexOf("/")!==h.length-1&&(h+="/");let l;if(r&&r.baseTexture)l=r;else{const b=$o(h+(n??i.meta.image),e.src);l=(await t.load([b]))[b]}const c=new Pu({texture:l.baseTexture,data:i,resolutionFilename:e.src,cachePrefix:a});await c.parse();const d=(g=i==null?void 0:i.meta)==null?void 0:g.related_multi_packs;if(Array.isArray(d)){const b=[];for(const x of d){if(typeof x!="string")continue;let S=h+x;(v=e.data)!=null&&v.ignoreMultiPack||(S=$o(S,e.src),b.push(t.load({src:S,data:{ignoreMultiPack:!0}})))}const y=await Promise.all(b);c.linkedSheets=y,y.forEach(x=>{x.linkedSheets=[c].concat(c.linkedSheets.filter(S=>S!==x))})}return c},unload(i){i.destroy(!0)}}};Me.add(Pv);class An{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class un{static test(e){return typeof e=="string"&&e.startsWith("info face=")}static parse(e){const t=e.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const a in t){const h=t[a].match(/^[a-z]+/gm)[0],l=t[a].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),c={};for(const d in l){const g=l[d].split("="),v=g[0],b=g[1].replace(/"/gm,""),y=parseFloat(b),x=isNaN(y)?b:y;c[v]=x}r[h].push(c)}const n=new An;return r.info.forEach(a=>n.info.push({face:a.face,size:parseInt(a.size,10)})),r.common.forEach(a=>n.common.push({lineHeight:parseInt(a.lineHeight,10)})),r.page.forEach(a=>n.page.push({id:parseInt(a.id,10),file:a.file})),r.char.forEach(a=>n.char.push({id:parseInt(a.id,10),page:parseInt(a.page,10),x:parseInt(a.x,10),y:parseInt(a.y,10),width:parseInt(a.width,10),height:parseInt(a.height,10),xoffset:parseInt(a.xoffset,10),yoffset:parseInt(a.yoffset,10),xadvance:parseInt(a.xadvance,10)})),r.kerning.forEach(a=>n.kerning.push({first:parseInt(a.first,10),second:parseInt(a.second,10),amount:parseInt(a.amount,10)})),r.distanceField.forEach(a=>n.distanceField.push({distanceRange:parseInt(a.distanceRange,10),fieldType:a.fieldType})),n}}class Ko{static test(e){const t=e;return typeof e!="string"&&"getElementsByTagName"in e&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(e){const t=new An,r=e.getElementsByTagName("info"),n=e.getElementsByTagName("common"),a=e.getElementsByTagName("page"),h=e.getElementsByTagName("char"),l=e.getElementsByTagName("kerning"),c=e.getElementsByTagName("distanceField");for(let d=0;d<r.length;d++)t.info.push({face:r[d].getAttribute("face"),size:parseInt(r[d].getAttribute("size"),10)});for(let d=0;d<n.length;d++)t.common.push({lineHeight:parseInt(n[d].getAttribute("lineHeight"),10)});for(let d=0;d<a.length;d++)t.page.push({id:parseInt(a[d].getAttribute("id"),10)||0,file:a[d].getAttribute("file")});for(let d=0;d<h.length;d++){const g=h[d];t.char.push({id:parseInt(g.getAttribute("id"),10),page:parseInt(g.getAttribute("page"),10)||0,x:parseInt(g.getAttribute("x"),10),y:parseInt(g.getAttribute("y"),10),width:parseInt(g.getAttribute("width"),10),height:parseInt(g.getAttribute("height"),10),xoffset:parseInt(g.getAttribute("xoffset"),10),yoffset:parseInt(g.getAttribute("yoffset"),10),xadvance:parseInt(g.getAttribute("xadvance"),10)})}for(let d=0;d<l.length;d++)t.kerning.push({first:parseInt(l[d].getAttribute("first"),10),second:parseInt(l[d].getAttribute("second"),10),amount:parseInt(l[d].getAttribute("amount"),10)});for(let d=0;d<c.length;d++)t.distanceField.push({fieldType:c[d].getAttribute("fieldType"),distanceRange:parseInt(c[d].getAttribute("distanceRange"),10)});return t}}class Yo{static test(e){return typeof e=="string"&&e.includes("<font>")?Ko.test(Se.ADAPTER.parseXML(e)):!1}static parse(e){return Ko.parse(Se.ADAPTER.parseXML(e))}}const po=[un,Ko,Yo];function Iv(i){for(let e=0;e<po.length;e++)if(po[e].test(i))return po[e];return null}function Rv(i,e,t,r,n,a){const h=t.fill;if(Array.isArray(h)){if(h.length===1)return h[0]}else return h;let l;const c=t.dropShadow?t.dropShadowDistance:0,d=t.padding||0,g=i.width/r-c-d*2,v=i.height/r-c-d*2,b=h.slice(),y=t.fillGradientStops.slice();if(!y.length){const x=b.length+1;for(let S=1;S<x;++S)y.push(S/x)}if(b.unshift(h[0]),y.unshift(0),b.push(h[h.length-1]),y.push(1),t.fillGradientType===Un.LINEAR_VERTICAL){l=e.createLinearGradient(g/2,d,g/2,v+d);let x=0;const S=(a.fontProperties.fontSize+t.strokeThickness)/v;for(let w=0;w<n.length;w++){const T=a.lineHeight*w;for(let N=0;N<b.length;N++){let M=0;typeof y[N]=="number"?M=y[N]:M=N/b.length;const F=T/v+M*S;let O=Math.max(x,F);O=Math.min(O,1),l.addColorStop(O,b[N]),x=O}}}else{l=e.createLinearGradient(d,v/2,g+d,v/2);const x=b.length+1;let S=1;for(let w=0;w<b.length;w++){let T;typeof y[w]=="number"?T=y[w]:T=S/x,l.addColorStop(T,b[w]),S++}}return l}function Mv(i,e,t,r,n,a,h){const l=t.text,c=t.fontProperties;e.translate(r,n),e.scale(a,a);const d=h.strokeThickness/2,g=-(h.strokeThickness/2);if(e.font=h.toFontString(),e.lineWidth=h.strokeThickness,e.textBaseline=h.textBaseline,e.lineJoin=h.lineJoin,e.miterLimit=h.miterLimit,e.fillStyle=Rv(i,e,h,a,[l],t),e.strokeStyle=h.stroke,h.dropShadow){const v=h.dropShadowColor,b=h.dropShadowBlur*a,y=h.dropShadowDistance*a;e.shadowColor=st.shared.setValue(v).setAlpha(h.dropShadowAlpha).toRgbaString(),e.shadowBlur=b,e.shadowOffsetX=Math.cos(h.dropShadowAngle)*y,e.shadowOffsetY=Math.sin(h.dropShadowAngle)*y}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;h.stroke&&h.strokeThickness&&e.strokeText(l,d,g+t.lineHeight-c.descent),h.fill&&e.fillText(l,d,g+t.lineHeight-c.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function cn(i){return i.codePointAt?i.codePointAt(0):i.charCodeAt(0)}function pd(i){return Array.from?Array.from(i):i.split("")}function Ov(i){typeof i=="string"&&(i=[i]);const e=[];for(let t=0,r=i.length;t<r;t++){const n=i[t];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const a=n[0].charCodeAt(0),h=n[1].charCodeAt(0);if(h<a)throw new Error("[BitmapFont]: Invalid character range.");for(let l=a,c=h;l<=c;l++)e.push(String.fromCharCode(l))}else e.push(...pd(n))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}const zr=class pr{constructor(e,t,r){var g;const[n]=e.info,[a]=e.common,[h]=e.page,[l]=e.distanceField,c=Nr(h.file),d={};this._ownsTextures=r,this.font=n.face,this.size=n.size,this.lineHeight=a.lineHeight/c,this.chars={},this.pageTextures=d;for(let v=0;v<e.page.length;v++){const{id:b,file:y}=e.page[v];d[b]=t instanceof Array?t[v]:t[y],l!=null&&l.fieldType&&l.fieldType!=="none"&&(d[b].baseTexture.alphaMode=Rt.NO_PREMULTIPLIED_ALPHA,d[b].baseTexture.mipmap=br.OFF)}for(let v=0;v<e.char.length;v++){const{id:b,page:y}=e.char[v];let{x,y:S,width:w,height:T,xoffset:N,yoffset:M,xadvance:F}=e.char[v];x/=c,S/=c,w/=c,T/=c,N/=c,M/=c,F/=c;const O=new We(x+d[y].frame.x/c,S+d[y].frame.y/c,w,T);this.chars[b]={xOffset:N,yOffset:M,xAdvance:F,kerning:{},texture:new Re(d[y].baseTexture,O),page:y}}for(let v=0;v<e.kerning.length;v++){let{first:b,second:y,amount:x}=e.kerning[v];b/=c,y/=c,x/=c,this.chars[y]&&(this.chars[y].kerning[b]=x)}this.distanceFieldRange=l==null?void 0:l.distanceRange,this.distanceFieldType=((g=l==null?void 0:l.fieldType)==null?void 0:g.toLowerCase())??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,r){let n;if(e instanceof An)n=e;else{const h=Iv(e);if(!h)throw new Error("Unrecognized data format for font.");n=h.parse(e)}t instanceof Re&&(t=[t]);const a=new pr(n,t,r);return pr.available[a.font]=a,a}static uninstall(e){const t=pr.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete pr.available[e]}static from(e,t,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:n,padding:a,resolution:h,textureWidth:l,textureHeight:c,...d}=Object.assign({},pr.defaultOptions,r),g=Ov(n),v=t instanceof Fr?t:new Fr(t),b=l,y=new An;y.info[0]={face:v.fontFamily,size:v.fontSize},y.common[0]={lineHeight:v.fontSize};let x=0,S=0,w,T,N,M=0;const F=[];for(let J=0;J<g.length;J++){w||(w=Se.ADAPTER.createCanvas(),w.width=l,w.height=c,T=w.getContext("2d"),N=new He(w,{resolution:h,...d}),F.push(new Re(N)),y.page.push({id:F.length-1,file:""}));const C=g[J],V=Xr.measureText(C,v,!1,w),se=V.width,ae=Math.ceil(V.height),ve=Math.ceil((v.fontStyle==="italic"?2:1)*se);if(S>=c-ae*h){if(S===0)throw new Error(`[BitmapFont] textureHeight ${c}px is too small (fontFamily: '${v.fontFamily}', fontSize: ${v.fontSize}px, char: '${C}')`);--J,w=null,T=null,N=null,S=0,x=0,M=0;continue}if(M=Math.max(ae+V.fontProperties.descent,M),ve*h+x>=b){if(x===0)throw new Error(`[BitmapFont] textureWidth ${l}px is too small (fontFamily: '${v.fontFamily}', fontSize: ${v.fontSize}px, char: '${C}')`);--J,S+=M*h,S=Math.ceil(S),x=0,M=0;continue}Mv(w,T,V,x,S,h,v);const H=cn(V.text);y.char.push({id:H,page:F.length-1,x:x/h,y:S/h,width:ve,height:ae,xoffset:0,yoffset:0,xadvance:se-(v.dropShadow?v.dropShadowDistance:0)-(v.stroke?v.strokeThickness:0)}),x+=(ve+2*a)*h,x=Math.ceil(x)}if(!(r!=null&&r.skipKerning))for(let J=0,C=g.length;J<C;J++){const V=g[J];for(let se=0;se<C;se++){const ae=g[se],ve=T.measureText(V).width,H=T.measureText(ae).width,K=T.measureText(V+ae).width-(ve+H);K&&y.kerning.push({first:cn(V),second:cn(ae),amount:K})}}const O=new pr(y,F,!0);return pr.available[e]!==void 0&&pr.uninstall(e),pr.available[e]=O,O}};zr.ALPHA=[["a","z"],["A","Z"]," "],zr.NUMERIC=[["0","9"]],zr.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],zr.ASCII=[[" ","~"]],zr.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:zr.ALPHANUMERIC},zr.available={};let qr=zr;var kv=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,Nv=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const Iu=[],Ru=[],Mu=[],Dv=class fd extends tr{constructor(e,t={}){super();const{align:r,tint:n,maxWidth:a,letterSpacing:h,fontName:l,fontSize:c}=Object.assign({},fd.styleDefaults,t);if(!qr.available[l])throw new Error(`Missing BitmapFont "${l}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tintColor=new st(n),this._font=void 0,this._fontName=l,this._fontSize=c,this.text=e,this._maxWidth=a,this._maxLineHeight=0,this._letterSpacing=h,this._anchor=new Or(()=>{this.dirty=!0},this,0,0),this._roundPixels=Se.ROUND_PIXELS,this.dirty=!0,this._resolution=Se.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var ve;const e=qr.available[this._fontName],t=this.fontSize,r=t/e.size,n=new Ze,a=[],h=[],l=[],c=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",d=pd(c),g=this._maxWidth*e.size/t,v=e.distanceFieldType==="none"?Iu:Ru;let b=null,y=0,x=0,S=0,w=-1,T=0,N=0,M=0,F=0;for(let H=0;H<d.length;H++){const K=d[H],re=cn(K);if(/(?:\s)/.test(K)&&(w=H,T=y,F++),K==="\r"||K===`
`){h.push(y),l.push(-1),x=Math.max(x,y),++S,++N,n.x=0,n.y+=e.lineHeight,b=null,F=0;continue}const oe=e.chars[re];if(!oe)continue;b&&oe.kerning[b]&&(n.x+=oe.kerning[b]);const R=Mu.pop()||{texture:Re.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Ze};R.texture=oe.texture,R.line=S,R.charCode=re,R.position.x=Math.round(n.x+oe.xOffset+this._letterSpacing/2),R.position.y=Math.round(n.y+oe.yOffset),R.prevSpaces=F,a.push(R),y=R.position.x+Math.max(oe.xAdvance-oe.xOffset,oe.texture.orig.width),n.x+=oe.xAdvance+this._letterSpacing,M=Math.max(M,oe.yOffset+oe.texture.height),b=re,w!==-1&&g>0&&n.x>g&&(++N,Vs(a,1+w-N,1+H-w),H=w,w=-1,h.push(T),l.push(a.length>0?a[a.length-1].prevSpaces:0),x=Math.max(x,T),S++,n.x=0,n.y+=e.lineHeight,b=null,F=0)}const O=d[d.length-1];O!=="\r"&&O!==`
`&&(/(?:\s)/.test(O)&&(y=T),h.push(y),x=Math.max(x,y),l.push(-1));const J=[];for(let H=0;H<=S;H++){let K=0;this._align==="right"?K=x-h[H]:this._align==="center"?K=(x-h[H])/2:this._align==="justify"&&(K=l[H]<0?0:(x-h[H])/l[H]),J.push(K)}const C=a.length,V={},se=[],ae=this._activePagesMeshData;v.push(...ae);for(let H=0;H<C;H++){const K=a[H].texture,re=K.baseTexture.uid;if(!V[re]){let oe=v.pop();if(!oe){const k=new nv;let P,q;e.distanceFieldType==="none"?(P=new Tu(Re.EMPTY),q=Be.NORMAL):(P=new Tu(Re.EMPTY,{program:kr.from(Nv,kv),uniforms:{uFWidth:0}}),q=Be.NORMAL_NPM);const U=new Su(k,P);U.blendMode=q,oe={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:U,vertices:null,uvs:null,indices:null}}oe.index=0,oe.indexCount=0,oe.vertexCount=0,oe.uvsCount=0,oe.total=0;const{_textureCache:R}=this;R[re]=R[re]||new Re(K.baseTexture),oe.mesh.texture=R[re],oe.mesh.tint=this._tintColor.value,se.push(oe),V[re]=oe}V[re].total++}for(let H=0;H<ae.length;H++)se.includes(ae[H])||this.removeChild(ae[H].mesh);for(let H=0;H<se.length;H++)se[H].mesh.parent!==this&&this.addChild(se[H].mesh);this._activePagesMeshData=se;for(const H in V){const K=V[H],re=K.total;if(!(((ve=K.indices)==null?void 0:ve.length)>6*re)||K.vertices.length<Su.BATCHABLE_SIZE*2)K.vertices=new Float32Array(4*2*re),K.uvs=new Float32Array(4*2*re),K.indices=new Uint16Array(6*re);else{const oe=K.total,R=K.vertices;for(let k=oe*4*2;k<R.length;k++)R[k]=0}K.mesh.size=6*re}for(let H=0;H<C;H++){const K=a[H];let re=K.position.x+J[K.line]*(this._align==="justify"?K.prevSpaces:1);this._roundPixels&&(re=Math.round(re));const oe=re*r,R=K.position.y*r,k=K.texture,P=V[k.baseTexture.uid],q=k.frame,U=k._uvs,D=P.index++;P.indices[D*6+0]=0+D*4,P.indices[D*6+1]=1+D*4,P.indices[D*6+2]=2+D*4,P.indices[D*6+3]=0+D*4,P.indices[D*6+4]=2+D*4,P.indices[D*6+5]=3+D*4,P.vertices[D*8+0]=oe,P.vertices[D*8+1]=R,P.vertices[D*8+2]=oe+q.width*r,P.vertices[D*8+3]=R,P.vertices[D*8+4]=oe+q.width*r,P.vertices[D*8+5]=R+q.height*r,P.vertices[D*8+6]=oe,P.vertices[D*8+7]=R+q.height*r,P.uvs[D*8+0]=U.x0,P.uvs[D*8+1]=U.y0,P.uvs[D*8+2]=U.x1,P.uvs[D*8+3]=U.y1,P.uvs[D*8+4]=U.x2,P.uvs[D*8+5]=U.y2,P.uvs[D*8+6]=U.x3,P.uvs[D*8+7]=U.y3}this._textWidth=x*r,this._textHeight=(n.y+e.lineHeight)*r;for(const H in V){const K=V[H];if(this.anchor.x!==0||this.anchor.y!==0){let k=0;const P=this._textWidth*this.anchor.x,q=this._textHeight*this.anchor.y;for(let U=0;U<K.total;U++)K.vertices[k++]-=P,K.vertices[k++]-=q,K.vertices[k++]-=P,K.vertices[k++]-=q,K.vertices[k++]-=P,K.vertices[k++]-=q,K.vertices[k++]-=P,K.vertices[k++]-=q}this._maxLineHeight=M*r;const re=K.mesh.geometry.getBuffer("aVertexPosition"),oe=K.mesh.geometry.getBuffer("aTextureCoord"),R=K.mesh.geometry.getIndex();re.data=K.vertices,oe.data=K.uvs,R.data=K.indices,re.update(),oe.update(),R.update()}for(let H=0;H<a.length;H++)Mu.push(a[H]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:r,size:n}=qr.available[this._fontName];if(r!=="none"){const{a,b:h,c:l,d:c}=this.worldTransform,d=Math.sqrt(a*a+h*h),g=Math.sqrt(l*l+c*c),v=(Math.abs(d)+Math.abs(g))/2,b=this.fontSize/n,y=e._view.resolution;for(const x of this._activePagesMeshData)x.mesh.shader.uniforms.uFWidth=v*t*b*y}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=qr.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(e){if(this.tint!==e){this._tintColor.setValue(e);for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!qr.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??qr.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,r=qr.available[this._fontName].distanceFieldType==="none"?Iu:Ru;r.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],r.filter(n=>t[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=Re.EMPTY});for(const n in t)t[n].destroy(),delete t[n];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(e)}};Dv.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const Fv=[".xml",".fnt"],Bv={extension:{type:be.LoadParser,priority:rr.Normal},name:"loadBitmapFont",test(i){return Fv.includes(vt.extname(i).toLowerCase())},async testParse(i){return un.test(i)||Yo.test(i)},async parse(i,e,t){const r=un.test(i)?un.parse(i):Yo.parse(i),{src:n}=e,{page:a}=r,h=[];for(let d=0;d<a.length;++d){const g=a[d].file;let v=vt.join(vt.dirname(n),g);v=$o(v,n),h.push(v)}const l=await t.load(h),c=h.map(d=>l[d]);return qr.install(r,c,!0)},async load(i,e){return(await Se.ADAPTER.fetch(i)).text()},unload(i){i.destroy()}};Me.add(Bv);const Jo=class Us extends Fr{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(e){return new Us(Object.keys(Us.defaultOptions).reduce((t,r)=>({...t,[r]:e[r]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(e=>{URL.revokeObjectURL(e.src),e.refs--,e.refs===0&&(e.fontFace&&document.fonts.delete(e.fontFace),delete Us.availableFonts[e.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(e,t={}){const{availableFonts:r}=Us;if(r[e]){const n=r[e];return this._fonts.push(n),n.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return Se.ADAPTER.fetch(e).then(n=>n.blob()).then(async n=>new Promise((a,h)=>{const l=URL.createObjectURL(n),c=new FileReader;c.onload=()=>a([l,c.result]),c.onerror=h,c.readAsDataURL(n)})).then(async([n,a])=>{const h=Object.assign({family:vt.basename(e,vt.extname(e)),weight:"normal",style:"normal",display:"auto",src:n,dataSrc:a,refs:1,originalUrl:e,fontFace:null},t);r[e]=h,this._fonts.push(h),this.styleID++;const l=new FontFace(h.family,`url(${h.src})`,{weight:h.weight,style:h.style,display:h.display});h.fontFace=l,await l.load(),document.fonts.add(l),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...e){const t=e.filter(r=>!this._overrides.includes(r));t.length>0&&(this._overrides.push(...t),this.styleID++)}removeOverride(...e){const t=e.filter(r=>this._overrides.includes(r));t.length>0&&(this._overrides=this._overrides.filter(r=>!t.includes(r)),this.styleID++)}toCSS(e){return[`transform: scale(${e})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((e,t)=>`${e}
            @font-face {
                font-family: "${t.family}";
                src: url('${t.dataSrc}');
                font-weight: ${t.weight};
                font-style: ${t.style};
                font-display: ${t.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){return Array.isArray(e)&&(e=ec(e)),typeof e=="number"?Af(e):e}dropShadowToCSS(){let e=this.normalizeColor(this.dropShadowColor);const t=this.dropShadowAlpha,r=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),n=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&t<1&&(e+=(t*255|0).toString(16).padStart(2,"0"));const a=`${r}px ${n}px`;return this.dropShadowBlur>0?`text-shadow: ${a} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${a} ${e}`}reset(){Object.assign(this,Us.defaultOptions)}onBeforeDraw(){const{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise(t=>setTimeout(t,100)):Promise.resolve()}get isSafari(){const{userAgent:e}=Se.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(e){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(e){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(e){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(e){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};Jo.availableFonts={},Jo.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let fo=Jo;const tn=class Gs extends ti{constructor(e="",t={}){super(Re.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const r=new Image,n=Re.from(r,{scaleMode:Se.SCALE_MODE,resourceOptions:{autoLoad:!1}});n.orig=new We,n.trim=new We,this.texture=n;const a="http://www.w3.org/2000/svg",h="http://www.w3.org/1999/xhtml",l=document.createElementNS(a,"svg"),c=document.createElementNS(a,"foreignObject"),d=document.createElementNS(h,"div"),g=document.createElementNS(h,"style");c.setAttribute("width","10000"),c.setAttribute("height","10000"),c.style.overflow="hidden",l.appendChild(c),this.maxWidth=Gs.defaultMaxWidth,this.maxHeight=Gs.defaultMaxHeight,this._domElement=d,this._styleElement=g,this._svgRoot=l,this._foreignObject=c,this._foreignObject.appendChild(g),this._foreignObject.appendChild(d),this._image=r,this._loadImage=new Image,this._autoResolution=Gs.defaultAutoResolution,this._resolution=Gs.defaultResolution??Se.RESOLUTION,this.text=e,this.style=t}measureText(e){var g,v;const{text:t,style:r,resolution:n}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:t,style:r.toCSS(n)}),this._styleElement.textContent=r.toGlobalCSS(),document.body.appendChild(this._svgRoot);const a=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:h,height:l}=a;(h>this.maxWidth||l>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const c=Math.min(this.maxWidth,Math.ceil(h)),d=Math.min(this.maxHeight,Math.ceil(l));return this._svgRoot.setAttribute("width",c.toString()),this._svgRoot.setAttribute("height",d.toString()),t!==this._text&&(this._domElement.innerHTML=this._text),r!==this._style&&(Object.assign(this._domElement,{style:(g=this._style)==null?void 0:g.toCSS(n)}),this._styleElement.textContent=(v=this._style)==null?void 0:v.toGlobalCSS()),{width:c+r.padding*2,height:d+r.padding*2}}async updateText(e=!0){const{style:t,_image:r,_loadImage:n}=this;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;const{width:a,height:h}=this.measureText();r.width=n.width=Math.ceil(Math.max(1,a)),r.height=n.height=Math.ceil(Math.max(1,h)),this._updateID++;const l=this._updateID;await new Promise(c=>{n.onload=async()=>{if(l<this._updateID){c();return}await t.onBeforeDraw(),r.src=n.src,n.onload=null,n.src="",this.updateTexture(),c()};const d=new XMLSerializer().serializeToString(this._svgRoot);n.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(d)}`})}get source(){return this._image}updateTexture(){const{style:e,texture:t,_image:r,resolution:n}=this,{padding:a}=e,{baseTexture:h}=t;t.trim.width=t._frame.width=r.width/n,t.trim.height=t._frame.height=r.height/n,t.trim.x=-a,t.trim.y=-a,t.orig.width=t._frame.width-a*2,t.orig.height=t._frame.height-a*2,this._onTextureUpdate(),h.setRealSize(r.width,r.height,n),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){var r,n,a,h,l;typeof e=="boolean"&&(e={children:e}),e=Object.assign({},Gs.defaultDestroyOptions,e),super.destroy(e);const t=null;this.ownsStyle&&((r=this._style)==null||r.cleanFonts()),this._style=t,(n=this._svgRoot)==null||n.remove(),this._svgRoot=t,(a=this._domElement)==null||a.remove(),this._domElement=t,(h=this._foreignObject)==null||h.remove(),this._foreignObject=t,(l=this._styleElement)==null||l.remove(),this._styleElement=t,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=t,this._image.src="",this._image=t}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);const t=Yr(this.scale.x)||1;this.scale.x=t*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);const t=Yr(this.scale.y)||1;this.scale.y=t*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&(e=e||{},e instanceof fo?(this.ownsStyle=!1,this._style=e):e instanceof Fr?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=fo.from(e)):(this.ownsStyle=!0,this._style=new fo(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(e===""||e===null||e===void 0?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};tn.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},tn.defaultMaxWidth=2024,tn.defaultMaxHeight=2024,tn.defaultAutoResolution=!0;var Lv=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Uv=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

uniform float outerStrength;
uniform float innerStrength;

uniform vec4 glowColor;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform bool knockout;
uniform float alpha;

const float PI = 3.14159265358979323846264;

const float DIST = __DIST__;
const float ANGLE_STEP_SIZE = min(__ANGLE_STEP_SIZE__, PI * 2.0);
const float ANGLE_STEP_NUM = ceil(PI * 2.0 / ANGLE_STEP_SIZE);

const float MAX_TOTAL_ALPHA = ANGLE_STEP_NUM * DIST * (DIST + 1.0) / 2.0;

void main(void) {
    vec2 px = vec2(1.0 / filterArea.x, 1.0 / filterArea.y);

    float totalAlpha = 0.0;

    vec2 direction;
    vec2 displaced;
    vec4 curColor;

    for (float angle = 0.0; angle < PI * 2.0; angle += ANGLE_STEP_SIZE) {
       direction = vec2(cos(angle), sin(angle)) * px;

       for (float curDistance = 0.0; curDistance < DIST; curDistance++) {
           displaced = clamp(vTextureCoord + direction * 
                   (curDistance + 1.0), filterClamp.xy, filterClamp.zw);

           curColor = texture2D(uSampler, displaced);

           totalAlpha += (DIST - curDistance) * curColor.a;
       }
    }
    
    curColor = texture2D(uSampler, vTextureCoord);

    float alphaRatio = (totalAlpha / MAX_TOTAL_ALPHA);

    float innerGlowAlpha = (1.0 - alphaRatio) * innerStrength * curColor.a;
    float innerGlowStrength = min(1.0, innerGlowAlpha);
    
    vec4 innerColor = mix(curColor, glowColor, innerGlowStrength);

    float outerGlowAlpha = alphaRatio * outerStrength * (1. - curColor.a);
    float outerGlowStrength = min(1.0 - innerColor.a, outerGlowAlpha);

    if (knockout) {
      float resultAlpha = (outerGlowAlpha + innerGlowAlpha) * alpha;
      gl_FragColor = vec4(glowColor.rgb * resultAlpha, resultAlpha);
    }
    else {
      vec4 outerGlowColor = outerGlowStrength * glowColor.rgba * alpha;
      gl_FragColor = innerColor + outerGlowColor;
    }
}
`;const gd=class extends wt{constructor(i){const e=Object.assign({},gd.defaults,i),{outerStrength:t,innerStrength:r,color:n,knockout:a,quality:h,alpha:l}=e,c=Math.round(e.distance);super(Lv,Uv.replace(/__ANGLE_STEP_SIZE__/gi,`${(1/h/c).toFixed(7)}`).replace(/__DIST__/gi,`${c.toFixed(0)}.0`)),this.uniforms.glowColor=new Float32Array([0,0,0,1]),this.uniforms.alpha=1,Object.assign(this,{color:n,outerStrength:t,innerStrength:r,padding:c,knockout:a,alpha:l})}get color(){return ec(this.uniforms.glowColor)}set color(i){Tf(i,this.uniforms.glowColor)}get outerStrength(){return this.uniforms.outerStrength}set outerStrength(i){this.uniforms.outerStrength=i}get innerStrength(){return this.uniforms.innerStrength}set innerStrength(i){this.uniforms.innerStrength=i}get knockout(){return this.uniforms.knockout}set knockout(i){this.uniforms.knockout=i}get alpha(){return this.uniforms.alpha}set alpha(i){this.uniforms.alpha=i}};let Ti=gd;Ti.defaults={distance:10,outerStrength:4,innerStrength:0,color:16777215,quality:.1,knockout:!1,alpha:1};var dn={exports:{}},Gv=dn.exports,Ou;function jv(){return Ou||(Ou=1,function(i,e){(function(t,r){i.exports=r()})(Gv,function(){var t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Ys<"u"?Ys:typeof self<"u"?self:{};function r(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var n={exports:{}};(function(f){(function(s,o){var u=Math.pow(2,-24),p=Math.pow(2,32),m=Math.pow(2,53),_={encode:function(E){var A,I=new ArrayBuffer(256),X=new DataView(I),G=0;function L(Ye){for(var me=I.byteLength,Te=G+Ye;me<Te;)me*=2;if(me!==I.byteLength){var ye=X;I=new ArrayBuffer(me),X=new DataView(I);for(var z=G+3>>2,xe=0;xe<z;++xe)X.setUint32(4*xe,ye.getUint32(4*xe))}return A=Ye,X}function Q(){G+=A}function B(Ye){Q(L(1).setUint8(G,Ye))}function j(Ye){for(var me=L(Ye.length),Te=0;Te<Ye.length;++Te)me.setUint8(G+Te,Ye[Te]);Q()}function $(Ye,me){me<24?B(Ye<<5|me):me<256?(B(Ye<<5|24),B(me)):me<65536?(B(Ye<<5|25),function(Te){Q(L(2).setUint16(G,Te))}(me)):me<4294967296?(B(Ye<<5|26),function(Te){Q(L(4).setUint32(G,Te))}(me)):(B(Ye<<5|27),function(Te){var ye=Te%p,z=(Te-ye)/p,xe=L(8);xe.setUint32(G,z),xe.setUint32(G+4,ye),Q()}(me))}if(function Ye(me){var Te;if(me===!1)return B(244);if(me===!0)return B(245);if(me===null)return B(246);if(me===o)return B(247);switch(typeof me){case"number":if(Math.floor(me)===me){if(0<=me&&me<=m)return $(0,me);if(-m<=me&&me<0)return $(1,-(me+1))}return B(251),function(ze){Q(L(8).setFloat64(G,ze))}(me);case"string":var ye=[];for(Te=0;Te<me.length;++Te){var z=me.charCodeAt(Te);z<128?ye.push(z):z<2048?(ye.push(192|z>>6),ye.push(128|63&z)):z<55296?(ye.push(224|z>>12),ye.push(128|z>>6&63),ye.push(128|63&z)):(z=(1023&z)<<10,z|=1023&me.charCodeAt(++Te),z+=65536,ye.push(240|z>>18),ye.push(128|z>>12&63),ye.push(128|z>>6&63),ye.push(128|63&z))}return $(3,ye.length),j(ye);default:var xe;if(Array.isArray(me))for($(4,xe=me.length),Te=0;Te<xe;++Te)Ye(me[Te]);else if(me instanceof Uint8Array)$(2,me.length),j(me);else{var qe=Object.keys(me);for($(5,xe=qe.length),Te=0;Te<xe;++Te){var Ve=qe[Te];Ye(Ve),Ye(me[Ve])}}}}(E),"slice"in I)return I.slice(0,G);for(var te=new ArrayBuffer(G),ke=new DataView(te),$e=0;$e<G;++$e)ke.setUint8($e,X.getUint8($e));return te},decode:function(E,A,I){var X=new DataView(E),G=0;function L(Te,ye){return G+=ye,Te}function Q(Te){return L(new Uint8Array(E,G,Te),Te)}function B(){return L(X.getUint8(G),1)}function j(){return L(X.getUint16(G),2)}function $(){return L(X.getUint32(G),4)}function te(){return X.getUint8(G)===255&&(G+=1,!0)}function ke(Te){if(Te<24)return Te;if(Te===24)return B();if(Te===25)return j();if(Te===26)return $();if(Te===27)return $()*p+$();if(Te===31)return-1;throw"Invalid length encoding"}function $e(Te){var ye=B();if(ye===255)return-1;var z=ke(31&ye);if(z<0||ye>>5!==Te)throw"Invalid indefinite length element";return z}function Ye(Te,ye){for(var z=0;z<ye;++z){var xe=B();128&xe&&(xe<224?(xe=(31&xe)<<6|63&B(),ye-=1):xe<240?(xe=(15&xe)<<12|(63&B())<<6|63&B(),ye-=2):(xe=(15&xe)<<18|(63&B())<<12|(63&B())<<6|63&B(),ye-=3)),xe<65536?Te.push(xe):(xe-=65536,Te.push(55296|xe>>10),Te.push(56320|1023&xe))}}typeof A!="function"&&(A=function(Te){return Te}),typeof I!="function"&&(I=function(){return o});var me=function Te(){var ye,z,xe=B(),qe=xe>>5,Ve=31&xe;if(qe===7)switch(Ve){case 25:return function(){var Ot=new ArrayBuffer(4),Wt=new DataView(Ot),Ms=j(),ui=32768&Ms,Ar=31744&Ms,as=1023&Ms;if(Ar===31744)Ar=261120;else if(Ar!==0)Ar+=114688;else if(as!==0)return as*u;return Wt.setUint32(0,ui<<16|Ar<<13|as<<13),Wt.getFloat32(0)}();case 26:return L(X.getFloat32(G),4);case 27:return L(X.getFloat64(G),8)}if((z=ke(Ve))<0&&(qe<2||6<qe))throw"Invalid length";switch(qe){case 0:return z;case 1:return-1-z;case 2:if(z<0){for(var ze=[],Tt=0;(z=$e(qe))>=0;)Tt+=z,ze.push(Q(z));var ne=new Uint8Array(Tt),pe=0;for(ye=0;ye<ze.length;++ye)ne.set(ze[ye],pe),pe+=ze[ye].length;return ne}return Q(z);case 3:var he=[];if(z<0)for(;(z=$e(qe))>=0;)Ye(he,z);else Ye(he,z);return String.fromCharCode.apply(null,he);case 4:var le;if(z<0)for(le=[];!te();)le.push(Te());else for(le=new Array(z),ye=0;ye<z;++ye)le[ye]=Te();return le;case 5:var Gt={};for(ye=0;ye<z||z<0&&!te();++ye)Gt[Te()]=Te();return Gt;case 6:return A(Te(),z);case 7:switch(z){case 20:return!1;case 21:return!0;case 22:return null;case 23:return o;default:return I(z)}}}();if(G!==E.byteLength)throw"Remaining bytes";return me}};f.exports?f.exports=_:s.CBOR||(s.CBOR=_)})(t)})(n);var a=r(n.exports);function h(f,s){var o={};for(var u in f)Object.prototype.hasOwnProperty.call(f,u)&&s.indexOf(u)<0&&(o[u]=f[u]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function"){var p=0;for(u=Object.getOwnPropertySymbols(f);p<u.length;p++)s.indexOf(u[p])<0&&Object.prototype.propertyIsEnumerable.call(f,u[p])&&(o[u[p]]=f[u[p]])}return o}function l(f,s,o,u){return new(o||(o=Promise))(function(p,m){function _(I){try{A(u.next(I))}catch(X){m(X)}}function E(I){try{A(u.throw(I))}catch(X){m(X)}}function A(I){var X;I.done?p(I.value):(X=I.value,X instanceof o?X:new o(function(G){G(X)})).then(_,E)}A((u=u.apply(f,s||[])).next())})}typeof SuppressedError=="function"&&SuppressedError;class c{static legacyCryptoModule(s){throw new Error("Should be implemented by concrete crypto module implementation.")}static aesCbcCryptoModule(s){throw new Error("Should be implemented by concrete crypto module implementation.")}constructor(s){var o;this.defaultCryptor=s.default,this.cryptors=(o=s.cryptors)!==null&&o!==void 0?o:[]}getAllCryptors(){return[this.defaultCryptor,...this.cryptors]}}c.encoder=new TextEncoder,c.decoder=new TextDecoder;class d{static create(s){return new d(s)}constructor(s){let o,u,p,m;if(s instanceof File)m=s,p=s.name,u=s.type,o=s.size;else if("data"in s){const _=s.data;u=s.mimeType,p=s.name,m=new File([_],p,{type:u}),o=m.size}if(m===void 0)throw new Error("Couldn't construct a file out of supplied options.");if(p===void 0)throw new Error("Couldn't guess filename out of the options. Please provide one.");o&&(this.contentLength=o),this.mimeType=u,this.data=m,this.name=p}toBuffer(){return l(this,void 0,void 0,function*(){throw new Error("This feature is only supported in Node.js environments.")})}toArrayBuffer(){return l(this,void 0,void 0,function*(){return new Promise((s,o)=>{const u=new FileReader;u.addEventListener("load",()=>{if(u.result instanceof ArrayBuffer)return s(u.result)}),u.addEventListener("error",()=>o(u.error)),u.readAsArrayBuffer(this.data)})})}toString(){return l(this,void 0,void 0,function*(){return new Promise((s,o)=>{const u=new FileReader;u.addEventListener("load",()=>{if(typeof u.result=="string")return s(u.result)}),u.addEventListener("error",()=>{o(u.error)}),u.readAsBinaryString(this.data)})})}toStream(){return l(this,void 0,void 0,function*(){throw new Error("This feature is only supported in Node.js environments.")})}toFile(){return l(this,void 0,void 0,function*(){return this.data})}toFileUri(){return l(this,void 0,void 0,function*(){throw new Error("This feature is only supported in React Native environments.")})}toBlob(){return l(this,void 0,void 0,function*(){return this.data})}}d.supportsBlob=typeof Blob<"u",d.supportsFile=typeof File<"u",d.supportsBuffer=!1,d.supportsStream=!1,d.supportsString=!0,d.supportsArrayBuffer=!0,d.supportsEncryptFile=!0,d.supportsFileUri=!1;function g(f){const s=f.replace(/==?$/,""),o=Math.floor(s.length/4*3),u=new ArrayBuffer(o),p=new Uint8Array(u);let m=0;function _(){const E=s.charAt(m++),A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(E);if(A===-1)throw new Error(`Illegal character at ${m}: ${s.charAt(m-1)}`);return A}for(let E=0;E<o;E+=3){const A=_(),I=_(),X=_(),G=_(),L=(63&A)<<2|I>>4,Q=(15&I)<<4|X>>2,B=(3&X)<<6|G;p[E]=L,X!=64&&(p[E+1]=Q),G!=64&&(p[E+2]=B)}return u}function v(f){let s="";const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=new Uint8Array(f),p=u.byteLength,m=p%3,_=p-m;let E,A,I,X,G;for(let L=0;L<_;L+=3)G=u[L]<<16|u[L+1]<<8|u[L+2],E=(16515072&G)>>18,A=(258048&G)>>12,I=(4032&G)>>6,X=63&G,s+=o[E]+o[A]+o[I]+o[X];return m==1?(G=u[_],E=(252&G)>>2,A=(3&G)<<4,s+=o[E]+o[A]+"=="):m==2&&(G=u[_]<<8|u[_+1],E=(64512&G)>>10,A=(1008&G)>>4,I=(15&G)<<2,s+=o[E]+o[A]+o[I]+"="),s}var b;(function(f){f.PNNetworkIssuesCategory="PNNetworkIssuesCategory",f.PNTimeoutCategory="PNTimeoutCategory",f.PNCancelledCategory="PNCancelledCategory",f.PNBadRequestCategory="PNBadRequestCategory",f.PNAccessDeniedCategory="PNAccessDeniedCategory",f.PNValidationErrorCategory="PNValidationErrorCategory",f.PNAcknowledgmentCategory="PNAcknowledgmentCategory",f.PNMalformedResponseCategory="PNMalformedResponseCategory",f.PNUnknownCategory="PNUnknownCategory",f.PNNetworkUpCategory="PNNetworkUpCategory",f.PNNetworkDownCategory="PNNetworkDownCategory",f.PNReconnectedCategory="PNReconnectedCategory",f.PNConnectedCategory="PNConnectedCategory",f.PNSubscriptionChangedCategory="PNSubscriptionChangedCategory",f.PNRequestMessageCountExceededCategory="PNRequestMessageCountExceededCategory",f.PNDisconnectedCategory="PNDisconnectedCategory",f.PNConnectionErrorCategory="PNConnectionErrorCategory",f.PNDisconnectedUnexpectedlyCategory="PNDisconnectedUnexpectedlyCategory"})(b||(b={}));var y=b;class x extends Error{constructor(s,o){super(s),this.status=o,this.name="PubNubError",this.message=s,Object.setPrototypeOf(this,new.target.prototype)}}function S(f,s){var o;return(o=f.statusCode)!==null&&o!==void 0||(f.statusCode=0),Object.assign(Object.assign({},f),{statusCode:f.statusCode,category:s,error:!0})}function w(f,s){return S(Object.assign({message:f},{}),y.PNValidationErrorCategory)}function T(f,s){return S(Object.assign(Object.assign({message:"Unable to deserialize service response"},f!==void 0?{responseText:f}:{}),s!==void 0?{statusCode:s}:{}),y.PNMalformedResponseCategory)}var N,M,F,O,J,C=C||function(f){var s={},o=s.lib={},u=function(){},p=o.Base={extend:function(L){u.prototype=this;var Q=new u;return L&&Q.mixIn(L),Q.hasOwnProperty("init")||(Q.init=function(){Q.$super.init.apply(this,arguments)}),Q.init.prototype=Q,Q.$super=this,Q},create:function(){var L=this.extend();return L.init.apply(L,arguments),L},init:function(){},mixIn:function(L){for(var Q in L)L.hasOwnProperty(Q)&&(this[Q]=L[Q]);L.hasOwnProperty("toString")&&(this.toString=L.toString)},clone:function(){return this.init.prototype.extend(this)}},m=o.WordArray=p.extend({init:function(L,Q){L=this.words=L||[],this.sigBytes=Q??4*L.length},toString:function(L){return(L||E).stringify(this)},concat:function(L){var Q=this.words,B=L.words,j=this.sigBytes;if(L=L.sigBytes,this.clamp(),j%4)for(var $=0;$<L;$++)Q[j+$>>>2]|=(B[$>>>2]>>>24-$%4*8&255)<<24-(j+$)%4*8;else if(65535<B.length)for($=0;$<L;$+=4)Q[j+$>>>2]=B[$>>>2];else Q.push.apply(Q,B);return this.sigBytes+=L,this},clamp:function(){var L=this.words,Q=this.sigBytes;L[Q>>>2]&=4294967295<<32-Q%4*8,L.length=f.ceil(Q/4)},clone:function(){var L=p.clone.call(this);return L.words=this.words.slice(0),L},random:function(L){for(var Q=[],B=0;B<L;B+=4)Q.push(4294967296*f.random()|0);return new m.init(Q,L)}}),_=s.enc={},E=_.Hex={stringify:function(L){var Q=L.words;L=L.sigBytes;for(var B=[],j=0;j<L;j++){var $=Q[j>>>2]>>>24-j%4*8&255;B.push(($>>>4).toString(16)),B.push((15&$).toString(16))}return B.join("")},parse:function(L){for(var Q=L.length,B=[],j=0;j<Q;j+=2)B[j>>>3]|=parseInt(L.substr(j,2),16)<<24-j%8*4;return new m.init(B,Q/2)}},A=_.Latin1={stringify:function(L){var Q=L.words;L=L.sigBytes;for(var B=[],j=0;j<L;j++)B.push(String.fromCharCode(Q[j>>>2]>>>24-j%4*8&255));return B.join("")},parse:function(L){for(var Q=L.length,B=[],j=0;j<Q;j++)B[j>>>2]|=(255&L.charCodeAt(j))<<24-j%4*8;return new m.init(B,Q)}},I=_.Utf8={stringify:function(L){try{return decodeURIComponent(escape(A.stringify(L)))}catch{throw Error("Malformed UTF-8 data")}},parse:function(L){return A.parse(unescape(encodeURIComponent(L)))}},X=o.BufferedBlockAlgorithm=p.extend({reset:function(){this._data=new m.init,this._nDataBytes=0},_append:function(L){typeof L=="string"&&(L=I.parse(L)),this._data.concat(L),this._nDataBytes+=L.sigBytes},_process:function(L){var Q=this._data,B=Q.words,j=Q.sigBytes,$=this.blockSize,te=j/(4*$);if(L=(te=L?f.ceil(te):f.max((0|te)-this._minBufferSize,0))*$,j=f.min(4*L,j),L){for(var ke=0;ke<L;ke+=$)this._doProcessBlock(B,ke);ke=B.splice(0,L),Q.sigBytes-=j}return new m.init(ke,j)},clone:function(){var L=p.clone.call(this);return L._data=this._data.clone(),L},_minBufferSize:0});o.Hasher=X.extend({cfg:p.extend(),init:function(L){this.cfg=this.cfg.extend(L),this.reset()},reset:function(){X.reset.call(this),this._doReset()},update:function(L){return this._append(L),this._process(),this},finalize:function(L){return L&&this._append(L),this._doFinalize()},blockSize:16,_createHelper:function(L){return function(Q,B){return new L.init(B).finalize(Q)}},_createHmacHelper:function(L){return function(Q,B){return new G.HMAC.init(L,B).finalize(Q)}}});var G=s.algo={};return s}(Math);(function(f){for(var s=C,o=(p=s.lib).WordArray,u=p.Hasher,p=s.algo,m=[],_=[],E=function(B){return 4294967296*(B-(0|B))|0},A=2,I=0;64>I;){var X;e:{X=A;for(var G=f.sqrt(X),L=2;L<=G;L++)if(!(X%L)){X=!1;break e}X=!0}X&&(8>I&&(m[I]=E(f.pow(A,.5))),_[I]=E(f.pow(A,1/3)),I++),A++}var Q=[];p=p.SHA256=u.extend({_doReset:function(){this._hash=new o.init(m.slice(0))},_doProcessBlock:function(B,j){for(var $=this._hash.words,te=$[0],ke=$[1],$e=$[2],Ye=$[3],me=$[4],Te=$[5],ye=$[6],z=$[7],xe=0;64>xe;xe++){if(16>xe)Q[xe]=0|B[j+xe];else{var qe=Q[xe-15],Ve=Q[xe-2];Q[xe]=((qe<<25|qe>>>7)^(qe<<14|qe>>>18)^qe>>>3)+Q[xe-7]+((Ve<<15|Ve>>>17)^(Ve<<13|Ve>>>19)^Ve>>>10)+Q[xe-16]}qe=z+((me<<26|me>>>6)^(me<<21|me>>>11)^(me<<7|me>>>25))+(me&Te^~me&ye)+_[xe]+Q[xe],Ve=((te<<30|te>>>2)^(te<<19|te>>>13)^(te<<10|te>>>22))+(te&ke^te&$e^ke&$e),z=ye,ye=Te,Te=me,me=Ye+qe|0,Ye=$e,$e=ke,ke=te,te=qe+Ve|0}$[0]=$[0]+te|0,$[1]=$[1]+ke|0,$[2]=$[2]+$e|0,$[3]=$[3]+Ye|0,$[4]=$[4]+me|0,$[5]=$[5]+Te|0,$[6]=$[6]+ye|0,$[7]=$[7]+z|0},_doFinalize:function(){var B=this._data,j=B.words,$=8*this._nDataBytes,te=8*B.sigBytes;return j[te>>>5]|=128<<24-te%32,j[14+(te+64>>>9<<4)]=f.floor($/4294967296),j[15+(te+64>>>9<<4)]=$,B.sigBytes=4*j.length,this._process(),this._hash},clone:function(){var B=u.clone.call(this);return B._hash=this._hash.clone(),B}}),s.SHA256=u._createHelper(p),s.HmacSHA256=u._createHmacHelper(p)})(Math),M=(N=C).enc.Utf8,N.algo.HMAC=N.lib.Base.extend({init:function(f,s){f=this._hasher=new f.init,typeof s=="string"&&(s=M.parse(s));var o=f.blockSize,u=4*o;s.sigBytes>u&&(s=f.finalize(s)),s.clamp();for(var p=this._oKey=s.clone(),m=this._iKey=s.clone(),_=p.words,E=m.words,A=0;A<o;A++)_[A]^=1549556828,E[A]^=909522486;p.sigBytes=m.sigBytes=u,this.reset()},reset:function(){var f=this._hasher;f.reset(),f.update(this._iKey)},update:function(f){return this._hasher.update(f),this},finalize:function(f){var s=this._hasher;return f=s.finalize(f),s.reset(),s.finalize(this._oKey.clone().concat(f))}}),O=(F=C).lib.WordArray,F.enc.Base64={stringify:function(f){var s=f.words,o=f.sigBytes,u=this._map;f.clamp(),f=[];for(var p=0;p<o;p+=3)for(var m=(s[p>>>2]>>>24-p%4*8&255)<<16|(s[p+1>>>2]>>>24-(p+1)%4*8&255)<<8|s[p+2>>>2]>>>24-(p+2)%4*8&255,_=0;4>_&&p+.75*_<o;_++)f.push(u.charAt(m>>>6*(3-_)&63));if(s=u.charAt(64))for(;f.length%4;)f.push(s);return f.join("")},parse:function(f){var s=f.length,o=this._map;(u=o.charAt(64))&&(u=f.indexOf(u))!=-1&&(s=u);for(var u=[],p=0,m=0;m<s;m++)if(m%4){var _=o.indexOf(f.charAt(m-1))<<m%4*2,E=o.indexOf(f.charAt(m))>>>6-m%4*2;u[p>>>2]|=(_|E)<<24-p%4*8,p++}return O.create(u,p)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(f){function s(G,L,Q,B,j,$,te){return((G=G+(L&Q|~L&B)+j+te)<<$|G>>>32-$)+L}function o(G,L,Q,B,j,$,te){return((G=G+(L&B|Q&~B)+j+te)<<$|G>>>32-$)+L}function u(G,L,Q,B,j,$,te){return((G=G+(L^Q^B)+j+te)<<$|G>>>32-$)+L}function p(G,L,Q,B,j,$,te){return((G=G+(Q^(L|~B))+j+te)<<$|G>>>32-$)+L}for(var m=C,_=(A=m.lib).WordArray,E=A.Hasher,A=m.algo,I=[],X=0;64>X;X++)I[X]=4294967296*f.abs(f.sin(X+1))|0;A=A.MD5=E.extend({_doReset:function(){this._hash=new _.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(G,L){for(var Q=0;16>Q;Q++){var B=G[j=L+Q];G[j]=16711935&(B<<8|B>>>24)|4278255360&(B<<24|B>>>8)}Q=this._hash.words;var j=G[L+0],$=(B=G[L+1],G[L+2]),te=G[L+3],ke=G[L+4],$e=G[L+5],Ye=G[L+6],me=G[L+7],Te=G[L+8],ye=G[L+9],z=G[L+10],xe=G[L+11],qe=G[L+12],Ve=G[L+13],ze=G[L+14],Tt=G[L+15],ne=s(ne=Q[0],le=Q[1],he=Q[2],pe=Q[3],j,7,I[0]),pe=s(pe,ne,le,he,B,12,I[1]),he=s(he,pe,ne,le,$,17,I[2]),le=s(le,he,pe,ne,te,22,I[3]);ne=s(ne,le,he,pe,ke,7,I[4]),pe=s(pe,ne,le,he,$e,12,I[5]),he=s(he,pe,ne,le,Ye,17,I[6]),le=s(le,he,pe,ne,me,22,I[7]),ne=s(ne,le,he,pe,Te,7,I[8]),pe=s(pe,ne,le,he,ye,12,I[9]),he=s(he,pe,ne,le,z,17,I[10]),le=s(le,he,pe,ne,xe,22,I[11]),ne=s(ne,le,he,pe,qe,7,I[12]),pe=s(pe,ne,le,he,Ve,12,I[13]),he=s(he,pe,ne,le,ze,17,I[14]),ne=o(ne,le=s(le,he,pe,ne,Tt,22,I[15]),he,pe,B,5,I[16]),pe=o(pe,ne,le,he,Ye,9,I[17]),he=o(he,pe,ne,le,xe,14,I[18]),le=o(le,he,pe,ne,j,20,I[19]),ne=o(ne,le,he,pe,$e,5,I[20]),pe=o(pe,ne,le,he,z,9,I[21]),he=o(he,pe,ne,le,Tt,14,I[22]),le=o(le,he,pe,ne,ke,20,I[23]),ne=o(ne,le,he,pe,ye,5,I[24]),pe=o(pe,ne,le,he,ze,9,I[25]),he=o(he,pe,ne,le,te,14,I[26]),le=o(le,he,pe,ne,Te,20,I[27]),ne=o(ne,le,he,pe,Ve,5,I[28]),pe=o(pe,ne,le,he,$,9,I[29]),he=o(he,pe,ne,le,me,14,I[30]),ne=u(ne,le=o(le,he,pe,ne,qe,20,I[31]),he,pe,$e,4,I[32]),pe=u(pe,ne,le,he,Te,11,I[33]),he=u(he,pe,ne,le,xe,16,I[34]),le=u(le,he,pe,ne,ze,23,I[35]),ne=u(ne,le,he,pe,B,4,I[36]),pe=u(pe,ne,le,he,ke,11,I[37]),he=u(he,pe,ne,le,me,16,I[38]),le=u(le,he,pe,ne,z,23,I[39]),ne=u(ne,le,he,pe,Ve,4,I[40]),pe=u(pe,ne,le,he,j,11,I[41]),he=u(he,pe,ne,le,te,16,I[42]),le=u(le,he,pe,ne,Ye,23,I[43]),ne=u(ne,le,he,pe,ye,4,I[44]),pe=u(pe,ne,le,he,qe,11,I[45]),he=u(he,pe,ne,le,Tt,16,I[46]),ne=p(ne,le=u(le,he,pe,ne,$,23,I[47]),he,pe,j,6,I[48]),pe=p(pe,ne,le,he,me,10,I[49]),he=p(he,pe,ne,le,ze,15,I[50]),le=p(le,he,pe,ne,$e,21,I[51]),ne=p(ne,le,he,pe,qe,6,I[52]),pe=p(pe,ne,le,he,te,10,I[53]),he=p(he,pe,ne,le,z,15,I[54]),le=p(le,he,pe,ne,B,21,I[55]),ne=p(ne,le,he,pe,Te,6,I[56]),pe=p(pe,ne,le,he,Tt,10,I[57]),he=p(he,pe,ne,le,Ye,15,I[58]),le=p(le,he,pe,ne,Ve,21,I[59]),ne=p(ne,le,he,pe,ke,6,I[60]),pe=p(pe,ne,le,he,xe,10,I[61]),he=p(he,pe,ne,le,$,15,I[62]),le=p(le,he,pe,ne,ye,21,I[63]),Q[0]=Q[0]+ne|0,Q[1]=Q[1]+le|0,Q[2]=Q[2]+he|0,Q[3]=Q[3]+pe|0},_doFinalize:function(){var G=this._data,L=G.words,Q=8*this._nDataBytes,B=8*G.sigBytes;L[B>>>5]|=128<<24-B%32;var j=f.floor(Q/4294967296);for(L[15+(B+64>>>9<<4)]=16711935&(j<<8|j>>>24)|4278255360&(j<<24|j>>>8),L[14+(B+64>>>9<<4)]=16711935&(Q<<8|Q>>>24)|4278255360&(Q<<24|Q>>>8),G.sigBytes=4*(L.length+1),this._process(),L=(G=this._hash).words,Q=0;4>Q;Q++)B=L[Q],L[Q]=16711935&(B<<8|B>>>24)|4278255360&(B<<24|B>>>8);return G},clone:function(){var G=E.clone.call(this);return G._hash=this._hash.clone(),G}}),m.MD5=E._createHelper(A),m.HmacMD5=E._createHmacHelper(A)}(Math),function(){var f,s=C,o=(f=s.lib).Base,u=f.WordArray,p=(f=s.algo).EvpKDF=o.extend({cfg:o.extend({keySize:4,hasher:f.MD5,iterations:1}),init:function(m){this.cfg=this.cfg.extend(m)},compute:function(m,_){for(var E=(G=this.cfg).hasher.create(),A=u.create(),I=A.words,X=G.keySize,G=G.iterations;I.length<X;){L&&E.update(L);var L=E.update(m).finalize(_);E.reset();for(var Q=1;Q<G;Q++)L=E.finalize(L),E.reset();A.concat(L)}return A.sigBytes=4*X,A}});s.EvpKDF=function(m,_,E){return p.create(E).compute(m,_)}}(),C.lib.Cipher||function(){var f=(L=C).lib,s=f.Base,o=f.WordArray,u=f.BufferedBlockAlgorithm,p=L.enc.Base64,m=L.algo.EvpKDF,_=f.Cipher=u.extend({cfg:s.extend(),createEncryptor:function(B,j){return this.create(this._ENC_XFORM_MODE,B,j)},createDecryptor:function(B,j){return this.create(this._DEC_XFORM_MODE,B,j)},init:function(B,j,$){this.cfg=this.cfg.extend($),this._xformMode=B,this._key=j,this.reset()},reset:function(){u.reset.call(this),this._doReset()},process:function(B){return this._append(B),this._process()},finalize:function(B){return B&&this._append(B),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(B){return{encrypt:function(j,$,te){return(typeof $=="string"?Q:G).encrypt(B,j,$,te)},decrypt:function(j,$,te){return(typeof $=="string"?Q:G).decrypt(B,j,$,te)}}}});f.StreamCipher=_.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var E=L.mode={},A=function(B,j,$){var te=this._iv;te?this._iv=void 0:te=this._prevBlock;for(var ke=0;ke<$;ke++)B[j+ke]^=te[ke]},I=(f.BlockCipherMode=s.extend({createEncryptor:function(B,j){return this.Encryptor.create(B,j)},createDecryptor:function(B,j){return this.Decryptor.create(B,j)},init:function(B,j){this._cipher=B,this._iv=j}})).extend();I.Encryptor=I.extend({processBlock:function(B,j){var $=this._cipher,te=$.blockSize;A.call(this,B,j,te),$.encryptBlock(B,j),this._prevBlock=B.slice(j,j+te)}}),I.Decryptor=I.extend({processBlock:function(B,j){var $=this._cipher,te=$.blockSize,ke=B.slice(j,j+te);$.decryptBlock(B,j),A.call(this,B,j,te),this._prevBlock=ke}}),E=E.CBC=I,I=(L.pad={}).Pkcs7={pad:function(B,j){for(var $,te=($=($=4*j)-B.sigBytes%$)<<24|$<<16|$<<8|$,ke=[],$e=0;$e<$;$e+=4)ke.push(te);$=o.create(ke,$),B.concat($)},unpad:function(B){B.sigBytes-=255&B.words[B.sigBytes-1>>>2]}},f.BlockCipher=_.extend({cfg:_.cfg.extend({mode:E,padding:I}),reset:function(){_.reset.call(this);var B=(j=this.cfg).iv,j=j.mode;if(this._xformMode==this._ENC_XFORM_MODE)var $=j.createEncryptor;else $=j.createDecryptor,this._minBufferSize=1;this._mode=$.call(j,this,B&&B.words)},_doProcessBlock:function(B,j){this._mode.processBlock(B,j)},_doFinalize:function(){var B=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){B.pad(this._data,this.blockSize);var j=this._process(!0)}else j=this._process(!0),B.unpad(j);return j},blockSize:4});var X=f.CipherParams=s.extend({init:function(B){this.mixIn(B)},toString:function(B){return(B||this.formatter).stringify(this)}}),G=(E=(L.format={}).OpenSSL={stringify:function(B){var j=B.ciphertext;return((B=B.salt)?o.create([1398893684,1701076831]).concat(B).concat(j):j).toString(p)},parse:function(B){var j=(B=p.parse(B)).words;if(j[0]==1398893684&&j[1]==1701076831){var $=o.create(j.slice(2,4));j.splice(0,4),B.sigBytes-=16}return X.create({ciphertext:B,salt:$})}},f.SerializableCipher=s.extend({cfg:s.extend({format:E}),encrypt:function(B,j,$,te){te=this.cfg.extend(te);var ke=B.createEncryptor($,te);return j=ke.finalize(j),ke=ke.cfg,X.create({ciphertext:j,key:$,iv:ke.iv,algorithm:B,mode:ke.mode,padding:ke.padding,blockSize:B.blockSize,formatter:te.format})},decrypt:function(B,j,$,te){return te=this.cfg.extend(te),j=this._parse(j,te.format),B.createDecryptor($,te).finalize(j.ciphertext)},_parse:function(B,j){return typeof B=="string"?j.parse(B,this):B}})),L=(L.kdf={}).OpenSSL={execute:function(B,j,$,te){return te||(te=o.random(8)),B=m.create({keySize:j+$}).compute(B,te),$=o.create(B.words.slice(j),4*$),B.sigBytes=4*j,X.create({key:B,iv:$,salt:te})}},Q=f.PasswordBasedCipher=G.extend({cfg:G.cfg.extend({kdf:L}),encrypt:function(B,j,$,te){return $=(te=this.cfg.extend(te)).kdf.execute($,B.keySize,B.ivSize),te.iv=$.iv,(B=G.encrypt.call(this,B,j,$.key,te)).mixIn($),B},decrypt:function(B,j,$,te){return te=this.cfg.extend(te),j=this._parse(j,te.format),$=te.kdf.execute($,B.keySize,B.ivSize,j.salt),te.iv=$.iv,G.decrypt.call(this,B,j,$.key,te)}})}(),function(){for(var f=C,s=f.lib.BlockCipher,o=f.algo,u=[],p=[],m=[],_=[],E=[],A=[],I=[],X=[],G=[],L=[],Q=[],B=0;256>B;B++)Q[B]=128>B?B<<1:B<<1^283;var j=0,$=0;for(B=0;256>B;B++){var te=(te=$^$<<1^$<<2^$<<3^$<<4)>>>8^255&te^99;u[j]=te,p[te]=j;var ke=Q[j],$e=Q[ke],Ye=Q[$e],me=257*Q[te]^16843008*te;m[j]=me<<24|me>>>8,_[j]=me<<16|me>>>16,E[j]=me<<8|me>>>24,A[j]=me,me=16843009*Ye^65537*$e^257*ke^16843008*j,I[te]=me<<24|me>>>8,X[te]=me<<16|me>>>16,G[te]=me<<8|me>>>24,L[te]=me,j?(j=ke^Q[Q[Q[Ye^ke]]],$^=Q[Q[$]]):j=$=1}var Te=[0,1,2,4,8,16,32,64,128,27,54];o=o.AES=s.extend({_doReset:function(){for(var ye=(xe=this._key).words,z=xe.sigBytes/4,xe=4*((this._nRounds=z+6)+1),qe=this._keySchedule=[],Ve=0;Ve<xe;Ve++)if(Ve<z)qe[Ve]=ye[Ve];else{var ze=qe[Ve-1];Ve%z?6<z&&Ve%z==4&&(ze=u[ze>>>24]<<24|u[ze>>>16&255]<<16|u[ze>>>8&255]<<8|u[255&ze]):(ze=u[(ze=ze<<8|ze>>>24)>>>24]<<24|u[ze>>>16&255]<<16|u[ze>>>8&255]<<8|u[255&ze],ze^=Te[Ve/z|0]<<24),qe[Ve]=qe[Ve-z]^ze}for(ye=this._invKeySchedule=[],z=0;z<xe;z++)Ve=xe-z,ze=z%4?qe[Ve]:qe[Ve-4],ye[z]=4>z||4>=Ve?ze:I[u[ze>>>24]]^X[u[ze>>>16&255]]^G[u[ze>>>8&255]]^L[u[255&ze]]},encryptBlock:function(ye,z){this._doCryptBlock(ye,z,this._keySchedule,m,_,E,A,u)},decryptBlock:function(ye,z){var xe=ye[z+1];ye[z+1]=ye[z+3],ye[z+3]=xe,this._doCryptBlock(ye,z,this._invKeySchedule,I,X,G,L,p),xe=ye[z+1],ye[z+1]=ye[z+3],ye[z+3]=xe},_doCryptBlock:function(ye,z,xe,qe,Ve,ze,Tt,ne){for(var pe=this._nRounds,he=ye[z]^xe[0],le=ye[z+1]^xe[1],Gt=ye[z+2]^xe[2],Ot=ye[z+3]^xe[3],Wt=4,Ms=1;Ms<pe;Ms++){var ui=qe[he>>>24]^Ve[le>>>16&255]^ze[Gt>>>8&255]^Tt[255&Ot]^xe[Wt++],Ar=qe[le>>>24]^Ve[Gt>>>16&255]^ze[Ot>>>8&255]^Tt[255&he]^xe[Wt++],as=qe[Gt>>>24]^Ve[Ot>>>16&255]^ze[he>>>8&255]^Tt[255&le]^xe[Wt++];Ot=qe[Ot>>>24]^Ve[he>>>16&255]^ze[le>>>8&255]^Tt[255&Gt]^xe[Wt++],he=ui,le=Ar,Gt=as}ui=(ne[he>>>24]<<24|ne[le>>>16&255]<<16|ne[Gt>>>8&255]<<8|ne[255&Ot])^xe[Wt++],Ar=(ne[le>>>24]<<24|ne[Gt>>>16&255]<<16|ne[Ot>>>8&255]<<8|ne[255&he])^xe[Wt++],as=(ne[Gt>>>24]<<24|ne[Ot>>>16&255]<<16|ne[he>>>8&255]<<8|ne[255&le])^xe[Wt++],Ot=(ne[Ot>>>24]<<24|ne[he>>>16&255]<<16|ne[le>>>8&255]<<8|ne[255&Gt])^xe[Wt++],ye[z]=ui,ye[z+1]=Ar,ye[z+2]=as,ye[z+3]=Ot},keySize:8}),f.AES=s._createHelper(o)}(),C.mode.ECB=((J=C.lib.BlockCipherMode.extend()).Encryptor=J.extend({processBlock:function(f,s){this._cipher.encryptBlock(f,s)}}),J.Decryptor=J.extend({processBlock:function(f,s){this._cipher.decryptBlock(f,s)}}),J);var V=r(C);class se{constructor({cipherKey:s}){this.cipherKey=s,this.CryptoJS=V,this.encryptedKey=this.CryptoJS.SHA256(s)}encrypt(s){if((typeof s=="string"?s:se.decoder.decode(s)).length===0)throw new Error("encryption error. empty content");const o=this.getIv();return{metadata:o,data:g(this.CryptoJS.AES.encrypt(s,this.encryptedKey,{iv:this.bufferToWordArray(o),mode:this.CryptoJS.mode.CBC}).ciphertext.toString(this.CryptoJS.enc.Base64))}}encryptFileData(s){return l(this,void 0,void 0,function*(){const o=yield this.getKey(),u=this.getIv();return{data:yield crypto.subtle.encrypt({name:this.algo,iv:u},o,s),metadata:u}})}decrypt(s){if(typeof s.data=="string")throw new Error("Decryption error: data for decryption should be ArrayBuffed.");const o=this.bufferToWordArray(new Uint8ClampedArray(s.metadata)),u=this.bufferToWordArray(new Uint8ClampedArray(s.data));return se.encoder.encode(this.CryptoJS.AES.decrypt({ciphertext:u},this.encryptedKey,{iv:o,mode:this.CryptoJS.mode.CBC}).toString(this.CryptoJS.enc.Utf8)).buffer}decryptFileData(s){return l(this,void 0,void 0,function*(){if(typeof s.data=="string")throw new Error("Decryption error: data for decryption should be ArrayBuffed.");const o=yield this.getKey();return crypto.subtle.decrypt({name:this.algo,iv:s.metadata},o,s.data)})}get identifier(){return"ACRH"}get algo(){return"AES-CBC"}getIv(){return crypto.getRandomValues(new Uint8Array(se.BLOCK_SIZE))}getKey(){return l(this,void 0,void 0,function*(){const s=se.encoder.encode(this.cipherKey),o=yield crypto.subtle.digest("SHA-256",s.buffer);return crypto.subtle.importKey("raw",o,this.algo,!0,["encrypt","decrypt"])})}bufferToWordArray(s){const o=[];let u;for(u=0;u<s.length;u+=1)o[u/4|0]|=s[u]<<24-8*u;return this.CryptoJS.lib.WordArray.create(o,s.length)}}function ae(f){const s=[];let o;for(o=0;o<f.length;o+=1)s[o/4|0]|=f[o]<<24-8*o;return V.lib.WordArray.create(s,f.length)}se.BLOCK_SIZE=16,se.encoder=new TextEncoder,se.decoder=new TextDecoder;class ve{constructor(s){this.configuration=s,this.iv="0123456789012345",this.allowedKeyEncodings=["hex","utf8","base64","binary"],this.allowedKeyLengths=[128,256],this.allowedModes=["ecb","cbc"],this.defaultOptions={encryptKey:!0,keyEncoding:"utf8",keyLength:256,mode:"cbc"}}HMACSHA256(s){return V.HmacSHA256(s,this.configuration.secretKey).toString(V.enc.Base64)}SHA256(s){return V.SHA256(s).toString(V.enc.Hex)}encrypt(s,o,u){return this.configuration.customEncrypt?this.configuration.customEncrypt(s):this.pnEncrypt(s,o,u)}decrypt(s,o,u){return this.configuration.customDecrypt?this.configuration.customDecrypt(s):this.pnDecrypt(s,o,u)}pnEncrypt(s,o,u){const p=o??this.configuration.cipherKey;if(!p)return s;u=this.parseOptions(u);const m=this.getMode(u),_=this.getPaddedKey(p,u);if(this.configuration.useRandomIVs){const A=this.getRandomIV(),I=V.AES.encrypt(s,_,{iv:A,mode:m}).ciphertext;return A.clone().concat(I.clone()).toString(V.enc.Base64)}const E=this.getIV(u);return V.AES.encrypt(s,_,{iv:E,mode:m}).ciphertext.toString(V.enc.Base64)||s}pnDecrypt(s,o,u){const p=o??this.configuration.cipherKey;if(!p)return s;u=this.parseOptions(u);const m=this.getMode(u),_=this.getPaddedKey(p,u);if(this.configuration.useRandomIVs){const E=new Uint8ClampedArray(g(s)),A=ae(E.slice(0,16)),I=ae(E.slice(16));try{const X=V.AES.decrypt({ciphertext:I},_,{iv:A,mode:m}).toString(V.enc.Utf8);return JSON.parse(X)}catch{return null}}else{const E=this.getIV(u);try{const A=V.enc.Base64.parse(s),I=V.AES.decrypt({ciphertext:A},_,{iv:E,mode:m}).toString(V.enc.Utf8);return JSON.parse(I)}catch{return null}}}parseOptions(s){var o,u,p,m;if(!s)return this.defaultOptions;const _={encryptKey:(o=s.encryptKey)!==null&&o!==void 0?o:this.defaultOptions.encryptKey,keyEncoding:(u=s.keyEncoding)!==null&&u!==void 0?u:this.defaultOptions.keyEncoding,keyLength:(p=s.keyLength)!==null&&p!==void 0?p:this.defaultOptions.keyLength,mode:(m=s.mode)!==null&&m!==void 0?m:this.defaultOptions.mode};return this.allowedKeyEncodings.indexOf(_.keyEncoding.toLowerCase())===-1&&(_.keyEncoding=this.defaultOptions.keyEncoding),this.allowedKeyLengths.indexOf(_.keyLength)===-1&&(_.keyLength=this.defaultOptions.keyLength),this.allowedModes.indexOf(_.mode.toLowerCase())===-1&&(_.mode=this.defaultOptions.mode),_}decodeKey(s,o){return o.keyEncoding==="base64"?V.enc.Base64.parse(s):o.keyEncoding==="hex"?V.enc.Hex.parse(s):s}getPaddedKey(s,o){return s=this.decodeKey(s,o),o.encryptKey?V.enc.Utf8.parse(this.SHA256(s).slice(0,32)):s}getMode(s){return s.mode==="ecb"?V.mode.ECB:V.mode.CBC}getIV(s){return s.mode==="cbc"?V.enc.Utf8.parse(this.iv):null}getRandomIV(){return V.lib.WordArray.random(16)}}class H{encrypt(s,o){return l(this,void 0,void 0,function*(){if(!(o instanceof ArrayBuffer)&&typeof o!="string")throw new Error("Cannot encrypt this file. In browsers file encryption supports only string or ArrayBuffer");const u=yield this.getKey(s);return o instanceof ArrayBuffer?this.encryptArrayBuffer(u,o):this.encryptString(u,o)})}encryptArrayBuffer(s,o){return l(this,void 0,void 0,function*(){const u=crypto.getRandomValues(new Uint8Array(16));return this.concatArrayBuffer(u.buffer,yield crypto.subtle.encrypt({name:"AES-CBC",iv:u},s,o))})}encryptString(s,o){return l(this,void 0,void 0,function*(){const u=crypto.getRandomValues(new Uint8Array(16)),p=H.encoder.encode(o).buffer,m=yield crypto.subtle.encrypt({name:"AES-CBC",iv:u},s,p),_=this.concatArrayBuffer(u.buffer,m);return H.decoder.decode(_)})}encryptFile(s,o,u){return l(this,void 0,void 0,function*(){var p,m;if(((p=o.contentLength)!==null&&p!==void 0?p:0)<=0)throw new Error("encryption error. empty content");const _=yield this.getKey(s),E=yield o.toArrayBuffer(),A=yield this.encryptArrayBuffer(_,E);return u.create({name:o.name,mimeType:(m=o.mimeType)!==null&&m!==void 0?m:"application/octet-stream",data:A})})}decrypt(s,o){return l(this,void 0,void 0,function*(){if(!(o instanceof ArrayBuffer)&&typeof o!="string")throw new Error("Cannot decrypt this file. In browsers file decryption supports only string or ArrayBuffer");const u=yield this.getKey(s);return o instanceof ArrayBuffer?this.decryptArrayBuffer(u,o):this.decryptString(u,o)})}decryptArrayBuffer(s,o){return l(this,void 0,void 0,function*(){const u=o.slice(0,16);if(o.slice(H.IV_LENGTH).byteLength<=0)throw new Error("decryption error: empty content");return yield crypto.subtle.decrypt({name:"AES-CBC",iv:u},s,o.slice(H.IV_LENGTH))})}decryptString(s,o){return l(this,void 0,void 0,function*(){const u=H.encoder.encode(o).buffer,p=u.slice(0,16),m=u.slice(16),_=yield crypto.subtle.decrypt({name:"AES-CBC",iv:p},s,m);return H.decoder.decode(_)})}decryptFile(s,o,u){return l(this,void 0,void 0,function*(){const p=yield this.getKey(s),m=yield o.toArrayBuffer(),_=yield this.decryptArrayBuffer(p,m);return u.create({name:o.name,mimeType:o.mimeType,data:_})})}getKey(s){return l(this,void 0,void 0,function*(){const o=yield crypto.subtle.digest("SHA-256",H.encoder.encode(s)),u=Array.from(new Uint8Array(o)).map(m=>m.toString(16).padStart(2,"0")).join(""),p=H.encoder.encode(u.slice(0,32)).buffer;return crypto.subtle.importKey("raw",p,"AES-CBC",!0,["encrypt","decrypt"])})}concatArrayBuffer(s,o){const u=new Uint8Array(s.byteLength+o.byteLength);return u.set(new Uint8Array(s),0),u.set(new Uint8Array(o),s.byteLength),u.buffer}}H.IV_LENGTH=16,H.encoder=new TextEncoder,H.decoder=new TextDecoder;class K{constructor(s){this.config=s,this.cryptor=new ve(Object.assign({},s)),this.fileCryptor=new H}encrypt(s){const o=typeof s=="string"?s:K.decoder.decode(s);return{data:this.cryptor.encrypt(o),metadata:null}}encryptFile(s,o){return l(this,void 0,void 0,function*(){var u;if(!this.config.cipherKey)throw new x("File encryption error: cipher key not set.");return this.fileCryptor.encryptFile((u=this.config)===null||u===void 0?void 0:u.cipherKey,s,o)})}decrypt(s){const o=typeof s.data=="string"?s.data:v(s.data);return this.cryptor.decrypt(o)}decryptFile(s,o){return l(this,void 0,void 0,function*(){if(!this.config.cipherKey)throw new x("File encryption error: cipher key not set.");return this.fileCryptor.decryptFile(this.config.cipherKey,s,o)})}get identifier(){return""}}K.encoder=new TextEncoder,K.decoder=new TextDecoder;class re extends c{static legacyCryptoModule(s){var o;if(!s.cipherKey)throw new x("Crypto module error: cipher key not set.");return new re({default:new K(Object.assign(Object.assign({},s),{useRandomIVs:(o=s.useRandomIVs)===null||o===void 0||o})),cryptors:[new se({cipherKey:s.cipherKey})]})}static aesCbcCryptoModule(s){var o;if(!s.cipherKey)throw new x("Crypto module error: cipher key not set.");return new re({default:new se({cipherKey:s.cipherKey}),cryptors:[new K(Object.assign(Object.assign({},s),{useRandomIVs:(o=s.useRandomIVs)===null||o===void 0||o}))]})}static withDefaultCryptor(s){return new this({default:s})}encrypt(s){const o=s instanceof ArrayBuffer&&this.defaultCryptor.identifier===re.LEGACY_IDENTIFIER?this.defaultCryptor.encrypt(re.decoder.decode(s)):this.defaultCryptor.encrypt(s);if(!o.metadata)return o.data;if(typeof o.data=="string")throw new Error("Encryption error: encrypted data should be ArrayBuffed.");const u=this.getHeaderData(o);return this.concatArrayBuffer(u,o.data)}encryptFile(s,o){return l(this,void 0,void 0,function*(){if(this.defaultCryptor.identifier===oe.LEGACY_IDENTIFIER)return this.defaultCryptor.encryptFile(s,o);const u=yield this.getFileData(s),p=yield this.defaultCryptor.encryptFileData(u);if(typeof p.data=="string")throw new Error("Encryption error: encrypted data should be ArrayBuffed.");return o.create({name:s.name,mimeType:"application/octet-stream",data:this.concatArrayBuffer(this.getHeaderData(p),p.data)})})}decrypt(s){const o=typeof s=="string"?g(s):s,u=oe.tryParse(o),p=this.getCryptor(u),m=u.length>0?o.slice(u.length-u.metadataLength,u.length):null;if(o.slice(u.length).byteLength<=0)throw new Error("Decryption error: empty content");return p.decrypt({data:o.slice(u.length),metadata:m})}decryptFile(s,o){return l(this,void 0,void 0,function*(){const u=yield s.data.arrayBuffer(),p=oe.tryParse(u),m=this.getCryptor(p);if((m==null?void 0:m.identifier)===oe.LEGACY_IDENTIFIER)return m.decryptFile(s,o);const _=(yield this.getFileData(u)).slice(p.length-p.metadataLength,p.length);return o.create({name:s.name,data:yield this.defaultCryptor.decryptFileData({data:u.slice(p.length),metadata:_})})})}getCryptorFromId(s){const o=this.getAllCryptors().find(u=>s===u.identifier);if(o)return o;throw Error("Unknown cryptor error")}getCryptor(s){if(typeof s=="string"){const o=this.getAllCryptors().find(u=>u.identifier===s);if(o)return o;throw new Error("Unknown cryptor error")}if(s instanceof R)return this.getCryptorFromId(s.identifier)}getHeaderData(s){if(!s.metadata)return;const o=oe.from(this.defaultCryptor.identifier,s.metadata),u=new Uint8Array(o.length);let p=0;return u.set(o.data,p),p+=o.length-s.metadata.byteLength,u.set(new Uint8Array(s.metadata),p),u.buffer}concatArrayBuffer(s,o){const u=new Uint8Array(s.byteLength+o.byteLength);return u.set(new Uint8Array(s),0),u.set(new Uint8Array(o),s.byteLength),u.buffer}getFileData(s){return l(this,void 0,void 0,function*(){if(s instanceof ArrayBuffer)return s;if(s instanceof d)return s.toArrayBuffer();throw new Error("Cannot decrypt/encrypt file. In browsers file encrypt/decrypt supported for string, ArrayBuffer or Blob")})}}re.LEGACY_IDENTIFIER="";class oe{static from(s,o){if(s!==oe.LEGACY_IDENTIFIER)return new R(s,o.byteLength)}static tryParse(s){const o=new Uint8Array(s);let u,p,m=null;if(o.byteLength>=4&&(u=o.slice(0,4),this.decoder.decode(u)!==oe.SENTINEL))return re.LEGACY_IDENTIFIER;if(!(o.byteLength>=5))throw new Error("Decryption error: invalid header version");if(m=o[4],m>oe.MAX_VERSION)throw new Error("Decryption error: Unknown cryptor error");let _=5+oe.IDENTIFIER_LENGTH;if(!(o.byteLength>=_))throw new Error("Decryption error: invalid crypto identifier");p=o.slice(5,_);let E=null;if(!(o.byteLength>=_+1))throw new Error("Decryption error: invalid metadata length");return E=o[_],_+=1,E===255&&o.byteLength>=_+2&&(E=new Uint16Array(o.slice(_,_+2)).reduce((A,I)=>(A<<8)+I,0)),new R(this.decoder.decode(p),E)}}oe.SENTINEL="PNED",oe.LEGACY_IDENTIFIER="",oe.IDENTIFIER_LENGTH=4,oe.VERSION=1,oe.MAX_VERSION=1,oe.decoder=new TextDecoder;class R{constructor(s,o){this._identifier=s,this._metadataLength=o}get identifier(){return this._identifier}set identifier(s){this._identifier=s}get metadataLength(){return this._metadataLength}set metadataLength(s){this._metadataLength=s}get version(){return oe.VERSION}get length(){return oe.SENTINEL.length+1+oe.IDENTIFIER_LENGTH+(this.metadataLength<255?1:3)+this.metadataLength}get data(){let s=0;const o=new Uint8Array(this.length),u=new TextEncoder;o.set(u.encode(oe.SENTINEL)),s+=oe.SENTINEL.length,o[s]=this.version,s++,this.identifier&&o.set(u.encode(this.identifier),s);const p=this.metadataLength;return s+=oe.IDENTIFIER_LENGTH,p<255?o[s]=p:o.set([255,p>>8,255&p],s),o}}R.IDENTIFIER_LENGTH=4,R.SENTINEL="PNED";class k extends Error{static create(s,o){return k.isErrorObject(s)?k.createFromError(s):k.createFromServiceResponse(s,o)}static createFromError(s){let o=y.PNUnknownCategory,u="Unknown error",p="Error";if(!s)return new k(u,o,0);if(s instanceof k)return s;if(k.isErrorObject(s)&&(u=s.message,p=s.name),p==="AbortError"||u.indexOf("Aborted")!==-1)o=y.PNCancelledCategory,u="Request cancelled";else if(u.toLowerCase().indexOf("timeout")!==-1)o=y.PNTimeoutCategory,u="Request timeout";else if(u.toLowerCase().indexOf("network")!==-1)o=y.PNNetworkIssuesCategory,u="Network issues";else if(p==="TypeError")o=u.indexOf("Load failed")!==-1||u.indexOf("Failed to fetch")!=-1?y.PNNetworkIssuesCategory:y.PNBadRequestCategory;else if(p==="FetchError"){const m=s.code;["ECONNREFUSED","ENETUNREACH","ENOTFOUND","ECONNRESET","EAI_AGAIN"].includes(m)&&(o=y.PNNetworkIssuesCategory),m==="ECONNREFUSED"?u="Connection refused":m==="ENETUNREACH"?u="Network not reachable":m==="ENOTFOUND"?u="Server not found":m==="ECONNRESET"?u="Connection reset by peer":m==="EAI_AGAIN"?u="Name resolution error":m==="ETIMEDOUT"?(o=y.PNTimeoutCategory,u="Request timeout"):u=`Unknown system error: ${s}`}else u==="Request timeout"&&(o=y.PNTimeoutCategory);return new k(u,o,0,s)}static createFromServiceResponse(s,o){let u,p=y.PNUnknownCategory,m="Unknown error",{status:_}=s;if(o!=null||(o=s.body),_===402?m="Not available for used key set. Contact support@pubnub.com":_===400?(p=y.PNBadRequestCategory,m="Bad request"):_===403&&(p=y.PNAccessDeniedCategory,m="Access denied"),typeof s=="object"&&Object.keys(s).length===0&&(p=y.PNMalformedResponseCategory,m="Malformed response (network issues)",_=400),o&&o.byteLength>0){const E=new TextDecoder().decode(o);if(s.headers["content-type"].indexOf("text/javascript")!==-1||s.headers["content-type"].indexOf("application/json")!==-1)try{const A=JSON.parse(E);typeof A=="object"&&(Array.isArray(A)?typeof A[0]=="number"&&A[0]===0&&A.length>1&&typeof A[1]=="string"&&(u=A[1]):("error"in A&&(A.error===1||A.error===!0)&&"status"in A&&typeof A.status=="number"&&"message"in A&&"service"in A?(u=A,_=A.status):u=A,"error"in A&&A.error instanceof Error&&(u=A.error)))}catch{u=E}else if(s.headers["content-type"].indexOf("xml")!==-1){const A=/<Message>(.*)<\/Message>/gi.exec(E);m=A?`Upload to bucket failed: ${A[1]}`:"Upload to bucket failed."}else u=E}return new k(m,p,_,u)}constructor(s,o,u,p){super(s),this.category=o,this.statusCode=u,this.errorData=p,this.name="PubNubAPIError"}toStatus(s){return{error:!0,category:this.category,operation:s,statusCode:this.statusCode,errorData:this.errorData,toJSON:function(){let o;const u=this.errorData;if(u)try{if(typeof u=="object"){const m=Object.assign(Object.assign(Object.assign(Object.assign({},"name"in u?{name:u.name}:{}),"message"in u?{message:u.message}:{}),"stack"in u?{stack:u.stack}:{}),u);o=JSON.parse(JSON.stringify(m,k.circularReplacer()))}else o=u}catch{o={error:"Could not serialize the error object"}}const p=h(this,["toJSON"]);return JSON.stringify(Object.assign(Object.assign({},p),{errorData:o}))}}}toPubNubError(s,o){return new x(o??this.message,this.toStatus(s))}static circularReplacer(){const s=new WeakSet;return function(o,u){if(typeof u=="object"&&u!==null){if(s.has(u))return"[Circular]";s.add(u)}return u}}static isErrorObject(s){return!(!s||typeof s!="object")&&(s instanceof Error||"name"in s&&"message"in s&&typeof s.name=="string"&&typeof s.message=="string"||Object.prototype.toString.call(s)==="[object Error]")}}class P{constructor(s){this.configuration=s,this.subscriptionWorkerReady=!1,this.accessTokensMap={},this.workerEventsQueue=[],this.callbacks=new Map,this.setupSubscriptionWorker()}terminate(){this.scheduleEventPost({type:"client-unregister",clientIdentifier:this.configuration.clientIdentifier,subscriptionKey:this.configuration.subscriptionKey,logVerbosity:this.configuration.logVerbosity})}makeSendable(s){if(!s.path.startsWith("/v2/subscribe")&&!s.path.endsWith("/heartbeat")&&!s.path.endsWith("/leave"))return this.configuration.transport.makeSendable(s);let o;const u={type:"send-request",clientIdentifier:this.configuration.clientIdentifier,subscriptionKey:this.configuration.subscriptionKey,logVerbosity:this.configuration.logVerbosity,request:s};return s.cancellable&&(o={abort:()=>{const p={type:"cancel-request",clientIdentifier:this.configuration.clientIdentifier,subscriptionKey:this.configuration.subscriptionKey,logVerbosity:this.configuration.logVerbosity,identifier:s.identifier};this.scheduleEventPost(p)}}),[new Promise((p,m)=>{this.callbacks.set(s.identifier,{resolve:p,reject:m}),this.parsedAccessTokenForRequest(s).then(_=>u.token=_).then(()=>this.scheduleEventPost(u))}),o]}request(s){return s}scheduleEventPost(s,o=!1){const u=this.sharedSubscriptionWorker;u?u.port.postMessage(s):o?this.workerEventsQueue.splice(0,0,s):this.workerEventsQueue.push(s)}flushScheduledEvents(){const s=this.sharedSubscriptionWorker;if(!s||this.workerEventsQueue.length===0)return;const o=[];for(let u=0;u<this.workerEventsQueue.length;u++){const p=this.workerEventsQueue[u];if(p.type==="cancel-request"&&u!==0)for(let m=0;m<u;m++){const _=this.workerEventsQueue[m];if(_.type==="send-request"&&_.request.identifier===p.identifier){o.push(p,_);break}}}this.workerEventsQueue=this.workerEventsQueue.filter(u=>!o.includes(u)),this.workerEventsQueue.forEach(u=>s.port.postMessage(u)),this.workerEventsQueue=[]}get sharedSubscriptionWorker(){return this.subscriptionWorkerReady?this.subscriptionWorker:null}setupSubscriptionWorker(){typeof SharedWorker<"u"&&(this.subscriptionWorker=new SharedWorker(this.configuration.workerUrl,`/pubnub-${this.configuration.sdkVersion}`),this.subscriptionWorker.port.start(),this.scheduleEventPost({type:"client-register",clientIdentifier:this.configuration.clientIdentifier,subscriptionKey:this.configuration.subscriptionKey,userId:this.configuration.userId,heartbeatInterval:this.configuration.heartbeatInterval,logVerbosity:this.configuration.logVerbosity,workerOfflineClientsCheckInterval:this.configuration.workerOfflineClientsCheckInterval,workerUnsubscribeOfflineClients:this.configuration.workerUnsubscribeOfflineClients,workerLogVerbosity:this.configuration.workerLogVerbosity},!0),this.subscriptionWorker.port.onmessage=s=>this.handleWorkerEvent(s))}handleWorkerEvent(s){const{data:o}=s;if(o.type==="shared-worker-ping"||o.type==="shared-worker-connected"||o.type==="shared-worker-console-log"||o.type==="shared-worker-console-dir"||o.clientIdentifier===this.configuration.clientIdentifier){if(o.type==="shared-worker-connected")this.subscriptionWorkerReady=!0,this.flushScheduledEvents();else if(o.type==="shared-worker-console-log")console.log(`[SharedWorker] ${o.message}`);else if(o.type==="shared-worker-console-dir")o.message&&console.log(`[SharedWorker] ${o.message}`),console.dir(o.data,{depth:10});else if(o.type==="shared-worker-ping"){const{logVerbosity:u,subscriptionKey:p,clientIdentifier:m}=this.configuration;this.scheduleEventPost({type:"client-pong",subscriptionKey:p,clientIdentifier:m,logVerbosity:u})}else if(o.type==="request-progress-start"||o.type==="request-progress-end")this.logRequestProgress(o);else if(o.type==="request-process-success"||o.type==="request-process-error"){const{resolve:u,reject:p}=this.callbacks.get(o.identifier);if(o.type==="request-process-success")u({status:o.response.status,url:o.url,headers:o.response.headers,body:o.response.body});else{let m=y.PNUnknownCategory,_="Unknown error";if(o.error)o.error.type==="NETWORK_ISSUE"?m=y.PNNetworkIssuesCategory:o.error.type==="TIMEOUT"?m=y.PNTimeoutCategory:o.error.type==="ABORTED"&&(m=y.PNCancelledCategory),_=`${o.error.message} (${o.identifier})`;else if(o.response)return p(k.create({url:o.url,headers:o.response.headers,body:o.response.body,status:o.response.status},o.response.body));p(new k(_,m,0,new Error(_)))}}}}parsedAccessTokenForRequest(s){return l(this,void 0,void 0,function*(){var o;const u=s.queryParameters?(o=s.queryParameters.auth)!==null&&o!==void 0?o:"":void 0;if(u)return this.accessTokensMap[u]?this.accessTokensMap[u]:this.stringifyAccessToken(u).then(([p,m])=>{if(p&&m)return(this.accessTokensMap={[u]:{token:m,expiration:p.timestamp*p.ttl*60}})[u]})})}stringifyAccessToken(s){return l(this,void 0,void 0,function*(){if(!this.configuration.tokenManager)return[void 0,void 0];const o=this.configuration.tokenManager.parseToken(s);if(!o)return[void 0,void 0];const u=m=>m?Object.entries(m).sort(([_],[E])=>_.localeCompare(E)).map(([_,E])=>Object.entries(E||{}).sort(([A],[I])=>A.localeCompare(I)).map(([A,I])=>{return`${_}:${A}=${I?(X=I,Object.entries(X).filter(([G,L])=>L).map(([G])=>G[0]).sort().join("")):""}`;var X}).join(",")).join(";"):"";let p=[u(o.resources),u(o.patterns),o.authorized_uuid].filter(Boolean).join("|");if(typeof crypto<"u"&&crypto.subtle){const m=yield crypto.subtle.digest("SHA-256",new TextEncoder().encode(p));p=String.fromCharCode(...Array.from(new Uint8Array(m)))}return[o,typeof btoa<"u"?btoa(p):p]})}logRequestProgress(s){var o,u;s.type==="request-progress-start"?(console.log("<<<<<"),console.log(`[${s.timestamp}] ${s.url}
${JSON.stringify((o=s.query)!==null&&o!==void 0?o:{})}`),console.log("-----")):(console.log(">>>>>>"),console.log(`[${s.timestamp} / ${s.duration}] ${s.url}
${JSON.stringify((u=s.query)!==null&&u!==void 0?u:{})}
${s.response}`),console.log("-----"))}}function q(f){const s=p=>typeof p=="object"&&p!==null&&p.constructor===Object,o=p=>typeof p=="number"&&isFinite(p);if(!s(f))return f;const u={};return Object.keys(f).forEach(p=>{const m=(A=>typeof A=="string"||A instanceof String)(p);let _=p;const E=f[p];m&&p.indexOf(",")>=0?_=p.split(",").map(Number).reduce((A,I)=>A+String.fromCharCode(I),""):(o(p)||m&&!isNaN(Number(p)))&&(_=String.fromCharCode(o(p)?p:parseInt(p,10))),u[_]=s(E)?q(E):E}),u}const U=f=>{var s,o,u,p,m,_;return f.subscriptionWorkerUrl&&typeof SharedWorker>"u"&&(f.subscriptionWorkerUrl=null),Object.assign(Object.assign({},(E=>{var A,I,X,G,L,Q,B,j,$,te,ke,$e,Ye,me,Te,ye;const z=Object.assign({},E);if((A=z.logVerbosity)!==null&&A!==void 0||(z.logVerbosity=!1),(I=z.ssl)!==null&&I!==void 0||(z.ssl=!0),(X=z.transactionalRequestTimeout)!==null&&X!==void 0||(z.transactionalRequestTimeout=15),(G=z.subscribeRequestTimeout)!==null&&G!==void 0||(z.subscribeRequestTimeout=310),(L=z.fileRequestTimeout)!==null&&L!==void 0||(z.fileRequestTimeout=300),(Q=z.restore)!==null&&Q!==void 0||(z.restore=!1),(B=z.useInstanceId)!==null&&B!==void 0||(z.useInstanceId=!1),(j=z.suppressLeaveEvents)!==null&&j!==void 0||(z.suppressLeaveEvents=!1),($=z.requestMessageCountThreshold)!==null&&$!==void 0||(z.requestMessageCountThreshold=100),(te=z.autoNetworkDetection)!==null&&te!==void 0||(z.autoNetworkDetection=!1),(ke=z.enableEventEngine)!==null&&ke!==void 0||(z.enableEventEngine=!1),($e=z.maintainPresenceState)!==null&&$e!==void 0||(z.maintainPresenceState=!0),(Ye=z.useSmartHeartbeat)!==null&&Ye!==void 0||(z.useSmartHeartbeat=!1),(me=z.keepAlive)!==null&&me!==void 0||(z.keepAlive=!1),z.userId&&z.uuid)throw new x("PubNub client configuration error: use only 'userId'");if((Te=z.userId)!==null&&Te!==void 0||(z.userId=z.uuid),!z.userId)throw new x("PubNub client configuration error: 'userId' not set");if(((ye=z.userId)===null||ye===void 0?void 0:ye.trim().length)===0)throw new x("PubNub client configuration error: 'userId' is empty");z.origin||(z.origin=Array.from({length:20},(he,le)=>`ps${le+1}.pndsn.com`));const xe={subscribeKey:z.subscribeKey,publishKey:z.publishKey,secretKey:z.secretKey};z.presenceTimeout!==void 0&&(z.presenceTimeout>320?(z.presenceTimeout=320,console.warn("WARNING: Presence timeout is larger than the maximum. Using maximum value: ",320)):z.presenceTimeout<=0&&(console.warn("WARNING: Presence timeout should be larger than zero."),delete z.presenceTimeout)),z.presenceTimeout!==void 0?z.heartbeatInterval=z.presenceTimeout/2-1:z.presenceTimeout=300;let qe=!1,Ve=!0,ze=5,Tt=!1,ne=100,pe=!0;return z.dedupeOnSubscribe!==void 0&&typeof z.dedupeOnSubscribe=="boolean"&&(Tt=z.dedupeOnSubscribe),z.maximumCacheSize!==void 0&&typeof z.maximumCacheSize=="number"&&(ne=z.maximumCacheSize),z.useRequestId!==void 0&&typeof z.useRequestId=="boolean"&&(pe=z.useRequestId),z.announceSuccessfulHeartbeats!==void 0&&typeof z.announceSuccessfulHeartbeats=="boolean"&&(qe=z.announceSuccessfulHeartbeats),z.announceFailedHeartbeats!==void 0&&typeof z.announceFailedHeartbeats=="boolean"&&(Ve=z.announceFailedHeartbeats),z.fileUploadPublishRetryLimit!==void 0&&typeof z.fileUploadPublishRetryLimit=="number"&&(ze=z.fileUploadPublishRetryLimit),Object.assign(Object.assign({},z),{keySet:xe,dedupeOnSubscribe:Tt,maximumCacheSize:ne,useRequestId:pe,announceSuccessfulHeartbeats:qe,announceFailedHeartbeats:Ve,fileUploadPublishRetryLimit:ze})})(f)),{listenToBrowserNetworkEvents:(s=f.listenToBrowserNetworkEvents)===null||s===void 0||s,subscriptionWorkerUrl:f.subscriptionWorkerUrl,subscriptionWorkerOfflineClientsCheckInterval:(o=f.subscriptionWorkerOfflineClientsCheckInterval)!==null&&o!==void 0?o:10,subscriptionWorkerUnsubscribeOfflineClients:(u=f.subscriptionWorkerUnsubscribeOfflineClients)!==null&&u!==void 0&&u,subscriptionWorkerLogVerbosity:(p=f.subscriptionWorkerLogVerbosity)!==null&&p!==void 0&&p,transport:(m=f.transport)!==null&&m!==void 0?m:"fetch",keepAlive:(_=f.keepAlive)===null||_===void 0||_})};var D;(function(f){f.Unknown="UnknownEndpoint",f.MessageSend="MessageSendEndpoint",f.Subscribe="SubscribeEndpoint",f.Presence="PresenceEndpoint",f.Files="FilesEndpoint",f.MessageStorage="MessageStorageEndpoint",f.ChannelGroups="ChannelGroupsEndpoint",f.DevicePushNotifications="DevicePushNotificationsEndpoint",f.AppContext="AppContextEndpoint",f.MessageReactions="MessageReactionsEndpoint"})(D||(D={}));class Z{static None(){return{shouldRetry:(s,o,u,p)=>!1,getDelay:(s,o)=>-1,validate:()=>!0}}static LinearRetryPolicy(s){var o;return{delay:s.delay,maximumRetry:s.maximumRetry,excluded:(o=s.excluded)!==null&&o!==void 0?o:[],shouldRetry(u,p,m,_){return Y(u,p,m,_??0,this.maximumRetry,this.excluded)},getDelay(u,p){let m=-1;return p&&p.headers["retry-after"]!==void 0&&(m=parseInt(p.headers["retry-after"],10)),m===-1&&(m=this.delay),1e3*(m+Math.random())},validate(){if(this.delay<2)throw new Error("Delay can not be set less than 2 seconds for retry");if(this.maximumRetry>10)throw new Error("Maximum retry for linear retry policy can not be more than 10")}}}static ExponentialRetryPolicy(s){var o;return{minimumDelay:s.minimumDelay,maximumDelay:s.maximumDelay,maximumRetry:s.maximumRetry,excluded:(o=s.excluded)!==null&&o!==void 0?o:[],shouldRetry(u,p,m,_){return Y(u,p,m,_??0,this.maximumRetry,this.excluded)},getDelay(u,p){let m=-1;return p&&p.headers["retry-after"]!==void 0&&(m=parseInt(p.headers["retry-after"],10)),m===-1&&(m=Math.min(Math.pow(2,u),this.maximumDelay)),1e3*(m+Math.random())},validate(){if(this.minimumDelay<2)throw new Error("Minimum delay can not be set less than 2 seconds for retry");if(this.maximumDelay>150)throw new Error("Maximum delay can not be set more than 150 seconds for retry");if(this.maximumRetry>6)throw new Error("Maximum retry for exponential retry policy can not be more than 6")}}}}const Y=(f,s,o,u,p,m)=>(!o||o!==y.PNCancelledCategory&&o!==y.PNBadRequestCategory&&o!==y.PNAccessDeniedCategory)&&!ie(f,m)&&!(u>p)&&(!s||s.status===429||s.status>=500),ie=(f,s)=>!!(s&&s.length>0)&&s.includes(ue(f)),ue=f=>{let s=D.Unknown;return f.path.startsWith("/v2/subscribe")?s=D.Subscribe:f.path.startsWith("/publish/")||f.path.startsWith("/signal/")?s=D.MessageSend:f.path.startsWith("/v2/presence")?s=D.Presence:f.path.startsWith("/v2/history")||f.path.startsWith("/v3/history")?s=D.MessageStorage:f.path.startsWith("/v1/message-actions/")?s=D.MessageReactions:f.path.startsWith("/v1/channel-registration/")||f.path.startsWith("/v2/objects/")?s=D.ChannelGroups:f.path.startsWith("/v1/push/")||f.path.startsWith("/v2/push/")?s=D.DevicePushNotifications:f.path.startsWith("/v1/files/")&&(s=D.Files),s};var _e={exports:{}};/*! lil-uuid - v0.1 - MIT License - https://github.com/lil-js/uuid */(function(f,s){(function(o){var u="0.1.0",p={3:/^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,4:/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,5:/^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,all:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i};function m(){var E,A,I="";for(E=0;E<32;E++)A=16*Math.random()|0,E!==8&&E!==12&&E!==16&&E!==20||(I+="-"),I+=(E===12?4:E===16?3&A|8:A).toString(16);return I}function _(E,A){var I=p[A||"all"];return I&&I.test(E)||!1}m.isUUID=_,m.VERSION=u,o.uuid=m,o.isUUID=_})(s),f!==null&&(f.exports=s.uuid)})(_e,_e.exports);var Ee=r(_e.exports),Ce={createUUID:()=>Ee.uuid?Ee.uuid():Ee()};const De=(f,s)=>{var o,u,p;!f.retryConfiguration&&f.enableEventEngine&&(f.retryConfiguration=Z.ExponentialRetryPolicy({minimumDelay:2,maximumDelay:150,maximumRetry:6,excluded:[D.MessageSend,D.Presence,D.Files,D.MessageStorage,D.ChannelGroups,D.DevicePushNotifications,D.AppContext,D.MessageReactions]})),(o=f.retryConfiguration)===null||o===void 0||o.validate(),(u=f.useRandomIVs)!==null&&u!==void 0||(f.useRandomIVs=!0),f.origin=ce((p=f.ssl)!==null&&p!==void 0&&p,f.origin);const m=f.cryptoModule;m&&delete f.cryptoModule;const _=Object.assign(Object.assign({},f),{_pnsdkSuffix:{},_instanceId:`pn-${Ce.createUUID()}`,_cryptoModule:void 0,_cipherKey:void 0,_setupCryptoModule:s,get instanceId(){if(this.useInstanceId)return this._instanceId},getInstanceId(){if(this.useInstanceId)return this._instanceId},getUserId(){return this.userId},setUserId(E){if(!E||typeof E!="string"||E.trim().length===0)throw new Error("Missing or invalid userId parameter. Provide a valid string userId");this.userId=E},getAuthKey(){return this.authKey},setAuthKey(E){this.authKey=E},getFilterExpression(){return this.filterExpression},setFilterExpression(E){this.filterExpression=E},getCipherKey(){return this._cipherKey},setCipherKey(E){this._cipherKey=E,E||!this._cryptoModule?E&&this._setupCryptoModule&&(this._cryptoModule=this._setupCryptoModule({cipherKey:E,useRandomIVs:f.useRandomIVs,customEncrypt:this.getCustomEncrypt(),customDecrypt:this.getCustomDecrypt()})):this._cryptoModule=void 0},getCryptoModule(){return this._cryptoModule},getUseRandomIVs:()=>f.useRandomIVs,getKeepPresenceChannelsInPresenceRequests:()=>f.sdkFamily==="Web"&&f.subscriptionWorkerUrl,setPresenceTimeout(E){this.heartbeatInterval=E/2-1,this.presenceTimeout=E},getPresenceTimeout(){return this.presenceTimeout},getHeartbeatInterval(){return this.heartbeatInterval},setHeartbeatInterval(E){this.heartbeatInterval=E},getTransactionTimeout(){return this.transactionalRequestTimeout},getSubscribeTimeout(){return this.subscribeRequestTimeout},getFileTimeout(){return this.fileRequestTimeout},get PubNubFile(){return f.PubNubFile},get version(){return"9.5.2"},getVersion(){return this.version},_addPnsdkSuffix(E,A){this._pnsdkSuffix[E]=`${A}`},_getPnsdkSuffix(E){const A=Object.values(this._pnsdkSuffix).join(E);return A.length>0?E+A:""},getUUID(){return this.getUserId()},setUUID(E){this.setUserId(E)},getCustomEncrypt:()=>f.customEncrypt,getCustomDecrypt:()=>f.customDecrypt});return f.cipherKey?_.setCipherKey(f.cipherKey):m&&(_._cryptoModule=m),_},ce=(f,s)=>{const o=f?"https://":"http://";return typeof s=="string"?`${o}${s}`:`${o}${s[Math.floor(Math.random()*s.length)]}`};class Pe{constructor(s){this.cbor=s}setToken(s){s&&s.length>0?this.token=s:this.token=void 0}getToken(){return this.token}parseToken(s){const o=this.cbor.decodeToken(s);if(o!==void 0){const u=o.res.uuid?Object.keys(o.res.uuid):[],p=Object.keys(o.res.chan),m=Object.keys(o.res.grp),_=o.pat.uuid?Object.keys(o.pat.uuid):[],E=Object.keys(o.pat.chan),A=Object.keys(o.pat.grp),I={version:o.v,timestamp:o.t,ttl:o.ttl,authorized_uuid:o.uuid,signature:o.sig},X=u.length>0,G=p.length>0,L=m.length>0;if(X||G||L){if(I.resources={},X){const $=I.resources.uuids={};u.forEach(te=>$[te]=this.extractPermissions(o.res.uuid[te]))}if(G){const $=I.resources.channels={};p.forEach(te=>$[te]=this.extractPermissions(o.res.chan[te]))}if(L){const $=I.resources.groups={};m.forEach(te=>$[te]=this.extractPermissions(o.res.grp[te]))}}const Q=_.length>0,B=E.length>0,j=A.length>0;if(Q||B||j){if(I.patterns={},Q){const $=I.patterns.uuids={};_.forEach(te=>$[te]=this.extractPermissions(o.pat.uuid[te]))}if(B){const $=I.patterns.channels={};E.forEach(te=>$[te]=this.extractPermissions(o.pat.chan[te]))}if(j){const $=I.patterns.groups={};A.forEach(te=>$[te]=this.extractPermissions(o.pat.grp[te]))}}return o.meta&&Object.keys(o.meta).length>0&&(I.meta=o.meta),I}}extractPermissions(s){const o={read:!1,write:!1,manage:!1,delete:!1,get:!1,update:!1,join:!1};return 128&~s||(o.join=!0),64&~s||(o.update=!0),32&~s||(o.get=!0),8&~s||(o.delete=!0),4&~s||(o.manage=!0),2&~s||(o.write=!0),1&~s||(o.read=!0),o}}var ge;(function(f){f.GET="GET",f.POST="POST",f.PATCH="PATCH",f.DELETE="DELETE",f.LOCAL="LOCAL"})(ge||(ge={}));const fe=f=>encodeURIComponent(f).replace(/[!~*'()]/g,s=>`%${s.charCodeAt(0).toString(16).toUpperCase()}`),Ue=(f,s)=>{const o=f.map(u=>fe(u));return o.length?o.join(","):s??""},Ie=(f,s)=>{const o=Object.fromEntries(s.map(u=>[u,!1]));return f.filter(u=>!(s.includes(u)&&!o[u])||(o[u]=!0,!1))},Oe=(f,s)=>[...f].filter(o=>s.includes(o)&&f.indexOf(o)===f.lastIndexOf(o)&&s.indexOf(o)===s.lastIndexOf(o));class rt{constructor(s,o,u){this.publishKey=s,this.secretKey=o,this.hasher=u}signature(s){const o=s.path.startsWith("/publish")?ge.GET:s.method;let u=`${o}
${this.publishKey}
${s.path}
${this.queryParameters(s.queryParameters)}
`;if(o===ge.POST||o===ge.PATCH){const p=s.body;let m;p&&p instanceof ArrayBuffer?m=rt.textDecoder.decode(p):p&&typeof p!="object"&&(m=p),m&&(u+=m)}return`v2.${this.hasher(u,this.secretKey)}`.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}queryParameters(s){return Object.keys(s).sort().map(o=>{const u=s[o];return Array.isArray(u)?u.sort().map(p=>`${o}=${fe(p)}`).join("&"):`${o}=${fe(u)}`}).join("&")}}rt.textDecoder=new TextDecoder("utf-8");class ht{constructor(s){this.configuration=s;const{clientConfiguration:{keySet:o},shaHMAC:u}=s;o.secretKey&&u&&(this.signatureGenerator=new rt(o.publishKey,o.secretKey,u))}makeSendable(s){const o=this.configuration.clientConfiguration.retryConfiguration,u=this.configuration.transport;if(o!==void 0){let p,m,_=!1,E=0;const A={abort:I=>{_=!0,p&&clearTimeout(p),m&&m.abort(I)}};return[new Promise((I,X)=>{const G=()=>{if(_)return;const[L,Q]=u.makeSendable(this.request(s));m=Q;const B=(j,$)=>{const te=!$||$.category!==y.PNCancelledCategory,ke=!j||j.status>=400;let $e=-1;te&&ke&&o.shouldRetry(s,j,$==null?void 0:$.category,E+1)&&($e=o.getDelay(E,j)),$e>0?(E++,p=setTimeout(()=>G(),$e)):j?I(j):$&&X($)};L.then(j=>B(j)).catch(j=>B(void 0,j))};G()}),m?A:void 0]}return u.makeSendable(this.request(s))}request(s){var o;const{clientConfiguration:u}=this.configuration;return(s=this.configuration.transport.request(s)).queryParameters||(s.queryParameters={}),u.useInstanceId&&(s.queryParameters.instanceid=u.getInstanceId()),s.queryParameters.uuid||(s.queryParameters.uuid=u.userId),u.useRequestId&&(s.queryParameters.requestid=s.identifier),s.queryParameters.pnsdk=this.generatePNSDK(),(o=s.origin)!==null&&o!==void 0||(s.origin=u.origin),this.authenticateRequest(s),this.signRequest(s),s}authenticateRequest(s){var o;if(s.path.startsWith("/v2/auth/")||s.path.startsWith("/v3/pam/")||s.path.startsWith("/time"))return;const{clientConfiguration:u,tokenManager:p}=this.configuration,m=(o=p&&p.getToken())!==null&&o!==void 0?o:u.authKey;m&&(s.queryParameters.auth=m)}signRequest(s){this.signatureGenerator&&!s.path.startsWith("/time")&&(s.queryParameters.timestamp=String(Math.floor(new Date().getTime()/1e3)),s.queryParameters.signature=this.signatureGenerator.signature(s))}generatePNSDK(){const{clientConfiguration:s}=this.configuration;if(s.sdkName)return s.sdkName;let o=`PubNub-JS-${s.sdkFamily}`;s.partnerId&&(o+=`-${s.partnerId}`),o+=`/${s.getVersion()}`;const u=s._getPnsdkSuffix(" ");return u.length>0&&(o+=u),o}}class pt{constructor(s="fetch",o=!1,u=!1){if(this.transport=s,this.keepAlive=o,this.logVerbosity=u,s!=="fetch"||window&&window.fetch||(this.transport="xhr"),this.transport==="fetch"&&(pt.originalFetch=fetch.bind(window),this.isFetchMonkeyPatched())){if(pt.originalFetch=pt.getOriginalFetch(),!u)return;console.warn("[PubNub] Native Web Fetch API 'fetch' function monkey patched."),this.isFetchMonkeyPatched(pt.originalFetch)?console.warn("[PubNub] Unable receive native Web Fetch API. There can be issues with subscribe long-poll cancellation"):console.info("[PubNub] Use native Web Fetch API 'fetch' implementation from iframe as APM workaround.")}}makeSendable(s){const o=new AbortController,u={abortController:o,abort:p=>!o.signal.aborted&&o.abort(p)};return[this.webTransportRequestFromTransportRequest(s).then(p=>{const m=new Date().getTime();return this.logRequestProcessProgress(p,s.body),this.sendRequest(p,u).then(_=>_.arrayBuffer().then(E=>[_,E])).then(_=>{const E=_[1].byteLength>0?_[1]:void 0,{status:A,headers:I}=_[0],X={};I.forEach((L,Q)=>X[Q]=L.toLowerCase());const G={status:A,url:p.url,headers:X,body:E};if(A>=400)throw k.create(G);return this.logRequestProcessProgress(p,void 0,new Date().getTime()-m,E),G}).catch(_=>{let E=_;if(typeof _=="string"){const A=_.toLowerCase();E=new Error(_),!A.includes("timeout")&&A.includes("cancel")&&(E.name="AbortError")}throw k.create(E)})}),u]}request(s){return s}sendRequest(s,o){return l(this,void 0,void 0,function*(){return this.transport==="fetch"?this.sendFetchRequest(s,o):this.sendXHRRequest(s,o)})}sendFetchRequest(s,o){return l(this,void 0,void 0,function*(){let u;const p=new Promise((_,E)=>{u=setTimeout(()=>{clearTimeout(u),E(new Error("Request timeout")),o.abort("Cancel because of timeout")},1e3*s.timeout)}),m=new Request(s.url,{method:s.method,headers:s.headers,redirect:"follow",body:s.body});return Promise.race([pt.originalFetch(m,{signal:o.abortController.signal,credentials:"omit",cache:"no-cache"}).then(_=>(u&&clearTimeout(u),_)),p])})}sendXHRRequest(s,o){return l(this,void 0,void 0,function*(){return new Promise((u,p)=>{var m;const _=new XMLHttpRequest;_.open(s.method,s.url,!0),_.responseType="arraybuffer",_.timeout=1e3*s.timeout,o.abortController.signal.onabort=()=>{_.readyState!=XMLHttpRequest.DONE&&_.readyState!=XMLHttpRequest.UNSENT&&_.abort()},Object.entries((m=s.headers)!==null&&m!==void 0?m:{}).forEach(([E,A])=>_.setRequestHeader(E,A)),_.onabort=()=>p(new Error("Aborted")),_.ontimeout=()=>p(new Error("Request timeout")),_.onerror=()=>p(new Error("Request timeout")),_.onload=()=>{const E=new Headers;_.getAllResponseHeaders().split(`\r
`).forEach(A=>{const[I,X]=A.split(": ");I.length>1&&X.length>1&&E.append(I,X)}),u(new Response(_.response,{status:_.status,headers:E,statusText:_.statusText}))},_.send(s.body)})})}webTransportRequestFromTransportRequest(s){return l(this,void 0,void 0,function*(){let o,u=s.path;if(s.formData&&s.formData.length>0){s.queryParameters={};const m=s.body,_=new FormData;for(const{key:E,value:A}of s.formData)_.append(E,A);try{const E=yield m.toArrayBuffer();_.append("file",new Blob([E],{type:"application/octet-stream"}),m.name)}catch{try{const A=yield m.toFileUri();_.append("file",A,m.name)}catch{}}o=_}else if(s.body&&(typeof s.body=="string"||s.body instanceof ArrayBuffer))if(s.compressible&&typeof CompressionStream<"u"){const m=new ReadableStream({start(_){_.enqueue(typeof s.body=="string"?pt.encoder.encode(s.body):s.body),_.close()}});o=yield new Response(m.pipeThrough(new CompressionStream("deflate"))).arrayBuffer()}else o=s.body;var p;return s.queryParameters&&Object.keys(s.queryParameters).length!==0&&(u=`${u}?${p=s.queryParameters,Object.keys(p).map(m=>{const _=p[m];return Array.isArray(_)?_.map(E=>`${m}=${fe(E)}`).join("&"):`${m}=${fe(_)}`}).join("&")}`),{url:`${s.origin}${u}`,method:s.method,headers:s.headers,timeout:s.timeout,body:o}})}logRequestProcessProgress(s,o,u,p){if(!this.logVerbosity)return;const{protocol:m,host:_,pathname:E,search:A}=new URL(s.url),I=new Date().toISOString();if(u){let X=`[${I} / ${u}]
${m}//${_}${E}
${A}`;p&&(X+=`

${pt.decoder.decode(p)}`),console.log(">>>>>>"),console.log(X),console.log("-----")}else{let X=`[${I}]
${m}//${_}${E}
${A}`;o&&(typeof o=="string"||o instanceof ArrayBuffer)&&(X+=typeof o=="string"?`

${o}`:`

${pt.decoder.decode(o)}`),console.log("<<<<<"),console.log(X),console.log("-----")}}isFetchMonkeyPatched(s){return!(s??fetch).toString().includes("[native code]")&&fetch.name!=="fetch"}static getOriginalFetch(){let s=document.querySelector('iframe[name="pubnub-context-unpatched-fetch"]');return s||(s=document.createElement("iframe"),s.style.display="none",s.name="pubnub-context-unpatched-fetch",s.src="about:blank",document.body.appendChild(s)),s.contentWindow?s.contentWindow.fetch.bind(s.contentWindow):fetch}}pt.encoder=new TextEncoder,pt.decoder=new TextDecoder;class sr{constructor(){this.listeners=[]}addListener(s){this.listeners.push(s)}removeListener(s){const o=this.listeners.indexOf(s);o!==-1&&this.listeners.splice(o,1)}removeAllListeners(){this.listeners=[]}announceStatus(s){this.listeners.forEach(o=>{o.status&&o.status(s)})}announcePresence(s){this.listeners.forEach(o=>{o.presence&&o.presence(s)})}announceMessage(s){this.listeners.forEach(o=>{o.message&&o.message(s)})}announceSignal(s){this.listeners.forEach(o=>{o.signal&&o.signal(s)})}announceMessageAction(s){this.listeners.forEach(o=>{o.messageAction&&o.messageAction(s)})}announceFile(s){this.listeners.forEach(o=>{o.file&&o.file(s)})}announceObjects(s){this.listeners.forEach(o=>{o.objects&&o.objects(s)})}announceNetworkUp(){this.listeners.forEach(s=>{s.status&&s.status({category:y.PNNetworkUpCategory})})}announceNetworkDown(){this.listeners.forEach(s=>{s.status&&s.status({category:y.PNNetworkDownCategory})})}announceUser(s){this.listeners.forEach(o=>{o.user&&o.user(s)})}announceSpace(s){this.listeners.forEach(o=>{o.space&&o.space(s)})}announceMembership(s){this.listeners.forEach(o=>{o.membership&&o.membership(s)})}}class Mt{constructor(s){this.time=s}onReconnect(s){this.callback=s}startPolling(){this.timeTimer=setInterval(()=>this.callTime(),3e3)}stopPolling(){this.timeTimer&&clearInterval(this.timeTimer),this.timeTimer=null}callTime(){this.time(s=>{s.error||(this.stopPolling(),this.callback&&this.callback())})}}class Br{constructor({maximumCacheSize:s}){this.maximumCacheSize=s,this.hashHistory=[]}getKey(s){var o;return`${s.timetoken}-${this.hashCode(JSON.stringify((o=s.message)!==null&&o!==void 0?o:"")).toString()}`}isDuplicate(s){return this.hashHistory.includes(this.getKey(s))}addEntry(s){this.hashHistory.length>=this.maximumCacheSize&&this.hashHistory.shift(),this.hashHistory.push(this.getKey(s))}clearHistory(){this.hashHistory=[]}hashCode(s){let o=0;if(s.length===0)return o;for(let u=0;u<s.length;u+=1)o=(o<<5)-o+s.charCodeAt(u),o|=0;return o}}class Lr{constructor(s,o,u,p,m,_,E){this.configuration=s,this.listenerManager=o,this.eventEmitter=u,this.subscribeCall=p,this.heartbeatCall=m,this.leaveCall=_,this.reconnectionManager=new Mt(E),this.dedupingManager=new Br(this.configuration),this.heartbeatChannelGroups={},this.heartbeatChannels={},this.presenceChannelGroups={},this.presenceChannels={},this.heartbeatTimer=null,this.presenceState={},this.pendingChannelGroupSubscriptions=new Set,this.pendingChannelSubscriptions=new Set,this.channelGroups={},this.channels={},this.currentTimetoken="0",this.lastTimetoken="0",this.storedTimetoken=null,this.subscriptionStatusAnnounced=!1,this.isOnline=!0}get subscribedChannels(){return Object.keys(this.channels)}get subscribedChannelGroups(){return Object.keys(this.channelGroups)}get abort(){return this._subscribeAbort}set abort(s){this._subscribeAbort=s}disconnect(){this.stopSubscribeLoop(),this.stopHeartbeatTimer(),this.reconnectionManager.stopPolling()}reconnect(s=!1){this.startSubscribeLoop(s),s||this.configuration.useSmartHeartbeat||this.startHeartbeatTimer()}subscribe(s){const{channels:o,channelGroups:u,timetoken:p,withPresence:m=!1,withHeartbeats:_=!1}=s;p&&(this.lastTimetoken=this.currentTimetoken,this.currentTimetoken=p),this.currentTimetoken!=="0"&&this.currentTimetoken!==0&&(this.storedTimetoken=this.currentTimetoken,this.currentTimetoken=0),o==null||o.forEach(E=>{this.pendingChannelSubscriptions.add(E),this.channels[E]={},m&&(this.presenceChannels[E]={}),(_||this.configuration.getHeartbeatInterval())&&(this.heartbeatChannels[E]={})}),u==null||u.forEach(E=>{this.pendingChannelGroupSubscriptions.add(E),this.channelGroups[E]={},m&&(this.presenceChannelGroups[E]={}),(_||this.configuration.getHeartbeatInterval())&&(this.heartbeatChannelGroups[E]={})}),this.subscriptionStatusAnnounced=!1,this.reconnect()}unsubscribe(s,o){let{channels:u,channelGroups:p}=s;const m=new Set,_=new Set;u==null||u.forEach(E=>{E in this.channels&&(delete this.channels[E],_.add(E),E in this.heartbeatChannels&&delete this.heartbeatChannels[E]),E in this.presenceState&&delete this.presenceState[E],E in this.presenceChannels&&(delete this.presenceChannels[E],_.add(E))}),p==null||p.forEach(E=>{E in this.channelGroups&&(delete this.channelGroups[E],m.add(E),E in this.heartbeatChannelGroups&&delete this.heartbeatChannelGroups[E]),E in this.presenceState&&delete this.presenceState[E],E in this.presenceChannelGroups&&(delete this.presenceChannelGroups[E],m.add(E))}),_.size===0&&m.size===0||(this.configuration.suppressLeaveEvents!==!1||o||(p=Array.from(m),u=Array.from(_),this.leaveCall({channels:u,channelGroups:p},E=>{const{error:A}=E,I=h(E,["error"]);let X;A&&(E.errorData&&typeof E.errorData=="object"&&"message"in E.errorData&&typeof E.errorData.message=="string"?X=E.errorData.message:"message"in E&&typeof E.message=="string"&&(X=E.message)),this.listenerManager.announceStatus(Object.assign(Object.assign({},I),{error:X!=null&&X,affectedChannels:u,affectedChannelGroups:p,currentTimetoken:this.currentTimetoken,lastTimetoken:this.lastTimetoken}))})),Object.keys(this.channels).length===0&&Object.keys(this.presenceChannels).length===0&&Object.keys(this.channelGroups).length===0&&Object.keys(this.presenceChannelGroups).length===0&&(this.lastTimetoken=0,this.currentTimetoken=0,this.storedTimetoken=null,this.region=null,this.reconnectionManager.stopPolling()),this.reconnect(!0))}unsubscribeAll(s){this.unsubscribe({channels:this.subscribedChannels,channelGroups:this.subscribedChannelGroups},s)}startSubscribeLoop(s=!1){this.stopSubscribeLoop();const o=[...Object.keys(this.channelGroups)],u=[...Object.keys(this.channels)];Object.keys(this.presenceChannelGroups).forEach(p=>o.push(`${p}-pnpres`)),Object.keys(this.presenceChannels).forEach(p=>u.push(`${p}-pnpres`)),u.length===0&&o.length===0||(this.subscribeCall({channels:u,channelGroups:o,state:this.presenceState,heartbeat:this.configuration.getPresenceTimeout(),timetoken:this.currentTimetoken,region:this.region!==null?this.region:void 0,filterExpression:this.configuration.filterExpression},(p,m)=>{this.processSubscribeResponse(p,m)}),!s&&this.configuration.useSmartHeartbeat&&this.startHeartbeatTimer())}stopSubscribeLoop(){this._subscribeAbort&&(this._subscribeAbort(),this._subscribeAbort=null)}processSubscribeResponse(s,o){if(s.error)return typeof s.errorData=="object"&&"name"in s.errorData&&s.errorData.name==="AbortError"||s.category===y.PNCancelledCategory?void 0:void(s.category===y.PNTimeoutCategory?this.startSubscribeLoop():s.category===y.PNNetworkIssuesCategory||s.category===y.PNMalformedResponseCategory?(this.disconnect(),s.error&&this.configuration.autoNetworkDetection&&this.isOnline&&(this.isOnline=!1,this.listenerManager.announceNetworkDown()),this.reconnectionManager.onReconnect(()=>{this.configuration.autoNetworkDetection&&!this.isOnline&&(this.isOnline=!0,this.listenerManager.announceNetworkUp()),this.reconnect(),this.subscriptionStatusAnnounced=!0;const _={category:y.PNReconnectedCategory,operation:s.operation,lastTimetoken:this.lastTimetoken,currentTimetoken:this.currentTimetoken};this.listenerManager.announceStatus(_)}),this.reconnectionManager.startPolling(),this.listenerManager.announceStatus(Object.assign(Object.assign({},s),{category:y.PNNetworkIssuesCategory}))):s.category===y.PNBadRequestCategory?(this.stopHeartbeatTimer(),this.listenerManager.announceStatus(s)):this.listenerManager.announceStatus(s));if(this.storedTimetoken?(this.currentTimetoken=this.storedTimetoken,this.storedTimetoken=null):(this.lastTimetoken=this.currentTimetoken,this.currentTimetoken=o.cursor.timetoken),!this.subscriptionStatusAnnounced){const _={category:y.PNConnectedCategory,operation:s.operation,affectedChannels:Array.from(this.pendingChannelSubscriptions),subscribedChannels:this.subscribedChannels,affectedChannelGroups:Array.from(this.pendingChannelGroupSubscriptions),lastTimetoken:this.lastTimetoken,currentTimetoken:this.currentTimetoken};this.subscriptionStatusAnnounced=!0,this.listenerManager.announceStatus(_),this.pendingChannelGroupSubscriptions.clear(),this.pendingChannelSubscriptions.clear()}const{messages:u}=o,{requestMessageCountThreshold:p,dedupeOnSubscribe:m}=this.configuration;p&&u.length>=p&&this.listenerManager.announceStatus({category:y.PNRequestMessageCountExceededCategory,operation:s.operation});try{u.forEach(_=>{if(m&&"message"in _.data&&"timetoken"in _.data){if(this.dedupingManager.isDuplicate(_.data))return;this.dedupingManager.addEntry(_.data)}this.eventEmitter.emitEvent(_)})}catch(_){const E={error:!0,category:y.PNUnknownCategory,errorData:_,statusCode:0};this.listenerManager.announceStatus(E)}this.region=o.cursor.region,this.startSubscribeLoop()}setState(s){const{state:o,channels:u,channelGroups:p}=s;u==null||u.forEach(m=>m in this.channels&&(this.presenceState[m]=o)),p==null||p.forEach(m=>m in this.channelGroups&&(this.presenceState[m]=o))}changePresence(s){const{connected:o,channels:u,channelGroups:p}=s;o?(u==null||u.forEach(m=>this.heartbeatChannels[m]={}),p==null||p.forEach(m=>this.heartbeatChannelGroups[m]={})):(u==null||u.forEach(m=>{m in this.heartbeatChannels&&delete this.heartbeatChannels[m]}),p==null||p.forEach(m=>{m in this.heartbeatChannelGroups&&delete this.heartbeatChannelGroups[m]}),this.configuration.suppressLeaveEvents===!1&&this.leaveCall({channels:u,channelGroups:p},m=>this.listenerManager.announceStatus(m))),this.reconnect()}startHeartbeatTimer(){this.stopHeartbeatTimer();const s=this.configuration.getHeartbeatInterval();s&&s!==0&&(this.configuration.useSmartHeartbeat||this.sendHeartbeat(),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),1e3*s))}stopHeartbeatTimer(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}sendHeartbeat(){const s=Object.keys(this.heartbeatChannelGroups),o=Object.keys(this.heartbeatChannels);o.length===0&&s.length===0||this.heartbeatCall({channels:o,channelGroups:s,heartbeat:this.configuration.getPresenceTimeout(),state:this.presenceState},u=>{u.error&&this.configuration.announceFailedHeartbeats&&this.listenerManager.announceStatus(u),u.error&&this.configuration.autoNetworkDetection&&this.isOnline&&(this.isOnline=!1,this.disconnect(),this.listenerManager.announceNetworkDown(),this.reconnect()),!u.error&&this.configuration.announceSuccessfulHeartbeats&&this.listenerManager.announceStatus(u)})}}class xr{constructor(s,o,u){this._payload=s,this.setDefaultPayloadStructure(),this.title=o,this.body=u}get payload(){return this._payload}set title(s){this._title=s}set subtitle(s){this._subtitle=s}set body(s){this._body=s}set badge(s){this._badge=s}set sound(s){this._sound=s}setDefaultPayloadStructure(){}toObject(){return{}}}class Hn extends xr{constructor(){super(...arguments),this._apnsPushType="apns",this._isSilent=!1}get payload(){return this._payload}set configurations(s){s&&s.length&&(this._configurations=s)}get notification(){return this.payload.aps}get title(){return this._title}set title(s){s&&s.length&&(this.payload.aps.alert.title=s,this._title=s)}get subtitle(){return this._subtitle}set subtitle(s){s&&s.length&&(this.payload.aps.alert.subtitle=s,this._subtitle=s)}get body(){return this._body}set body(s){s&&s.length&&(this.payload.aps.alert.body=s,this._body=s)}get badge(){return this._badge}set badge(s){s!=null&&(this.payload.aps.badge=s,this._badge=s)}get sound(){return this._sound}set sound(s){s&&s.length&&(this.payload.aps.sound=s,this._sound=s)}set silent(s){this._isSilent=s}setDefaultPayloadStructure(){this.payload.aps={alert:{}}}toObject(){const s=Object.assign({},this.payload),{aps:o}=s;let{alert:u}=o;if(this._isSilent&&(o["content-available"]=1),this._apnsPushType==="apns2"){if(!this._configurations||!this._configurations.length)throw new ReferenceError("APNS2 configuration is missing");const p=[];this._configurations.forEach(m=>{p.push(this.objectFromAPNS2Configuration(m))}),p.length&&(s.pn_push=p)}return u&&Object.keys(u).length||delete o.alert,this._isSilent&&(delete o.alert,delete o.badge,delete o.sound,u={}),this._isSilent||u&&Object.keys(u).length?s:null}objectFromAPNS2Configuration(s){if(!s.targets||!s.targets.length)throw new ReferenceError("At least one APNS2 target should be provided");const{collapseId:o,expirationDate:u}=s,p={auth_method:"token",targets:s.targets.map(m=>this.objectFromAPNSTarget(m)),version:"v2"};return o&&o.length&&(p.collapse_id=o),u&&(p.expiration=u.toISOString()),p}objectFromAPNSTarget(s){if(!s.topic||!s.topic.length)throw new TypeError("Target 'topic' undefined.");const{topic:o,environment:u="development",excludedDevices:p=[]}=s,m={topic:o,environment:u};return p.length&&(m.excluded_devices=p),m}}class $n extends xr{get payload(){return this._payload}get notification(){return this.payload.notification}get data(){return this.payload.data}get title(){return this._title}set title(s){s&&s.length&&(this.payload.notification.title=s,this._title=s)}get body(){return this._body}set body(s){s&&s.length&&(this.payload.notification.body=s,this._body=s)}get sound(){return this._sound}set sound(s){s&&s.length&&(this.payload.notification.sound=s,this._sound=s)}get icon(){return this._icon}set icon(s){s&&s.length&&(this.payload.notification.icon=s,this._icon=s)}get tag(){return this._tag}set tag(s){s&&s.length&&(this.payload.notification.tag=s,this._tag=s)}set silent(s){this._isSilent=s}setDefaultPayloadStructure(){this.payload.notification={},this.payload.data={}}toObject(){let s=Object.assign({},this.payload.data),o=null;const u={};if(Object.keys(this.payload).length>2){const p=h(this.payload,["notification","data"]);s=Object.assign(Object.assign({},s),p)}return this._isSilent?s.notification=this.payload.notification:o=this.payload.notification,Object.keys(s).length&&(u.data=s),o&&Object.keys(o).length&&(u.notification=o),Object.keys(u).length?u:null}}class Ri{constructor(s,o){this._payload={apns:{},fcm:{}},this._title=s,this._body=o,this.apns=new Hn(this._payload.apns,s,o),this.fcm=new $n(this._payload.fcm,s,o)}set debugging(s){this._debugging=s}get title(){return this._title}get subtitle(){return this._subtitle}set subtitle(s){this._subtitle=s,this.apns.subtitle=s,this.fcm.subtitle=s}get body(){return this._body}get badge(){return this._badge}set badge(s){this._badge=s,this.apns.badge=s,this.fcm.badge=s}get sound(){return this._sound}set sound(s){this._sound=s,this.apns.sound=s,this.fcm.sound=s}buildPayload(s){const o={};if(s.includes("apns")||s.includes("apns2")){this.apns._apnsPushType=s.includes("apns")?"apns":"apns2";const u=this.apns.toObject();u&&Object.keys(u).length&&(o.pn_apns=u)}if(s.includes("fcm")){const u=this.fcm.toObject();u&&Object.keys(u).length&&(o.pn_gcm=u)}return Object.keys(o).length&&this._debugging&&(o.pn_debug=!0),o}}class Le{constructor(s){this.params=s,this.requestIdentifier=Ce.createUUID(),this._cancellationController=null}get cancellationController(){return this._cancellationController}set cancellationController(s){this._cancellationController=s}abort(s){this&&this.cancellationController&&this.cancellationController.abort(s)}operation(){throw Error("Should be implemented by subclass.")}validate(){}parse(s){return l(this,void 0,void 0,function*(){return this.deserializeResponse(s)})}request(){var s,o,u,p,m,_;const E={method:(o=(s=this.params)===null||s===void 0?void 0:s.method)!==null&&o!==void 0?o:ge.GET,path:this.path,queryParameters:this.queryParameters,cancellable:(p=(u=this.params)===null||u===void 0?void 0:u.cancellable)!==null&&p!==void 0&&p,compressible:(_=(m=this.params)===null||m===void 0?void 0:m.compressible)!==null&&_!==void 0&&_,timeout:10,identifier:this.requestIdentifier},A=this.headers;if(A&&(E.headers=A),E.method===ge.POST||E.method===ge.PATCH){const[I,X]=[this.body,this.formData];X&&(E.formData=X),I&&(E.body=I)}return E}get headers(){var s,o;return Object.assign({"Accept-Encoding":"gzip, deflate"},(o=(s=this.params)===null||s===void 0?void 0:s.compressible)!==null&&o!==void 0&&o?{"Content-Encoding":"deflate"}:{})}get path(){throw Error("`path` getter should be implemented by subclass.")}get queryParameters(){return{}}get formData(){}get body(){}deserializeResponse(s){const o=Le.decoder.decode(s.body),u=s.headers["content-type"];let p;if(!u||u.indexOf("javascript")===-1&&u.indexOf("json")===-1)throw new x("Service response error, check status for details",T(o,s.status));try{p=JSON.parse(o)}catch(m){throw console.error("Error parsing JSON response:",m),new x("Service response error, check status for details",T(o,s.status))}if("status"in p&&typeof p.status=="number"&&p.status>=400)throw k.create(s);return p}}var Er;Le.decoder=new TextDecoder,function(f){f.PNPublishOperation="PNPublishOperation",f.PNSignalOperation="PNSignalOperation",f.PNSubscribeOperation="PNSubscribeOperation",f.PNUnsubscribeOperation="PNUnsubscribeOperation",f.PNWhereNowOperation="PNWhereNowOperation",f.PNHereNowOperation="PNHereNowOperation",f.PNGlobalHereNowOperation="PNGlobalHereNowOperation",f.PNSetStateOperation="PNSetStateOperation",f.PNGetStateOperation="PNGetStateOperation",f.PNHeartbeatOperation="PNHeartbeatOperation",f.PNAddMessageActionOperation="PNAddActionOperation",f.PNRemoveMessageActionOperation="PNRemoveMessageActionOperation",f.PNGetMessageActionsOperation="PNGetMessageActionsOperation",f.PNTimeOperation="PNTimeOperation",f.PNHistoryOperation="PNHistoryOperation",f.PNDeleteMessagesOperation="PNDeleteMessagesOperation",f.PNFetchMessagesOperation="PNFetchMessagesOperation",f.PNMessageCounts="PNMessageCountsOperation",f.PNGetAllUUIDMetadataOperation="PNGetAllUUIDMetadataOperation",f.PNGetUUIDMetadataOperation="PNGetUUIDMetadataOperation",f.PNSetUUIDMetadataOperation="PNSetUUIDMetadataOperation",f.PNRemoveUUIDMetadataOperation="PNRemoveUUIDMetadataOperation",f.PNGetAllChannelMetadataOperation="PNGetAllChannelMetadataOperation",f.PNGetChannelMetadataOperation="PNGetChannelMetadataOperation",f.PNSetChannelMetadataOperation="PNSetChannelMetadataOperation",f.PNRemoveChannelMetadataOperation="PNRemoveChannelMetadataOperation",f.PNGetMembersOperation="PNGetMembersOperation",f.PNSetMembersOperation="PNSetMembersOperation",f.PNGetMembershipsOperation="PNGetMembershipsOperation",f.PNSetMembershipsOperation="PNSetMembershipsOperation",f.PNListFilesOperation="PNListFilesOperation",f.PNGenerateUploadUrlOperation="PNGenerateUploadUrlOperation",f.PNPublishFileOperation="PNPublishFileOperation",f.PNPublishFileMessageOperation="PNPublishFileMessageOperation",f.PNGetFileUrlOperation="PNGetFileUrlOperation",f.PNDownloadFileOperation="PNDownloadFileOperation",f.PNDeleteFileOperation="PNDeleteFileOperation",f.PNAddPushNotificationEnabledChannelsOperation="PNAddPushNotificationEnabledChannelsOperation",f.PNRemovePushNotificationEnabledChannelsOperation="PNRemovePushNotificationEnabledChannelsOperation",f.PNPushNotificationEnabledChannelsOperation="PNPushNotificationEnabledChannelsOperation",f.PNRemoveAllPushNotificationsOperation="PNRemoveAllPushNotificationsOperation",f.PNChannelGroupsOperation="PNChannelGroupsOperation",f.PNRemoveGroupOperation="PNRemoveGroupOperation",f.PNChannelsForGroupOperation="PNChannelsForGroupOperation",f.PNAddChannelsToGroupOperation="PNAddChannelsToGroupOperation",f.PNRemoveChannelsFromGroupOperation="PNRemoveChannelsFromGroupOperation",f.PNAccessManagerGrant="PNAccessManagerGrant",f.PNAccessManagerGrantToken="PNAccessManagerGrantToken",f.PNAccessManagerAudit="PNAccessManagerAudit",f.PNAccessManagerRevokeToken="PNAccessManagerRevokeToken",f.PNHandshakeOperation="PNHandshakeOperation",f.PNReceiveMessagesOperation="PNReceiveMessagesOperation"}(Er||(Er={}));var Ae=Er,tt;(function(f){f[f.Presence=-2]="Presence",f[f.Message=-1]="Message",f[f.Signal=1]="Signal",f[f.AppContext=2]="AppContext",f[f.MessageAction=3]="MessageAction",f[f.Files=4]="Files"})(tt||(tt={}));class ii extends Le{constructor(s){var o,u,p,m,_,E;super({cancellable:!0}),this.parameters=s,(o=(m=this.parameters).withPresence)!==null&&o!==void 0||(m.withPresence=!1),(u=(_=this.parameters).channelGroups)!==null&&u!==void 0||(_.channelGroups=[]),(p=(E=this.parameters).channels)!==null&&p!==void 0||(E.channels=[])}operation(){return Ae.PNSubscribeOperation}validate(){const{keySet:{subscribeKey:s},channels:o,channelGroups:u}=this.parameters;return s?o||u?void 0:"`channels` and `channelGroups` both should not be empty":"Missing Subscribe Key"}parse(s){return l(this,void 0,void 0,function*(){let o,u;try{u=Le.decoder.decode(s.body),o=JSON.parse(u)}catch(m){console.error("Error parsing JSON response:",m)}if(!o)throw new x("Service response error, check status for details",T(u,s.status));const p=o.m.filter(m=>{const _=m.b===void 0?m.c:m.b;return this.parameters.channels&&this.parameters.channels.includes(_)||this.parameters.channelGroups&&this.parameters.channelGroups.includes(_)}).map(m=>{let{e:_}=m;return _!=null||(_=m.c.endsWith("-pnpres")?tt.Presence:tt.Message),_!=tt.Signal&&typeof m.d=="string"?_==tt.Message?{type:tt.Message,data:this.messageFromEnvelope(m)}:{type:tt.Files,data:this.fileFromEnvelope(m)}:_==tt.Message?{type:tt.Message,data:this.messageFromEnvelope(m)}:_===tt.Presence?{type:tt.Presence,data:this.presenceEventFromEnvelope(m)}:_==tt.Signal?{type:tt.Signal,data:this.signalFromEnvelope(m)}:_===tt.AppContext?{type:tt.AppContext,data:this.appContextFromEnvelope(m)}:_===tt.MessageAction?{type:tt.MessageAction,data:this.messageActionFromEnvelope(m)}:{type:tt.Files,data:this.fileFromEnvelope(m)}});return{cursor:{timetoken:o.t.t,region:o.t.r},messages:p}})}get headers(){var s;return Object.assign(Object.assign({},(s=super.headers)!==null&&s!==void 0?s:{}),{accept:"text/javascript"})}presenceEventFromEnvelope(s){var o;const{d:u}=s,[p,m]=this.subscriptionChannelFromEnvelope(s),_=p.replace("-pnpres",""),E=m!==null?_:null,A=m!==null?m:_;return typeof u!="string"&&("data"in u?(u.state=u.data,delete u.data):"action"in u&&u.action==="interval"&&(u.hereNowRefresh=(o=u.here_now_refresh)!==null&&o!==void 0&&o,delete u.here_now_refresh)),Object.assign({channel:_,subscription:m,actualChannel:E,subscribedChannel:A,timetoken:s.p.t},u)}messageFromEnvelope(s){const[o,u]=this.subscriptionChannelFromEnvelope(s),[p,m]=this.decryptedData(s.d),_={channel:o,subscription:u,actualChannel:u!==null?o:null,subscribedChannel:u!==null?u:o,timetoken:s.p.t,publisher:s.i,message:p};return s.u&&(_.userMetadata=s.u),s.cmt&&(_.customMessageType=s.cmt),m&&(_.error=m),_}signalFromEnvelope(s){const[o,u]=this.subscriptionChannelFromEnvelope(s),p={channel:o,subscription:u,timetoken:s.p.t,publisher:s.i,message:s.d};return s.u&&(p.userMetadata=s.u),s.cmt&&(p.customMessageType=s.cmt),p}messageActionFromEnvelope(s){const[o,u]=this.subscriptionChannelFromEnvelope(s),p=s.d;return{channel:o,subscription:u,timetoken:s.p.t,publisher:s.i,event:p.event,data:Object.assign(Object.assign({},p.data),{uuid:s.i})}}appContextFromEnvelope(s){const[o,u]=this.subscriptionChannelFromEnvelope(s),p=s.d;return{channel:o,subscription:u,timetoken:s.p.t,message:p}}fileFromEnvelope(s){const[o,u]=this.subscriptionChannelFromEnvelope(s),[p,m]=this.decryptedData(s.d);let _=m;const E={channel:o,subscription:u,timetoken:s.p.t,publisher:s.i};return s.u&&(E.userMetadata=s.u),p?typeof p=="string"?_!=null||(_="Unexpected file information payload data type."):(E.message=p.message,p.file&&(E.file={id:p.file.id,name:p.file.name,url:this.parameters.getFileUrl({id:p.file.id,name:p.file.name,channel:o})})):_!=null||(_="File information payload is missing."),s.cmt&&(E.customMessageType=s.cmt),_&&(E.error=_),E}subscriptionChannelFromEnvelope(s){return[s.c,s.b===void 0?s.c:s.b]}decryptedData(s){if(!this.parameters.crypto||typeof s!="string")return[s,void 0];let o,u;try{const p=this.parameters.crypto.decrypt(s);o=p instanceof ArrayBuffer?JSON.parse(Mi.decoder.decode(p)):p}catch(p){o=null,u=`Error while decrypting message content: ${p.message}`}return[o??s,u]}}class Mi extends ii{get path(){var s;const{keySet:{subscribeKey:o},channels:u}=this.parameters;return`/v2/subscribe/${o}/${Ue((s=u==null?void 0:u.sort())!==null&&s!==void 0?s:[],",")}/0`}get queryParameters(){const{channelGroups:s,filterExpression:o,heartbeat:u,state:p,timetoken:m,region:_}=this.parameters,E={};return s&&s.length>0&&(E["channel-group"]=s.sort().join(",")),o&&o.length>0&&(E["filter-expr"]=o),u&&(E.heartbeat=u),p&&Object.keys(p).length>0&&(E.state=JSON.stringify(p)),m!==void 0&&typeof m=="string"?m.length>0&&m!=="0"&&(E.tt=m):m!==void 0&&m>0&&(E.tt=m),_&&(E.tr=_),E}}class ni{constructor(s){this.listenerManager=s,this.channelListenerMap=new Map,this.groupListenerMap=new Map}emitEvent(s){var o;if(s.type===tt.Message)this.listenerManager.announceMessage(s.data),this.announce("message",s.data,s.data.channel,s.data.subscription);else if(s.type===tt.Signal)this.listenerManager.announceSignal(s.data),this.announce("signal",s.data,s.data.channel,s.data.subscription);else if(s.type===tt.Presence)this.listenerManager.announcePresence(s.data),this.announce("presence",s.data,(o=s.data.subscription)!==null&&o!==void 0?o:s.data.channel,s.data.subscription);else if(s.type===tt.AppContext){const{data:u}=s,{message:p}=u;if(this.listenerManager.announceObjects(u),this.announce("objects",u,u.channel,u.subscription),p.type==="uuid"){const{message:m,channel:_}=u,E=h(u,["message","channel"]),{event:A,type:I}=p,X=h(p,["event","type"]),G=Object.assign(Object.assign({},E),{spaceId:_,message:Object.assign(Object.assign({},X),{event:A==="set"?"updated":"removed",type:"user"})});this.listenerManager.announceUser(G),this.announce("user",G,G.spaceId,G.subscription)}else if(p.type==="channel"){const{message:m,channel:_}=u,E=h(u,["message","channel"]),{event:A,type:I}=p,X=h(p,["event","type"]),G=Object.assign(Object.assign({},E),{spaceId:_,message:Object.assign(Object.assign({},X),{event:A==="set"?"updated":"removed",type:"space"})});this.listenerManager.announceSpace(G),this.announce("space",G,G.spaceId,G.subscription)}else if(p.type==="membership"){const{message:m,channel:_}=u,E=h(u,["message","channel"]),{event:A,data:I}=p,X=h(p,["event","data"]),{uuid:G,channel:L}=I,Q=h(I,["uuid","channel"]),B=Object.assign(Object.assign({},E),{spaceId:_,message:Object.assign(Object.assign({},X),{event:A==="set"?"updated":"removed",data:Object.assign(Object.assign({},Q),{user:G,space:L})})});this.listenerManager.announceMembership(B),this.announce("membership",B,B.spaceId,B.subscription)}}else s.type===tt.MessageAction?(this.listenerManager.announceMessageAction(s.data),this.announce("messageAction",s.data,s.data.channel,s.data.subscription)):s.type===tt.Files&&(this.listenerManager.announceFile(s.data),this.announce("file",s.data,s.data.channel,s.data.subscription))}addListener(s,o,u,p){return p!=null||(p=Ce.createUUID()),o&&u?(o==null||o.forEach(m=>{this.channelListenerMap.has(m)?this.channelListenerMap.get(m).push({id:p,listener:s}):this.channelListenerMap.set(m,[{id:p,listener:s}])}),u==null||u.forEach(m=>{this.groupListenerMap.has(m)?this.groupListenerMap.get(m).push({id:p,listener:s}):this.groupListenerMap.set(m,[{id:p,listener:s}])})):this.listenerManager.addListener(s),p}removeListener(s,o,u,p){u&&p?(u==null||u.forEach(m=>{const _=this.channelListenerMap.get(m);if(_){const E=_.find(I=>I.id===o),A=E?_.indexOf(E):-1;A!==-1&&_.splice(A,1)}}),p==null||p.forEach(m=>{const _=this.groupListenerMap.get(m);if(_){const E=_.find(I=>I.id===o),A=E?_.indexOf(E):-1;A!==-1&&_.splice(A,1)}})):this.listenerManager.removeListener(s)}removeAllListeners(){this.listenerManager.removeAllListeners(),this.channelListenerMap.clear(),this.groupListenerMap.clear()}announce(s,o,u,p){o&&this.channelListenerMap.has(u)&&this.channelListenerMap.get(u).forEach(m=>{const _=m.listener[s];_&&_(o)}),p&&this.groupListenerMap.has(p)&&this.groupListenerMap.get(p).forEach(m=>{const _=m.listener[s];_&&_(o)})}}class ts{constructor(s=!1){this.sync=s,this.listeners=new Set}subscribe(s){return this.listeners.add(s),()=>{this.listeners.delete(s)}}notify(s){const o=()=>{this.listeners.forEach(u=>{u(s)})};this.sync?o():setTimeout(o,0)}}class W{transition(s,o){var u;if(this.transitionMap.has(o.type))return(u=this.transitionMap.get(o.type))===null||u===void 0?void 0:u(s,o)}constructor(s){this.label=s,this.transitionMap=new Map,this.enterEffects=[],this.exitEffects=[]}on(s,o){return this.transitionMap.set(s,o),this}with(s,o){return[this,s,o??[]]}onEnter(s){return this.enterEffects.push(s),this}onExit(s){return this.exitEffects.push(s),this}}class ee extends ts{describe(s){return new W(s)}start(s,o){this.currentState=s,this.currentContext=o,this.notify({type:"engineStarted",state:s,context:o})}transition(s){if(!this.currentState)throw new Error("Start the engine first");this.notify({type:"eventReceived",event:s});const o=this.currentState.transition(this.currentContext,s);if(o){const[u,p,m]=o;for(const A of this.currentState.exitEffects)this.notify({type:"invocationDispatched",invocation:A(this.currentContext)});const _=this.currentState;this.currentState=u;const E=this.currentContext;this.currentContext=p,this.notify({type:"transitionDone",fromState:_,fromContext:E,toState:u,toContext:p,event:s});for(const A of m)this.notify({type:"invocationDispatched",invocation:A});for(const A of this.currentState.enterEffects)this.notify({type:"invocationDispatched",invocation:A(this.currentContext)})}}}class Je{constructor(s){this.dependencies=s,this.instances=new Map,this.handlers=new Map}on(s,o){this.handlers.set(s,o)}dispatch(s){if(s.type==="CANCEL"){if(this.instances.has(s.payload)){const p=this.instances.get(s.payload);p==null||p.cancel(),this.instances.delete(s.payload)}return}const o=this.handlers.get(s.type);if(!o)throw new Error(`Unhandled invocation '${s.type}'`);const u=o(s.payload,this.dependencies);s.managed&&this.instances.set(s.type,u),u.start()}dispose(){for(const[s,o]of this.instances.entries())o.cancel(),this.instances.delete(s)}}function Ge(f,s){const o=function(...u){return{type:f,payload:s==null?void 0:s(...u)}};return o.type=f,o}function Qe(f,s){const o=(...u)=>({type:f,payload:s(...u),managed:!1});return o.type=f,o}function je(f,s){const o=(...u)=>({type:f,payload:s(...u),managed:!0});return o.type=f,o.cancel={type:"CANCEL",payload:f,managed:!1},o}class Vt extends Error{constructor(){super("The operation was aborted."),this.name="AbortError",Object.setPrototypeOf(this,new.target.prototype)}}class wr extends ts{constructor(){super(...arguments),this._aborted=!1}get aborted(){return this._aborted}throwIfAborted(){if(this._aborted)throw new Vt}abort(){this._aborted=!0,this.notify(new Vt)}}class St{constructor(s,o){this.payload=s,this.dependencies=o}}class ir extends St{constructor(s,o,u){super(s,o),this.asyncFunction=u,this.abortSignal=new wr}start(){this.asyncFunction(this.payload,this.abortSignal,this.dependencies).catch(s=>{})}cancel(){this.abortSignal.abort()}}const Dt=f=>(s,o)=>new ir(s,o,f),nr=Ge("RECONNECT",()=>({})),xt=Ge("DISCONNECT",f=>({isOffline:f})),Sr=Ge("JOINED",(f,s)=>({channels:f,groups:s})),Ur=Ge("LEFT",(f,s)=>({channels:f,groups:s})),Gr=Ge("LEFT_ALL",f=>({isOffline:f})),jr=Ge("HEARTBEAT_SUCCESS",f=>({statusCode:f})),Ts=Ge("HEARTBEAT_FAILURE",f=>f),rs=Ge("TIMES_UP",()=>({})),ss=je("HEARTBEAT",(f,s)=>({channels:f,groups:s})),It=Qe("LEAVE",(f,s)=>({channels:f,groups:s})),As=Qe("EMIT_STATUS",f=>f),Cs=je("WAIT",()=>({}));class ai extends Je{constructor(s,o){super(o),this.on(ss.type,Dt((u,p,m)=>l(this,[u,p,m],void 0,function*(_,E,{heartbeat:A,presenceState:I,config:X}){try{yield A(Object.assign(Object.assign({channels:_.channels,channelGroups:_.groups},X.maintainPresenceState&&{state:I}),{heartbeat:X.presenceTimeout})),s.transition(jr(200))}catch(G){if(G instanceof x){if(G.status&&G.status.category==y.PNCancelledCategory)return;s.transition(Ts(G))}}}))),this.on(It.type,Dt((u,p,m)=>l(this,[u,p,m],void 0,function*(_,E,{leave:A,config:I}){if(!I.suppressLeaveEvents)try{A({channels:_.channels,channelGroups:_.groups})}catch{}}))),this.on(Cs.type,Dt((u,p,m)=>l(this,[u,p,m],void 0,function*(_,E,{heartbeatDelay:A}){return E.throwIfAborted(),yield A(),E.throwIfAborted(),s.transition(rs())}))),this.on(As.type,Dt((u,p,m)=>l(this,[u,p,m],void 0,function*(_,E,{emitStatus:A,config:I}){I.announceFailedHeartbeats&&(_==null?void 0:_.error)===!0?A(Object.assign(Object.assign({},_),{operation:Ae.PNHeartbeatOperation})):I.announceSuccessfulHeartbeats&&_.statusCode===200&&A(Object.assign(Object.assign({},_),{error:!1,operation:Ae.PNHeartbeatOperation,category:y.PNAcknowledgmentCategory}))})))}}const Ft=new W("HEARTBEAT_STOPPED");Ft.on(Sr.type,(f,s)=>Ft.with({channels:[...f.channels,...s.payload.channels],groups:[...f.groups,...s.payload.groups]})),Ft.on(Ur.type,(f,s)=>Ft.with({channels:f.channels.filter(o=>!s.payload.channels.includes(o)),groups:f.groups.filter(o=>!s.payload.groups.includes(o))})),Ft.on(nr.type,(f,s)=>ut.with({channels:f.channels,groups:f.groups})),Ft.on(Gr.type,(f,s)=>ar.with(void 0));const Bt=new W("HEARTBEAT_COOLDOWN");Bt.onEnter(()=>Cs()),Bt.onExit(()=>Cs.cancel),Bt.on(rs.type,(f,s)=>ut.with({channels:f.channels,groups:f.groups})),Bt.on(Sr.type,(f,s)=>ut.with({channels:[...f.channels,...s.payload.channels],groups:[...f.groups,...s.payload.groups]})),Bt.on(Ur.type,(f,s)=>ut.with({channels:f.channels.filter(o=>!s.payload.channels.includes(o)),groups:f.groups.filter(o=>!s.payload.groups.includes(o))},[It(s.payload.channels,s.payload.groups)])),Bt.on(xt.type,(f,s)=>Ft.with({channels:f.channels,groups:f.groups},[...s.payload.isOffline?[]:[It(f.channels,f.groups)]])),Bt.on(Gr.type,(f,s)=>ar.with(void 0,[...s.payload.isOffline?[]:[It(f.channels,f.groups)]]));const Tr=new W("HEARTBEAT_FAILED");Tr.on(Sr.type,(f,s)=>ut.with({channels:[...f.channels,...s.payload.channels],groups:[...f.groups,...s.payload.groups]})),Tr.on(Ur.type,(f,s)=>ut.with({channels:f.channels.filter(o=>!s.payload.channels.includes(o)),groups:f.groups.filter(o=>!s.payload.groups.includes(o))},[It(s.payload.channels,s.payload.groups)])),Tr.on(nr.type,(f,s)=>ut.with({channels:f.channels,groups:f.groups})),Tr.on(xt.type,(f,s)=>Ft.with({channels:f.channels,groups:f.groups},[...s.payload.isOffline?[]:[It(f.channels,f.groups)]])),Tr.on(Gr.type,(f,s)=>ar.with(void 0,[...s.payload.isOffline?[]:[It(f.channels,f.groups)]]));const ut=new W("HEARTBEATING");ut.onEnter(f=>ss(f.channels,f.groups)),ut.onExit(()=>ss.cancel),ut.on(jr.type,(f,s)=>Bt.with({channels:f.channels,groups:f.groups},[As(Object.assign({},s.payload))])),ut.on(Sr.type,(f,s)=>ut.with({channels:[...f.channels,...s.payload.channels],groups:[...f.groups,...s.payload.groups]})),ut.on(Ur.type,(f,s)=>ut.with({channels:f.channels.filter(o=>!s.payload.channels.includes(o)),groups:f.groups.filter(o=>!s.payload.groups.includes(o))},[It(s.payload.channels,s.payload.groups)])),ut.on(Ts.type,(f,s)=>Tr.with(Object.assign({},f),[...s.payload.status?[As(Object.assign({},s.payload.status))]:[]])),ut.on(xt.type,(f,s)=>Ft.with({channels:f.channels,groups:f.groups},[...s.payload.isOffline?[]:[It(f.channels,f.groups)]])),ut.on(Gr.type,(f,s)=>ar.with(void 0,[...s.payload.isOffline?[]:[It(f.channels,f.groups)]]));const ar=new W("HEARTBEAT_INACTIVE");ar.on(Sr.type,(f,s)=>ut.with({channels:s.payload.channels,groups:s.payload.groups}));class Hr{get _engine(){return this.engine}constructor(s){this.dependencies=s,this.engine=new ee,this.channels=[],this.groups=[],this.dispatcher=new ai(this.engine,s),this._unsubscribeEngine=this.engine.subscribe(o=>{o.type==="invocationDispatched"&&this.dispatcher.dispatch(o.invocation)}),this.engine.start(ar,void 0)}join({channels:s,groups:o}){this.channels=[...this.channels,...s??[]],this.groups=[...this.groups,...o??[]],this.engine.transition(Sr(this.channels.slice(0),this.groups.slice(0)))}leave({channels:s,groups:o}){this.dependencies.presenceState&&(s==null||s.forEach(u=>delete this.dependencies.presenceState[u]),o==null||o.forEach(u=>delete this.dependencies.presenceState[u])),this.engine.transition(Ur(s??[],o??[]))}leaveAll(s){this.engine.transition(Gr(s))}reconnect(){this.engine.transition(nr())}disconnect(s){this.engine.transition(xt(s))}dispose(){this.disconnect(!0),this._unsubscribeEngine(),this.dispatcher.dispose()}}const $r=je("HANDSHAKE",(f,s)=>({channels:f,groups:s})),oi=je("RECEIVE_MESSAGES",(f,s,o)=>({channels:f,groups:s,cursor:o})),hi=Qe("EMIT_MESSAGES",f=>f),Lt=Qe("EMIT_STATUS",f=>f),or=Ge("SUBSCRIPTION_CHANGED",(f,s,o)=>({channels:f,groups:s,isOffline:o})),Vr=Ge("SUBSCRIPTION_RESTORED",(f,s,o,u)=>({channels:f,groups:s,cursor:{timetoken:o,region:u??0}})),yh=Ge("HANDSHAKE_SUCCESS",f=>f),vh=Ge("HANDSHAKE_FAILURE",f=>f),bh=Ge("RECEIVE_SUCCESS",(f,s)=>({cursor:f,events:s})),_h=Ge("RECEIVE_FAILURE",f=>f),Vn=Ge("DISCONNECT",f=>({isOffline:f})),li=Ge("RECONNECT",(f,s)=>({cursor:{timetoken:f??"",region:s??0}})),Ps=Ge("UNSUBSCRIBE_ALL",()=>({}));class Ed extends Je{constructor(s,o){super(o),this.on($r.type,Dt((u,p,m)=>l(this,[u,p,m],void 0,function*(_,E,{handshake:A,presenceState:I,config:X}){E.throwIfAborted();try{const G=yield A(Object.assign({abortSignal:E,channels:_.channels,channelGroups:_.groups,filterExpression:X.filterExpression},X.maintainPresenceState&&{state:I}));return s.transition(yh(G))}catch(G){if(G instanceof x)return G.status&&G.status.category==y.PNCancelledCategory?void 0:s.transition(vh(G))}}))),this.on(oi.type,Dt((u,p,m)=>l(this,[u,p,m],void 0,function*(_,E,{receiveMessages:A,config:I}){E.throwIfAborted();try{const X=yield A({abortSignal:E,channels:_.channels,channelGroups:_.groups,timetoken:_.cursor.timetoken,region:_.cursor.region,filterExpression:I.filterExpression});s.transition(bh(X.cursor,X.messages))}catch(X){if(X instanceof x){if(X.status&&X.status.category==y.PNCancelledCategory)return;if(!E.aborted)return s.transition(_h(X))}}}))),this.on(hi.type,Dt((u,p,m)=>l(this,[u,p,m],void 0,function*(_,E,{emitMessages:A}){_.length>0&&A(_)}))),this.on(Lt.type,Dt((u,p,m)=>l(this,[u,p,m],void 0,function*(_,E,{emitStatus:A}){return A(_)})))}}const is=new W("HANDSHAKE_STOPPED");is.on(or.type,(f,{payload:s})=>s.channels.length===0&&s.groups.length===0?nt.with(void 0):is.with({channels:s.channels,groups:s.groups,cursor:f.cursor})),is.on(li.type,(f,{payload:s})=>ct.with(Object.assign(Object.assign({},f),{cursor:s.cursor||f.cursor}))),is.on(Vr.type,(f,{payload:s})=>{var o;return s.channels.length===0&&s.groups.length===0?nt.with(void 0):is.with({channels:s.channels,groups:s.groups,cursor:{timetoken:s.cursor.timetoken,region:s.cursor.region||((o=f.cursor)===null||o===void 0?void 0:o.region)||0}})}),is.on(Ps.type,f=>nt.with());const Is=new W("HANDSHAKE_FAILED");Is.on(or.type,(f,{payload:s})=>s.channels.length===0&&s.groups.length===0?nt.with(void 0):ct.with({channels:s.channels,groups:s.groups,cursor:f.cursor})),Is.on(li.type,(f,{payload:s})=>ct.with({channels:f.channels,groups:f.groups,cursor:s.cursor||f.cursor})),Is.on(Vr.type,(f,{payload:s})=>{var o,u;return s.channels.length===0&&s.groups.length===0?nt.with(void 0):ct.with({channels:s.channels,groups:s.groups,cursor:{timetoken:s.cursor.timetoken,region:s.cursor.region?s.cursor.region:(u=(o=f==null?void 0:f.cursor)===null||o===void 0?void 0:o.region)!==null&&u!==void 0?u:0}})}),Is.on(Ps.type,f=>nt.with());const ns=new W("RECEIVE_STOPPED");ns.on(or.type,(f,{payload:s})=>s.channels.length===0&&s.groups.length===0?nt.with(void 0):ns.with({channels:s.channels,groups:s.groups,cursor:f.cursor})),ns.on(Vr.type,(f,{payload:s})=>s.channels.length===0&&s.groups.length===0?nt.with(void 0):ns.with({channels:s.channels,groups:s.groups,cursor:{timetoken:s.cursor.timetoken,region:s.cursor.region||f.cursor.region}})),ns.on(li.type,(f,{payload:s})=>{var o;return ct.with({channels:f.channels,groups:f.groups,cursor:{timetoken:s.cursor.timetoken?(o=s.cursor)===null||o===void 0?void 0:o.timetoken:f.cursor.timetoken,region:s.cursor.region||f.cursor.region}})}),ns.on(Ps.type,()=>nt.with(void 0));const Rs=new W("RECEIVE_FAILED");Rs.on(li.type,(f,{payload:s})=>{var o;return ct.with({channels:f.channels,groups:f.groups,cursor:{timetoken:s.cursor.timetoken?(o=s.cursor)===null||o===void 0?void 0:o.timetoken:f.cursor.timetoken,region:s.cursor.region||f.cursor.region}})}),Rs.on(or.type,(f,{payload:s})=>s.channels.length===0&&s.groups.length===0?nt.with(void 0):ct.with({channels:s.channels,groups:s.groups,cursor:f.cursor})),Rs.on(Vr.type,(f,{payload:s})=>s.channels.length===0&&s.groups.length===0?nt.with(void 0):ct.with({channels:s.channels,groups:s.groups,cursor:{timetoken:s.cursor.timetoken,region:s.cursor.region||f.cursor.region}})),Rs.on(Ps.type,f=>nt.with(void 0));const Ut=new W("RECEIVING");Ut.onEnter(f=>oi(f.channels,f.groups,f.cursor)),Ut.onExit(()=>oi.cancel),Ut.on(bh.type,(f,{payload:s})=>Ut.with({channels:f.channels,groups:f.groups,cursor:s.cursor},[hi(s.events)])),Ut.on(or.type,(f,{payload:s})=>{var o;if(s.channels.length===0&&s.groups.length===0){let u;return s.isOffline&&(u=(o=k.create(new Error("Network connection error")).toPubNubError(Ae.PNSubscribeOperation).status)===null||o===void 0?void 0:o.category),nt.with(void 0,[Lt(Object.assign({category:s.isOffline?y.PNDisconnectedUnexpectedlyCategory:y.PNDisconnectedCategory},u?{error:u}:{}))])}return Ut.with({channels:s.channels,groups:s.groups,cursor:f.cursor},[Lt({category:y.PNSubscriptionChangedCategory,affectedChannels:s.channels.slice(0),affectedChannelGroups:s.groups.slice(0),currentTimetoken:f.cursor.timetoken})])}),Ut.on(Vr.type,(f,{payload:s})=>s.channels.length===0&&s.groups.length===0?nt.with(void 0,[Lt({category:y.PNDisconnectedCategory})]):Ut.with({channels:s.channels,groups:s.groups,cursor:{timetoken:s.cursor.timetoken,region:s.cursor.region||f.cursor.region}},[Lt({category:y.PNSubscriptionChangedCategory,affectedChannels:s.channels.slice(0),affectedChannelGroups:s.groups.slice(0),currentTimetoken:s.cursor.timetoken})])),Ut.on(_h.type,(f,{payload:s})=>{var o;return Rs.with(Object.assign(Object.assign({},f),{reason:s}),[Lt({category:y.PNDisconnectedUnexpectedlyCategory,error:(o=s.status)===null||o===void 0?void 0:o.category})])}),Ut.on(Vn.type,(f,s)=>{var o;if(s.payload.isOffline){const u=k.create(new Error("Network connection error")).toPubNubError(Ae.PNSubscribeOperation);return Rs.with({channels:f.channels,groups:f.groups,cursor:f.cursor,reason:u},[Lt({category:y.PNDisconnectedUnexpectedlyCategory,error:(o=u.status)===null||o===void 0?void 0:o.category})])}return ns.with({channels:f.channels,groups:f.groups,cursor:f.cursor},[Lt({category:y.PNDisconnectedCategory})])}),Ut.on(Ps.type,f=>nt.with(void 0,[Lt({category:y.PNDisconnectedCategory})]));const ct=new W("HANDSHAKING");ct.onEnter(f=>$r(f.channels,f.groups)),ct.onExit(()=>$r.cancel),ct.on(or.type,(f,{payload:s})=>s.channels.length===0&&s.groups.length===0?nt.with(void 0):ct.with({channels:s.channels,groups:s.groups,cursor:f.cursor})),ct.on(yh.type,(f,{payload:s})=>{var o,u,p,m;return Ut.with({channels:f.channels,groups:f.groups,cursor:{timetoken:!((o=f.cursor)===null||o===void 0)&&o.timetoken?(u=f.cursor)===null||u===void 0?void 0:u.timetoken:s.timetoken,region:s.region}},[Lt({category:y.PNConnectedCategory,affectedChannels:f.channels.slice(0),affectedChannelGroups:f.groups.slice(0),currentTimetoken:!((p=f.cursor)===null||p===void 0)&&p.timetoken?(m=f.cursor)===null||m===void 0?void 0:m.timetoken:s.timetoken})])}),ct.on(vh.type,(f,s)=>{var o;return Is.with({channels:f.channels,groups:f.groups,cursor:f.cursor,reason:s.payload},[Lt({category:y.PNConnectionErrorCategory,error:(o=s.payload.status)===null||o===void 0?void 0:o.category})])}),ct.on(Vn.type,(f,s)=>{var o;if(s.payload.isOffline){const u=k.create(new Error("Network connection error")).toPubNubError(Ae.PNSubscribeOperation);return Is.with({channels:f.channels,groups:f.groups,cursor:f.cursor,reason:u},[Lt({category:y.PNConnectionErrorCategory,error:(o=u.status)===null||o===void 0?void 0:o.category})])}return is.with({channels:f.channels,groups:f.groups,cursor:f.cursor})}),ct.on(Vr.type,(f,{payload:s})=>{var o;return s.channels.length===0&&s.groups.length===0?nt.with(void 0):ct.with({channels:s.channels,groups:s.groups,cursor:{timetoken:s.cursor.timetoken,region:s.cursor.region||((o=f==null?void 0:f.cursor)===null||o===void 0?void 0:o.region)||0}})}),ct.on(Ps.type,f=>nt.with());const nt=new W("UNSUBSCRIBED");nt.on(or.type,(f,{payload:s})=>s.channels.length===0&&s.groups.length===0?nt.with(void 0):ct.with({channels:s.channels,groups:s.groups})),nt.on(Vr.type,(f,{payload:s})=>s.channels.length===0&&s.groups.length===0?nt.with(void 0):ct.with({channels:s.channels,groups:s.groups,cursor:s.cursor}));class wd{get _engine(){return this.engine}constructor(s){this.engine=new ee,this.channels=[],this.groups=[],this.dependencies=s,this.dispatcher=new Ed(this.engine,s),this._unsubscribeEngine=this.engine.subscribe(o=>{o.type==="invocationDispatched"&&this.dispatcher.dispatch(o.invocation)}),this.engine.start(nt,void 0)}subscribe({channels:s,channelGroups:o,timetoken:u,withPresence:p}){this.channels=[...this.channels,...s??[]],this.groups=[...this.groups,...o??[]],p&&(this.channels.map(m=>this.channels.push(`${m}-pnpres`)),this.groups.map(m=>this.groups.push(`${m}-pnpres`))),u?this.engine.transition(Vr(Array.from(new Set([...this.channels,...s??[]])),Array.from(new Set([...this.groups,...o??[]])),u)):this.engine.transition(or(Array.from(new Set([...this.channels,...s??[]])),Array.from(new Set([...this.groups,...o??[]])))),this.dependencies.join&&this.dependencies.join({channels:Array.from(new Set(this.channels.filter(m=>!m.endsWith("-pnpres")))),groups:Array.from(new Set(this.groups.filter(m=>!m.endsWith("-pnpres"))))})}unsubscribe({channels:s=[],channelGroups:o=[]}){const u=Ie(this.channels,[...s,...s.map(m=>`${m}-pnpres`)]),p=Ie(this.groups,[...o,...o.map(m=>`${m}-pnpres`)]);if(new Set(this.channels).size!==new Set(u).size||new Set(this.groups).size!==new Set(p).size){const m=Oe(this.channels,s),_=Oe(this.groups,o);this.dependencies.presenceState&&(m==null||m.forEach(E=>delete this.dependencies.presenceState[E]),_==null||_.forEach(E=>delete this.dependencies.presenceState[E])),this.channels=u,this.groups=p,this.engine.transition(or(Array.from(new Set(this.channels.slice(0))),Array.from(new Set(this.groups.slice(0))))),this.dependencies.leave&&this.dependencies.leave({channels:m.slice(0),groups:_.slice(0)})}}unsubscribeAll(s){const o=this.getSubscribedChannels(),u=this.getSubscribedChannels();this.channels=[],this.groups=[],this.dependencies.presenceState&&Object.keys(this.dependencies.presenceState).forEach(p=>{delete this.dependencies.presenceState[p]}),this.engine.transition(or(this.channels.slice(0),this.groups.slice(0),s)),this.dependencies.leaveAll&&this.dependencies.leaveAll({channels:u,groups:o,isOffline:s})}reconnect({timetoken:s,region:o}){const u=this.getSubscribedChannels(),p=this.getSubscribedChannels();this.engine.transition(li(s,o)),this.dependencies.presenceReconnect&&this.dependencies.presenceReconnect({channels:p,groups:u})}disconnect(s){const o=this.getSubscribedChannels(),u=this.getSubscribedChannels();this.engine.transition(Vn(s)),this.dependencies.presenceDisconnect&&this.dependencies.presenceDisconnect({channels:u,groups:o,isOffline:s})}getSubscribedChannels(){return Array.from(new Set(this.channels.slice(0)))}getSubscribedChannelGroups(){return Array.from(new Set(this.groups.slice(0)))}dispose(){this.disconnect(!0),this._unsubscribeEngine(),this.dispatcher.dispose()}}class Sd extends Le{constructor(s){var o;const u=(o=s.sendByPost)!==null&&o!==void 0&&o;super({method:u?ge.POST:ge.GET,compressible:u}),this.parameters=s,this.parameters.sendByPost=u}operation(){return Ae.PNPublishOperation}validate(){const{message:s,channel:o,keySet:{publishKey:u}}=this.parameters;return o?s?u?void 0:"Missing 'publishKey'":"Missing 'message'":"Missing 'channel'"}parse(s){return l(this,void 0,void 0,function*(){return{timetoken:this.deserializeResponse(s)[2]}})}get path(){const{message:s,channel:o,keySet:u}=this.parameters,p=this.prepareMessagePayload(s);return`/publish/${u.publishKey}/${u.subscribeKey}/0/${fe(o)}/0${this.parameters.sendByPost?"":`/${fe(p)}`}`}get queryParameters(){const{customMessageType:s,meta:o,replicate:u,storeInHistory:p,ttl:m}=this.parameters,_={};return s&&(_.custom_message_type=s),p!==void 0&&(_.store=p?"1":"0"),m!==void 0&&(_.ttl=m),u===void 0||u||(_.norep="true"),o&&typeof o=="object"&&(_.meta=JSON.stringify(o)),_}get headers(){var s;if(this.parameters.sendByPost)return Object.assign(Object.assign({},(s=super.headers)!==null&&s!==void 0?s:{}),{"Content-Type":"application/json"})}get body(){return this.prepareMessagePayload(this.parameters.message)}prepareMessagePayload(s){const{crypto:o}=this.parameters;if(!o)return JSON.stringify(s)||"";const u=o.encrypt(JSON.stringify(s));return JSON.stringify(typeof u=="string"?u:v(u))}}class Td extends Le{constructor(s){super(),this.parameters=s}operation(){return Ae.PNSignalOperation}validate(){const{message:s,channel:o,keySet:{publishKey:u}}=this.parameters;return o?s?u?void 0:"Missing 'publishKey'":"Missing 'message'":"Missing 'channel'"}parse(s){return l(this,void 0,void 0,function*(){return{timetoken:this.deserializeResponse(s)[2]}})}get path(){const{keySet:{publishKey:s,subscribeKey:o},channel:u,message:p}=this.parameters,m=JSON.stringify(p);return`/signal/${s}/${o}/0/${fe(u)}/0/${fe(m)}`}get queryParameters(){const{customMessageType:s}=this.parameters,o={};return s&&(o.custom_message_type=s),o}}class Ad extends ii{operation(){return Ae.PNReceiveMessagesOperation}validate(){return super.validate()||(this.parameters.timetoken?this.parameters.region?void 0:"region can not be empty":"timetoken can not be empty")}get path(){const{keySet:{subscribeKey:s},channels:o=[]}=this.parameters;return`/v2/subscribe/${s}/${Ue(o.sort(),",")}/0`}get queryParameters(){const{channelGroups:s,filterExpression:o,timetoken:u,region:p}=this.parameters,m={ee:""};return s&&s.length>0&&(m["channel-group"]=s.sort().join(",")),o&&o.length>0&&(m["filter-expr"]=o),typeof u=="string"?u&&u.length>0&&(m.tt=u):u&&u>0&&(m.tt=u),p&&(m.tr=p),m}}class Cd extends ii{operation(){return Ae.PNHandshakeOperation}get path(){const{keySet:{subscribeKey:s},channels:o=[]}=this.parameters;return`/v2/subscribe/${s}/${Ue(o.sort(),",")}/0`}get queryParameters(){const{channelGroups:s,filterExpression:o,state:u}=this.parameters,p={tt:0,ee:""};return s&&s.length>0&&(p["channel-group"]=s.sort().join(",")),o&&o.length>0&&(p["filter-expr"]=o),u&&Object.keys(u).length>0&&(p.state=JSON.stringify(u)),p}}class Pd extends Le{constructor(s){var o,u,p,m;super(),this.parameters=s,(o=(p=this.parameters).channels)!==null&&o!==void 0||(p.channels=[]),(u=(m=this.parameters).channelGroups)!==null&&u!==void 0||(m.channelGroups=[])}operation(){return Ae.PNGetStateOperation}validate(){const{keySet:{subscribeKey:s},channels:o,channelGroups:u}=this.parameters;if(!s)return"Missing Subscribe Key"}parse(s){return l(this,void 0,void 0,function*(){const o=this.deserializeResponse(s),{channels:u=[],channelGroups:p=[]}=this.parameters,m={channels:{}};return u.length===1&&p.length===0?m.channels[u[0]]=o.payload:m.channels=o.payload,m})}get path(){const{keySet:{subscribeKey:s},uuid:o,channels:u}=this.parameters;return`/v2/presence/sub-key/${s}/channel/${Ue(u??[],",")}/uuid/${o}`}get queryParameters(){const{channelGroups:s}=this.parameters;return s&&s.length!==0?{"channel-group":s.join(",")}:{}}}class Id extends Le{constructor(s){super(),this.parameters=s}operation(){return Ae.PNSetStateOperation}validate(){const{keySet:{subscribeKey:s},state:o,channels:u=[],channelGroups:p=[]}=this.parameters;return s?o?(u==null?void 0:u.length)===0&&(p==null?void 0:p.length)===0?"Please provide a list of channels and/or channel-groups":void 0:"Missing State":"Missing Subscribe Key"}parse(s){return l(this,void 0,void 0,function*(){return{state:this.deserializeResponse(s).payload}})}get path(){const{keySet:{subscribeKey:s},uuid:o,channels:u}=this.parameters;return`/v2/presence/sub-key/${s}/channel/${Ue(u??[],",")}/uuid/${fe(o)}/data`}get queryParameters(){const{channelGroups:s,state:o}=this.parameters,u={state:JSON.stringify(o)};return s&&s.length!==0&&(u["channel-group"]=s.join(",")),u}}class xh extends Le{constructor(s){super({cancellable:!0}),this.parameters=s}operation(){return Ae.PNHeartbeatOperation}validate(){const{keySet:{subscribeKey:s},channels:o=[],channelGroups:u=[]}=this.parameters;return s?o.length===0&&u.length===0?"Please provide a list of channels and/or channel-groups":void 0:"Missing Subscribe Key"}parse(s){const o=Object.create(null,{parse:{get:()=>super.parse}});return l(this,void 0,void 0,function*(){return o.parse.call(this,s).then(u=>({}))})}get path(){const{keySet:{subscribeKey:s},channels:o}=this.parameters;return`/v2/presence/sub-key/${s}/channel/${Ue(o??[],",")}/heartbeat`}get queryParameters(){const{channelGroups:s,state:o,heartbeat:u}=this.parameters,p={heartbeat:`${u}`};return s&&s.length!==0&&(p["channel-group"]=s.join(",")),o&&(p.state=JSON.stringify(o)),p}}class Rd extends Le{constructor(s){super(),this.parameters=s,this.parameters.channelGroups&&(this.parameters.channelGroups=Array.from(new Set(this.parameters.channelGroups))),this.parameters.channels&&(this.parameters.channels=Array.from(new Set(this.parameters.channels)))}operation(){return Ae.PNUnsubscribeOperation}validate(){const{keySet:{subscribeKey:s},channels:o=[],channelGroups:u=[]}=this.parameters;return s?o.length===0&&u.length===0?"At least one `channel` or `channel group` should be provided.":void 0:"Missing Subscribe Key"}parse(s){const o=Object.create(null,{parse:{get:()=>super.parse}});return l(this,void 0,void 0,function*(){return o.parse.call(this,s).then(u=>({}))})}get path(){var s;const{keySet:{subscribeKey:o},channels:u}=this.parameters;return`/v2/presence/sub-key/${o}/channel/${Ue((s=u==null?void 0:u.sort())!==null&&s!==void 0?s:[],",")}/leave`}get queryParameters(){const{channelGroups:s}=this.parameters;return s&&s.length!==0?{"channel-group":s.sort().join(",")}:{}}}class Md extends Le{constructor(s){super(),this.parameters=s}operation(){return Ae.PNWhereNowOperation}validate(){if(!this.parameters.keySet.subscribeKey)return"Missing Subscribe Key"}parse(s){return l(this,void 0,void 0,function*(){const o=this.deserializeResponse(s);return o.payload?{channels:o.payload.channels}:{channels:[]}})}get path(){const{keySet:{subscribeKey:s},uuid:o}=this.parameters;return`/v2/presence/sub-key/${s}/uuid/${fe(o)}`}}class Od extends Le{constructor(s){var o,u,p,m,_,E;super(),this.parameters=s,(o=(m=this.parameters).queryParameters)!==null&&o!==void 0||(m.queryParameters={}),(u=(_=this.parameters).includeUUIDs)!==null&&u!==void 0||(_.includeUUIDs=!0),(p=(E=this.parameters).includeState)!==null&&p!==void 0||(E.includeState=!1)}operation(){const{channels:s=[],channelGroups:o=[]}=this.parameters;return s.length===0&&o.length===0?Ae.PNGlobalHereNowOperation:Ae.PNHereNowOperation}validate(){if(!this.parameters.keySet.subscribeKey)return"Missing Subscribe Key"}parse(s){return l(this,void 0,void 0,function*(){var o,u;const p=this.deserializeResponse(s),m="occupancy"in p?1:p.payload.total_channels,_="occupancy"in p?p.occupancy:p.payload.total_occupancy,E={};let A={};if("occupancy"in p){const I=this.parameters.channels[0];A[I]={uuids:(o=p.uuids)!==null&&o!==void 0?o:[],occupancy:_}}else A=(u=p.payload.channels)!==null&&u!==void 0?u:{};return Object.keys(A).forEach(I=>{const X=A[I];E[I]={occupants:this.parameters.includeUUIDs?X.uuids.map(G=>typeof G=="string"?{uuid:G,state:null}:G):[],name:I,occupancy:X.occupancy}}),{totalChannels:m,totalOccupancy:_,channels:E}})}get path(){const{keySet:{subscribeKey:s},channels:o,channelGroups:u}=this.parameters;let p=`/v2/presence/sub-key/${s}`;return(o&&o.length>0||u&&u.length>0)&&(p+=`/channel/${Ue(o??[],",")}`),p}get queryParameters(){const{channelGroups:s,includeUUIDs:o,includeState:u,queryParameters:p}=this.parameters;return Object.assign(Object.assign(Object.assign(Object.assign({},o?{}:{disable_uuids:"1"}),u!=null&&u?{state:"1"}:{}),s&&s.length>0?{"channel-group":s.join(",")}:{}),p)}}class kd extends Le{constructor(s){super({method:ge.DELETE}),this.parameters=s}operation(){return Ae.PNDeleteMessagesOperation}validate(){return this.parameters.keySet.subscribeKey?this.parameters.channel?void 0:"Missing channel":"Missing Subscribe Key"}parse(s){const o=Object.create(null,{parse:{get:()=>super.parse}});return l(this,void 0,void 0,function*(){return o.parse.call(this,s).then(u=>({}))})}get path(){const{keySet:{subscribeKey:s},channel:o}=this.parameters;return`/v3/history/sub-key/${s}/channel/${fe(o)}`}get queryParameters(){const{start:s,end:o}=this.parameters;return Object.assign(Object.assign({},s?{start:s}:{}),o?{end:o}:{})}}class Nd extends Le{constructor(s){super(),this.parameters=s}operation(){return Ae.PNMessageCounts}validate(){const{keySet:{subscribeKey:s},channels:o,timetoken:u,channelTimetokens:p}=this.parameters;return s?o?u&&p?"`timetoken` and `channelTimetokens` are incompatible together":u||p?p&&p.length>1&&p.length!==o.length?"Length of `channelTimetokens` and `channels` do not match":void 0:"`timetoken` or `channelTimetokens` need to be set":"Missing channels":"Missing Subscribe Key"}parse(s){return l(this,void 0,void 0,function*(){return{channels:this.deserializeResponse(s).channels}})}get path(){return`/v3/history/sub-key/${this.parameters.keySet.subscribeKey}/message-counts/${Ue(this.parameters.channels)}`}get queryParameters(){let{channelTimetokens:s}=this.parameters;return this.parameters.timetoken&&(s=[this.parameters.timetoken]),Object.assign(Object.assign({},s.length===1?{timetoken:s[0]}:{}),s.length>1?{channelsTimetoken:s.join(",")}:{})}}class Wn extends Le{constructor(s){var o,u,p;super(),this.parameters=s,s.count?s.count=Math.min(s.count,100):s.count=100,(o=s.stringifiedTimeToken)!==null&&o!==void 0||(s.stringifiedTimeToken=!1),(u=s.includeMeta)!==null&&u!==void 0||(s.includeMeta=!1),(p=s.logVerbosity)!==null&&p!==void 0||(s.logVerbosity=!1)}operation(){return Ae.PNHistoryOperation}validate(){return this.parameters.keySet.subscribeKey?this.parameters.channel?void 0:"Missing channel":"Missing Subscribe Key"}parse(s){return l(this,void 0,void 0,function*(){const o=this.deserializeResponse(s),u=o[0],p=o[1],m=o[2];return Array.isArray(u)?{messages:u.map(_=>{const E=this.processPayload(_.message),A={entry:E.payload,timetoken:_.timetoken};return E.error&&(A.error=E.error),_.meta&&(A.meta=_.meta),A}),startTimeToken:p,endTimeToken:m}:{messages:[],startTimeToken:p,endTimeToken:m}})}get path(){const{keySet:{subscribeKey:s},channel:o}=this.parameters;return`/v2/history/sub-key/${s}/channel/${fe(o)}`}get queryParameters(){const{start:s,end:o,reverse:u,count:p,stringifiedTimeToken:m,includeMeta:_}=this.parameters;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({count:p,include_token:"true"},s?{start:s}:{}),o?{end:o}:{}),m?{string_message_token:"true"}:{}),u!=null?{reverse:u.toString()}:{}),_?{include_meta:"true"}:{})}processPayload(s){const{crypto:o,logVerbosity:u}=this.parameters;if(!o||typeof s!="string")return{payload:s};let p,m;try{const _=o.decrypt(s);p=_ instanceof ArrayBuffer?JSON.parse(Wn.decoder.decode(_)):_}catch(_){u&&console.log("decryption error",_.message),p=s,m=`Error while decrypting message content: ${_.message}`}return{payload:p,error:m}}}var Oi;(function(f){f[f.Message=-1]="Message",f[f.Files=4]="Files"})(Oi||(Oi={}));class zn extends Le{constructor(s){var o,u,p,m,_;super(),this.parameters=s;const E=(o=s.includeMessageActions)!==null&&o!==void 0&&o,A=s.channels.length>1||E?25:100;s.count?s.count=Math.min(s.count,A):s.count=A,s.includeUuid?s.includeUUID=s.includeUuid:(u=s.includeUUID)!==null&&u!==void 0||(s.includeUUID=!0),(p=s.stringifiedTimeToken)!==null&&p!==void 0||(s.stringifiedTimeToken=!1),(m=s.includeMessageType)!==null&&m!==void 0||(s.includeMessageType=!0),(_=s.logVerbosity)!==null&&_!==void 0||(s.logVerbosity=!1)}operation(){return Ae.PNFetchMessagesOperation}validate(){const{keySet:{subscribeKey:s},channels:o,includeMessageActions:u}=this.parameters;return s?o?u!==void 0&&u&&o.length>1?"History can return actions data for a single channel only. Either pass a single channel or disable the includeMessageActions flag.":void 0:"Missing channels":"Missing Subscribe Key"}parse(s){return l(this,void 0,void 0,function*(){var o;const u=this.deserializeResponse(s),p=(o=u.channels)!==null&&o!==void 0?o:{},m={};return Object.keys(p).forEach(_=>{m[_]=p[_].map(E=>{E.message_type===null&&(E.message_type=Oi.Message);const A=this.processPayload(_,E),I=Object.assign(Object.assign({channel:_,timetoken:E.timetoken,message:A.payload,messageType:E.message_type},E.custom_message_type?{customMessageType:E.custom_message_type}:{}),{uuid:E.uuid});if(E.actions){const X=I;X.actions=E.actions,X.data=E.actions}return E.meta&&(I.meta=E.meta),A.error&&(I.error=A.error),I})}),u.more?{channels:m,more:u.more}:{channels:m}})}get path(){const{keySet:{subscribeKey:s},channels:o,includeMessageActions:u}=this.parameters;return`/v3/${u?"history-with-actions":"history"}/sub-key/${s}/channel/${Ue(o)}`}get queryParameters(){const{start:s,end:o,count:u,includeCustomMessageType:p,includeMessageType:m,includeMeta:_,includeUUID:E,stringifiedTimeToken:A}=this.parameters;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({max:u},s?{start:s}:{}),o?{end:o}:{}),A?{string_message_token:"true"}:{}),_!==void 0&&_?{include_meta:"true"}:{}),E?{include_uuid:"true"}:{}),p!=null?{include_custom_message_type:p?"true":"false"}:{}),m?{include_message_type:"true"}:{})}processPayload(s,o){const{crypto:u,logVerbosity:p}=this.parameters;if(!u||typeof o.message!="string")return{payload:o.message};let m,_;try{const E=u.decrypt(o.message);m=E instanceof ArrayBuffer?JSON.parse(zn.decoder.decode(E)):E}catch(E){p&&console.log("decryption error",E.message),m=o.message,_=`Error while decrypting message content: ${E.message}`}if(!_&&m&&o.message_type==Oi.Files&&typeof m=="object"&&this.isFileMessage(m)){const E=m;return{payload:{message:E.message,file:Object.assign(Object.assign({},E.file),{url:this.parameters.getFileUrl({channel:s,id:E.file.id,name:E.file.name})})},error:_}}return{payload:m,error:_}}isFileMessage(s){return s.file!==void 0}}class Dd extends Le{constructor(s){super(),this.parameters=s}operation(){return Ae.PNGetMessageActionsOperation}validate(){return this.parameters.keySet.subscribeKey?this.parameters.channel?void 0:"Missing message channel":"Missing Subscribe Key"}parse(s){return l(this,void 0,void 0,function*(){const o=this.deserializeResponse(s);let u=null,p=null;return o.data.length>0&&(u=o.data[0].actionTimetoken,p=o.data[o.data.length-1].actionTimetoken),{data:o.data,more:o.more,start:u,end:p}})}get path(){const{keySet:{subscribeKey:s},channel:o}=this.parameters;return`/v1/message-actions/${s}/channel/${fe(o)}`}get queryParameters(){const{limit:s,start:o,end:u}=this.parameters;return Object.assign(Object.assign(Object.assign({},o?{start:o}:{}),u?{end:u}:{}),s?{limit:s}:{})}}class Fd extends Le{constructor(s){super({method:ge.POST}),this.parameters=s}operation(){return Ae.PNAddMessageActionOperation}validate(){const{keySet:{subscribeKey:s},action:o,channel:u,messageTimetoken:p}=this.parameters;return s?u?p?o?o.value?o.type?o.type.length>15?"Action.type value exceed maximum length of 15":void 0:"Missing Action.type":"Missing Action.value":"Missing Action":"Missing message timetoken":"Missing message channel":"Missing Subscribe Key"}parse(s){const o=Object.create(null,{parse:{get:()=>super.parse}});return l(this,void 0,void 0,function*(){return o.parse.call(this,s).then(({data:u})=>({data:u}))})}get path(){const{keySet:{subscribeKey:s},channel:o,messageTimetoken:u}=this.parameters;return`/v1/message-actions/${s}/channel/${fe(o)}/message/${u}`}get headers(){var s;return Object.assign(Object.assign({},(s=super.headers)!==null&&s!==void 0?s:{}),{"Content-Type":"application/json"})}get body(){return JSON.stringify(this.parameters.action)}}class Bd extends Le{constructor(s){super({method:ge.DELETE}),this.parameters=s}operation(){return Ae.PNRemoveMessageActionOperation}validate(){const{keySet:{subscribeKey:s},channel:o,messageTimetoken:u,actionTimetoken:p}=this.parameters;return s?o?u?p?void 0:"Missing action timetoken":"Missing message timetoken":"Missing message action channel":"Missing Subscribe Key"}parse(s){const o=Object.create(null,{parse:{get:()=>super.parse}});return l(this,void 0,void 0,function*(){return o.parse.call(this,s).then(({data:u})=>({data:u}))})}get path(){const{keySet:{subscribeKey:s},channel:o,actionTimetoken:u,messageTimetoken:p}=this.parameters;return`/v1/message-actions/${s}/channel/${fe(o)}/message/${p}/action/${u}`}}class Ld extends Le{constructor(s){var o,u;super(),this.parameters=s,(o=(u=this.parameters).storeInHistory)!==null&&o!==void 0||(u.storeInHistory=!0)}operation(){return Ae.PNPublishFileMessageOperation}validate(){const{channel:s,fileId:o,fileName:u}=this.parameters;return s?o?u?void 0:"file name can't be empty":"file id can't be empty":"channel can't be empty"}parse(s){return l(this,void 0,void 0,function*(){return{timetoken:this.deserializeResponse(s)[2]}})}get path(){const{message:s,channel:o,keySet:{publishKey:u,subscribeKey:p},fileId:m,fileName:_}=this.parameters,E=Object.assign({file:{name:_,id:m}},s?{message:s}:{});return`/v1/files/publish-file/${u}/${p}/0/${fe(o)}/0/${fe(this.prepareMessagePayload(E))}`}get queryParameters(){const{customMessageType:s,storeInHistory:o,ttl:u,meta:p}=this.parameters;return Object.assign(Object.assign(Object.assign({store:o?"1":"0"},s?{custom_message_type:s}:{}),u?{ttl:u}:{}),p&&typeof p=="object"?{meta:JSON.stringify(p)}:{})}prepareMessagePayload(s){const{crypto:o}=this.parameters;if(!o)return JSON.stringify(s)||"";const u=o.encrypt(JSON.stringify(s));return JSON.stringify(typeof u=="string"?u:v(u))}}class Ud extends Le{constructor(s){super({method:ge.LOCAL}),this.parameters=s}operation(){return Ae.PNGetFileUrlOperation}validate(){const{channel:s,id:o,name:u}=this.parameters;return s?o?u?void 0:"file name can't be empty":"file id can't be empty":"channel can't be empty"}parse(s){return l(this,void 0,void 0,function*(){return s.url})}get path(){const{channel:s,id:o,name:u,keySet:{subscribeKey:p}}=this.parameters;return`/v1/files/${p}/channels/${fe(s)}/files/${o}/${u}`}}class Gd extends Le{constructor(s){super({method:ge.DELETE}),this.parameters=s}operation(){return Ae.PNDeleteFileOperation}validate(){const{channel:s,id:o,name:u}=this.parameters;return s?o?u?void 0:"file name can't be empty":"file id can't be empty":"channel can't be empty"}get path(){const{keySet:{subscribeKey:s},id:o,channel:u,name:p}=this.parameters;return`/v1/files/${s}/channels/${fe(u)}/files/${o}/${p}`}}class jd extends Le{constructor(s){var o,u;super(),this.parameters=s,(o=(u=this.parameters).limit)!==null&&o!==void 0||(u.limit=100)}operation(){return Ae.PNListFilesOperation}validate(){if(!this.parameters.channel)return"channel can't be empty"}get path(){const{keySet:{subscribeKey:s},channel:o}=this.parameters;return`/v1/files/${s}/channels/${fe(o)}/files`}get queryParameters(){const{limit:s,next:o}=this.parameters;return Object.assign({limit:s},o?{next:o}:{})}}class Hd extends Le{constructor(s){super({method:ge.POST}),this.parameters=s}operation(){return Ae.PNGenerateUploadUrlOperation}validate(){return this.parameters.channel?this.parameters.name?void 0:"'name' can't be empty":"channel can't be empty"}parse(s){return l(this,void 0,void 0,function*(){const o=this.deserializeResponse(s);return{id:o.data.id,name:o.data.name,url:o.file_upload_request.url,formFields:o.file_upload_request.form_fields}})}get path(){const{keySet:{subscribeKey:s},channel:o}=this.parameters;return`/v1/files/${s}/channels/${fe(o)}/generate-upload-url`}get headers(){var s;return Object.assign(Object.assign({},(s=super.headers)!==null&&s!==void 0?s:{}),{"Content-Type":"application/json"})}get body(){return JSON.stringify({name:this.parameters.name})}}class qn extends Le{constructor(s){super({method:ge.POST}),this.parameters=s;const o=s.file.mimeType;o&&(s.formFields=s.formFields.map(u=>u.name==="Content-Type"?{name:u.name,value:o}:u))}operation(){return Ae.PNPublishFileOperation}validate(){const{fileId:s,fileName:o,file:u,uploadUrl:p}=this.parameters;return s?o?u?p?void 0:"Validation failed: file upload 'url' can't be empty":"Validation failed: 'file' can't be empty":"Validation failed: file 'name' can't be empty":"Validation failed: file 'id' can't be empty"}parse(s){return l(this,void 0,void 0,function*(){return{status:s.status,message:s.body?qn.decoder.decode(s.body):"OK"}})}request(){return Object.assign(Object.assign({},super.request()),{origin:new URL(this.parameters.uploadUrl).origin,timeout:300})}get path(){const{pathname:s,search:o}=new URL(this.parameters.uploadUrl);return`${s}${o}`}get body(){return this.parameters.file}get formData(){return this.parameters.formFields}}class $d{constructor(s){var o;if(this.parameters=s,this.file=(o=this.parameters.PubNubFile)===null||o===void 0?void 0:o.create(s.file),!this.file)throw new Error("File upload error: unable to create File object.")}process(){return l(this,void 0,void 0,function*(){let s,o;return this.generateFileUploadUrl().then(u=>(s=u.name,o=u.id,this.uploadFile(u))).then(u=>{if(u.status!==204)throw new x("Upload to bucket was unsuccessful",{error:!0,statusCode:u.status,category:y.PNUnknownCategory,operation:Ae.PNPublishFileOperation,errorData:{message:u.message}})}).then(()=>this.publishFileMessage(o,s)).catch(u=>{if(u instanceof x)throw u;const p=u instanceof k?u:k.create(u);throw new x("File upload error.",p.toStatus(Ae.PNPublishFileOperation))})})}generateFileUploadUrl(){return l(this,void 0,void 0,function*(){const s=new Hd(Object.assign(Object.assign({},this.parameters),{name:this.file.name,keySet:this.parameters.keySet}));return this.parameters.sendRequest(s)})}uploadFile(s){return l(this,void 0,void 0,function*(){const{cipherKey:o,PubNubFile:u,crypto:p,cryptography:m}=this.parameters,{id:_,name:E,url:A,formFields:I}=s;return this.parameters.PubNubFile.supportsEncryptFile&&(!o&&p?this.file=yield p.encryptFile(this.file,u):o&&m&&(this.file=yield m.encryptFile(o,this.file,u))),this.parameters.sendRequest(new qn({fileId:_,fileName:E,file:this.file,uploadUrl:A,formFields:I}))})}publishFileMessage(s,o){return l(this,void 0,void 0,function*(){var u,p,m,_;let E,A={timetoken:"0"},I=this.parameters.fileUploadPublishRetryLimit,X=!1;do try{A=yield this.parameters.publishFile(Object.assign(Object.assign({},this.parameters),{fileId:s,fileName:o})),X=!0}catch(G){G instanceof x&&(E=G),I-=1}while(!X&&I>0);if(X)return{status:200,timetoken:A.timetoken,id:s,name:o};throw new x("Publish failed. You may want to execute that operation manually using pubnub.publishFile",{error:!0,category:(p=(u=E.status)===null||u===void 0?void 0:u.category)!==null&&p!==void 0?p:y.PNUnknownCategory,statusCode:(_=(m=E.status)===null||m===void 0?void 0:m.statusCode)!==null&&_!==void 0?_:0,channel:this.parameters.channel,id:s,name:o})})}}class Eh{subscribe(s){const o=s==null?void 0:s.timetoken;this.pubnub.registerSubscribeCapable(this),this.subscribedAutomatically=!1,this.subscribed=!0,this.pubnub.subscribe(Object.assign({channels:this.channelNames,channelGroups:this.groupNames},o!==null&&o!==""&&{timetoken:o}))}unsubscribe(){this.pubnub.unregisterSubscribeCapable(this),this.subscribedAutomatically=!1,this.subscribed=!1;const{channels:s,channelGroups:o}=this.pubnub.getSubscribeCapableEntities(),u=this.groupNames.filter(m=>!o.includes(m)),p=this.channelNames.filter(m=>!s.includes(m));p.length===0&&u.length===0||this.pubnub.unsubscribe({channels:p,channelGroups:u})}set onMessage(s){this.typeBasedListener.message=s}set onPresence(s){this.typeBasedListener.presence=s}set onSignal(s){this.typeBasedListener.signal=s}set onObjects(s){this.typeBasedListener.objects=s}set onMessageAction(s){this.typeBasedListener.messageAction=s}set onFile(s){this.typeBasedListener.file=s}addListener(s){this.aggregatedListener&&this.aggregatedListener!==s&&this.removeListener(this.aggregatedListener),this.aggregatedListenerId=this.eventEmitter.addListener(s,this.channelNames,this.groupNames),this.aggregatedListener=s}removeListener(s){this.aggregatedListener&&(this.eventEmitter.removeListener(s,this.aggregatedListenerId,this.channelNames,this.groupNames),this.aggregatedListenerId=void 0,this.aggregatedListener=void 0)}get channels(){return this.channelNames.slice(0)}get channelGroups(){return this.groupNames.slice(0)}}class wh extends Eh{constructor({channels:s=[],channelGroups:o=[],subscriptionOptions:u,eventEmitter:p,pubnub:m}){super(),this.channelNames=[],this.groupNames=[],this.subscriptionList=[],this.subscribedAutomatically=!1,this.subscribed=!1,this.options=u,this.eventEmitter=p,this.pubnub=m,s.forEach(_=>this.subscriptionList.push(this.pubnub.channel(_).subscription(this.options))),o.forEach(_=>this.subscriptionList.push(this.pubnub.channelGroup(_).subscription(this.options))),this.typeBasedListener={},this.typeBasedListenerId=p.addListener(this.typeBasedListener,this.channelNames,this.groupNames),this.updateListeners()}addSubscription(s){this.subscriptionList.includes(s)||this.subscriptionList.push(s),this.updateListeners(),this.subscribed&&!s.subscribed&&(s.subscribe(),s.subscribedAutomatically=!0)}removeSubscription(s){this.subscriptionList=this.subscriptionList.filter(o=>o!==s),this.updateListeners(),s.subscribedAutomatically&&s.unsubscribe()}addSubscriptionSet(s){this.subscriptionList=Array.from(new Set([...this.subscriptionList,...s.subscriptions])),this.updateListeners(),this.subscribed&&!s.subscribed&&(s.subscribe(),s.subscribedAutomatically=!0)}removeSubscriptionSet(s){this.subscriptionList=this.subscriptionList.filter(o=>!s.subscriptions.includes(o)),this.updateListeners(),s.subscribedAutomatically&&s.unsubscribe()}get subscriptions(){return this.subscriptionList.slice(0)}updateListeners(){const s=[],o=[];this.subscriptionList.forEach(A=>{A.channelGroups.length&&s.push(...A.channelGroups),A.channels.length&&o.push(...A.channels)});const u=this.channelNames.filter(A=>!o.includes(A)),p=this.groupNames.filter(A=>!s.includes(A)),m=o.filter(A=>!this.channelNames.includes(A)),_=s.filter(A=>!this.groupNames.includes(A));(u.length||p.length)&&this.eventEmitter.removeListener(this.typeBasedListener,this.typeBasedListenerId,u,p),(m.length||_.length)&&this.eventEmitter.addListener(this.typeBasedListener,m,_,this.typeBasedListenerId);const E=this.aggregatedListener;E&&this.removeListener(E),this.groupNames=s,this.channelNames=o,E&&this.addListener(E)}}class ki extends Eh{constructor({channels:s,channelGroups:o,subscriptionOptions:u,eventEmitter:p,pubnub:m}){super(),this.channelNames=[],this.groupNames=[],this.subscribedAutomatically=!1,this.subscribed=!1,this.channelNames=s,this.groupNames=o,this.options=u,this.pubnub=m,this.eventEmitter=p,this.typeBasedListener={},p.addListener(this.typeBasedListener,this.channelNames,this.groupNames)}addSubscription(s){const o=new wh({channels:[...this.channelNames,...s.channels],channelGroups:[...this.groupNames,...s.channelGroups],subscriptionOptions:Object.assign(Object.assign({},this.options),s==null?void 0:s.options),eventEmitter:this.eventEmitter,pubnub:this.pubnub});return this.subscribed&&(s.subscribed||(s.subscribe(),s.subscribedAutomatically=!0),this.aggregatedListener&&o.addListener(this.aggregatedListener),this.pubnub.registerSubscribeCapable(o),o.subscribed=!0),o}}class Vd{constructor(s,o,u){this.eventEmitter=o,this.pubnub=u,this.id=s}subscription(s){return new ki({channels:[this.id],channelGroups:[],subscriptionOptions:s,eventEmitter:this.eventEmitter,pubnub:this.pubnub})}}class Wd{constructor(s,o,u){this.eventEmitter=o,this.pubnub=u,this.name=s}subscription(s){{const o=[this.name];return s!=null&&s.receivePresenceEvents&&!this.name.endsWith("-pnpres")&&o.push(`${this.name}-pnpres`),new ki({channels:[],channelGroups:o,subscriptionOptions:s,eventEmitter:this.eventEmitter,pubnub:this.pubnub})}}}class zd{constructor(s,o,u){this.eventEmitter=o,this.pubnub=u,this.id=s}subscription(s){return new ki({channels:[this.id],channelGroups:[],subscriptionOptions:s,eventEmitter:this.eventEmitter,pubnub:this.pubnub})}}class qd{constructor(s,o,u){this.eventEmitter=o,this.pubnub=u,this.name=s}subscription(s){{const o=[this.name];return s!=null&&s.receivePresenceEvents&&!this.name.endsWith("-pnpres")&&o.push(`${this.name}-pnpres`),new ki({channels:o,channelGroups:[],subscriptionOptions:s,eventEmitter:this.eventEmitter,pubnub:this.pubnub})}}}class Xd extends Le{constructor(s){super(),this.parameters=s}operation(){return Ae.PNRemoveChannelsFromGroupOperation}validate(){const{keySet:{subscribeKey:s},channels:o,channelGroup:u}=this.parameters;return s?u?o?void 0:"Missing channels":"Missing Channel Group":"Missing Subscribe Key"}parse(s){const o=Object.create(null,{parse:{get:()=>super.parse}});return l(this,void 0,void 0,function*(){return o.parse.call(this,s).then(u=>({}))})}get path(){const{keySet:{subscribeKey:s},channelGroup:o}=this.parameters;return`/v1/channel-registration/sub-key/${s}/channel-group/${fe(o)}`}get queryParameters(){return{remove:this.parameters.channels.join(",")}}}class Kd extends Le{constructor(s){super(),this.parameters=s}operation(){return Ae.PNAddChannelsToGroupOperation}validate(){const{keySet:{subscribeKey:s},channels:o,channelGroup:u}=this.parameters;return s?u?o?void 0:"Missing channels":"Missing Channel Group":"Missing Subscribe Key"}parse(s){const o=Object.create(null,{parse:{get:()=>super.parse}});return l(this,void 0,void 0,function*(){return o.parse.call(this,s).then(u=>({}))})}get path(){const{keySet:{subscribeKey:s},channelGroup:o}=this.parameters;return`/v1/channel-registration/sub-key/${s}/channel-group/${fe(o)}`}get queryParameters(){return{add:this.parameters.channels.join(",")}}}class Yd extends Le{constructor(s){super(),this.parameters=s}operation(){return Ae.PNChannelsForGroupOperation}validate(){return this.parameters.keySet.subscribeKey?this.parameters.channelGroup?void 0:"Missing Channel Group":"Missing Subscribe Key"}parse(s){return l(this,void 0,void 0,function*(){return{channels:this.deserializeResponse(s).payload.channels}})}get path(){const{keySet:{subscribeKey:s},channelGroup:o}=this.parameters;return`/v1/channel-registration/sub-key/${s}/channel-group/${fe(o)}`}}class Jd extends Le{constructor(s){super(),this.parameters=s}operation(){return Ae.PNRemoveGroupOperation}validate(){return this.parameters.keySet.subscribeKey?this.parameters.channelGroup?void 0:"Missing Channel Group":"Missing Subscribe Key"}parse(s){const o=Object.create(null,{parse:{get:()=>super.parse}});return l(this,void 0,void 0,function*(){return o.parse.call(this,s).then(u=>({}))})}get path(){const{keySet:{subscribeKey:s},channelGroup:o}=this.parameters;return`/v1/channel-registration/sub-key/${s}/channel-group/${fe(o)}/remove`}}class Zd extends Le{constructor(s){super(),this.parameters=s}operation(){return Ae.PNChannelGroupsOperation}validate(){if(!this.parameters.keySet.subscribeKey)return"Missing Subscribe Key"}parse(s){return l(this,void 0,void 0,function*(){return{groups:this.deserializeResponse(s).payload.groups}})}get path(){return`/v1/channel-registration/sub-key/${this.parameters.keySet.subscribeKey}/channel-group`}}class Qd{constructor(s,o){this.sendRequest=o,this.keySet=s}listChannels(s,o){return l(this,void 0,void 0,function*(){const u=new Yd(Object.assign(Object.assign({},s),{keySet:this.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)})}listGroups(s){return l(this,void 0,void 0,function*(){const o=new Zd({keySet:this.keySet});return s?this.sendRequest(o,s):this.sendRequest(o)})}addChannels(s,o){return l(this,void 0,void 0,function*(){const u=new Kd(Object.assign(Object.assign({},s),{keySet:this.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)})}removeChannels(s,o){return l(this,void 0,void 0,function*(){const u=new Xd(Object.assign(Object.assign({},s),{keySet:this.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)})}deleteGroup(s,o){return l(this,void 0,void 0,function*(){const u=new Jd(Object.assign(Object.assign({},s),{keySet:this.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)})}}class Ni extends Le{constructor(s){var o,u;super(),this.parameters=s,this.parameters.pushGateway==="apns2"&&((o=(u=this.parameters).environment)!==null&&o!==void 0||(u.environment="development")),this.parameters.count&&this.parameters.count>1e3&&(this.parameters.count=1e3)}operation(){throw Error("Should be implemented in subclass.")}validate(){const{keySet:{subscribeKey:s},action:o,device:u,pushGateway:p}=this.parameters;return s?u?o!=="add"&&o!=="remove"||"channels"in this.parameters&&this.parameters.channels.length!==0?p?this.parameters.pushGateway!=="apns2"||this.parameters.topic?void 0:"Missing APNS2 topic":"Missing GW Type (pushGateway: gcm or apns2)":"Missing Channels":"Missing Device ID (device)":"Missing Subscribe Key"}get path(){const{keySet:{subscribeKey:s},action:o,device:u,pushGateway:p}=this.parameters;let m=p==="apns2"?`/v2/push/sub-key/${s}/devices-apns2/${u}`:`/v1/push/sub-key/${s}/devices/${u}`;return o==="remove-device"&&(m=`${m}/remove`),m}get queryParameters(){const{start:s,count:o}=this.parameters;let u=Object.assign(Object.assign({type:this.parameters.pushGateway},s?{start:s}:{}),o&&o>0?{count:o}:{});if("channels"in this.parameters&&(u[this.parameters.action]=this.parameters.channels.join(",")),this.parameters.pushGateway==="apns2"){const{environment:p,topic:m}=this.parameters;u=Object.assign(Object.assign({},u),{environment:p,topic:m})}return u}}class ep extends Ni{constructor(s){super(Object.assign(Object.assign({},s),{action:"remove"}))}operation(){return Ae.PNRemovePushNotificationEnabledChannelsOperation}parse(s){const o=Object.create(null,{parse:{get:()=>super.parse}});return l(this,void 0,void 0,function*(){return o.parse.call(this,s).then(u=>({}))})}}class tp extends Ni{constructor(s){super(Object.assign(Object.assign({},s),{action:"list"}))}operation(){return Ae.PNPushNotificationEnabledChannelsOperation}parse(s){return l(this,void 0,void 0,function*(){return{channels:this.deserializeResponse(s)}})}}class rp extends Ni{constructor(s){super(Object.assign(Object.assign({},s),{action:"add"}))}operation(){return Ae.PNAddPushNotificationEnabledChannelsOperation}parse(s){const o=Object.create(null,{parse:{get:()=>super.parse}});return l(this,void 0,void 0,function*(){return o.parse.call(this,s).then(u=>({}))})}}class sp extends Ni{constructor(s){super(Object.assign(Object.assign({},s),{action:"remove-device"}))}operation(){return Ae.PNRemoveAllPushNotificationsOperation}parse(s){const o=Object.create(null,{parse:{get:()=>super.parse}});return l(this,void 0,void 0,function*(){return o.parse.call(this,s).then(u=>({}))})}}class ip{constructor(s,o){this.sendRequest=o,this.keySet=s}listChannels(s,o){return l(this,void 0,void 0,function*(){const u=new tp(Object.assign(Object.assign({},s),{keySet:this.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)})}addChannels(s,o){return l(this,void 0,void 0,function*(){const u=new rp(Object.assign(Object.assign({},s),{keySet:this.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)})}removeChannels(s,o){return l(this,void 0,void 0,function*(){const u=new ep(Object.assign(Object.assign({},s),{keySet:this.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)})}deleteDevice(s,o){return l(this,void 0,void 0,function*(){const u=new sp(Object.assign(Object.assign({},s),{keySet:this.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)})}}class np extends Le{constructor(s){var o,u,p,m,_,E;super(),this.parameters=s,(o=s.include)!==null&&o!==void 0||(s.include={}),(u=(_=s.include).customFields)!==null&&u!==void 0||(_.customFields=!1),(p=(E=s.include).totalCount)!==null&&p!==void 0||(E.totalCount=!1),(m=s.limit)!==null&&m!==void 0||(s.limit=100)}operation(){return Ae.PNGetAllChannelMetadataOperation}get path(){return`/v2/objects/${this.parameters.keySet.subscribeKey}/channels`}get queryParameters(){const{include:s,page:o,filter:u,sort:p,limit:m}=this.parameters;let _="";return _=typeof p=="string"?p:Object.entries(p??{}).map(([E,A])=>A!==null?`${E}:${A}`:E),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({include:["status","type",...s.customFields?["custom"]:[]].join(","),count:`${s.totalCount}`},u?{filter:u}:{}),o!=null&&o.next?{start:o.next}:{}),o!=null&&o.prev?{end:o.prev}:{}),m?{limit:m}:{}),_.length?{sort:_}:{})}}class ap extends Le{constructor(s){super({method:ge.DELETE}),this.parameters=s}operation(){return Ae.PNRemoveChannelMetadataOperation}validate(){if(!this.parameters.channel)return"Channel cannot be empty"}get path(){const{keySet:{subscribeKey:s},channel:o}=this.parameters;return`/v2/objects/${s}/channels/${fe(o)}`}}class op extends Le{constructor(s){var o,u,p,m,_,E,A,I,X,G,L,Q,B,j,$,te,ke,$e;super(),this.parameters=s,(o=s.include)!==null&&o!==void 0||(s.include={}),(u=(L=s.include).customFields)!==null&&u!==void 0||(L.customFields=!1),(p=(Q=s.include).totalCount)!==null&&p!==void 0||(Q.totalCount=!1),(m=(B=s.include).statusField)!==null&&m!==void 0||(B.statusField=!1),(_=(j=s.include).typeField)!==null&&_!==void 0||(j.typeField=!1),(E=($=s.include).channelFields)!==null&&E!==void 0||($.channelFields=!1),(A=(te=s.include).customChannelFields)!==null&&A!==void 0||(te.customChannelFields=!1),(I=(ke=s.include).channelStatusField)!==null&&I!==void 0||(ke.channelStatusField=!1),(X=($e=s.include).channelTypeField)!==null&&X!==void 0||($e.channelTypeField=!1),(G=s.limit)!==null&&G!==void 0||(s.limit=100),this.parameters.userId&&(this.parameters.uuid=this.parameters.userId)}operation(){return Ae.PNGetMembershipsOperation}validate(){if(!this.parameters.uuid)return"'uuid' cannot be empty"}get path(){const{keySet:{subscribeKey:s},uuid:o}=this.parameters;return`/v2/objects/${s}/uuids/${fe(o)}/channels`}get queryParameters(){const{include:s,page:o,filter:u,sort:p,limit:m}=this.parameters;let _="";_=typeof p=="string"?p:Object.entries(p??{}).map(([A,I])=>I!==null?`${A}:${I}`:A);const E=[];return s.statusField&&E.push("status"),s.typeField&&E.push("type"),s.customFields&&E.push("custom"),s.channelFields&&E.push("channel"),s.channelStatusField&&E.push("channel.status"),s.channelTypeField&&E.push("channel.type"),s.customChannelFields&&E.push("channel.custom"),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({count:`${s.totalCount}`},E.length>0?{include:E.join(",")}:{}),u?{filter:u}:{}),o!=null&&o.next?{start:o.next}:{}),o!=null&&o.prev?{end:o.prev}:{}),m?{limit:m}:{}),_.length?{sort:_}:{})}}class Sh extends Le{constructor(s){var o,u,p,m,_,E,A,I,X,G,L,Q,B,j,$,te,ke,$e;super({method:ge.PATCH}),this.parameters=s,(o=s.include)!==null&&o!==void 0||(s.include={}),(u=(L=s.include).customFields)!==null&&u!==void 0||(L.customFields=!1),(p=(Q=s.include).totalCount)!==null&&p!==void 0||(Q.totalCount=!1),(m=(B=s.include).statusField)!==null&&m!==void 0||(B.statusField=!1),(_=(j=s.include).typeField)!==null&&_!==void 0||(j.typeField=!1),(E=($=s.include).channelFields)!==null&&E!==void 0||($.channelFields=!1),(A=(te=s.include).customChannelFields)!==null&&A!==void 0||(te.customChannelFields=!1),(I=(ke=s.include).channelStatusField)!==null&&I!==void 0||(ke.channelStatusField=!1),(X=($e=s.include).channelTypeField)!==null&&X!==void 0||($e.channelTypeField=!1),(G=s.limit)!==null&&G!==void 0||(s.limit=100),this.parameters.userId&&(this.parameters.uuid=this.parameters.userId)}operation(){return Ae.PNSetMembershipsOperation}validate(){const{uuid:s,channels:o}=this.parameters;return s?o&&o.length!==0?void 0:"Channels cannot be empty":"'uuid' cannot be empty"}get path(){const{keySet:{subscribeKey:s},uuid:o}=this.parameters;return`/v2/objects/${s}/uuids/${fe(o)}/channels`}get queryParameters(){const{include:s,page:o,filter:u,sort:p,limit:m}=this.parameters;let _="";_=typeof p=="string"?p:Object.entries(p??{}).map(([A,I])=>I!==null?`${A}:${I}`:A);const E=["channel.status","channel.type","status"];return s.statusField&&E.push("status"),s.typeField&&E.push("type"),s.customFields&&E.push("custom"),s.channelFields&&E.push("channel"),s.channelStatusField&&E.push("channel.status"),s.channelTypeField&&E.push("channel.type"),s.customChannelFields&&E.push("channel.custom"),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({count:`${s.totalCount}`},E.length>0?{include:E.join(",")}:{}),u?{filter:u}:{}),o!=null&&o.next?{start:o.next}:{}),o!=null&&o.prev?{end:o.prev}:{}),m?{limit:m}:{}),_.length?{sort:_}:{})}get body(){const{channels:s,type:o}=this.parameters;return JSON.stringify({[`${o}`]:s.map(u=>typeof u=="string"?{channel:{id:u}}:{channel:{id:u.id},status:u.status,type:u.type,custom:u.custom})})}}class hp extends Le{constructor(s){var o,u,p,m;super(),this.parameters=s,(o=s.include)!==null&&o!==void 0||(s.include={}),(u=(m=s.include).customFields)!==null&&u!==void 0||(m.customFields=!1),(p=s.limit)!==null&&p!==void 0||(s.limit=100)}operation(){return Ae.PNGetAllUUIDMetadataOperation}get path(){return`/v2/objects/${this.parameters.keySet.subscribeKey}/uuids`}get queryParameters(){const{include:s,page:o,filter:u,sort:p,limit:m}=this.parameters;let _="";return _=typeof p=="string"?p:Object.entries(p??{}).map(([E,A])=>A!==null?`${E}:${A}`:E),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({include:["status","type",...s.customFields?["custom"]:[]].join(",")},s.totalCount!==void 0?{count:`${s.totalCount}`}:{}),u?{filter:u}:{}),o!=null&&o.next?{start:o.next}:{}),o!=null&&o.prev?{end:o.prev}:{}),m?{limit:m}:{}),_.length?{sort:_}:{})}}class lp extends Le{constructor(s){var o,u,p;super(),this.parameters=s,(o=s.include)!==null&&o!==void 0||(s.include={}),(u=(p=s.include).customFields)!==null&&u!==void 0||(p.customFields=!0)}operation(){return Ae.PNGetChannelMetadataOperation}validate(){if(!this.parameters.channel)return"Channel cannot be empty"}get path(){const{keySet:{subscribeKey:s},channel:o}=this.parameters;return`/v2/objects/${s}/channels/${fe(o)}`}get queryParameters(){return{include:["status","type",...this.parameters.include.customFields?["custom"]:[]].join(",")}}}class up extends Le{constructor(s){var o,u,p;super({method:ge.PATCH}),this.parameters=s,(o=s.include)!==null&&o!==void 0||(s.include={}),(u=(p=s.include).customFields)!==null&&u!==void 0||(p.customFields=!0)}operation(){return Ae.PNSetChannelMetadataOperation}validate(){return this.parameters.channel?this.parameters.data?void 0:"Data cannot be empty":"Channel cannot be empty"}get headers(){var s;return this.parameters.ifMatchesEtag?Object.assign(Object.assign({},(s=super.headers)!==null&&s!==void 0?s:{}),{"If-Match":this.parameters.ifMatchesEtag}):super.headers}get path(){const{keySet:{subscribeKey:s},channel:o}=this.parameters;return`/v2/objects/${s}/channels/${fe(o)}`}get queryParameters(){return{include:["status","type",...this.parameters.include.customFields?["custom"]:[]].join(",")}}get body(){return JSON.stringify(this.parameters.data)}}class cp extends Le{constructor(s){super({method:ge.DELETE}),this.parameters=s,this.parameters.userId&&(this.parameters.uuid=this.parameters.userId)}operation(){return Ae.PNRemoveUUIDMetadataOperation}validate(){if(!this.parameters.uuid)return"'uuid' cannot be empty"}get path(){const{keySet:{subscribeKey:s},uuid:o}=this.parameters;return`/v2/objects/${s}/uuids/${fe(o)}`}}class dp extends Le{constructor(s){var o,u,p,m,_,E,A,I,X,G,L,Q,B,j,$,te,ke,$e;super(),this.parameters=s,(o=s.include)!==null&&o!==void 0||(s.include={}),(u=(L=s.include).customFields)!==null&&u!==void 0||(L.customFields=!1),(p=(Q=s.include).totalCount)!==null&&p!==void 0||(Q.totalCount=!1),(m=(B=s.include).statusField)!==null&&m!==void 0||(B.statusField=!1),(_=(j=s.include).typeField)!==null&&_!==void 0||(j.typeField=!1),(E=($=s.include).UUIDFields)!==null&&E!==void 0||($.UUIDFields=!1),(A=(te=s.include).customUUIDFields)!==null&&A!==void 0||(te.customUUIDFields=!1),(I=(ke=s.include).UUIDStatusField)!==null&&I!==void 0||(ke.UUIDStatusField=!1),(X=($e=s.include).UUIDTypeField)!==null&&X!==void 0||($e.UUIDTypeField=!1),(G=s.limit)!==null&&G!==void 0||(s.limit=100)}operation(){return Ae.PNSetMembersOperation}validate(){if(!this.parameters.channel)return"Channel cannot be empty"}get path(){const{keySet:{subscribeKey:s},channel:o}=this.parameters;return`/v2/objects/${s}/channels/${fe(o)}/uuids`}get queryParameters(){const{include:s,page:o,filter:u,sort:p,limit:m}=this.parameters;let _="";_=typeof p=="string"?p:Object.entries(p??{}).map(([A,I])=>I!==null?`${A}:${I}`:A);const E=[];return s.statusField&&E.push("status"),s.typeField&&E.push("type"),s.customFields&&E.push("custom"),s.UUIDFields&&E.push("uuid"),s.UUIDStatusField&&E.push("uuid.status"),s.UUIDTypeField&&E.push("uuid.type"),s.customUUIDFields&&E.push("uuid.custom"),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({count:`${s.totalCount}`},E.length>0?{include:E.join(",")}:{}),u?{filter:u}:{}),o!=null&&o.next?{start:o.next}:{}),o!=null&&o.prev?{end:o.prev}:{}),m?{limit:m}:{}),_.length?{sort:_}:{})}}class Th extends Le{constructor(s){var o,u,p,m,_,E,A,I,X,G,L,Q,B,j,$,te,ke,$e;super({method:ge.PATCH}),this.parameters=s,(o=s.include)!==null&&o!==void 0||(s.include={}),(u=(L=s.include).customFields)!==null&&u!==void 0||(L.customFields=!1),(p=(Q=s.include).totalCount)!==null&&p!==void 0||(Q.totalCount=!1),(m=(B=s.include).statusField)!==null&&m!==void 0||(B.statusField=!1),(_=(j=s.include).typeField)!==null&&_!==void 0||(j.typeField=!1),(E=($=s.include).UUIDFields)!==null&&E!==void 0||($.UUIDFields=!1),(A=(te=s.include).customUUIDFields)!==null&&A!==void 0||(te.customUUIDFields=!1),(I=(ke=s.include).UUIDStatusField)!==null&&I!==void 0||(ke.UUIDStatusField=!1),(X=($e=s.include).UUIDTypeField)!==null&&X!==void 0||($e.UUIDTypeField=!1),(G=s.limit)!==null&&G!==void 0||(s.limit=100)}operation(){return Ae.PNSetMembersOperation}validate(){const{channel:s,uuids:o}=this.parameters;return s?o&&o.length!==0?void 0:"UUIDs cannot be empty":"Channel cannot be empty"}get path(){const{keySet:{subscribeKey:s},channel:o}=this.parameters;return`/v2/objects/${s}/channels/${fe(o)}/uuids`}get queryParameters(){const{include:s,page:o,filter:u,sort:p,limit:m}=this.parameters;let _="";_=typeof p=="string"?p:Object.entries(p??{}).map(([A,I])=>I!==null?`${A}:${I}`:A);const E=["uuid.status","uuid.type","type"];return s.statusField&&E.push("status"),s.typeField&&E.push("type"),s.customFields&&E.push("custom"),s.UUIDFields&&E.push("uuid"),s.UUIDStatusField&&E.push("uuid.status"),s.UUIDTypeField&&E.push("uuid.type"),s.customUUIDFields&&E.push("uuid.custom"),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({count:`${s.totalCount}`},E.length>0?{include:E.join(",")}:{}),u?{filter:u}:{}),o!=null&&o.next?{start:o.next}:{}),o!=null&&o.prev?{end:o.prev}:{}),m?{limit:m}:{}),_.length?{sort:_}:{})}get body(){const{uuids:s,type:o}=this.parameters;return JSON.stringify({[`${o}`]:s.map(u=>typeof u=="string"?{uuid:{id:u}}:{uuid:{id:u.id},status:u.status,type:u.type,custom:u.custom})})}}class pp extends Le{constructor(s){var o,u,p;super(),this.parameters=s,(o=s.include)!==null&&o!==void 0||(s.include={}),(u=(p=s.include).customFields)!==null&&u!==void 0||(p.customFields=!0),this.parameters.userId&&(this.parameters.uuid=this.parameters.userId)}operation(){return Ae.PNGetUUIDMetadataOperation}validate(){if(!this.parameters.uuid)return"'uuid' cannot be empty"}get path(){const{keySet:{subscribeKey:s},uuid:o}=this.parameters;return`/v2/objects/${s}/uuids/${fe(o)}`}get queryParameters(){const{include:s}=this.parameters;return{include:["status","type",...s.customFields?["custom"]:[]].join(",")}}}class fp extends Le{constructor(s){var o,u,p;super({method:ge.PATCH}),this.parameters=s,(o=s.include)!==null&&o!==void 0||(s.include={}),(u=(p=s.include).customFields)!==null&&u!==void 0||(p.customFields=!0),this.parameters.userId&&(this.parameters.uuid=this.parameters.userId)}operation(){return Ae.PNSetUUIDMetadataOperation}validate(){return this.parameters.uuid?this.parameters.data?void 0:"Data cannot be empty":"'uuid' cannot be empty"}get headers(){var s;return this.parameters.ifMatchesEtag?Object.assign(Object.assign({},(s=super.headers)!==null&&s!==void 0?s:{}),{"If-Match":this.parameters.ifMatchesEtag}):super.headers}get path(){const{keySet:{subscribeKey:s},uuid:o}=this.parameters;return`/v2/objects/${s}/uuids/${fe(o)}`}get queryParameters(){return{include:["status","type",...this.parameters.include.customFields?["custom"]:[]].join(",")}}get body(){return JSON.stringify(this.parameters.data)}}class gp{constructor(s,o){this.keySet=s.keySet,this.configuration=s,this.sendRequest=o}getAllUUIDMetadata(s,o){return l(this,void 0,void 0,function*(){return this._getAllUUIDMetadata(s,o)})}_getAllUUIDMetadata(s,o){return l(this,void 0,void 0,function*(){const u=s&&typeof s!="function"?s:{};o!=null||(o=typeof s=="function"?s:void 0);const p=new hp(Object.assign(Object.assign({},u),{keySet:this.keySet}));return o?this.sendRequest(p,o):this.sendRequest(p)})}getUUIDMetadata(s,o){return l(this,void 0,void 0,function*(){return this._getUUIDMetadata(s,o)})}_getUUIDMetadata(s,o){return l(this,void 0,void 0,function*(){var u;const p=s&&typeof s!="function"?s:{};o!=null||(o=typeof s=="function"?s:void 0),p.userId&&(p.uuid=p.userId),(u=p.uuid)!==null&&u!==void 0||(p.uuid=this.configuration.userId);const m=new pp(Object.assign(Object.assign({},p),{keySet:this.keySet}));return o?this.sendRequest(m,o):this.sendRequest(m)})}setUUIDMetadata(s,o){return l(this,void 0,void 0,function*(){return this._setUUIDMetadata(s,o)})}_setUUIDMetadata(s,o){return l(this,void 0,void 0,function*(){var u;s.userId&&(s.uuid=s.userId),(u=s.uuid)!==null&&u!==void 0||(s.uuid=this.configuration.userId);const p=new fp(Object.assign(Object.assign({},s),{keySet:this.keySet}));return o?this.sendRequest(p,o):this.sendRequest(p)})}removeUUIDMetadata(s,o){return l(this,void 0,void 0,function*(){return this._removeUUIDMetadata(s,o)})}_removeUUIDMetadata(s,o){return l(this,void 0,void 0,function*(){var u;const p=s&&typeof s!="function"?s:{};o!=null||(o=typeof s=="function"?s:void 0),p.userId&&(p.uuid=p.userId),(u=p.uuid)!==null&&u!==void 0||(p.uuid=this.configuration.userId);const m=new cp(Object.assign(Object.assign({},p),{keySet:this.keySet}));return o?this.sendRequest(m,o):this.sendRequest(m)})}getAllChannelMetadata(s,o){return l(this,void 0,void 0,function*(){return this._getAllChannelMetadata(s,o)})}_getAllChannelMetadata(s,o){return l(this,void 0,void 0,function*(){const u=s&&typeof s!="function"?s:{};o!=null||(o=typeof s=="function"?s:void 0);const p=new np(Object.assign(Object.assign({},u),{keySet:this.keySet}));return o?this.sendRequest(p,o):this.sendRequest(p)})}getChannelMetadata(s,o){return l(this,void 0,void 0,function*(){return this._getChannelMetadata(s,o)})}_getChannelMetadata(s,o){return l(this,void 0,void 0,function*(){const u=new lp(Object.assign(Object.assign({},s),{keySet:this.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)})}setChannelMetadata(s,o){return l(this,void 0,void 0,function*(){return this._setChannelMetadata(s,o)})}_setChannelMetadata(s,o){return l(this,void 0,void 0,function*(){const u=new up(Object.assign(Object.assign({},s),{keySet:this.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)})}removeChannelMetadata(s,o){return l(this,void 0,void 0,function*(){return this._removeChannelMetadata(s,o)})}_removeChannelMetadata(s,o){return l(this,void 0,void 0,function*(){const u=new ap(Object.assign(Object.assign({},s),{keySet:this.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)})}getChannelMembers(s,o){return l(this,void 0,void 0,function*(){const u=new dp(Object.assign(Object.assign({},s),{keySet:this.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)})}setChannelMembers(s,o){return l(this,void 0,void 0,function*(){const u=new Th(Object.assign(Object.assign({},s),{type:"set",keySet:this.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)})}removeChannelMembers(s,o){return l(this,void 0,void 0,function*(){const u=new Th(Object.assign(Object.assign({},s),{type:"delete",keySet:this.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)})}getMemberships(s,o){return l(this,void 0,void 0,function*(){var u;const p=s&&typeof s!="function"?s:{};o!=null||(o=typeof s=="function"?s:void 0),p.userId&&(p.uuid=p.userId),(u=p.uuid)!==null&&u!==void 0||(p.uuid=this.configuration.userId);const m=new op(Object.assign(Object.assign({},p),{keySet:this.keySet}));return o?this.sendRequest(m,o):this.sendRequest(m)})}setMemberships(s,o){return l(this,void 0,void 0,function*(){var u;s.userId&&(s.uuid=s.userId),(u=s.uuid)!==null&&u!==void 0||(s.uuid=this.configuration.userId);const p=new Sh(Object.assign(Object.assign({},s),{type:"set",keySet:this.keySet}));return o?this.sendRequest(p,o):this.sendRequest(p)})}removeMemberships(s,o){return l(this,void 0,void 0,function*(){var u;s.userId&&(s.uuid=s.userId),(u=s.uuid)!==null&&u!==void 0||(s.uuid=this.configuration.userId);const p=new Sh(Object.assign(Object.assign({},s),{type:"delete",keySet:this.keySet}));return o?this.sendRequest(p,o):this.sendRequest(p)})}fetchMemberships(s,o){return l(this,void 0,void 0,function*(){var u,p;if("spaceId"in s){const A=s,I={channel:(u=A.spaceId)!==null&&u!==void 0?u:A.channel,filter:A.filter,limit:A.limit,page:A.page,include:Object.assign({},A.include),sort:A.sort?Object.fromEntries(Object.entries(A.sort).map(([G,L])=>[G.replace("user","uuid"),L])):void 0},X=G=>({status:G.status,data:G.data.map(L=>({user:L.uuid,custom:L.custom,updated:L.updated,eTag:L.eTag})),totalCount:G.totalCount,next:G.next,prev:G.prev});return o?this.getChannelMembers(I,(G,L)=>{o(G,L&&X(L))}):this.getChannelMembers(I).then(X)}const m=s,_={uuid:(p=m.userId)!==null&&p!==void 0?p:m.uuid,filter:m.filter,limit:m.limit,page:m.page,include:Object.assign({},m.include),sort:m.sort?Object.fromEntries(Object.entries(m.sort).map(([A,I])=>[A.replace("space","channel"),I])):void 0},E=A=>({status:A.status,data:A.data.map(I=>({space:I.channel,custom:I.custom,updated:I.updated,eTag:I.eTag})),totalCount:A.totalCount,next:A.next,prev:A.prev});return o?this.getMemberships(_,(A,I)=>{o(A,I&&E(I))}):this.getMemberships(_).then(E)})}addMemberships(s,o){return l(this,void 0,void 0,function*(){var u,p,m,_,E,A;if("spaceId"in s){const G=s,L={channel:(u=G.spaceId)!==null&&u!==void 0?u:G.channel,uuids:(m=(p=G.users)===null||p===void 0?void 0:p.map(Q=>typeof Q=="string"?Q:{id:Q.userId,custom:Q.custom}))!==null&&m!==void 0?m:G.uuids,limit:0};return o?this.setChannelMembers(L,o):this.setChannelMembers(L)}const I=s,X={uuid:(_=I.userId)!==null&&_!==void 0?_:I.uuid,channels:(A=(E=I.spaces)===null||E===void 0?void 0:E.map(G=>typeof G=="string"?G:{id:G.spaceId,custom:G.custom}))!==null&&A!==void 0?A:I.channels,limit:0};return o?this.setMemberships(X,o):this.setMemberships(X)})}}class mp extends Le{constructor(){super()}operation(){return Ae.PNTimeOperation}parse(s){return l(this,void 0,void 0,function*(){return{timetoken:this.deserializeResponse(s)[0]}})}get path(){return"/time/0"}}class yp extends Le{constructor(s){super(),this.parameters=s}operation(){return Ae.PNDownloadFileOperation}validate(){const{channel:s,id:o,name:u}=this.parameters;return s?o?u?void 0:"file name can't be empty":"file id can't be empty":"channel can't be empty"}parse(s){return l(this,void 0,void 0,function*(){const{cipherKey:o,crypto:u,cryptography:p,name:m,PubNubFile:_}=this.parameters,E=s.headers["content-type"];let A,I=s.body;return _.supportsEncryptFile&&(o||u)&&(o&&p?I=yield p.decrypt(o,I):!o&&u&&(A=yield u.decryptFile(_.create({data:I,name:m,mimeType:E}),_))),A||_.create({data:I,name:m,mimeType:E})})}get path(){const{keySet:{subscribeKey:s},channel:o,id:u,name:p}=this.parameters;return`/v1/files/${s}/channels/${fe(o)}/files/${u}/${p}`}}class hr{static notificationPayload(s,o){return new Ri(s,o)}static generateUUID(){return Ce.createUUID()}constructor(s){if(this._configuration=s.configuration,this.cryptography=s.cryptography,this.tokenManager=s.tokenManager,this.transport=s.transport,this.crypto=s.crypto,this._objects=new gp(this._configuration,this.sendRequest.bind(this)),this._channelGroups=new Qd(this._configuration.keySet,this.sendRequest.bind(this)),this._push=new ip(this._configuration.keySet,this.sendRequest.bind(this)),this.listenerManager=new sr,this.eventEmitter=new ni(this.listenerManager),this.subscribeCapable=new Set,this._configuration.enableEventEngine){let o=this._configuration.getHeartbeatInterval();this.presenceState={},o&&(this.presenceEventEngine=new Hr({heartbeat:this.heartbeat.bind(this),leave:u=>this.makeUnsubscribe(u,()=>{}),heartbeatDelay:()=>new Promise((u,p)=>{o=this._configuration.getHeartbeatInterval(),o?setTimeout(u,1e3*o):p(new x("Heartbeat interval has been reset."))}),emitStatus:u=>this.listenerManager.announceStatus(u),config:this._configuration,presenceState:this.presenceState})),this.eventEngine=new wd({handshake:this.subscribeHandshake.bind(this),receiveMessages:this.subscribeReceiveMessages.bind(this),delay:u=>new Promise(p=>setTimeout(p,u)),join:this.join.bind(this),leave:this.leave.bind(this),leaveAll:this.leaveAll.bind(this),presenceReconnect:this.presenceReconnect.bind(this),presenceDisconnect:this.presenceDisconnect.bind(this),presenceState:this.presenceState,config:this._configuration,emitMessages:u=>{try{u.forEach(p=>this.eventEmitter.emitEvent(p))}catch(p){const m={error:!0,category:y.PNUnknownCategory,errorData:p,statusCode:0};this.listenerManager.announceStatus(m)}},emitStatus:u=>this.listenerManager.announceStatus(u)})}else this.subscriptionManager=new Lr(this._configuration,this.listenerManager,this.eventEmitter,this.makeSubscribe.bind(this),this.heartbeat.bind(this),this.makeUnsubscribe.bind(this),this.time.bind(this))}get configuration(){return this._configuration}get _config(){return this.configuration}get authKey(){var s;return(s=this._configuration.authKey)!==null&&s!==void 0?s:void 0}getAuthKey(){return this.authKey}setAuthKey(s){this._configuration.setAuthKey(s)}get userId(){return this._configuration.userId}set userId(s){if(!s||typeof s!="string"||s.trim().length===0)throw new Error("Missing or invalid userId parameter. Provide a valid string userId");this._configuration.userId=s}getUserId(){return this._configuration.userId}setUserId(s){if(!s||typeof s!="string"||s.trim().length===0)throw new Error("Missing or invalid userId parameter. Provide a valid string userId");this._configuration.userId=s}get filterExpression(){var s;return(s=this._configuration.getFilterExpression())!==null&&s!==void 0?s:void 0}getFilterExpression(){return this.filterExpression}set filterExpression(s){this._configuration.setFilterExpression(s)}setFilterExpression(s){this.filterExpression=s}get cipherKey(){return this._configuration.getCipherKey()}set cipherKey(s){this._configuration.setCipherKey(s)}setCipherKey(s){this.cipherKey=s}set heartbeatInterval(s){this._configuration.setHeartbeatInterval(s)}setHeartbeatInterval(s){this.heartbeatInterval=s}getVersion(){return this._configuration.getVersion()}_addPnsdkSuffix(s,o){this._configuration._addPnsdkSuffix(s,o)}getUUID(){return this.userId}setUUID(s){this.userId=s}get customEncrypt(){return this._configuration.getCustomEncrypt()}get customDecrypt(){return this._configuration.getCustomDecrypt()}channel(s){return new qd(s,this.eventEmitter,this)}channelGroup(s){return new Wd(s,this.eventEmitter,this)}channelMetadata(s){return new Vd(s,this.eventEmitter,this)}userMetadata(s){return new zd(s,this.eventEmitter,this)}subscriptionSet(s){return new wh(Object.assign(Object.assign({},s),{eventEmitter:this.eventEmitter,pubnub:this}))}sendRequest(s,o){return l(this,void 0,void 0,function*(){const u=s.validate();if(u){if(o)return o(w(u),null);throw new x("Validation failed, check status for details",w(u))}const p=s.request(),m=s.operation();p.formData&&p.formData.length>0||m===Ae.PNDownloadFileOperation?p.timeout=this._configuration.getFileTimeout():m===Ae.PNSubscribeOperation||m===Ae.PNReceiveMessagesOperation?p.timeout=this._configuration.getSubscribeTimeout():p.timeout=this._configuration.getTransactionTimeout();const _={error:!1,operation:m,category:y.PNAcknowledgmentCategory,statusCode:0},[E,A]=this.transport.makeSendable(p);return s.cancellationController=A||null,E.then(I=>{if(_.statusCode=I.status,I.status!==200&&I.status!==204){const X=hr.decoder.decode(I.body),G=I.headers["content-type"];if(G||G.indexOf("javascript")!==-1||G.indexOf("json")!==-1){const L=JSON.parse(X);typeof L=="object"&&"error"in L&&L.error&&typeof L.error=="object"&&(_.errorData=L.error)}else _.responseText=X}return s.parse(I)}).then(I=>o?o(_,I):I).catch(I=>{const X=I instanceof k?I:k.create(I);if(o)return o(X.toStatus(m),null);throw X.toPubNubError(m,"REST API request processing error, check status for details")})})}destroy(s){var o;(o=this.subscribeCapable)===null||o===void 0||o.clear(),this.subscriptionManager?(this.subscriptionManager.unsubscribeAll(s),this.subscriptionManager.disconnect()):this.eventEngine&&this.eventEngine.unsubscribeAll(s),this.presenceEventEngine&&this.presenceEventEngine.leaveAll(s)}stop(){this.destroy()}addListener(s){this.listenerManager.addListener(s)}removeListener(s){this.listenerManager.removeListener(s)}removeAllListeners(){this.listenerManager.removeAllListeners()}publish(s,o){return l(this,void 0,void 0,function*(){{const u=new Sd(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet,crypto:this._configuration.getCryptoModule()}));return o?this.sendRequest(u,o):this.sendRequest(u)}})}signal(s,o){return l(this,void 0,void 0,function*(){{const u=new Td(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)}})}fire(s,o){return l(this,void 0,void 0,function*(){return o!=null||(o=()=>{}),this.publish(Object.assign(Object.assign({},s),{replicate:!1,storeInHistory:!1}),o)})}getSubscribedChannels(){return this.subscriptionManager?this.subscriptionManager.subscribedChannels:this.eventEngine?this.eventEngine.getSubscribedChannels():[]}getSubscribedChannelGroups(){return this.subscriptionManager?this.subscriptionManager.subscribedChannelGroups:this.eventEngine?this.eventEngine.getSubscribedChannelGroups():[]}registerSubscribeCapable(s){this.subscribeCapable&&!this.subscribeCapable.has(s)&&this.subscribeCapable.add(s)}unregisterSubscribeCapable(s){this.subscribeCapable&&this.subscribeCapable.has(s)&&this.subscribeCapable.delete(s)}getSubscribeCapableEntities(){{const s={channels:[],channelGroups:[]};if(!this.subscribeCapable)return s;for(const o of this.subscribeCapable)s.channelGroups.push(...o.channelGroups),s.channels.push(...o.channels);return s}}subscribe(s){this.subscriptionManager?this.subscriptionManager.subscribe(s):this.eventEngine&&this.eventEngine.subscribe(s)}makeSubscribe(s,o){{const u=new Mi(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet,crypto:this._configuration.getCryptoModule(),getFileUrl:this.getFileUrl.bind(this)}));if(this.sendRequest(u,(p,m)=>{var _;this.subscriptionManager&&((_=this.subscriptionManager.abort)===null||_===void 0?void 0:_.identifier)===u.requestIdentifier&&(this.subscriptionManager.abort=null),o(p,m)}),this.subscriptionManager){const p=()=>u.abort("Cancel long-poll subscribe request");p.identifier=u.requestIdentifier,this.subscriptionManager.abort=p}}}unsubscribe(s){this.subscriptionManager?this.subscriptionManager.unsubscribe(s):this.eventEngine&&this.eventEngine.unsubscribe(s)}makeUnsubscribe(s,o){{let{channels:u,channelGroups:p}=s;if(this._configuration.getKeepPresenceChannelsInPresenceRequests()||(p&&(p=p.filter(m=>!m.endsWith("-pnpres"))),u&&(u=u.filter(m=>!m.endsWith("-pnpres")))),(p??[]).length===0&&(u??[]).length===0)return o({error:!1,operation:Ae.PNUnsubscribeOperation,category:y.PNAcknowledgmentCategory,statusCode:200});this.sendRequest(new Rd({channels:u,channelGroups:p,keySet:this._configuration.keySet}),o)}}unsubscribeAll(){var s;(s=this.subscribeCapable)===null||s===void 0||s.clear(),this.subscriptionManager?this.subscriptionManager.unsubscribeAll():this.eventEngine&&this.eventEngine.unsubscribeAll()}disconnect(s){this.subscriptionManager?this.subscriptionManager.disconnect():this.eventEngine&&this.eventEngine.disconnect(s)}reconnect(s){this.subscriptionManager?this.subscriptionManager.reconnect():this.eventEngine&&this.eventEngine.reconnect(s??{})}subscribeHandshake(s){return l(this,void 0,void 0,function*(){{const o=new Cd(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet,crypto:this._configuration.getCryptoModule(),getFileUrl:this.getFileUrl.bind(this)})),u=s.abortSignal.subscribe(p=>{o.abort("Cancel subscribe handshake request")});return this.sendRequest(o).then(p=>(u(),p.cursor))}})}subscribeReceiveMessages(s){return l(this,void 0,void 0,function*(){{const o=new Ad(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet,crypto:this._configuration.getCryptoModule(),getFileUrl:this.getFileUrl.bind(this)})),u=s.abortSignal.subscribe(p=>{o.abort("Cancel long-poll subscribe request")});return this.sendRequest(o).then(p=>(u(),p))}})}getMessageActions(s,o){return l(this,void 0,void 0,function*(){{const u=new Dd(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)}})}addMessageAction(s,o){return l(this,void 0,void 0,function*(){{const u=new Fd(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)}})}removeMessageAction(s,o){return l(this,void 0,void 0,function*(){{const u=new Bd(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)}})}fetchMessages(s,o){return l(this,void 0,void 0,function*(){{const u=new zn(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet,crypto:this._configuration.getCryptoModule(),getFileUrl:this.getFileUrl.bind(this)}));return o?this.sendRequest(u,o):this.sendRequest(u)}})}deleteMessages(s,o){return l(this,void 0,void 0,function*(){{const u=new kd(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)}})}messageCounts(s,o){return l(this,void 0,void 0,function*(){{const u=new Nd(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)}})}history(s,o){return l(this,void 0,void 0,function*(){{const u=new Wn(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet,crypto:this._configuration.getCryptoModule()}));return o?this.sendRequest(u,o):this.sendRequest(u)}})}hereNow(s,o){return l(this,void 0,void 0,function*(){{const u=new Od(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)}})}whereNow(s,o){return l(this,void 0,void 0,function*(){var u;{const p=new Md({uuid:(u=s.uuid)!==null&&u!==void 0?u:this._configuration.userId,keySet:this._configuration.keySet});return o?this.sendRequest(p,o):this.sendRequest(p)}})}getState(s,o){return l(this,void 0,void 0,function*(){var u;{const p=new Pd(Object.assign(Object.assign({},s),{uuid:(u=s.uuid)!==null&&u!==void 0?u:this._configuration.userId,keySet:this._configuration.keySet}));return o?this.sendRequest(p,o):this.sendRequest(p)}})}setState(s,o){return l(this,void 0,void 0,function*(){var u,p;{const{keySet:m,userId:_}=this._configuration,E=this._configuration.getPresenceTimeout();let A;if(this._configuration.enableEventEngine&&this.presenceState){const I=this.presenceState;(u=s.channels)===null||u===void 0||u.forEach(X=>I[X]=s.state),"channelGroups"in s&&((p=s.channelGroups)===null||p===void 0||p.forEach(X=>I[X]=s.state))}return A="withHeartbeat"in s?new xh(Object.assign(Object.assign({},s),{keySet:m,heartbeat:E})):new Id(Object.assign(Object.assign({},s),{keySet:m,uuid:_})),this.subscriptionManager&&this.subscriptionManager.setState(s),o?this.sendRequest(A,o):this.sendRequest(A)}})}presence(s){var o;(o=this.subscriptionManager)===null||o===void 0||o.changePresence(s)}heartbeat(s,o){return l(this,void 0,void 0,function*(){{let{channels:u,channelGroups:p}=s;if(this._configuration.getKeepPresenceChannelsInPresenceRequests()||(p&&(p=p.filter(_=>!_.endsWith("-pnpres"))),u&&(u=u.filter(_=>!_.endsWith("-pnpres")))),(p??[]).length===0&&(u??[]).length===0){const _={error:!1,operation:Ae.PNHeartbeatOperation,category:y.PNAcknowledgmentCategory,statusCode:200};return o?o(_,{}):Promise.resolve(_)}const m=new xh(Object.assign(Object.assign({},s),{channels:u,channelGroups:p,keySet:this._configuration.keySet}));return o?this.sendRequest(m,o):this.sendRequest(m)}})}join(s){this.presenceEventEngine?this.presenceEventEngine.join(s):this.heartbeat(Object.assign(Object.assign({channels:s.channels,channelGroups:s.groups},this._configuration.maintainPresenceState&&{state:this.presenceState}),{heartbeat:this._configuration.getPresenceTimeout()}),()=>{})}presenceReconnect(s){this.presenceEventEngine?this.presenceEventEngine.reconnect():this.heartbeat(Object.assign(Object.assign({channels:s.channels,channelGroups:s.groups},this._configuration.maintainPresenceState&&{state:this.presenceState}),{heartbeat:this._configuration.getPresenceTimeout()}),()=>{})}leave(s){var o;this.presenceEventEngine?(o=this.presenceEventEngine)===null||o===void 0||o.leave(s):this.makeUnsubscribe({channels:s.channels,channelGroups:s.groups},()=>{})}leaveAll(s={}){this.presenceEventEngine?this.presenceEventEngine.leaveAll(s.isOffline):s.isOffline||this.makeUnsubscribe({channels:s.channels,channelGroups:s.groups},()=>{})}presenceDisconnect(s){this.presenceEventEngine?this.presenceEventEngine.disconnect(s.isOffline):s.isOffline||this.makeUnsubscribe({channels:s.channels,channelGroups:s.groups},()=>{})}grantToken(s,o){return l(this,void 0,void 0,function*(){throw new Error("Grant Token error: PAM module disabled")})}revokeToken(s,o){return l(this,void 0,void 0,function*(){throw new Error("Revoke Token error: PAM module disabled")})}get token(){return this.tokenManager&&this.tokenManager.getToken()}getToken(){return this.token}set token(s){this.tokenManager&&this.tokenManager.setToken(s)}setToken(s){this.token=s}parseToken(s){return this.tokenManager&&this.tokenManager.parseToken(s)}grant(s,o){return l(this,void 0,void 0,function*(){throw new Error("Grant error: PAM module disabled")})}audit(s,o){return l(this,void 0,void 0,function*(){throw new Error("Grant Permissions error: PAM module disabled")})}get objects(){return this._objects}fetchUsers(s,o){return l(this,void 0,void 0,function*(){return this.objects._getAllUUIDMetadata(s,o)})}fetchUser(s,o){return l(this,void 0,void 0,function*(){return this.objects._getUUIDMetadata(s,o)})}createUser(s,o){return l(this,void 0,void 0,function*(){return this.objects._setUUIDMetadata(s,o)})}updateUser(s,o){return l(this,void 0,void 0,function*(){return this.objects._setUUIDMetadata(s,o)})}removeUser(s,o){return l(this,void 0,void 0,function*(){return this.objects._removeUUIDMetadata(s,o)})}fetchSpaces(s,o){return l(this,void 0,void 0,function*(){return this.objects._getAllChannelMetadata(s,o)})}fetchSpace(s,o){return l(this,void 0,void 0,function*(){return this.objects._getChannelMetadata(s,o)})}createSpace(s,o){return l(this,void 0,void 0,function*(){return this.objects._setChannelMetadata(s,o)})}updateSpace(s,o){return l(this,void 0,void 0,function*(){return this.objects._setChannelMetadata(s,o)})}removeSpace(s,o){return l(this,void 0,void 0,function*(){return this.objects._removeChannelMetadata(s,o)})}fetchMemberships(s,o){return l(this,void 0,void 0,function*(){return this.objects.fetchMemberships(s,o)})}addMemberships(s,o){return l(this,void 0,void 0,function*(){return this.objects.addMemberships(s,o)})}updateMemberships(s,o){return l(this,void 0,void 0,function*(){return this.objects.addMemberships(s,o)})}removeMemberships(s,o){return l(this,void 0,void 0,function*(){var u,p,m;{if("spaceId"in s){const A=s,I={channel:(u=A.spaceId)!==null&&u!==void 0?u:A.channel,uuids:(p=A.userIds)!==null&&p!==void 0?p:A.uuids,limit:0};return o?this.objects.removeChannelMembers(I,o):this.objects.removeChannelMembers(I)}const _=s,E={uuid:_.userId,channels:(m=_.spaceIds)!==null&&m!==void 0?m:_.channels,limit:0};return o?this.objects.removeMemberships(E,o):this.objects.removeMemberships(E)}})}get channelGroups(){return this._channelGroups}get push(){return this._push}sendFile(s,o){return l(this,void 0,void 0,function*(){{if(!this._configuration.PubNubFile)throw new Error("Validation failed: 'PubNubFile' not configured or file upload not supported by the platform.");const u=new $d(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet,PubNubFile:this._configuration.PubNubFile,fileUploadPublishRetryLimit:this._configuration.fileUploadPublishRetryLimit,file:s.file,sendRequest:this.sendRequest.bind(this),publishFile:this.publishFile.bind(this),crypto:this._configuration.getCryptoModule(),cryptography:this.cryptography?this.cryptography:void 0})),p={error:!1,operation:Ae.PNPublishFileOperation,category:y.PNAcknowledgmentCategory,statusCode:0};return u.process().then(m=>(p.statusCode=m.status,o?o(p,m):m)).catch(m=>{let _;throw m instanceof x?_=m.status:m instanceof k&&(_=m.toStatus(p.operation)),o&&_&&o(_,null),new x("REST API request processing error, check status for details",_)})}})}publishFile(s,o){return l(this,void 0,void 0,function*(){{if(!this._configuration.PubNubFile)throw new Error("Validation failed: 'PubNubFile' not configured or file upload not supported by the platform.");const u=new Ld(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet,crypto:this._configuration.getCryptoModule()}));return o?this.sendRequest(u,o):this.sendRequest(u)}})}listFiles(s,o){return l(this,void 0,void 0,function*(){{const u=new jd(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)}})}getFileUrl(s){var o;{const u=this.transport.request(new Ud(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet})).request()),p=(o=u.queryParameters)!==null&&o!==void 0?o:{},m=Object.keys(p).map(_=>{const E=p[_];return Array.isArray(E)?E.map(A=>`${_}=${fe(A)}`).join("&"):`${_}=${fe(E)}`}).join("&");return`${u.origin}${u.path}?${m}`}}downloadFile(s,o){return l(this,void 0,void 0,function*(){{if(!this._configuration.PubNubFile)throw new Error("Validation failed: 'PubNubFile' not configured or file upload not supported by the platform.");const u=new yp(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet,PubNubFile:this._configuration.PubNubFile,cryptography:this.cryptography?this.cryptography:void 0,crypto:this._configuration.getCryptoModule()}));return o?this.sendRequest(u,o):yield this.sendRequest(u)}})}deleteFile(s,o){return l(this,void 0,void 0,function*(){{const u=new Gd(Object.assign(Object.assign({},s),{keySet:this._configuration.keySet}));return o?this.sendRequest(u,o):this.sendRequest(u)}})}time(s){return l(this,void 0,void 0,function*(){const o=new mp;return s?this.sendRequest(o,s):this.sendRequest(o)})}encrypt(s,o){const u=this._configuration.getCryptoModule();if(!o&&u&&typeof s=="string"){const p=u.encrypt(s);return typeof p=="string"?p:v(p)}if(!this.crypto)throw new Error("Encryption error: cypher key not set");return this.crypto.encrypt(s,o)}decrypt(s,o){const u=this._configuration.getCryptoModule();if(!o&&u){const p=u.decrypt(s);return p instanceof ArrayBuffer?JSON.parse(new TextDecoder().decode(p)):p}if(!this.crypto)throw new Error("Decryption error: cypher key not set");return this.crypto.decrypt(s,o)}encryptFile(s,o){return l(this,void 0,void 0,function*(){var u;if(typeof s!="string"&&(o=s),!o)throw new Error("File encryption error. Source file is missing.");if(!this._configuration.PubNubFile)throw new Error("File encryption error. File constructor not configured.");if(typeof s!="string"&&!this._configuration.getCryptoModule())throw new Error("File encryption error. Crypto module not configured.");if(typeof s=="string"){if(!this.cryptography)throw new Error("File encryption error. File encryption not available");return this.cryptography.encryptFile(s,o,this._configuration.PubNubFile)}return(u=this._configuration.getCryptoModule())===null||u===void 0?void 0:u.encryptFile(o,this._configuration.PubNubFile)})}decryptFile(s,o){return l(this,void 0,void 0,function*(){var u;if(typeof s!="string"&&(o=s),!o)throw new Error("File encryption error. Source file is missing.");if(!this._configuration.PubNubFile)throw new Error("File decryption error. File constructor not configured.");if(typeof s=="string"&&!this._configuration.getCryptoModule())throw new Error("File decryption error. Crypto module not configured.");if(typeof s=="string"){if(!this.cryptography)throw new Error("File decryption error. File decryption not available");return this.cryptography.decryptFile(s,o,this._configuration.PubNubFile)}return(u=this._configuration.getCryptoModule())===null||u===void 0?void 0:u.decryptFile(o,this._configuration.PubNubFile)})}}hr.decoder=new TextDecoder,hr.OPERATIONS=Ae,hr.CATEGORIES=y,hr.Endpoint=D,hr.ExponentialRetryPolicy=Z.ExponentialRetryPolicy,hr.LinearRetryPolicy=Z.LinearRetryPolicy,hr.NoneRetryPolicy=Z.None;class vp{constructor(s,o){this.decode=s,this.base64ToBinary=o}decodeToken(s){let o="";s.length%4==3?o="=":s.length%4==2&&(o="==");const u=s.replace(/-/gi,"+").replace(/_/gi,"/")+o,p=this.decode(this.base64ToBinary(u));return typeof p=="object"?p:void 0}}class Ah extends hr{constructor(s){var o;const u=U(s),p=Object.assign(Object.assign({},u),{sdkFamily:"Web"});p.PubNubFile=d;const m=De(p,X=>{if(X.cipherKey)return new re({default:new K(Object.assign({},X)),cryptors:[new se({cipherKey:X.cipherKey})]})});let _,E,A;_=new Pe(new vp(X=>q(a.decode(X)),g)),(m.getCipherKey()||m.secretKey)&&(E=new ve({secretKey:m.secretKey,cipherKey:m.getCipherKey(),useRandomIVs:m.getUseRandomIVs(),customEncrypt:m.getCustomEncrypt(),customDecrypt:m.getCustomDecrypt()})),A=new H;let I=new pt(p.transport,m.keepAlive,m.logVerbosity);if(u.subscriptionWorkerUrl){const X=new P({clientIdentifier:m._instanceId,subscriptionKey:m.subscribeKey,userId:m.getUserId(),workerUrl:u.subscriptionWorkerUrl,sdkVersion:m.getVersion(),heartbeatInterval:m.getHeartbeatInterval(),workerOfflineClientsCheckInterval:p.subscriptionWorkerOfflineClientsCheckInterval,workerUnsubscribeOfflineClients:p.subscriptionWorkerUnsubscribeOfflineClients,logVerbosity:m.logVerbosity,workerLogVerbosity:p.subscriptionWorkerLogVerbosity,tokenManager:_,transport:I});I=X,window.onpagehide=G=>{G.persisted||X.terminate()}}super({configuration:m,transport:new ht({clientConfiguration:m,tokenManager:_,transport:I}),cryptography:A,tokenManager:_,crypto:E}),((o=s.listenToBrowserNetworkEvents)===null||o===void 0||o)&&(window.addEventListener("offline",()=>{this.networkDownDetected()}),window.addEventListener("online",()=>{this.networkUpDetected()}))}networkDownDetected(){this.listenerManager.announceNetworkDown(),this._configuration.restore?this.disconnect(!0):this.destroy(!0)}networkUpDetected(){this.listenerManager.announceNetworkUp(),this.reconnect()}}return Ah.CryptoModule=re,Ah})}(dn)),dn.exports}var Hv=jv();const $v=th(Hv),Qt=new $v({publishKey:"pub-c-7a6bde4e-96b8-4e30-b3dd-371ac3033756",subscribeKey:"sub-c-95aa0fd1-e295-4812-9b06-73c5b7a8755e",userId:`player-${Math.random().toString(36).substring(2,9)}`});let er=null,Zs=!1,At=null,Et=!1,Hs=null,ku=null,Ai=null,_s=!0,Ks=null;const Zo=document.getElementById("lobby"),Nu=document.getElementById("game"),Du=document.getElementById("createGameButton"),Vv=document.getElementById("gameLink"),md=document.getElementById("linkText"),Wv=document.getElementById("copyLinkButton"),zv=document.getElementById("waitingMessage");function qv(i,e){const t=document.createElement("div");t.className="temporary-message",t.textContent=i,Zo.appendChild(t),console.log(`Displaying temporary message: ${i} for ${e}ms`),setTimeout(()=>{Zo.removeChild(t),console.log(`Removed temporary message: ${i}`)},e)}const Xv=600,Kv=250,Fu=15,ph=()=>{const i=window.innerWidth-Fu*2,e=window.innerHeight-Fu*2,t=Math.min(i,e),r=Math.max(Kv,Math.min(Xv,t));return console.log(`Main Canvas CANVAS_SIZE: ${r}, windowWidth: ${i}, windowHeight: ${e}`),r};let et=ph();const Ke=new hh({width:et,height:et,backgroundColor:1710618,antialias:!0,autoStart:!1}),rn=document.getElementById("snakeContainer");if(rn){const i=rn.querySelector("canvas");i&&i.remove(),rn.insertBefore(Ke.view,rn.firstChild),console.log("Main canvas appended to snakeContainer:",Ke.view),console.log(`Canvas dimensions: width=${Ke.view.width}, height=${Ke.view.height}`)}else console.error("snakeContainer element not found in the DOM.");const Ct=document.getElementById("turnIndicator");Ct||console.error("Turn indicator element not found in the DOM.");const vr=3;let gt=[["","",""],["","",""],["","",""]],Pt="X",Qs=!1,Cn=[],Pn=[],yt=et/vr;const ms=new si;Ke.stage.addChild(ms);const fh=()=>{ms.clear(),ms.lineStyle(6,65484,.8);for(let i=1;i<vr;i++)ms.moveTo(i*yt,0),ms.lineTo(i*yt,et),ms.moveTo(0,i*yt),ms.lineTo(et,i*yt);console.log(`Drew grid: ${vr}x${vr}, cellSize=${yt}, CANVAS_SIZE=${et}`),Ke.renderer.render(Ke.stage)},gh=()=>et*.2,Yv=new Fr({fontFamily:"Orbitron",fontSize:gh(),fontWeight:"700",align:"center"}),Bu=new Ti({color:16711935,outerStrength:3,innerStrength:0,distance:15,quality:.1}),Lu=new Ti({color:61695,outerStrength:3,innerStrength:0,distance:15,quality:.1}),Ir=new si,jn=()=>{Ir.clear(),Ir.beginFill(0,.001),Ir.drawRect(0,0,et,et),Ir.endFill(),Ir.interactive=!0,console.log(`Updated hit area: ${et}x${et}`)};jn();Ke.stage.addChild(Ir);const mh=()=>{Zo.style.display="none",Nu.style.display="flex",console.log("Game UI made visible: gameDiv display =",Nu.style.display),et=ph(),yt=et/vr,Ke.renderer.resize(et,et),console.log(`Canvas resized: width=${Ke.view.width}, height=${Ke.view.height}`),fh(),jn(),Ke.start(),console.log("Game rendered for player:",Zs?"Creator":"Joiner"),console.log(`Initial turn: currentPlayer=${Pt}, myPlayer=${At}, opponentJoined=${Et}`)};Du.addEventListener("click",()=>{er=Math.random().toString(36).substring(2,9),Zs=!0,At="X",Qt.subscribe({channels:[er]});const i=`${window.location.origin}${window.location.pathname}?room=${er}`;md.textContent=i,Vv.style.display="block",zv.style.display="block",Du.style.display="none",console.log("Creator: Waiting for opponent to join")});Wv.addEventListener("click",()=>{const i=md.textContent||"";navigator.clipboard.writeText(i).then(()=>{qv("Link copied to clipboard!",5e3),Ks&&clearTimeout(Ks),Ks=setTimeout(()=>{Et||(console.warn("Opponent did not join within 10 seconds, showing game for debugging"),mh())},1e4)})});const Jv=new URLSearchParams(window.location.search),Uu=Jv.get("room");Uu&&(er=Uu,Zs=!1,At="O",Et=!0,Qt.subscribe({channels:[er]}),Qt.publish({channel:er,message:{type:"playerJoined"}}),console.log("Joiner: Subscribed to room and sent playerJoined message, opponentJoined=",Et),mh());Qt.addListener({message:i=>{const e=i.message;if(typeof e!="object"||e===null||!("type"in e)){console.error('Invalid message payload: Expected an object with a "type" property',e);return}const t=e;switch(console.log("Received PubNub message:",t),t.type){case"playerJoined":Zs&&(Et=!0,console.log("Creator: Opponent joined, opponentJoined=",Et),Ks&&(clearTimeout(Ks),Ks=null),mh());break;case"move":if(typeof t.row!="number"||typeof t.col!="number"||!t.player||t.player!=="X"&&t.player!=="O"||!t.nextPlayer||t.nextPlayer!=="X"&&t.nextPlayer!=="O"){console.error("Invalid move payload: Missing or invalid row, col, player, or nextPlayer",t);return}if(Hs&&Hs.row===t.row&&Hs.col===t.col&&Hs.player===t.player&&t.player===At){console.log(`Skipping duplicate move: row=${t.row}, col=${t.col}, player=${t.player}`),Pt=t.nextPlayer,Ct&&(Ct.textContent=`Player ${Pt}'s Turn`),console.log(`After skipped move: currentPlayer=${Pt}, myPlayer=${At}, opponentJoined=${Et}`);return}yd(t.row,t.col,t.player),Pt=t.nextPlayer,Ct&&(Ct.textContent=`Player ${Pt}'s Turn`),console.log(`After move: currentPlayer=${Pt}, myPlayer=${At}, opponentJoined=${Et}`);break;case"gameOver":if(!t.messageText||typeof t.messageText!="string"){console.error("Invalid gameOver payload: Missing or invalid messageText",t);return}if(t.gameOverId&&t.gameOverId===Ai){console.log("Skipping duplicate gameOver message:",t.messageText);return}Ai=t.gameOverId||null,Qs=!0,Qo(t.messageText),Ct&&(Ct.textContent=t.messageText);break;case"reset":if(t.resetInitiator===Qt.getUUID()){console.log("Skipping reset message initiated by this player");return}t.startingPlayer&&(_s=t.startingPlayer==="X",console.log(`Updated creatorStartsNext to ${_s} based on startingPlayer=${t.startingPlayer}`)),vd(),Zs||(Qt.publish({channel:er,message:{type:"playerJoined"}}),Et=!0,console.log("Joiner: Sent playerJoined message after reset, opponentJoined=",Et));break;default:console.warn("Unknown message type:",t.type)}},status:i=>{i.error?console.error("PubNub status error:",i):console.log("PubNub status:",i)}});Ir.on("pointertap",i=>{if(console.log(`Click event triggered: gameOver=${Qs}, myPlayer=${At}, currentPlayer=${Pt}, opponentJoined=${Et}`),Qs||!At||Pt!==At||!Et)return;const e=i.data.getLocalPosition(Ke.stage),t=e.x,r=e.y,n=Math.floor(t/yt),a=Math.floor(r/yt);if(console.log(`Click at x=${t}, y=${r}, row=${a}, col=${n}, cellSize=${yt}`),a>=0&&a<vr&&n>=0&&n<vr&&gt[a][n]===""){const h=At==="X"?"O":"X";Hs={row:a,col:n,player:At},Qt.publish({channel:er,message:{type:"move",row:a,col:n,player:At,nextPlayer:h}}),yd(a,n,At),Pt=h,Ct&&(Ct.textContent=`Player ${Pt}'s Turn`),console.log(`After local move: currentPlayer=${Pt}, myPlayer=${At}, opponentJoined=${Et}`)}});function yd(i,e,t){gt[i][e]=t;const r=new Gn(t,{...Yv,fill:t==="X"?"#ff00ff":"#00f0ff",fontSize:gh()});r.anchor.set(.5),r.x=e*yt+yt/2,r.y=i*yt+yt/2,r.filters=[t==="X"?Bu:Lu],r.scale.set(0),Ke.stage.addChild(r),bd(r),In(r,t==="X"?Bu:Lu);const n=t==="X"?Cn:Pn;if(n.push({text:r,row:i,col:e}),console.log(`Board after move: ${JSON.stringify(gt)}`),console.log(`symbolArray (${t}):`,n),n.length>=3){if(console.log("----------------------------------------"),console.log(`symbolArray (${t}) length: ${n.length}`,n),console.log("----------------------------------------"),n.length>=4){const h=n.shift();Ke.stage.removeChild(h.text),gt[h.row][h.col]="",console.log(`Removed symbol at row ${h.row}, col ${h.col}`)}const a=n.find(h=>h.text.alpha===1);a&&(console.log(`Fading symbol at row ${a.row}, col ${a.col}, alpha: ${a.text.alpha}`),_d(a.text))}if(Zv(t)){const a=Math.random().toString(36).substring(2,9);Qt.publish({channel:er,message:{type:"gameOver",messageText:`${t} Wins!`,gameOverId:a}}),Ai=a,Qs=!0,Qo(`${t} Wins!`),Ct&&(Ct.textContent=`${t} Wins!`)}else if(Qv()){const a=Math.random().toString(36).substring(2,9);Qt.publish({channel:er,message:{type:"gameOver",messageText:"It's a Draw!",gameOverId:a}}),Ai=a,Qs=!0,Qo("It's a Draw!"),Ct&&(Ct.textContent="Draw!")}}const Gu=document.getElementById("resetButton");Gu?Gu.addEventListener("click",()=>{ku=Qt.getUUID(),_s=!_s;const i=_s?"X":"O";Qt.publish({channel:er,message:{type:"reset",resetInitiator:ku,startingPlayer:i}}),vd(),Zs&&(Et=!1,console.log("Creator: Waiting for Joiner to rejoin after reset, opponentJoined=",Et))}):console.error("Reset button not found in the DOM.");function vd(){gt=[["","",""],["","",""],["","",""]],Pt=_s?"X":"O",Qs=!1,Cn.forEach(e=>Ke.stage.removeChild(e.text)),Pn.forEach(e=>Ke.stage.removeChild(e.text)),Cn=[],Pn=[],Hs=null,Ai=null;const i=[];Ke.stage.children.forEach(e=>{(e.name==="message"||e.name==="messageBackground")&&(i.push(e),console.log(`Found ${e.name} to remove`))}),i.forEach(e=>{Ke.stage.removeChild(e),console.log(`Removed ${e.name} from stage`)}),Ct&&(Ct.textContent=`Player ${Pt}'s Turn`),Ke.stage.removeChild(Ir),jn(),Ke.stage.addChild(Ir),fh(),Ke.renderer.render(Ke.stage),console.log(`After reset: currentPlayer=${Pt}, myPlayer=${At}, opponentJoined=${Et}, creatorStartsNext=${_s}`)}function bd(i){let t=0;Ke.ticker.add(r=>{t+=r*(1e3/60);const n=Math.min(t/200,1);i.scale.set(n),n>=1&&Ke.ticker.remove(bd)})}function In(i,e){let t=0;const r=.05,n=2,a=4;Ke.ticker.add(h=>{t+=h*r,e.outerStrength=n+Math.sin(t)*(a-n)/2,i.parent||Ke.ticker.remove(In)})}function _d(i){const t=i.alpha,r=.1;let n=0;Ke.ticker.add(a=>{n+=a*(1e3/60);const h=n/1e3;i.alpha=t-(t-r)*h,h>=1&&(i.alpha=r,Ke.ticker.remove(_d))})}function Zv(i){for(let e=0;e<vr;e++)if(gt[e][0]===i&&gt[e][1]===i&&gt[e][2]===i)return!0;for(let e=0;e<vr;e++)if(gt[0][e]===i&&gt[1][e]===i&&gt[2][e]===i)return!0;return gt[0][0]===i&&gt[1][1]===i&&gt[2][2]===i||gt[0][2]===i&&gt[1][1]===i&&gt[2][0]===i}function Qv(){return gt.every(i=>i.every(e=>e!==""))}function Qo(i){console.log(`Displaying message: ${i}`);const e=new Gn(i,{fontFamily:"Orbitron",fontSize:et*.1,fill:16448250,fontWeight:"700",align:"center"});e.name="message",e.anchor.set(.5),e.x=et/2,e.y=et/2;const t=new Ti({color:16749824,outerStrength:3,distance:15,quality:.1});e.filters=[t];const r=new si;r.name="messageBackground",r.lineStyle(4,16749824,1),r.beginFill(0);const n=e.width,a=e.height,h=20,l=n+h*2,c=a+h*2;r.drawRect(-l/2,-c/2,l,c),r.endFill(),r.x=et/2,r.y=et/2;const d=new Ti({color:16749824,outerStrength:3,distance:15,quality:.1});r.filters=[d],Ke.stage.addChild(r),Ke.stage.addChild(e),In(e,t),In(r,d),Ke.renderer.render(Ke.stage)}const xd=()=>{et=ph(),yt=et/vr,Ke.renderer.resize(et,et),fh(),jn();const i=gh();[...Cn,...Pn].forEach(({text:t,row:r,col:n})=>{t.style.fontSize=i,t.x=n*yt+yt/2,t.y=r*yt+yt/2});const e=[];Ke.stage.children.forEach(t=>{(t.name==="message"||t.name==="messageBackground")&&e.push(t)}),e.forEach(t=>{t.name==="message"?(t.style.fontSize=et*.1,t.x=et/2,t.y=et/2):t.name==="messageBackground"&&(t.x=et/2,t.y=et/2)}),console.log(`Canvas dimensions after resize: width=${Ke.view.width}, height=${Ke.view.height}`)};window.addEventListener("resize",xd);xd();document.addEventListener("DOMContentLoaded",()=>{const i=document.getElementById("snakeOverlay");if(!i){console.error("snakeOverlay element not found in the DOM.");return}const e=620,t=250,r=30,n=()=>{const x=window.innerWidth-r,S=window.innerHeight-r,w=Math.min(x,S);return Math.max(t,Math.min(e,w))};let a=n();const h=new hh({width:a,height:a,backgroundAlpha:0,antialias:!0,resizeTo:void 0});i.innerHTML="",i.appendChild(h.view);const l=[],c=10;let d=a*.02;for(let x=0;x<c;x++){const S=new si;S.beginFill(16711935),S.drawRect(0,0,d,d),S.endFill(),h.stage.addChild(S),l.push(S)}let g=0;const v=2;h.ticker.add(x=>{g+=v*x;for(let S=0;S<l.length;S++){const w=(g-S*10)%(2*(a-d+a-d)),T=b(w);l[S].x=T.x,l[S].y=T.y}});function b(x){const S=a-d,w=a-d,T=2*(S+w);return x%=T,x<S?{x,y:0}:x<S+w?{x:S,y:x-S}:x<2*S+w?{x:2*S+w-x,y:w}:{x:0,y:T-x}}const y=()=>{a=n(),h.renderer.resize(a,a),d=a*.01,l.forEach(x=>{x.clear(),x.beginFill(16711935),x.drawRect(0,0,d,d),x.endFill()}),console.log(`Snake canvas resized to ${a}x${a}, segmentSize: ${d}`)};window.addEventListener("resize",y),y()});
